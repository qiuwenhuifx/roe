(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.videojsContribHls=e()}})(function(){var s,e,t;return function a(s,o,u){function f(i,e){if(!o[i]){if(!s[i]){var t=typeof require=="function"&&require;if(!e&&t)return t(i,!0);if(d)return d(i,!0);var r=new Error("Cannot find module '"+i+"'");throw r.code="MODULE_NOT_FOUND",r}var n=o[i]={exports:{}};s[i][0].call(n.exports,function(e){var t=s[i][1][e];return f(t?t:e)},n,n.exports,a,s,o,u)}return o[i].exports}var d=typeof require=="function"&&require;for(var e=0;e<u.length;e++)f(u[e]);return f}({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var c=function(){function i(e,t){var i=[];var r=true;var n=false;var a=undefined;try{for(var s=e[Symbol.iterator](),o;!(r=(o=s.next()).done);r=true){i.push(o.value);if(t&&i.length===t)break}}catch(e){n=true;a=e}finally{try{if(!r&&s["return"])s["return"]()}finally{if(n)throw a}}return i}return function(e,t){if(Array.isArray(e)){return e}else if(Symbol.iterator in Object(e)){return i(e,t)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();function r(e){return e&&e.__esModule?e:{default:e}}var n=e("global/window");var h=r(n);var p=function e(t,i){var r=t.cues;for(var n=0;n<r.length;n++){var a=r[n];if(i>=a.adStartTime&&i<=a.adEndTime){return a}}return null};var a=function e(t,i){var r=arguments.length<=2||arguments[2]===undefined?0:arguments[2];if(!t.segments){return}var n=r;var a=undefined;for(var s=0;s<t.segments.length;s++){var o=t.segments[s];if(!a){a=p(i,n+o.duration/2)}if(a){if("cueIn"in o){a.endTime=n;a.adEndTime=n;n+=o.duration;a=null;continue}if(n<a.endTime){n+=o.duration;continue}a.endTime+=o.duration}else{if("cueOut"in o){a=new h["default"].VTTCue(n,n+o.duration,o.cueOut);a.adStartTime=n;a.adEndTime=n+parseFloat(o.cueOut);i.addCue(a)}if("cueOutCont"in o){var u=undefined;var f=undefined;var d=o.cueOutCont.split("/").map(parseFloat);var l=c(d,2);u=l[0];f=l[1];a=new h["default"].VTTCue(n,n+o.duration,"");a.adStartTime=n-u;a.adEndTime=a.adStartTime+f;i.addCue(a)}}n+=o.duration}};i["default"]={updateAdCues:a,findAdCue:p};t.exports=i["default"]},{"global/window":32}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function e(t,i){return t.start(i)+"-"+t.end(i)};var u=function e(t,i){var r=t.toString(16);return"00".substring(0,2-r.length)+r+(i%2?" ":"")};var f=function e(t){if(t>=32&&t<126){return String.fromCharCode(t)}return"."};var r=function e(i){var r={};Object.keys(i).forEach(function(e){var t=i[e];if(ArrayBuffer.isView(t)){r[e]={bytes:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength}}else{r[e]=t}});return r};var a=function e(t){var i=t.byterange||{length:Infinity,offset:0};return[i.length,i.offset,t.resolvedUri].join(",")};var s={hexDump:function e(t){var i=Array.prototype.slice.call(t);var r=16;var n="";var a=undefined;var s=undefined;for(var o=0;o<i.length/r;o++){a=i.slice(o*r,o*r+r).map(u).join("");s=i.slice(o*r,o*r+r).map(f).join("");n+=a+" "+s+"\n"}return n},tagDump:function e(t){return s.hexDump(t.bytes)},textRanges:function e(t){var i="";var r=undefined;for(r=0;r<t.length;r++){i+=n(t,r)+" "}return i},createTransferableMessage:r,initSegmentId:a};i["default"]=s;t.exports=i["default"]},{}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i["default"]={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,GOAL_BUFFER_LENGTH_RATE:1,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,BUFFER_LOW_WATER_LINE_RATE:1};t.exports=i["default"]},{}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});function r(e){return e&&e.__esModule?e:{default:e}}var n=e("global/window");var a=r(n);var s=e("aes-decrypter");var o=e("./bin-utils");var u=function e(t){t.onmessage=function(e){var i=e.data;var t=new Uint8Array(i.encrypted.bytes,i.encrypted.byteOffset,i.encrypted.byteLength);var r=new Uint32Array(i.key.bytes,i.key.byteOffset,i.key.byteLength/4);var n=new Uint32Array(i.iv.bytes,i.iv.byteOffset,i.iv.byteLength/4);new s.Decrypter(t,r,n,function(e,t){a["default"].postMessage((0,o.createTransferableMessage)({source:i.source,decrypted:t}),[t.buffer])})}};i["default"]=function(e){return new u(e)};t.exports=i["default"]},{"./bin-utils":2,"aes-decrypter":25,"global/window":32}],5:[function(G,e,H){(function(e){"use strict";Object.defineProperty(H,"__esModule",{value:true});var t=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var h=function e(t,i,r){var n=true;e:while(n){var a=t,s=i,o=r;n=false;if(a===null)a=Function.prototype;var u=Object.getOwnPropertyDescriptor(a,s);if(u===undefined){var f=Object.getPrototypeOf(a);if(f===null){return undefined}else{t=f;i=s;r=o;n=true;u=f=undefined;continue e}}else if("value"in u){return u.value}else{var d=u.get;if(d===undefined){return undefined}return d.call(o)}}};function i(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function r(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var n=G("./playlist-loader");var m=i(n);var s=G("./playlist.js");var a=G("./segment-loader");var g=i(a);var o=G("./vtt-segment-loader");var v=i(o);var u=G("./ranges");var f=i(u);var d=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var y=i(d);var l=G("./ad-cue-tags");var _=i(l);var c=G("./sync-controller");var b=i(c);var T=G("videojs-contrib-media-sources/es5/codec-utils");var w=G("webwackify");var S=i(w);var k=G("./decrypter-worker");var O=i(k);var E=G("./config");var A=i(E);var L=G("./util/codecs.js");var P=G("./media-groups");var I=60*2;var C=undefined;var U={videoCodec:"avc1",videoObjectTypeIndicator:".4d400d",audioProfile:"2"};var D=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred"];var M=function e(t){return this.audioSegmentLoader_[t]+this.mainSegmentLoader_[t]};var x=function e(){var t=undefined;try{t=G.resolve("./decrypter-worker")}catch(e){}return t};var R=function e(t){return t.replace(/avc1\.(\d+)\.(\d+)/i,function(e){return(0,T.translateLegacyCodecs)([e])[0]})};H.mapLegacyAvcCodecs_=R;var B=function e(t,i,r){return t+"/"+i+'; codecs="'+r.filter(function(e){return!!e}).join(", ")+'"'};var j=function e(t){if(t.segments&&t.segments.length&&t.segments[0].map){return"mp4"}return"mp2t"};var N=function e(t){var i=t.attributes||{};if(i.CODECS){return(0,L.parseCodecs)(i.CODECS)}return U};var F=function e(t,i){var r=j(i);var n=N(i);var a=i.attributes||{};var s=true;var o=false;if(!i){return[]}if(t.mediaGroups.AUDIO&&a.AUDIO){var u=t.mediaGroups.AUDIO[a.AUDIO];if(u){o=true;s=false;for(var f in u){if(!u[f].uri){s=true;break}}}}if(o&&!n.audioProfile){y["default"].log.warn("Multiple audio tracks present but no audio codec string is specified. "+"Attempting to use the default audio codec (mp4a.40.2)");n.audioProfile=U.audioProfile}var d={};if(n.videoCodec){d.video=""+n.videoCodec+n.videoObjectTypeIndicator}if(n.audioProfile){d.audio="mp4a.40."+n.audioProfile}var l=B("audio",r,[d.audio]);var c=B("video",r,[d.video]);var h=B("video",r,[d.video,d.audio]);if(o){if(!s&&d.video){return[c,l]}return[h,l]}if(!d.video){return[l]}return[h]};H.mimeTypesForPlaylist_=F;var q=function(e){r(c,e);function c(e){var t=this;p(this,c);h(Object.getPrototypeOf(c.prototype),"constructor",this).call(this);var i=e.url;var r=e.withCredentials;var n=e.mode;var a=e.tech;var s=e.bandwidth;var o=e.externHls;var u=e.useCueTags;var f=e.blacklistDuration;var d=e.enableLowInitialPlaylist;if(!i){throw new Error("A non-empty playlist URL is required")}C=o;this.withCredentials=r;this.tech_=a;this.hls_=a.hls;this.mode_=n;this.useCueTags_=u;this.blacklistDuration=f;this.enableLowInitialPlaylist=d;if(this.useCueTags_){this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues");this.cueTagsTrack_.inBandMetadataTrackDispatchType=""}this.requestOptions_={withCredentials:this.withCredentials,timeout:null};this.mediaTypes_=(0,P.createMediaTypes)();this.mediaSource=new y["default"].MediaSource({mode:n});this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_.bind(this));this.seekable_=y["default"].createTimeRanges();this.hasPlayed_=function(){return false};this.syncController_=new b["default"](e);this.segmentMetadataTrack_=a.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},false).track;this.decrypter_=(0,S["default"])(O["default"],x());var l={hls:this.hls_,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:function e(){return t.seekable()},seeking:function e(){return t.tech_.seeking()},duration:function e(){return t.mediaSource.duration},hasPlayed:function e(){return t.hasPlayed_()},goalBufferLength:function e(){return t.goalBufferLength()},bandwidth:s,syncController:this.syncController_,decrypter:this.decrypter_};this.masterPlaylistLoader_=new m["default"](i,this.hls_,this.withCredentials);this.setupMasterPlaylistLoaderListeners_();this.mainSegmentLoader_=new g["default"](y["default"].mergeOptions(l,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),e);this.audioSegmentLoader_=new g["default"](y["default"].mergeOptions(l,{loaderType:"audio"}),e);this.subtitleSegmentLoader_=new v["default"](y["default"].mergeOptions(l,{loaderType:"vtt"}),e);this.setupSegmentLoaderListeners_();D.forEach(function(e){t[e+"_"]=M.bind(t,e)});this.masterPlaylistLoader_.load()}t(c,[{key:"setupMasterPlaylistLoaderListeners_",value:function e(){var i=this;this.masterPlaylistLoader_.on("loadedmetadata",function(){var e=i.masterPlaylistLoader_.media();var t=i.masterPlaylistLoader_.targetDuration*1.5*1e3;if((0,s.isLowestEnabledRendition)(i.masterPlaylistLoader_.master,i.masterPlaylistLoader_.media())){i.requestOptions_.timeout=0}else{i.requestOptions_.timeout=t}if(e.endList&&i.tech_.preload()!=="none"){i.mainSegmentLoader_.playlist(e,i.requestOptions_);i.mainSegmentLoader_.load()}(0,P.setupMediaGroups)({segmentLoaders:{AUDIO:i.audioSegmentLoader_,SUBTITLES:i.subtitleSegmentLoader_,main:i.mainSegmentLoader_},tech:i.tech_,requestOptions:i.requestOptions_,masterPlaylistLoader:i.masterPlaylistLoader_,mode:i.mode_,hls:i.hls_,master:i.master(),mediaTypes:i.mediaTypes_,blacklistCurrentPlaylist:i.blacklistCurrentPlaylist.bind(i)});i.triggerPresenceUsage_(i.master(),e);try{i.setupSourceBuffers_()}catch(e){y["default"].log.warn("Failed to create SourceBuffers",e);return i.mediaSource.endOfStream("decode")}i.setupFirstPlay();i.trigger("selectedinitialmedia")});this.masterPlaylistLoader_.on("loadedplaylist",function(){var e=i.masterPlaylistLoader_.media();if(!e){var t=undefined;if(i.enableLowInitialPlaylist){t=i.selectInitialPlaylist()}if(!t){t=i.selectPlaylist()}i.initialMedia_=t;i.masterPlaylistLoader_.media(i.initialMedia_);return}if(i.useCueTags_){i.updateAdCues_(e)}i.mainSegmentLoader_.playlist(e,i.requestOptions_);i.updateDuration();if(!i.tech_.paused()){i.mainSegmentLoader_.load()}if(!e.endList){(function(){var t=function e(){var t=i.seekable();if(t.length!==0){i.mediaSource.addSeekableRange_(t.start(0),t.end(0))}};if(i.duration()!==Infinity){(function(){var e=function e(){if(i.duration()===Infinity){t()}else{i.tech_.one("durationchange",e)}};i.tech_.one("durationchange",e)})()}else{t()}})()}});this.masterPlaylistLoader_.on("error",function(){i.blacklistCurrentPlaylist(i.masterPlaylistLoader_.error)});this.masterPlaylistLoader_.on("mediachanging",function(){i.mainSegmentLoader_.abort();i.mainSegmentLoader_.pause()});this.masterPlaylistLoader_.on("mediachange",function(){var e=i.masterPlaylistLoader_.media();var t=i.masterPlaylistLoader_.targetDuration*1.5*1e3;if((0,s.isLowestEnabledRendition)(i.masterPlaylistLoader_.master,i.masterPlaylistLoader_.media())){i.requestOptions_.timeout=0}else{i.requestOptions_.timeout=t}i.mainSegmentLoader_.playlist(e,i.requestOptions_);i.mainSegmentLoader_.load();i.tech_.trigger({type:"mediachange",bubbles:true})});this.masterPlaylistLoader_.on("playlistunchanged",function(){var e=i.masterPlaylistLoader_.media();var t=i.stuckAtPlaylistEnd_(e);if(t){i.blacklistCurrentPlaylist({message:"Playlist no longer updating."});i.tech_.trigger("playliststuck")}});this.masterPlaylistLoader_.on("renditiondisabled",function(){i.tech_.trigger({type:"usage",name:"hls-rendition-disabled"})});this.masterPlaylistLoader_.on("renditionenabled",function(){i.tech_.trigger({type:"usage",name:"hls-rendition-enabled"})})}},{key:"triggerPresenceUsage_",value:function e(t,i){var r=t.mediaGroups||{};var n=true;var a=Object.keys(r.AUDIO);for(var s in r.AUDIO){for(var o in r.AUDIO[s]){var u=r.AUDIO[s][o];if(!u.uri){n=false}}}if(n){this.tech_.trigger({type:"usage",name:"hls-demuxed"})}if(Object.keys(r.SUBTITLES).length){this.tech_.trigger({type:"usage",name:"hls-webvtt"})}if(C.Playlist.isAes(i)){this.tech_.trigger({type:"usage",name:"hls-aes"})}if(C.Playlist.isFmp4(i)){this.tech_.trigger({type:"usage",name:"hls-fmp4"})}if(a.length&&Object.keys(r.AUDIO[a[0]]).length>1){this.tech_.trigger({type:"usage",name:"hls-alternate-audio"})}if(this.useCueTags_){this.tech_.trigger({type:"usage",name:"hls-playlist-cue-tags"})}}},{key:"setupSegmentLoaderListeners_",value:function e(){var a=this;this.mainSegmentLoader_.on("bandwidthupdate",function(){var e=a.selectPlaylist();var t=a.masterPlaylistLoader_.media();var i=a.tech_.buffered();var r=i.length?i.end(i.length-1)-a.tech_.currentTime():0;var n=a.bufferLowWaterLine();if(!t.endList||a.duration()<A["default"].MAX_BUFFER_LOW_WATER_LINE||e.attributes.BANDWIDTH<t.attributes.BANDWIDTH||r>=n){a.masterPlaylistLoader_.media(e)}a.tech_.trigger("bandwidthupdate")});this.mainSegmentLoader_.on("progress",function(){a.trigger("progress")});this.mainSegmentLoader_.on("error",function(){a.blacklistCurrentPlaylist(a.mainSegmentLoader_.error())});this.mainSegmentLoader_.on("syncinfoupdate",function(){a.onSyncInfoUpdate_()});this.mainSegmentLoader_.on("timestampoffset",function(){a.tech_.trigger({type:"usage",name:"hls-timestamp-offset"})});this.audioSegmentLoader_.on("syncinfoupdate",function(){a.onSyncInfoUpdate_()});this.mainSegmentLoader_.on("ended",function(){a.onEndOfStream()});this.mainSegmentLoader_.on("earlyabort",function(){a.blacklistCurrentPlaylist({message:"Aborted early because there isn't enough bandwidth to complete the "+"request without rebuffering."},I)});this.mainSegmentLoader_.on("reseteverything",function(){a.tech_.trigger("hls-reset")});this.mainSegmentLoader_.on("segmenttimemapping",function(e){a.tech_.trigger({type:"hls-segment-time-mapping",mapping:e.mapping})});this.audioSegmentLoader_.on("ended",function(){a.onEndOfStream()})}},{key:"mediaSecondsLoaded_",value:function e(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}},{key:"load",value:function e(){this.mainSegmentLoader_.load();if(this.mediaTypes_.AUDIO.activePlaylistLoader){this.audioSegmentLoader_.load()}if(this.mediaTypes_.SUBTITLES.activePlaylistLoader){this.subtitleSegmentLoader_.load()}}},{key:"fastQualityChange_",value:function e(){var t=this.selectPlaylist();if(t!==this.masterPlaylistLoader_.media()){this.masterPlaylistLoader_.media(t);this.mainSegmentLoader_.resetLoader()}}},{key:"play",value:function e(){if(this.setupFirstPlay()){return}if(this.tech_.ended()){this.tech_.setCurrentTime(0)}if(this.hasPlayed_()){this.load()}var t=this.tech_.seekable();if(this.tech_.duration()===Infinity){if(this.tech_.currentTime()<t.start(0)){return this.tech_.setCurrentTime(t.end(t.length-1))}}}},{key:"setupFirstPlay",value:function e(){var t=this;var i=this.masterPlaylistLoader_.media();if(!i||this.tech_.paused()||this.hasPlayed_()){return false}if(!i.endList){var r=function(){var e=t.seekable();if(!e.length){return{v:false}}if(y["default"].browser.IE_VERSION&&t.mode_==="html5"&&t.tech_.readyState()===0){t.tech_.one("loadedmetadata",function(){t.trigger("firstplay");t.tech_.setCurrentTime(e.end(0));t.hasPlayed_=function(){return true}});return{v:false}}t.trigger("firstplay");t.tech_.setCurrentTime(e.end(0))}();if(typeof r==="object")return r.v}this.hasPlayed_=function(){return true};this.load();return true}},{key:"handleSourceOpen_",value:function e(){try{this.setupSourceBuffers_()}catch(e){y["default"].log.warn("Failed to create Source Buffers",e);return this.mediaSource.endOfStream("decode")}if(this.tech_.autoplay()){var t=this.tech_.play();if(typeof t!=="undefined"&&typeof t.then==="function"){t.then(null,function(e){})}}this.trigger("sourceopen")}},{key:"onEndOfStream",value:function e(){var t=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader){t=t&&this.audioSegmentLoader_.ended_}if(t){this.mediaSource.endOfStream()}}},{key:"stuckAtPlaylistEnd_",value:function e(t){var i=this.seekable();if(!i.length){return false}var r=this.syncController_.getExpiredTime(t,this.mediaSource.duration);if(r===null){return false}var n=C.Playlist.playlistEnd(t,r);var a=this.tech_.currentTime();var s=this.tech_.buffered();if(!s.length){return n-a<=f["default"].SAFE_TIME_DELTA}var o=s.end(s.length-1);return o-a<=f["default"].SAFE_TIME_DELTA&&n-o<=f["default"].SAFE_TIME_DELTA}},{key:"blacklistCurrentPlaylist",value:function e(t,i){if(t===undefined)t={};var r=undefined;var n=undefined;r=t.playlist||this.masterPlaylistLoader_.media();i=i||t.blacklistDuration||this.blacklistDuration;if(!r){this.error=t;try{return this.mediaSource.endOfStream("network")}catch(e){return this.trigger("error")}}var a=this.masterPlaylistLoader_.master.playlists.filter(s.isEnabled).length===1;if(a){y["default"].log.warn("Problem encountered with the current "+"HLS playlist. Trying again since it is the final playlist.");this.tech_.trigger("retryplaylist");return this.masterPlaylistLoader_.load(a)}r.excludeUntil=Date.now()+i*1e3;this.tech_.trigger("blacklistplaylist");this.tech_.trigger({type:"usage",name:"hls-rendition-blacklisted"});n=this.selectPlaylist();y["default"].log.warn("Problem encountered with the current HLS playlist."+(t.message?" "+t.message:"")+" Switching to another playlist.");return this.masterPlaylistLoader_.media(n)}},{key:"pauseLoading",value:function e(){this.mainSegmentLoader_.pause();if(this.mediaTypes_.AUDIO.activePlaylistLoader){this.audioSegmentLoader_.pause()}if(this.mediaTypes_.SUBTITLES.activePlaylistLoader){this.subtitleSegmentLoader_.pause()}}},{key:"setCurrentTime",value:function e(t){var i=f["default"].findRange(this.tech_.buffered(),t);if(!(this.masterPlaylistLoader_&&this.masterPlaylistLoader_.media())){return 0}if(!this.masterPlaylistLoader_.media().segments){return 0}if(i&&i.length&&this.mode_!=="flash"){return t}this.mainSegmentLoader_.resetEverything();this.mainSegmentLoader_.abort();if(this.mediaTypes_.AUDIO.activePlaylistLoader){this.audioSegmentLoader_.resetEverything();this.audioSegmentLoader_.abort()}if(this.mediaTypes_.SUBTITLES.activePlaylistLoader){this.subtitleSegmentLoader_.resetEverything();this.subtitleSegmentLoader_.abort()}this.load()}},{key:"duration",value:function e(){if(!this.masterPlaylistLoader_){return 0}if(this.mediaSource){return this.mediaSource.duration}return C.Playlist.duration(this.masterPlaylistLoader_.media())}},{key:"seekable",value:function e(){return this.seekable_}},{key:"onSyncInfoUpdate_",value:function e(){var t=undefined;var i=undefined;if(!this.masterPlaylistLoader_){return}var r=this.masterPlaylistLoader_.media();if(!r){return}var n=this.syncController_.getExpiredTime(r,this.mediaSource.duration);if(n===null){return}t=C.Playlist.seekable(r,n);if(t.length===0){return}if(this.mediaTypes_.AUDIO.activePlaylistLoader){r=this.mediaTypes_.AUDIO.activePlaylistLoader.media();n=this.syncController_.getExpiredTime(r,this.mediaSource.duration);if(n===null){return}i=C.Playlist.seekable(r,n);if(i.length===0){return}}if(!i){this.seekable_=t}else if(i.start(0)>t.end(0)||t.start(0)>i.end(0)){this.seekable_=t}else{this.seekable_=y["default"].createTimeRanges([[i.start(0)>t.start(0)?i.start(0):t.start(0),i.end(0)<t.end(0)?i.end(0):t.end(0)]])}this.tech_.trigger("seekablechanged")}},{key:"updateDuration",value:function e(){var t=this;var i=this.mediaSource.duration;var r=C.Playlist.duration(this.masterPlaylistLoader_.media());var n=this.tech_.buffered();var a=function e(){t.mediaSource.duration=r;t.tech_.trigger("durationchange");t.mediaSource.removeEventListener("sourceopen",e)};if(n.length>0){r=Math.max(r,n.end(n.length-1))}if(i!==r){if(this.mediaSource.readyState!=="open"){this.mediaSource.addEventListener("sourceopen",a)}else{a()}}}},{key:"dispose",value:function e(){var r=this;this.decrypter_.terminate();this.masterPlaylistLoader_.dispose();this.mainSegmentLoader_.dispose();["AUDIO","SUBTITLES"].forEach(function(e){var t=r.mediaTypes_[e].groups;for(var i in t){t[i].forEach(function(e){if(e.playlistLoader){e.playlistLoader.dispose()}})}});this.audioSegmentLoader_.dispose();this.subtitleSegmentLoader_.dispose()}},{key:"master",value:function e(){return this.masterPlaylistLoader_.master}},{key:"media",value:function e(){return this.masterPlaylistLoader_.media()||this.initialMedia_}},{key:"setupSourceBuffers_",value:function e(){var t=this.masterPlaylistLoader_.media();var i=undefined;if(!t||this.mediaSource.readyState!=="open"){return}i=F(this.masterPlaylistLoader_.master,t);if(i.length<1){this.error="No compatible SourceBuffer configuration for the variant stream:"+t.resolvedUri;return this.mediaSource.endOfStream("decode")}this.mainSegmentLoader_.mimeType(i[0]);if(i[1]){this.audioSegmentLoader_.mimeType(i[1])}this.excludeIncompatibleVariants_(t)}},{key:"excludeIncompatibleVariants_",value:function e(t){var i=this.masterPlaylistLoader_.master;var r=2;var n=null;var a=undefined;if(t.attributes.CODECS){a=(0,L.parseCodecs)(t.attributes.CODECS);n=a.videoCodec;r=a.codecCount}i.playlists.forEach(function(e){var t={codecCount:2,videoCodec:null};if(e.attributes.CODECS){var i=e.attributes.CODECS;t=(0,L.parseCodecs)(i);if(window.MediaSource&&window.MediaSource.isTypeSupported&&!window.MediaSource.isTypeSupported('video/mp4; codecs="'+R(i)+'"')){e.excludeUntil=Infinity}}if(t.codecCount!==r){e.excludeUntil=Infinity}if(t.videoCodec!==n){e.excludeUntil=Infinity}})}},{key:"updateAdCues_",value:function e(t){var i=0;var r=this.seekable();if(r.length){i=r.start(0)}_["default"].updateAdCues(t,this.cueTagsTrack_,i)}},{key:"goalBufferLength",value:function e(){var t=this.tech_.currentTime();var i=A["default"].GOAL_BUFFER_LENGTH;var r=A["default"].GOAL_BUFFER_LENGTH_RATE;var n=Math.max(i,A["default"].MAX_GOAL_BUFFER_LENGTH);return Math.min(i+t*r,n)}},{key:"bufferLowWaterLine",value:function e(){var t=this.tech_.currentTime();var i=A["default"].BUFFER_LOW_WATER_LINE;var r=A["default"].BUFFER_LOW_WATER_LINE_RATE;var n=Math.max(i,A["default"].MAX_BUFFER_LOW_WATER_LINE);return Math.min(i+t*r,n)}}]);return c}(y["default"].EventTarget);H.MasterPlaylistController=q}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ad-cue-tags":1,"./config":3,"./decrypter-worker":4,"./media-groups":6,"./playlist-loader":9,"./playlist.js":11,"./ranges":12,"./segment-loader":16,"./sync-controller":18,"./util/codecs.js":19,"./vtt-segment-loader":20,"videojs-contrib-media-sources/es5/codec-utils":65,webwackify:76}],6:[function(o,e,u){(function(e){"use strict";Object.defineProperty(u,"__esModule",{value:true});function t(e){return e&&e.__esModule?e:{default:e}}var i=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var g=t(i);var r=o("./playlist-loader");var v=t(r);var n=function e(){};var y=function e(t){var i=t["default"]?"main":"alternative";if(t.characteristics&&t.characteristics.indexOf("public.accessibility.describes-video")>=0){i="main-desc"}return i};var d=function e(t,i){t.abort();t.pause();if(i&&i.activePlaylistLoader){i.activePlaylistLoader.pause();i.activePlaylistLoader=null}};u.stopLoaders=d;var f=function e(t,i){i.activePlaylistLoader=t;t.load()};u.startLoaders=f;var l=function e(o,u){return function(){var e=u.segmentLoaders;var t=e[o];var i=e.main;var r=u.mediaTypes[o];var n=r.activeTrack();var a=r.activeGroup(n);var s=r.activePlaylistLoader;d(t,r);if(!a){return}if(!a.playlistLoader){if(s){i.resetEverything()}return}t.resyncLoader();f(a.playlistLoader,r)}};u.onGroupChanged=l;var c=function e(o,u){return function(){var e=u.segmentLoaders;var t=e[o];var i=e.main;var r=u.mediaTypes[o];var n=r.activeTrack();var a=r.activeGroup(n);var s=r.activePlaylistLoader;d(t,r);if(!a){return}if(!a.playlistLoader){i.resetEverything();return}if(s===a.playlistLoader){f(a.playlistLoader,r);return}if(t.track){t.track(n)}t.resetEverything();f(a.playlistLoader,r)}};u.onTrackChanged=c;var _={AUDIO:function e(u,f){return function(){var e=f.segmentLoaders[u];var t=f.mediaTypes[u];var i=f.blacklistCurrentPlaylist;d(e,t);var r=t.activeTrack();var n=t.activeGroup();var a=(n.filter(function(e){return e["default"]})[0]||n[0]).id;var s=t.tracks[a];if(r===s){i({message:"Problem encountered loading the default audio track."});return}g["default"].log.warn("Problem encountered loading the alternate audio track."+"Switching back to default.");for(var o in t.tracks){t.tracks[o].enabled=t.tracks[o]===s}t.onTrackChanged()}},SUBTITLES:function e(r,n){return function(){var e=n.segmentLoaders[r];var t=n.mediaTypes[r];g["default"].log.warn("Problem encountered loading the subtitle track."+"Disabling subtitle track.");d(e,t);var i=t.activeTrack();if(i){i.mode="disabled"}t.onTrackChanged()}}};u.onError=_;var b={AUDIO:function e(t,i,r){if(!i){return}var n=r.tech;var a=r.requestOptions;var s=r.segmentLoaders[t];i.on("loadedmetadata",function(){var e=i.media();s.playlist(e,a);if(!n.paused()||e.endList&&n.preload()!=="none"){s.load()}});i.on("loadedplaylist",function(){s.playlist(i.media(),a);if(!n.paused()){s.load()}});i.on("error",_[t](t,r))},SUBTITLES:function e(t,i,r){var n=r.tech;var a=r.requestOptions;var s=r.segmentLoaders[t];var o=r.mediaTypes[t];i.on("loadedmetadata",function(){var e=i.media();s.playlist(e,a);s.track(o.activeTrack());if(!n.paused()||e.endList&&n.preload()!=="none"){s.load()}});i.on("loadedplaylist",function(){s.playlist(i.media(),a);if(!n.paused()){s.load()}});i.on("error",_[t](t,r))}};u.setupListeners=b;var h={AUDIO:function e(t,i){var r=i.mode;var n=i.hls;var a=i.segmentLoaders[t];var s=i.requestOptions.withCredentials;var o=i.master.mediaGroups;var u=i.mediaTypes[t];var f=u.groups;var d=u.tracks;if(!o[t]||Object.keys(o[t]).length===0||r!=="html5"){o[t]={main:{default:{default:true}}}}for(var l in o[t]){if(!f[l]){f[l]=[]}for(var c in o[t][l]){var h=o[t][l][c];var p=undefined;if(h.resolvedUri){p=new v["default"](h.resolvedUri,n,s)}else{p=null}h=g["default"].mergeOptions({id:c,playlistLoader:p},h);b[t](t,h.playlistLoader,i);f[l].push(h);if(typeof d[c]==="undefined"){var m=new g["default"].AudioTrack({id:c,kind:y(h),enabled:false,language:h.language,default:h["default"],label:c});d[c]=m}}}a.on("error",_[t](t,i))},SUBTITLES:function e(t,i){var r=i.tech;var n=i.hls;var a=i.segmentLoaders[t];var s=i.requestOptions.withCredentials;var o=i.master.mediaGroups;var u=i.mediaTypes[t];var f=u.groups;var d=u.tracks;for(var l in o[t]){if(!f[l]){f[l]=[]}for(var c in o[t][l]){if(o[t][l][c].forced){continue}var h=o[t][l][c];h=g["default"].mergeOptions({id:c,playlistLoader:new v["default"](h.resolvedUri,n,s)},h);b[t](t,h.playlistLoader,i);f[l].push(h);if(typeof d[c]==="undefined"){var p=r.addRemoteTextTrack({id:c,kind:"subtitles",enabled:false,language:h.language,label:c},false).track;d[c]=p}}}a.on("error",_[t](t,i))},"CLOSED-CAPTIONS":function e(t,i){var r=i.tech;var n=i.master.mediaGroups;var a=i.mediaTypes[t];var s=a.groups;var o=a.tracks;for(var u in n[t]){if(!s[u]){s[u]=[]}for(var f in n[t][u]){var d=n[t][u][f];if(!d.instreamId.match(/CC\d/)){continue}s[u].push(g["default"].mergeOptions({id:f},d));if(typeof o[f]==="undefined"){var l=r.addRemoteTextTrack({id:d.instreamId,kind:"captions",enabled:false,language:d.language,label:f},false).track;o[f]=l}}}}};u.initialize=h;var p=function e(a,s){return function(t){var e=s.masterPlaylistLoader;var i=s.mediaTypes[a].groups;var r=e.media();if(!r){return null}var n=null;if(r.attributes[a]){n=i[r.attributes[a]]}n=n||i.main;if(typeof t==="undefined"){return n}if(t===null){return null}return n.filter(function(e){return e.id===t.id})[0]||null}};u.activeGroup=p;var m={AUDIO:function e(i,r){return function(){var e=r.mediaTypes[i].tracks;for(var t in e){if(e[t].enabled){return e[t]}}return null}},SUBTITLES:function e(i,r){return function(){var e=r.mediaTypes[i].tracks;for(var t in e){if(e[t].mode==="showing"){return e[t]}}return null}}};u.activeTrack=m;var a=function e(t){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(e){h[e](e,t)});var i=t.mediaTypes;var r=t.masterPlaylistLoader;var n=t.tech;var a=t.hls;["AUDIO","SUBTITLES"].forEach(function(e){i[e].activeGroup=p(e,t);i[e].activeTrack=m[e](e,t);i[e].onGroupChanged=l(e,t);i[e].onTrackChanged=c(e,t)});var s=i.AUDIO.activeGroup();var o=(s.filter(function(e){return e["default"]})[0]||s[0]).id;i.AUDIO.tracks[o].enabled=true;i.AUDIO.onTrackChanged();r.on("mediachange",function(){["AUDIO","SUBTITLES"].forEach(function(e){return i[e].onGroupChanged()})});var u=function e(){i.AUDIO.onTrackChanged();n.trigger({type:"usage",name:"hls-audio-change"})};n.audioTracks().addEventListener("change",u);n.remoteTextTracks().addEventListener("change",i.SUBTITLES.onTrackChanged);a.on("dispose",function(){n.audioTracks().removeEventListener("change",u);n.remoteTextTracks().removeEventListener("change",i.SUBTITLES.onTrackChanged)});n.clearTracks("audio");for(var f in i.AUDIO.tracks){n.audioTracks().addTrack(i.AUDIO.tracks[f])}};u.setupMediaGroups=a;var s=function e(){var t={};["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(e){t[e]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:n,activeTrack:n,onGroupChanged:n,onTrackChanged:n}});return t};u.createMediaTypes=s}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./playlist-loader":9}],7:[function(c,e,h){(function(e){"use strict";Object.defineProperty(h,"__esModule",{value:true});function t(e){return e&&e.__esModule?e:{default:e}}var i=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var y=t(i);var s=c("./bin-utils");var o={FAILURE:2,TIMEOUT:-101,ABORTED:-102};h.REQUEST_ERRORS=o;var r=function e(t){var i=undefined;var r=undefined;r=t.offset+t.length-1;i=t.offset;return"bytes="+i+"-"+r};var _=function e(t){var i={};if(t.byterange){i.Range=r(t.byterange)}return i};var b=function e(t){t.forEach(function(e){e.abort()})};var u=function e(t){return{bandwidth:t.bandwidth,bytesReceived:t.bytesReceived||0,roundTripTime:t.roundTripTime||0}};var n=function e(t){var i=t.target;var r=Date.now()-i.requestTime;var n={bandwidth:Infinity,bytesReceived:0,roundTripTime:r||0};n.bytesReceived=t.loaded;n.bandwidth=Math.floor(n.bytesReceived/n.roundTripTime*8*1e3);return n};var f=function e(t,i){if(i.timedout){return{status:i.status,message:"HLS request timed-out at URL: "+i.uri,code:o.TIMEOUT,xhr:i}}if(i.aborted){return{status:i.status,message:"HLS request aborted at URL: "+i.uri,code:o.ABORTED,xhr:i}}if(t){return{status:i.status,message:"HLS request errored at URL: "+i.uri,code:o.FAILURE,xhr:i}}return null};var T=function e(a,s){return function(e,t){var i=t.response;var r=f(e,t);if(r){return s(r,a)}if(i.byteLength!==16){return s({status:t.status,message:"Invalid HLS key at URL: "+t.uri,code:o.FAILURE,xhr:t},a)}var n=new DataView(i);a.key.bytes=new Uint32Array([n.getUint32(0),n.getUint32(4),n.getUint32(8),n.getUint32(12)]);return s(null,a)}};var w=function e(n,a){return function(e,t){var i=t.response;var r=f(e,t);if(r){return a(r,n)}if(i.byteLength===0){return a({status:t.status,message:"Empty HLS segment content at URL: "+t.uri,code:o.FAILURE,xhr:t},n)}n.map.bytes=new Uint8Array(t.response);return a(null,n)}};var S=function e(n,a){return function(e,t){var i=t.response;var r=f(e,t);if(r){return a(r,n)}if(i.byteLength===0){return a({status:t.status,message:"Empty HLS segment content at URL: "+t.uri,code:o.FAILURE,xhr:t},n)}n.stats=u(t);if(n.key){n.encryptedBytes=new Uint8Array(t.response)}else{n.bytes=new Uint8Array(t.response)}return a(null,n)}};var d=function e(r,n,a){var t=function e(t){if(t.data.source===n.requestId){r.removeEventListener("message",e);var i=t.data.decrypted;n.bytes=new Uint8Array(i.bytes,i.byteOffset,i.byteLength);return a(null,n)}};r.addEventListener("message",t);r.postMessage((0,s.createTransferableMessage)({source:n.requestId,encrypted:n.encryptedBytes,key:n.key.bytes,iv:n.key.iv}),[n.encryptedBytes.buffer,n.key.bytes.buffer])};var l=function e(t){return t.reduce(function(e,t){return t.code>e.code?t:e})};var k=function e(r,n,a){var s=[];var o=0;return function(e,t){if(e){b(r);s.push(e)}o+=1;if(o===r.length){t.endOfAllRequests=Date.now();if(s.length>0){var i=l(s);return a(i,t)}if(t.encryptedBytes){return d(n,t,a)}return a(null,t)}}};var O=function e(t,i){return function(e){t.stats=y["default"].mergeOptions(t.stats,n(e));if(!t.stats.firstBytesReceivedAt&&t.stats.bytesReceived){t.stats.firstBytesReceivedAt=Date.now()}return i(e,t)}};var a=function e(t,i,r,n,a,s){var o=[];var u=k(o,r,s);if(n.key){var f=y["default"].mergeOptions(i,{uri:n.key.resolvedUri,responseType:"arraybuffer"});var d=T(n,u);var l=t(f,d);o.push(l)}if(n.map&&!n.map.bytes){var c=y["default"].mergeOptions(i,{uri:n.map.resolvedUri,responseType:"arraybuffer",headers:_(n.map)});var h=w(n,u);var p=t(c,h);o.push(p)}var m=y["default"].mergeOptions(i,{uri:n.resolvedUri,responseType:"arraybuffer",headers:_(n)});var g=S(n,u);var v=t(m,g);v.addEventListener("progress",O(n,a));o.push(v);return function(){return b(o)}};h.mediaSegmentRequest=a}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./bin-utils":2}],8:[function(c,h,p){(function(e){"use strict";Object.defineProperty(p,"__esModule",{value:true});var t=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var r=c("global/window");var u=i(r);var n=c("./ranges");var f=i(n);var a=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var d=i(a);var l=["seeking","seeked","pause","playing","error"];var s=function(){function s(e){var t=this;o(this,s);this.tech_=e.tech;this.seekable=e.seekable;this.consecutiveUpdates=0;this.lastRecordedTime=null;this.timer_=null;this.checkCurrentTimeTimeout_=null;if(e.debug){this.logger_=d["default"].log.bind(d["default"],"playback-watcher ->")}this.logger_("initialize");var i=function e(){return t.monitorCurrentTime_()};var r=function e(){return t.techWaiting_()};var n=function e(){return t.cancelTimer_()};var a=function e(){return t.fixesBadSeeks_()};this.tech_.on("seekablechanged",a);this.tech_.on("waiting",r);this.tech_.on(l,n);this.tech_.on("canplay",i);this.dispose=function(){t.logger_("dispose");t.tech_.off("seekablechanged",a);t.tech_.off("waiting",r);t.tech_.off(l,n);t.tech_.off("canplay",i);if(t.checkCurrentTimeTimeout_){u["default"].clearTimeout(t.checkCurrentTimeTimeout_)}t.cancelTimer_()}}t(s,[{key:"monitorCurrentTime_",value:function e(){this.checkCurrentTime_();if(this.checkCurrentTimeTimeout_){u["default"].clearTimeout(this.checkCurrentTimeTimeout_)}this.checkCurrentTimeTimeout_=u["default"].setTimeout(this.monitorCurrentTime_.bind(this),250)}},{key:"checkCurrentTime_",value:function e(){if(this.tech_.seeking()&&this.fixesBadSeeks_()){this.consecutiveUpdates=0;this.lastRecordedTime=this.tech_.currentTime();return}if(this.tech_.paused()||this.tech_.seeking()){return}var t=this.tech_.currentTime();var i=this.tech_.buffered();if(this.lastRecordedTime===t&&(!i.length||t+f["default"].SAFE_TIME_DELTA>=i.end(i.length-1))){return this.techWaiting_()}if(this.consecutiveUpdates>=5&&t===this.lastRecordedTime){this.consecutiveUpdates++;this.waiting_()}else if(t===this.lastRecordedTime){this.consecutiveUpdates++}else{this.consecutiveUpdates=0;this.lastRecordedTime=t}}},{key:"cancelTimer_",value:function e(){this.consecutiveUpdates=0;if(this.timer_){this.logger_("cancelTimer_");clearTimeout(this.timer_)}this.timer_=null}},{key:"fixesBadSeeks_",value:function e(){var t=this.tech_.seeking();var i=this.seekable();var r=this.tech_.currentTime();var n=undefined;if(t&&this.afterSeekableWindow_(i,r)){var a=i.end(i.length-1);n=a}if(t&&this.beforeSeekableWindow_(i,r)){var s=i.start(0);n=s+f["default"].SAFE_TIME_DELTA}if(typeof n!=="undefined"){this.logger_("Trying to seek outside of seekable at time "+r+" with "+("seekable range "+f["default"].printableRange(i)+". Seeking to ")+(n+"."));this.tech_.setCurrentTime(n);return true}return false}},{key:"waiting_",value:function e(){if(this.techWaiting_()){return}var t=this.tech_.currentTime();var i=this.tech_.buffered();var r=f["default"].findRange(i,t);if(r.length&&t+3<=r.end(0)){this.cancelTimer_();this.tech_.setCurrentTime(t);this.logger_("Stopped at "+t+" while inside a buffered region "+("["+r.start(0)+" -> "+r.end(0)+"]. Attempting to resume ")+"playback by seeking to the current time.");this.tech_.trigger({type:"usage",name:"hls-unknown-waiting"});return}}},{key:"techWaiting_",value:function e(){var t=this.seekable();var i=this.tech_.currentTime();if(this.tech_.seeking()&&this.fixesBadSeeks_()){return true}if(this.tech_.seeking()||this.timer_!==null){return true}if(this.beforeSeekableWindow_(t,i)){var r=t.end(t.length-1);this.logger_("Fell out of live window at time "+i+". Seeking to "+("live point (seekable end) "+r));this.cancelTimer_();this.tech_.setCurrentTime(r);this.tech_.trigger({type:"usage",name:"hls-live-resync"});return true}var n=this.tech_.buffered();var a=f["default"].findNextRange(n,i);if(this.videoUnderflow_(a,n,i)){this.cancelTimer_();this.tech_.setCurrentTime(i);this.tech_.trigger({type:"usage",name:"hls-video-underflow"});return true}if(a.length>0){var s=a.start(0)-i;this.logger_("Stopped at "+i+", setting timer for "+s+", seeking "+("to "+a.start(0)));this.timer_=setTimeout(this.skipTheGap_.bind(this),s*1e3,i);return true}return false}},{key:"afterSeekableWindow_",value:function e(t,i){if(!t.length){return false}if(i>t.end(t.length-1)+f["default"].SAFE_TIME_DELTA){return true}return false}},{key:"beforeSeekableWindow_",value:function e(t,i){if(t.length&&t.start(0)>0&&i<t.start(0)-f["default"].SAFE_TIME_DELTA){return true}return false}},{key:"videoUnderflow_",value:function e(t,i,r){if(t.length===0){var n=this.gapFromVideoUnderflow_(i,r);if(n){this.logger_("Encountered a gap in video from "+n.start+" to "+n.end+". "+("Seeking to current time "+r));return true}}return false}},{key:"skipTheGap_",value:function e(t){var i=this.tech_.buffered();var r=this.tech_.currentTime();var n=f["default"].findNextRange(i,r);this.cancelTimer_();if(n.length===0||r!==t){return}this.logger_("skipTheGap_:","currentTime:",r,"scheduled currentTime:",t,"nextRange start:",n.start(0));this.tech_.setCurrentTime(n.start(0)+f["default"].TIME_FUDGE_FACTOR);this.tech_.trigger({type:"usage",name:"hls-gap-skip"})}},{key:"gapFromVideoUnderflow_",value:function e(t,i){var r=f["default"].findGaps(t);for(var n=0;n<r.length;n++){var a=r.start(n);var s=r.end(n);if(i-a<4&&i-a>2){return{start:a,end:s}}}return null}},{key:"logger_",value:function e(){}}]);return s}();p["default"]=s;h.exports=p["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ranges":12,"global/window":32}],9:[function(b,e,T){(function(e){"use strict";Object.defineProperty(T,"__esModule",{value:true});var t=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var a=function e(t,i,r){var n=true;e:while(n){var a=t,s=i,o=r;n=false;if(a===null)a=Function.prototype;var u=Object.getOwnPropertyDescriptor(a,s);if(u===undefined){var f=Object.getPrototypeOf(a);if(f===null){return undefined}else{t=f;i=s;r=o;n=true;u=f=undefined;continue e}}else if("value"in u){return u.value}else{var d=u.get;if(d===undefined){return undefined}return d.call(o)}}};function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function r(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var n=b("./resolve-url");var o=i(n);var u=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var f=b("m3u8-parser");var d=i(f);var l=b("global/window");var c=i(l);var h=function e(t,i,r){var n=i.slice();r=r||0;var a=Math.min(t.length,i.length+r);for(var s=r;s<a;s++){n[s-r]=(0,u.mergeOptions)(t[s],n[s-r])}return n};T.updateSegments=h;var p=function e(t,i){if(!t.resolvedUri){t.resolvedUri=(0,o["default"])(i,t.uri)}if(t.key&&!t.key.resolvedUri){t.key.resolvedUri=(0,o["default"])(i,t.key.uri)}if(t.map&&!t.map.resolvedUri){t.map.resolvedUri=(0,o["default"])(i,t.map.uri)}};T.resolveSegmentUris=p;var m=function e(t,i){var r=(0,u.mergeOptions)(t,{});var n=r.playlists.filter(function(e){return e.uri===i.uri})[0];if(!n){return null}if(n.segments&&i.segments&&n.segments.length===i.segments.length&&n.mediaSequence===i.mediaSequence){return null}var a=(0,u.mergeOptions)(n,i);if(n.segments){a.segments=h(n.segments,i.segments,i.mediaSequence-n.mediaSequence)}a.segments.forEach(function(e){p(e,a.resolvedUri)});for(var s=0;s<r.playlists.length;s++){if(r.playlists[s].uri===i.uri){r.playlists[s]=a}}r.playlists[i.uri]=a;return r};T.updateMaster=m;var g=function e(t){var i=t.playlists.length;while(i--){var r=t.playlists[i];t.playlists[r.uri]=r;r.resolvedUri=(0,o["default"])(t.uri,r.uri);if(!r.attributes){r.attributes={};u.log.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}}};T.setupMediaPlaylists=g;var v=function e(n){["AUDIO","SUBTITLES"].forEach(function(e){for(var t in n.mediaGroups[e]){for(var i in n.mediaGroups[e][t]){var r=n.mediaGroups[e][t][i];if(r.uri){r.resolvedUri=(0,o["default"])(n.uri,r.uri)}}}})};T.resolveMediaGroupUris=v;var y=function e(t,i){var r=t.segments[t.segments.length-1];var n=undefined;if(i&&r&&r.duration){n=r.duration*1e3}else{n=(t.targetDuration||10)*500}return n};T.refreshDelay=y;var _=function(e){r(n,e);function n(e,t,i){var r=this;s(this,n);a(Object.getPrototypeOf(n.prototype),"constructor",this).call(this);this.srcUrl=e;this.hls_=t;this.withCredentials=i;if(!this.srcUrl){throw new Error("A non-empty playlist URL is required")}this.state="HAVE_NOTHING";this.on("mediaupdatetimeout",function(){if(r.state!=="HAVE_METADATA"){return}r.state="HAVE_CURRENT_METADATA";r.request=r.hls_.xhr({uri:(0,o["default"])(r.master.uri,r.media().uri),withCredentials:r.withCredentials},function(e,t){if(!r.request){return}if(e){return r.playlistRequestError(r.request,r.media().uri,"HAVE_METADATA")}r.haveMetadata(r.request,r.media().uri)})})}t(n,[{key:"playlistRequestError",value:function e(t,i,r){this.request=null;if(r){this.state=r}this.error={playlist:this.master.playlists[i],status:t.status,message:"HLS playlist request error at URL: "+i,responseText:t.responseText,code:t.status>=500?4:2};this.trigger("error")}},{key:"haveMetadata",value:function e(t,i){var r=this;this.request=null;this.state="HAVE_METADATA";var n=new d["default"].Parser;n.push(t.responseText);n.end();n.manifest.uri=i;n.manifest.attributes=n.manifest.attributes||{};var a=m(this.master,n.manifest);this.targetDuration=n.manifest.targetDuration;if(a){this.master=a;this.media_=this.master.playlists[n.manifest.uri]}else{this.trigger("playlistunchanged")}if(!this.media().endList){c["default"].clearTimeout(this.mediaUpdateTimeout);this.mediaUpdateTimeout=c["default"].setTimeout(function(){r.trigger("mediaupdatetimeout")},y(this.media(),!!a))}this.trigger("loadedplaylist")}},{key:"dispose",value:function e(){this.stopRequest();c["default"].clearTimeout(this.mediaUpdateTimeout)}},{key:"stopRequest",value:function e(){if(this.request){var t=this.request;this.request=null;t.onreadystatechange=null;t.abort()}}},{key:"media",value:function e(i){var r=this;if(!i){return this.media_}if(this.state==="HAVE_NOTHING"){throw new Error("Cannot switch media playlist from "+this.state)}var n=this.state;if(typeof i==="string"){if(!this.master.playlists[i]){throw new Error("Unknown playlist URI: "+i)}i=this.master.playlists[i]}var t=!this.media_||i.uri!==this.media_.uri;if(this.master.playlists[i.uri].endList){if(this.request){this.request.onreadystatechange=null;this.request.abort();this.request=null}this.state="HAVE_METADATA";this.media_=i;if(t){this.trigger("mediachanging");this.trigger("mediachange")}return}if(!t){return}this.state="SWITCHING_MEDIA";if(this.request){if((0,o["default"])(this.master.uri,i.uri)===this.request.url){return}this.request.onreadystatechange=null;this.request.abort();this.request=null}if(this.media_){this.trigger("mediachanging")}this.request=this.hls_.xhr({uri:(0,o["default"])(this.master.uri,i.uri),withCredentials:this.withCredentials},function(e,t){if(!r.request){return}if(e){return r.playlistRequestError(r.request,i.uri,n)}r.haveMetadata(t,i.uri);if(n==="HAVE_MASTER"){r.trigger("loadedmetadata")}else{r.trigger("mediachange")}})}},{key:"pause",value:function e(){this.stopRequest();c["default"].clearTimeout(this.mediaUpdateTimeout);if(this.state==="HAVE_NOTHING"){this.started=false}if(this.state==="SWITCHING_MEDIA"){if(this.media_){this.state="HAVE_METADATA"}else{this.state="HAVE_MASTER"}}else if(this.state==="HAVE_CURRENT_METADATA"){this.state="HAVE_METADATA"}}},{key:"load",value:function e(t){var i=this;c["default"].clearTimeout(this.mediaUpdateTimeout);var r=this.media();if(t){var n=r?r.targetDuration/2*1e3:5*1e3;this.mediaUpdateTimeout=c["default"].setTimeout(function(){return i.load()},n);return}if(!this.started){this.start();return}if(r&&!r.endList){this.trigger("mediaupdatetimeout")}else{this.trigger("loadedplaylist")}}},{key:"start",value:function e(){var r=this;this.started=true;this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},function(e,t){if(!r.request){return}r.request=null;if(e){r.error={status:t.status,message:"HLS playlist request error at URL: "+r.srcUrl,responseText:t.responseText,code:2};if(r.state==="HAVE_NOTHING"){r.started=false}return r.trigger("error")}var i=new d["default"].Parser;i.push(t.responseText);i.end();r.state="HAVE_MASTER";i.manifest.uri=r.srcUrl;if(i.manifest.playlists){r.master=i.manifest;g(r.master);v(r.master);r.trigger("loadedplaylist");if(!r.request){r.media(i.manifest.playlists[0])}return}r.master={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:c["default"].location.href,playlists:[{uri:r.srcUrl}]};r.master.playlists[r.srcUrl]=r.master.playlists[0];r.master.playlists[0].resolvedUri=r.srcUrl;r.master.playlists[0].attributes=r.master.playlists[0].attributes||{};r.haveMetadata(t,r.srcUrl);return r.trigger("loadedmetadata")})}}]);return n}(u.EventTarget);T["default"]=_}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./resolve-url":15,"global/window":32,"m3u8-parser":33}],10:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});function r(e){return e&&e.__esModule?e:{default:e}}var n=e("./config");var v=r(n);var a=e("./playlist");var y=r(a);var s=e("./util/codecs.js");var o=function e(t,i){var r=undefined;if(!t){return""}r=window.getComputedStyle(t);if(!r){return""}return r[i]};var _=function e(t,r){var n=t.slice();t.sort(function(e,t){var i=r(e,t);if(i===0){return n.indexOf(e)-n.indexOf(t)}return i})};var m=function e(t,i){var r=undefined;var n=undefined;if(t.attributes.BANDWIDTH){r=t.attributes.BANDWIDTH}r=r||window.Number.MAX_VALUE;if(i.attributes.BANDWIDTH){n=i.attributes.BANDWIDTH}n=n||window.Number.MAX_VALUE;return r-n};i.comparePlaylistBandwidth=m;var u=function e(t,i){var r=undefined;var n=undefined;if(t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width){r=t.attributes.RESOLUTION.width}r=r||window.Number.MAX_VALUE;if(i.attributes.RESOLUTION&&i.attributes.RESOLUTION.width){n=i.attributes.RESOLUTION.width}n=n||window.Number.MAX_VALUE;if(r===n&&t.attributes.BANDWIDTH&&i.attributes.BANDWIDTH){return t.attributes.BANDWIDTH-i.attributes.BANDWIDTH}return r-n};i.comparePlaylistResolution=u;var f=function e(t,i,r,n){var a=t.playlists.map(function(e){var t=undefined;var i=undefined;var r=undefined;t=e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width;i=e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height;r=e.attributes.BANDWIDTH;r=r||window.Number.MAX_VALUE;return{bandwidth:r,width:t,height:i,playlist:e}});_(a,function(e,t){return e.bandwidth-t.bandwidth});a=a.filter(function(e){return!y["default"].isIncompatible(e.playlist)});var s=a.filter(function(e){return y["default"].isEnabled(e.playlist)});if(!s.length){s=a.filter(function(e){return!y["default"].isDisabled(e.playlist)})}var o=s.filter(function(e){return e.bandwidth*v["default"].BANDWIDTH_VARIANCE<i});var u=o[o.length-1];var f=o.filter(function(e){return e.bandwidth===u.bandwidth})[0];var d=o.filter(function(e){return e.width&&e.height});_(d,function(e,t){return e.width-t.width});var l=d.filter(function(e){return e.width===r&&e.height===n});u=l[l.length-1];var c=l.filter(function(e){return e.bandwidth===u.bandwidth})[0];var h=undefined;var p=undefined;var m=undefined;if(!c){h=d.filter(function(e){return e.width>r||e.height>n});p=h.filter(function(e){return e.width===h[0].width&&e.height===h[0].height});u=p[p.length-1];m=p.filter(function(e){return e.bandwidth===u.bandwidth})[0]}var g=m||c||f||s[0]||a[0];return g?g.playlist:null};i.simpleSelector=f;var d=function e(){return f(this.playlists.master,this.systemBandwidth,parseInt(o(this.tech_.el(),"width"),10),parseInt(o(this.tech_.el(),"height"),10))};i.lastBandwidthSelector=d;var l=function e(t){var i=-1;if(t<0||t>1){throw new Error("Moving average bandwidth decay must be between 0 and 1.")}return function(){if(i<0){i=this.systemBandwidth}i=t*this.systemBandwidth+(1-t)*i;return f(this.playlists.master,i,parseInt(o(this.tech_.el(),"width"),10),parseInt(o(this.tech_.el(),"height"),10))}};i.movingAverageBandwidthSelector=l;var c=function e(t){var i=t.master;var a=t.currentTime;var s=t.bandwidth;var o=t.duration;var u=t.segmentDuration;var f=t.timeUntilRebuffer;var d=t.currentTimeline;var l=t.syncController;var r=i.playlists.filter(function(e){return!y["default"].isIncompatible(e)});var n=r.filter(y["default"].isEnabled);if(!n.length){n=r.filter(function(e){return!y["default"].isDisabled(e)})}var c=n.filter(y["default"].hasAttribute.bind(null,"BANDWIDTH"));var h=c.map(function(e){var t=l.getSyncPoint(e,o,d,a);var i=t?1:2;var r=y["default"].estimateSegmentRequestTime(u,s,e);var n=r*i-f;return{playlist:e,rebufferingImpact:n}});var p=h.filter(function(e){return e.rebufferingImpact<=0});_(p,function(e,t){return m(t.playlist,e.playlist)});if(p.length){return p[0]}_(h,function(e,t){return e.rebufferingImpact-t.rebufferingImpact});return h[0]||null};i.minRebufferMaxBandwidthSelector=c;var h=function e(){var t=this.playlists.master.playlists.filter(y["default"].isEnabled);_(t,function(e,t){return m(e,t)});var i=t.filter(function(e){return(0,s.parseCodecs)(e.attributes.CODECS).videoCodec});return i[0]||null};i.lowestBitrateCompatibleVariantSelector=h},{"./config":3,"./playlist":11,"./util/codecs.js":19}],11:[function(A,e,L){(function(e){"use strict";Object.defineProperty(L,"__esModule",{value:true});function t(e){return e&&e.__esModule?e:{default:e}}var s=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var i=A("global/window");var n=t(i);var o=function e(t,i){var r=0;var n=i-t.mediaSequence;var a=t.segments[n];if(a){if(typeof a.start!=="undefined"){return{result:a.start,precise:true}}if(typeof a.end!=="undefined"){return{result:a.end-a.duration,precise:true}}}while(n--){a=t.segments[n];if(typeof a.end!=="undefined"){return{result:r+a.end,precise:true}}r+=a.duration;if(typeof a.start!=="undefined"){return{result:r+a.start,precise:true}}}return{result:r,precise:false}};var u=function e(t,i){var r=0;var n=undefined;var a=i-t.mediaSequence;for(;a<t.segments.length;a++){n=t.segments[a];if(typeof n.start!=="undefined"){return{result:n.start-r,precise:true}}r+=n.duration;if(typeof n.end!=="undefined"){return{result:n.end-r,precise:true}}}return{result:-1,precise:false}};var a=function e(t,i,r){var n=undefined;var a=undefined;if(typeof i==="undefined"){i=t.mediaSequence+t.segments.length}if(i<t.mediaSequence){return 0}n=o(t,i);if(n.precise){return n.result}a=u(t,i);if(a.precise){return a.result}return n.result+r};var f=function e(t,i,r){if(!t){return 0}if(typeof r!=="number"){r=0}if(typeof i==="undefined"){if(t.totalDuration){return t.totalDuration}if(!t.endList){return n["default"].Infinity}}return a(t,i,r)};L.duration=f;var d=function e(t,i,r){var n=0;if(i>r){var a=[r,i];i=a[0];r=a[1]}if(i<0){for(var s=i;s<Math.min(0,r);s++){n+=t.targetDuration}i=0}for(var s=i;s<r;s++){n+=t.segments[s].duration}return n};L.sumDurations=d;var l=function e(t){if(!t.segments.length){return 0}var i=t.segments.length-1;var r=t.segments[i].duration||t.targetDuration;var n=r+t.targetDuration*2;while(i--){r+=t.segments[i].duration;if(r>=n){break}}return Math.max(0,i)};L.safeLiveIndex=l;var c=function e(t,i,r){if(!t||!t.segments){return null}if(t.endList){return f(t)}if(i===null){return null}i=i||0;var n=r?l(t):t.segments.length;return a(t,t.mediaSequence+n,i)};L.playlistEnd=c;var r=function e(t,i){var r=true;var n=i||0;var a=c(t,i,r);if(a===null){return(0,s.createTimeRange)()}return(0,s.createTimeRange)(n,a)};L.seekable=r;var h=function e(t){return t-Math.floor(t)===0};var p=function e(t,i){if(h(i)){return i+t*.1}var r=i.toString().split(".")[1].length;for(var n=1;n<=r;n++){var a=Math.pow(10,n);var s=i*a;if(h(s)||n===r){return(s+t)/a}}};var m=p.bind(null,1);var g=p.bind(null,-1);var v=function e(t,i,r,n){var a=undefined;var s=undefined;var o=t.segments.length;var u=i-n;if(u<0){if(r>0){for(a=r-1;a>=0;a--){s=t.segments[a];u+=g(s.duration);if(u>0){return{mediaIndex:a,startTime:n-d(t,r,a)}}}}return{mediaIndex:0,startTime:i}}if(r<0){for(a=r;a<0;a++){u-=t.targetDuration;if(u<0){return{mediaIndex:0,startTime:i}}}r=0}for(a=r;a<o;a++){s=t.segments[a];u-=m(s.duration);if(u<0){return{mediaIndex:a,startTime:n+d(t,r,a)}}}return{mediaIndex:o-1,startTime:i}};L.getMediaInfoForTime=v;var y=function e(t){return t.excludeUntil&&t.excludeUntil>Date.now()};L.isBlacklisted=y;var _=function e(t){return t.excludeUntil&&t.excludeUntil===Infinity};L.isIncompatible=_;var b=function e(t){var i=y(t);return!t.disabled&&!i};L.isEnabled=b;var T=function e(t){return t.disabled};L.isDisabled=T;var w=function e(t){for(var i=0;i<t.segments.length;i++){if(t.segments[i].key){return true}}return false};L.isAes=w;var S=function e(t){for(var i=0;i<t.segments.length;i++){if(t.segments[i].map){return true}}return false};L.isFmp4=S;var k=function e(t,i){return i.attributes&&i.attributes[t]};L.hasAttribute=k;var O=function e(t,i,r){var n=arguments.length<=3||arguments[3]===undefined?0:arguments[3];if(!k("BANDWIDTH",r)){return NaN}var a=t*r.attributes.BANDWIDTH;return(a-n*8)/i};L.estimateSegmentRequestTime=O;var E=function e(t,i){if(t.playlists.length===1){return true}var r=i.attributes.BANDWIDTH||Number.MAX_VALUE;return t.playlists.filter(function(e){if(!b(e)){return false}return(e.attributes.BANDWIDTH||0)<r}).length===0};L.isLowestEnabledRendition=E;L["default"]={duration:f,seekable:r,safeLiveIndex:l,getMediaInfoForTime:v,isEnabled:b,isDisabled:T,isBlacklisted:y,isIncompatible:_,playlistEnd:c,isAes:w,isFmp4:S,hasAttribute:k,estimateSegmentRequestTime:O,isLowestEnabledRendition:E}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"global/window":32}],12:[function(e,y,_){(function(e){"use strict";Object.defineProperty(_,"__esModule",{value:true});var s=function(){function i(e,t){var i=[];var r=true;var n=false;var a=undefined;try{for(var s=e[Symbol.iterator](),o;!(r=(o=s.next()).done);r=true){i.push(o.value);if(t&&i.length===t)break}}catch(e){n=true;a=e}finally{try{if(!r&&s["return"])s["return"]()}finally{if(n)throw a}}return i}return function(e,t){if(Array.isArray(e)){return e}else if(Symbol.iterator in Object(e)){return i(e,t)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();function t(e){return e&&e.__esModule?e:{default:e}}var i=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var f=t(i);var r=1/30;var n=r*3;var d=function e(t,i){var r=s(i,2);var n=r[0];var a=r[1];return Math.min(Math.max(n,t),a)};var a=function e(t,i){var r=[];var n=undefined;if(t&&t.length){for(n=0;n<t.length;n++){if(i(t.start(n),t.end(n))){r.push([t.start(n),t.end(n)])}}}return f["default"].createTimeRanges(r)};var o=function e(t,i){return a(t,function(e,t){return e-r<=i&&t+r>=i})};var u=function e(t,i){return a(t,function(e){return e-r>=i})};var l=function e(t){if(t.length<2){return f["default"].createTimeRanges()}var i=[];for(var r=1;r<t.length;r++){var n=t.end(r-1);var a=t.start(r);i.push([n,a])}return f["default"].createTimeRanges(i)};var c=function e(t,i){var r=undefined;var n=undefined;var a=undefined;var s=[];var o=[];var u=function e(t){return t[0]<=a&&t[1]>=a};if(t){for(r=0;r<t.length;r++){n=t.start(r);a=t.end(r);o.push([n,a])}}if(i){for(r=0;r<i.length;r++){n=i.start(r);a=i.end(r);if(o.some(u)){continue}s.push(a)}}if(s.length!==1){return null}return s[0]};var h=function e(t,i){var r=null;var n=null;var a=0;var s=[];var o=[];if(!t||!t.length||!i||!i.length){return f["default"].createTimeRange()}var u=t.length;while(u--){s.push({time:t.start(u),type:"start"});s.push({time:t.end(u),type:"end"})}u=i.length;while(u--){s.push({time:i.start(u),type:"start"});s.push({time:i.end(u),type:"end"})}s.sort(function(e,t){return e.time-t.time});for(u=0;u<s.length;u++){if(s[u].type==="start"){a++;if(a===2){r=s[u].time}}else if(s[u].type==="end"){a--;if(a===1){n=s[u].time}}if(r!==null&&n!==null){o.push([r,n]);r=null;n=null}}return f["default"].createTimeRanges(o)};var p=function e(t,i,r,n){var a=i.end(0)-i.start(0);var s=t.end(0)-t.start(0);var o=a-s;var u=h(t,n);var f=h(i,n);var d=0;var l=0;var c=u.length;while(c--){d+=u.end(c)-u.start(c);if(u.start(c)===r){d+=o}}c=f.length;while(c--){l+=f.end(c)-f.start(c)}return Math.max(d,l)/a*100};var m=function e(t,i,r,n){var a=t+i;var s=f["default"].createTimeRanges([[t,a]]);var o=f["default"].createTimeRanges([[d(t,[r,a]),a]]);if(o.start(0)===o.end(0)){return 0}var u=p(o,s,r,n);if(isNaN(u)||u===Infinity||u===-Infinity){return 0}return u};var g=function e(t){var i=[];if(!t||!t.length){return""}for(var r=0;r<t.length;r++){i.push(t.start(r)+" => "+t.end(r))}return i.join(", ")};var v=function e(t,i){var r=arguments.length<=2||arguments[2]===undefined?1:arguments[2];var n=t.length?t.end(t.length-1):0;return(n-i)/r};_["default"]={findRange:o,findNextRange:u,findGaps:l,findSoleUncommonTimeRangesEnd:c,getSegmentBufferedPercent:m,TIME_FUDGE_FACTOR:r,SAFE_TIME_DELTA:n,printableRange:g,timeUntilRebuffer:v};y.exports=_["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],13:[function(e,a,s){(function(e){"use strict";Object.defineProperty(s,"__esModule",{value:true});function t(e){return e&&e.__esModule?e:{default:e}}var i=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var l=t(i);var c={errorInterval:30,getSource:function e(t){var i=this.tech({IWillNotUseThisInPlugins:true});var r=i.currentSource_;return t(r)}};var r=function i(r,e){var t=0;var n=0;var a=l["default"].mergeOptions(c,e);r.ready(function(){r.trigger({type:"usage",name:"hls-error-reload-initialized"})});var s=function e(){if(n){r.currentTime(n)}};var o=function e(t){if(t===null||t===undefined){return}n=r.duration()!==Infinity&&r.currentTime()||0;r.one("loadedmetadata",s);r.src(t);r.trigger({type:"usage",name:"hls-error-reload"});r.play()};var u=function e(){if(Date.now()-t<a.errorInterval*1e3){r.trigger({type:"usage",name:"hls-error-reload-canceled"});return}if(!a.getSource||typeof a.getSource!=="function"){l["default"].log.error("ERROR: reloadSourceOnError - The option getSource must be a function!");return}t=Date.now();return a.getSource.call(r,o)};var f=function e(){r.off("loadedmetadata",s);r.off("error",u);r.off("dispose",e)};var d=function e(t){f();i(r,t)};r.on("error",u);r.on("dispose",f);r.reloadSourceOnError=d};var n=function e(t){r(this,t)};s["default"]=n;a.exports=s["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],14:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=e("./playlist.js");var u=function e(n,a,s){return function(e){var t=n.master.playlists[a];var i=(0,o.isIncompatible)(t);var r=(0,o.isEnabled)(t);if(typeof e==="undefined"){return r}if(e){delete t.disabled}else{t.disabled=true}if(e!==r&&!i){s();if(e){n.trigger("renditionenabled")}else{n.trigger("renditiondisabled")}}return e}};var r=function e(t,i,r){s(this,e);var n=t.masterPlaylistController_.fastQualityChange_.bind(t.masterPlaylistController_);if(i.attributes.RESOLUTION){var a=i.attributes.RESOLUTION;this.width=a.width;this.height=a.height}this.bandwidth=i.attributes.BANDWIDTH;this.id=r;this.enabled=u(t.playlists,i.uri,n)};var n=function e(i){var t=i.playlists;i.representations=function(){return t.master.playlists.filter(function(e){return!(0,o.isIncompatible)(e)}).map(function(e,t){return new r(i,e,e.uri)})}};i["default"]=n;t.exports=i["default"]},{"./playlist.js":11}],15:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});function r(e){return e&&e.__esModule?e:{default:e}}var n=e("url-toolkit");var a=r(n);var s=e("global/window");var o=r(s);var u=function e(t,i){if(/^[a-z]+:/i.test(i)){return i}if(!/\/\//i.test(t)){t=a["default"].buildAbsoluteURL(o["default"].location.href,t)}return a["default"].buildAbsoluteURL(t,i)};i["default"]=u;t.exports=i["default"]},{"global/window":32,"url-toolkit":63}],16:[function(L,e,P){(function(e){"use strict";Object.defineProperty(P,"__esModule",{value:true});var t=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=function e(t,i,r){var n=true;e:while(n){var a=t,s=i,o=r;n=false;if(a===null)a=Function.prototype;var u=Object.getOwnPropertyDescriptor(a,s);if(u===undefined){var f=Object.getPrototypeOf(a);if(f===null){return undefined}else{t=f;i=s;r=o;n=true;u=f=undefined;continue e}}else if("value"in u){return u.value}else{var d=u.get;if(d===undefined){return undefined}return d.call(o)}}};function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var r=L("./playlist");var c=i(r);var o=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var u=i(o);var f=L("./source-updater");var d=i(f);var l=L("./config");var h=i(l);var p=L("global/window");var m=i(p);var g=L("videojs-contrib-media-sources/es5/remove-cues-from-track.js");var v=i(g);var y=L("./bin-utils");var _=L("./media-segment-request");var b=L("./ranges");var T=L("./playlist-selectors");var w=500;var S=function e(t,i,r){if(!t||!i){return false}var n=t.segments;var a=r===n.length;return t.endList&&i.readyState==="open"&&a};var k=function e(t){return typeof t==="number"&&isFinite(t)};var O=function e(t,i,r){if(t!=="main"||!i||!r){return null}if(!r.containsAudio&&!r.containsVideo){return"Neither audio nor video found in segment."}if(i.containsVideo&&!r.containsVideo){return"Only audio found in segment when we expected video."+" We can't switch to audio only from a stream that had video."+" To get rid of this message, please add codec information to the manifest."}if(!i.containsVideo&&r.containsVideo){return"Video found in segment when we expected only audio."+" We can't switch to a stream with video from an audio only stream."+" To get rid of this message, please add codec information to the manifest."}return null};P.illegalMediaSwitch=O;var E=function e(t,i,r){var n=undefined;if(t.length&&t.start(0)>0&&t.start(0)<i){n=t.start(0)}else{n=i-30}return Math.min(n,i-r)};P.safeBackBufferTrimTime=E;var A=function(e){s(r,e);function r(e){var t=this;var i=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];a(this,r);n(Object.getPrototypeOf(r.prototype),"constructor",this).call(this);if(!e){throw new TypeError("Initialization settings are required")}if(typeof e.currentTime!=="function"){throw new TypeError("No currentTime getter specified")}if(!e.mediaSource){throw new TypeError("No MediaSource specified")}this.state="INIT";this.bandwidth=e.bandwidth;this.throughput={rate:0,count:0};this.roundTrip=NaN;this.resetStats_();this.mediaIndex=null;this.hasPlayed_=e.hasPlayed;this.currentTime_=e.currentTime;this.seekable_=e.seekable;this.seeking_=e.seeking;this.duration_=e.duration;this.mediaSource_=e.mediaSource;this.hls_=e.hls;this.loaderType_=e.loaderType;this.startingMedia_=void 0;this.segmentMetadataTrack_=e.segmentMetadataTrack;this.goalBufferLength_=e.goalBufferLength;this.checkBufferTimeout_=null;this.error_=void 0;this.currentTimeline_=-1;this.pendingSegment_=null;this.mimeType_=null;this.sourceUpdater_=null;this.xhrOptions_=null;this.activeInitSegmentId_=null;this.initSegments_={};this.decrypter_=e.decrypter;this.syncController_=e.syncController;this.syncPoint_={segmentIndex:0,time:0};this.syncController_.on("syncinfoupdate",function(){return t.trigger("syncinfoupdate")});this.mediaSource_.addEventListener("sourceopen",function(){return t.ended_=false});this.fetchAtBuffer_=false;if(i.debug){this.logger_=u["default"].log.bind(u["default"],"segment-loader",this.loaderType_,"->")}}t(r,[{key:"resetStats_",value:function e(){this.mediaBytesTransferred=0;this.mediaRequests=0;this.mediaRequestsAborted=0;this.mediaRequestsTimedout=0;this.mediaRequestsErrored=0;this.mediaTransferDuration=0;this.mediaSecondsLoaded=0}},{key:"dispose",value:function e(){this.state="DISPOSED";this.pause();this.abort_();if(this.sourceUpdater_){this.sourceUpdater_.dispose()}this.resetStats_()}},{key:"abort",value:function e(){if(this.state!=="WAITING"){if(this.pendingSegment_){this.pendingSegment_=null}return}this.abort_();this.state="READY";if(!this.paused()){this.monitorBuffer_()}}},{key:"abort_",value:function e(){if(this.pendingSegment_){this.pendingSegment_.abortRequests()}this.pendingSegment_=null}},{key:"error",value:function e(t){if(typeof t!=="undefined"){this.error_=t}this.pendingSegment_=null;return this.error_}},{key:"endOfStream",value:function e(){this.ended_=true;this.pause();this.trigger("ended")}},{key:"buffered_",value:function e(){if(!this.sourceUpdater_){return u["default"].createTimeRanges()}return this.sourceUpdater_.buffered()}},{key:"initSegment",value:function e(t){var i=arguments.length<=1||arguments[1]===undefined?false:arguments[1];if(!t){return null}var r=(0,y.initSegmentId)(t);var n=this.initSegments_[r];if(i&&!n&&t.bytes){this.initSegments_[r]=n={resolvedUri:t.resolvedUri,byterange:t.byterange,bytes:t.bytes}}return n||t}},{key:"couldBeginLoading_",value:function e(){return this.playlist_&&(this.sourceUpdater_||this.mimeType_&&this.state==="INIT")&&!this.paused()}},{key:"load",value:function e(){this.monitorBuffer_();if(!this.playlist_){return}this.syncController_.setDateTimeMapping(this.playlist_);if(this.state==="INIT"&&this.couldBeginLoading_()){return this.init_()}if(!this.couldBeginLoading_()||this.state!=="READY"&&this.state!=="INIT"){return}this.state="READY"}},{key:"init_",value:function e(){this.state="READY";this.sourceUpdater_=new d["default"](this.mediaSource_,this.mimeType_);this.resetEverything();return this.monitorBuffer_()}},{key:"playlist",value:function e(t){var i=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];if(!t){return}var r=this.playlist_;var n=this.pendingSegment_;this.playlist_=t;this.xhrOptions_=i;if(!this.hasPlayed_()){t.syncInfo={mediaSequence:t.mediaSequence,time:0}}this.trigger("syncinfoupdate");if(this.state==="INIT"&&this.couldBeginLoading_()){return this.init_()}if(!r||r.uri!==t.uri){if(this.mediaIndex!==null){this.resyncLoader()}return}var a=t.mediaSequence-r.mediaSequence;this.logger_("mediaSequenceDiff",a);if(this.mediaIndex!==null){this.mediaIndex-=a}if(n){n.mediaIndex-=a;if(n.mediaIndex>=0){n.segment=t.segments[n.mediaIndex]}}this.syncController_.saveExpiredSegmentInfo(r,t)}},{key:"pause",value:function e(){if(this.checkBufferTimeout_){m["default"].clearTimeout(this.checkBufferTimeout_);this.checkBufferTimeout_=null}}},{key:"paused",value:function e(){return this.checkBufferTimeout_===null}},{key:"mimeType",value:function e(t){if(this.mimeType_){return}this.mimeType_=t;if(this.state==="INIT"&&this.couldBeginLoading_()){this.init_()}}},{key:"resetEverything",value:function e(){this.ended_=false;this.resetLoader();this.remove(0,this.duration_());this.trigger("reseteverything")}},{key:"resetLoader",value:function e(){this.fetchAtBuffer_=false;this.resyncLoader()}},{key:"resyncLoader",value:function e(){this.mediaIndex=null;this.syncPoint_=null;this.abort()}},{key:"remove",value:function e(t,i){if(this.sourceUpdater_){this.sourceUpdater_.remove(t,i)}(0,v["default"])(t,i,this.segmentMetadataTrack_)}},{key:"monitorBuffer_",value:function e(){if(this.checkBufferTimeout_){m["default"].clearTimeout(this.checkBufferTimeout_)}this.checkBufferTimeout_=m["default"].setTimeout(this.monitorBufferTick_.bind(this),1)}},{key:"monitorBufferTick_",value:function e(){if(this.state==="READY"){this.fillBuffer_()}if(this.checkBufferTimeout_){m["default"].clearTimeout(this.checkBufferTimeout_)}this.checkBufferTimeout_=m["default"].setTimeout(this.monitorBufferTick_.bind(this),w)}},{key:"fillBuffer_",value:function e(){if(this.sourceUpdater_.updating()){return}if(!this.syncPoint_){this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_())}var t=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);if(!t){return}var i=S(this.playlist_,this.mediaSource_,t.mediaIndex);if(i){this.endOfStream();return}if(t.mediaIndex===this.playlist_.segments.length-1&&this.mediaSource_.readyState==="ended"&&!this.seeking_()){return}if(t.timeline!==this.currentTimeline_||t.startOfSegment!==null&&t.startOfSegment<this.sourceUpdater_.timestampOffset()){this.syncController_.reset();t.timestampOffset=t.startOfSegment}this.loadSegment_(t)}},{key:"checkBuffer_",value:function e(t,i,r,n,a,s){var o=0;var u=undefined;if(t.length){o=t.end(t.length-1)}var f=Math.max(0,o-a);if(!i.segments.length){return null}if(f>=this.goalBufferLength_()){return null}if(!n&&f>=1){return null}this.logger_("checkBuffer_","mediaIndex:",r,"hasPlayed:",n,"currentTime:",a,"syncPoint:",s,"fetchAtBuffer:",this.fetchAtBuffer_,"bufferedTime:",f);if(s===null){r=this.getSyncSegmentCandidate_(i);this.logger_("getSync","mediaIndex:",r);return this.generateSegmentInfo_(i,r,null,true)}if(r!==null){this.logger_("walkForward","mediaIndex:",r+1);var d=i.segments[r];if(d&&d.end){u=d.end}else{u=o}return this.generateSegmentInfo_(i,r+1,u,false)}if(this.fetchAtBuffer_){var l=c["default"].getMediaInfoForTime(i,o,s.segmentIndex,s.time);r=l.mediaIndex;u=l.startTime}else{var l=c["default"].getMediaInfoForTime(i,a,s.segmentIndex,s.time);r=l.mediaIndex;u=l.startTime}this.logger_("getMediaIndexForTime","mediaIndex:",r,"startOfSegment:",u);return this.generateSegmentInfo_(i,r,u,false)}},{key:"getSyncSegmentCandidate_",value:function e(t){var i=this;if(this.currentTimeline_===-1){return 0}var r=t.segments.map(function(e,t){return{timeline:e.timeline,segmentIndex:t}}).filter(function(e){return e.timeline===i.currentTimeline_});if(r.length){return r[Math.min(r.length-1,1)].segmentIndex}return Math.max(t.segments.length-1,0)}},{key:"generateSegmentInfo_",value:function e(t,i,r,n){if(i<0||i>=t.segments.length){return null}var a=t.segments[i];return{requestId:"segment-loader-"+Math.random(),uri:a.resolvedUri,mediaIndex:i,isSyncRequest:n,startOfSegment:r,playlist:t,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:a.timeline,duration:a.duration,segment:a}}},{key:"abortRequestEarly_",value:function e(t){if(this.hls_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH){return false}if(Date.now()-(t.firstBytesReceivedAt||Date.now())<1e3){return false}var i=this.currentTime_();var r=t.bandwidth;var n=this.pendingSegment_.duration;var a=c["default"].estimateSegmentRequestTime(n,r,this.playlist_,t.bytesReceived);var s=(0,b.timeUntilRebuffer)(this.buffered_(),i,this.hls_.tech_.playbackRate())-1;if(a<=s){return false}var o=(0,T.minRebufferMaxBandwidthSelector)({master:this.hls_.playlists.master,currentTime:i,bandwidth:r,duration:this.duration_(),segmentDuration:n,timeUntilRebuffer:s,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(!o){return}var u=a-s;var f=u-o.rebufferingImpact;var d=.5;if(s<=b.TIME_FUDGE_FACTOR){d=1}if(!o.playlist||o.playlist.uri===this.playlist_.uri||f<d){return false}this.bandwidth=o.playlist.attributes.BANDWIDTH*h["default"].BANDWIDTH_VARIANCE+1;this.abort();this.trigger("earlyabort");return true}},{key:"handleProgress_",value:function e(t,i){if(!this.pendingSegment_||i.requestId!==this.pendingSegment_.requestId||this.abortRequestEarly_(i.stats)){return}this.trigger("progress")}},{key:"loadSegment_",value:function e(t){this.state="WAITING";this.pendingSegment_=t;this.trimBackBuffer_(t);t.abortRequests=(0,_.mediaSegmentRequest)(this.hls_.xhr,this.xhrOptions_,this.decrypter_,this.createSimplifiedSegmentObj_(t),this.handleProgress_.bind(this),this.segmentRequestFinished_.bind(this))}},{key:"trimBackBuffer_",value:function e(t){var i=E(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);if(i>0){this.remove(0,i)}}},{key:"createSimplifiedSegmentObj_",value:function e(t){var i=t.segment;var r={resolvedUri:i.resolvedUri,byterange:i.byterange,requestId:t.requestId};if(i.key){var n=i.key.iv||new Uint32Array([0,0,0,t.mediaIndex+t.playlist.mediaSequence]);r.key={resolvedUri:i.key.resolvedUri,iv:n}}if(i.map){r.map=this.initSegment(i.map)}return r}},{key:"segmentRequestFinished_",value:function e(t,i){this.mediaRequests+=1;if(i.stats){this.mediaBytesTransferred+=i.stats.bytesReceived;this.mediaTransferDuration+=i.stats.roundTripTime}if(!this.pendingSegment_){this.mediaRequestsAborted+=1;return}if(i.requestId!==this.pendingSegment_.requestId){return}if(t){this.pendingSegment_=null;this.state="READY";if(t.code===_.REQUEST_ERRORS.ABORTED){this.mediaRequestsAborted+=1;return}this.pause();if(t.code===_.REQUEST_ERRORS.TIMEOUT){this.mediaRequestsTimedout+=1;this.bandwidth=1;this.roundTrip=NaN;this.trigger("bandwidthupdate");return}this.mediaRequestsErrored+=1;this.error(t);this.trigger("error");return}this.bandwidth=i.stats.bandwidth;this.roundTrip=i.stats.roundTripTime;if(i.map){i.map=this.initSegment(i.map,true)}this.processSegmentResponse_(i)}},{key:"processSegmentResponse_",value:function e(t){var i=this.pendingSegment_;i.bytes=t.bytes;if(t.map){i.segment.map.bytes=t.map.bytes}i.endOfAllRequests=t.endOfAllRequests;this.handleSegment_()}},{key:"handleSegment_",value:function e(){var i=this;if(!this.pendingSegment_){this.state="READY";return}var t=this.pendingSegment_;var r=t.segment;var n=this.syncController_.probeSegmentInfo(t);if(typeof this.startingMedia_==="undefined"&&n&&(n.containsAudio||n.containsVideo)){this.startingMedia_={containsAudio:n.containsAudio,containsVideo:n.containsVideo}}var a=O(this.loaderType_,this.startingMedia_,n);if(a){this.error({message:a,blacklistDuration:Infinity});this.trigger("error");return}if(t.isSyncRequest){this.trigger("syncinfoupdate");this.pendingSegment_=null;this.state="READY";return}if(t.timestampOffset!==null&&t.timestampOffset!==this.sourceUpdater_.timestampOffset()){this.sourceUpdater_.timestampOffset(t.timestampOffset);this.trigger("timestampoffset")}var s=this.syncController_.mappingForTimeline(t.timeline);if(s!==null){this.trigger({type:"segmenttimemapping",mapping:s})}this.state="APPENDING";if(r.map){(function(){var e=(0,y.initSegmentId)(r.map);if(!i.activeInitSegmentId_||i.activeInitSegmentId_!==e){var t=i.initSegment(r.map);i.sourceUpdater_.appendBuffer(t.bytes,function(){i.activeInitSegmentId_=e})}})()}t.byteLength=t.bytes.byteLength;if(typeof r.start==="number"&&typeof r.end==="number"){this.mediaSecondsLoaded+=r.end-r.start}else{this.mediaSecondsLoaded+=r.duration}this.sourceUpdater_.appendBuffer(t.bytes,this.handleUpdateEnd_.bind(this))}},{key:"handleUpdateEnd_",value:function e(){this.logger_("handleUpdateEnd_","segmentInfo:",this.pendingSegment_);if(!this.pendingSegment_){this.state="READY";if(!this.paused()){this.monitorBuffer_()}return}var t=this.pendingSegment_;var i=t.segment;var r=this.mediaIndex!==null;this.pendingSegment_=null;this.recordThroughput_(t);this.addSegmentMetadataCue_(t);this.state="READY";this.mediaIndex=t.mediaIndex;this.fetchAtBuffer_=true;this.currentTimeline_=t.timeline;this.trigger("syncinfoupdate");if(i.end&&this.currentTime_()-i.end>t.playlist.targetDuration*3){this.resetEverything();return}if(r){this.trigger("bandwidthupdate")}this.trigger("progress");var n=S(t.playlist,this.mediaSource_,t.mediaIndex+1);if(n){this.endOfStream()}if(!this.paused()){this.monitorBuffer_()}}},{key:"recordThroughput_",value:function e(t){var i=this.throughput.rate;var r=Date.now()-t.endOfAllRequests+1;var n=Math.floor(t.byteLength/r*8*1e3);this.throughput.rate+=(n-i)/++this.throughput.count}},{key:"logger_",value:function e(){}},{key:"addSegmentMetadataCue_",value:function e(t){if(!this.segmentMetadataTrack_){return}var i=t.segment;var r=i.start;var n=i.end;if(!k(r)||!k(n)){return}(0,v["default"])(r,n,this.segmentMetadataTrack_);var a=m["default"].WebKitDataCue||m["default"].VTTCue;var s={bandwidth:t.playlist.attributes.BANDWIDTH,resolution:t.playlist.attributes.RESOLUTION,codecs:t.playlist.attributes.CODECS,byteLength:t.byteLength,uri:t.uri,timeline:t.timeline,playlist:t.playlist.uri,start:r,end:n};var o=JSON.stringify(s);var u=new a(r,n,o);u.value=s;this.segmentMetadataTrack_.addCue(u)}}]);return r}(u["default"].EventTarget);P["default"]=A}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./bin-utils":2,"./config":3,"./media-segment-request":7,"./playlist":11,"./playlist-selectors":10,"./ranges":12,"./source-updater":17,"global/window":32,"videojs-contrib-media-sources/es5/remove-cues-from-track.js":72}],17:[function(e,u,f){(function(e){"use strict";Object.defineProperty(f,"__esModule",{value:true});var t=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var r=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var s=i(r);var o=function e(){};var n=function(){function n(t,i){var r=this;a(this,n);var e=function e(){r.sourceBuffer_=t.addSourceBuffer(i);r.onUpdateendCallback_=function(){var e=r.pendingCallback_;r.pendingCallback_=null;if(e){e()}r.runCallback_()};r.sourceBuffer_.addEventListener("updateend",r.onUpdateendCallback_);r.runCallback_()};this.callbacks_=[];this.pendingCallback_=null;this.timestampOffset_=0;this.mediaSource=t;this.processedAppend_=false;if(t.readyState==="closed"){t.addEventListener("sourceopen",e)}else{e()}}t(n,[{key:"abort",value:function e(t){var i=this;if(this.processedAppend_){this.queueCallback_(function(){i.sourceBuffer_.abort()},t)}}},{key:"appendBuffer",value:function e(t,i){var r=this;this.processedAppend_=true;this.queueCallback_(function(){r.sourceBuffer_.appendBuffer(t)},i)}},{key:"buffered",value:function e(){if(!this.sourceBuffer_){return s["default"].createTimeRanges()}return this.sourceBuffer_.buffered}},{key:"remove",value:function e(t,i){var r=this;if(this.processedAppend_){this.queueCallback_(function(){r.sourceBuffer_.remove(t,i)},o)}}},{key:"updating",value:function e(){return!this.sourceBuffer_||this.sourceBuffer_.updating||this.pendingCallback_}},{key:"timestampOffset",value:function e(t){var i=this;if(typeof t!=="undefined"){this.queueCallback_(function(){i.sourceBuffer_.timestampOffset=t});this.timestampOffset_=t}return this.timestampOffset_}},{key:"queueCallback_",value:function e(t,i){this.callbacks_.push([t.bind(this),i]);this.runCallback_()}},{key:"runCallback_",value:function e(){var t=undefined;if(!this.updating()&&this.callbacks_.length){t=this.callbacks_.shift();this.pendingCallback_=t[1];t[0]()}}},{key:"dispose",value:function e(){this.sourceBuffer_.removeEventListener("updateend",this.onUpdateendCallback_);if(this.sourceBuffer_&&this.mediaSource.readyState==="open"){this.sourceBuffer_.abort()}}}]);return n}();f["default"]=n;u.exports=f["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],18:[function(p,e,m){(function(e){"use strict";Object.defineProperty(m,"__esModule",{value:true});var i=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=function e(t,i,r){var n=true;e:while(n){var a=t,s=i,o=r;n=false;if(a===null)a=Function.prototype;var u=Object.getOwnPropertyDescriptor(a,s);if(u===undefined){var f=Object.getPrototypeOf(a);if(f===null){return undefined}else{t=f;i=s;r=o;n=true;u=f=undefined;continue e}}else if("value"in u){return u.value}else{var d=u.get;if(d===undefined){return undefined}return d.call(o)}}};function t(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var s=p("mux.js/lib/mp4/probe");var o=t(s);var u=p("mux.js/lib/tools/ts-inspector.js");var d=p("./playlist");var f=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var l=t(f);var c=[{name:"VOD",run:function e(t,i,r,n,a){if(r!==Infinity){var s={time:0,segmentIndex:0};return s}return null}},{name:"ProgramDateTime",run:function e(t,i,r,n,a){if(t.datetimeToDisplayTime&&i.dateTimeObject){var s=i.dateTimeObject.getTime()/1e3;var o=s+t.datetimeToDisplayTime;var u={time:o,segmentIndex:0};return u}return null}},{name:"Segment",run:function e(t,i,r,n,a){var s=i.segments||[];var o=null;var u=null;a=a||0;for(var f=0;f<s.length;f++){var d=s[f];if(d.timeline===n&&typeof d.start!=="undefined"){var l=Math.abs(a-d.start);if(u!==null&&u<l){break}if(!o||u===null||u>=l){u=l;o={time:d.start,segmentIndex:f}}}}return o}},{name:"Discontinuity",run:function e(t,i,r,n,a){var s=null;a=a||0;if(i.discontinuityStarts&&i.discontinuityStarts.length){var o=null;for(var u=0;u<i.discontinuityStarts.length;u++){var f=i.discontinuityStarts[u];var d=i.discontinuitySequence+u+1;var l=t.discontinuities[d];if(l){var c=Math.abs(a-l.time);if(o!==null&&o<c){break}if(!s||o===null||o>=c){o=c;s={time:l.time,segmentIndex:f}}}}}return s}},{name:"Playlist",run:function e(t,i,r,n,a){if(i.syncInfo){var s={time:i.syncInfo.time,segmentIndex:i.syncInfo.mediaSequence-i.mediaSequence};return s}return null}}];m.syncPointStrategies=c;var h=function(e){a(t,e);function t(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];n(this,t);r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);this.inspectCache_=undefined;this.timelines=[];this.discontinuities=[];this.datetimeToDisplayTime=null;if(e.debug){this.logger_=l["default"].log.bind(l["default"],"sync-controller ->")}}i(t,[{key:"getSyncPoint",value:function e(t,i,r,n){var a=this.runStrategies_(t,i,r,n);if(!a.length){return null}return this.selectSyncPoint_(a,{key:"time",value:n})}},{key:"getExpiredTime",value:function e(t,i){if(!t||!t.segments){return null}var r=this.runStrategies_(t,i,t.discontinuitySequence,0);if(!r.length){return null}var n=this.selectSyncPoint_(r,{key:"segmentIndex",value:0});if(n.segmentIndex>0){n.time*=-1}return Math.abs(n.time+(0,d.sumDurations)(t,n.segmentIndex,0))}},{key:"runStrategies_",value:function e(t,i,r,n){var a=[];for(var s=0;s<c.length;s++){var o=c[s];var u=o.run(this,t,i,r,n);if(u){u.strategy=o.name;a.push({strategy:o.name,syncPoint:u});this.logger_("syncPoint found via <"+o.name+">:",u)}}return a}},{key:"selectSyncPoint_",value:function e(t,i){var r=t[0].syncPoint;var n=Math.abs(t[0].syncPoint[i.key]-i.value);var a=t[0].strategy;for(var s=1;s<t.length;s++){var o=Math.abs(t[s].syncPoint[i.key]-i.value);if(o<n){n=o;r=t[s].syncPoint;a=t[s].strategy}}this.logger_("syncPoint with strategy <"+a+"> chosen: ",r);return r}},{key:"saveExpiredSegmentInfo",value:function e(t,i){var r=i.mediaSequence-t.mediaSequence;for(var n=r-1;n>=0;n--){var a=t.segments[n];if(a&&typeof a.start!=="undefined"){i.syncInfo={mediaSequence:t.mediaSequence+n,time:a.start};this.logger_("playlist sync:",i.syncInfo);this.trigger("syncinfoupdate");break}}}},{key:"setDateTimeMapping",value:function e(t){if(!this.datetimeToDisplayTime&&t.dateTimeObject){var i=t.dateTimeObject.getTime()/1e3;this.datetimeToDisplayTime=-i}}},{key:"reset",value:function e(){this.inspectCache_=undefined}},{key:"probeSegmentInfo",value:function e(t){var i=t.segment;var r=t.playlist;var n=undefined;if(i.map){n=this.probeMp4Segment_(t)}else{n=this.probeTsSegment_(t)}if(n){if(this.calculateSegmentTimeMapping_(t,n)){this.saveDiscontinuitySyncInfo_(t);if(!r.syncInfo){r.syncInfo={mediaSequence:r.mediaSequence+t.mediaIndex,time:i.start}}}}return n}},{key:"probeMp4Segment_",value:function e(t){var i=t.segment;var r=o["default"].timescale(i.map.bytes);var n=o["default"].startTime(r,t.bytes);if(t.timestampOffset!==null){t.timestampOffset-=n}return{start:n,end:n+i.duration}}},{key:"probeTsSegment_",value:function e(t){var i=(0,u.inspect)(t.bytes,this.inspectCache_);var r=undefined;var n=undefined;if(!i){return null}if(i.video&&i.video.length===2){this.inspectCache_=i.video[1].dts;r=i.video[0].dtsTime;n=i.video[1].dtsTime}else if(i.audio&&i.audio.length===2){this.inspectCache_=i.audio[1].dts;r=i.audio[0].dtsTime;n=i.audio[1].dtsTime}return{start:r,end:n,containsVideo:i.video&&i.video.length===2,containsAudio:i.audio&&i.audio.length===2}}},{key:"timestampOffsetForTimeline",value:function e(t){if(typeof this.timelines[t]==="undefined"){return null}return this.timelines[t].time}},{key:"mappingForTimeline",value:function e(t){if(typeof this.timelines[t]==="undefined"){return null}return this.timelines[t].mapping}},{key:"calculateSegmentTimeMapping_",value:function e(t,i){var r=t.segment;var n=this.timelines[t.timeline];if(t.timestampOffset!==null){this.logger_("tsO:",t.timestampOffset);n={time:t.startOfSegment,mapping:t.startOfSegment-i.start};this.timelines[t.timeline]=n;this.trigger("timestampoffset");r.start=t.startOfSegment;r.end=i.end+n.mapping}else if(n){r.start=i.start+n.mapping;r.end=i.end+n.mapping}else{return false}return true}},{key:"saveDiscontinuitySyncInfo_",value:function e(t){var i=t.playlist;var r=t.segment;if(r.discontinuity){this.discontinuities[r.timeline]={time:r.start,accuracy:0}}else if(i.discontinuityStarts.length){for(var n=0;n<i.discontinuityStarts.length;n++){var a=i.discontinuityStarts[n];var s=i.discontinuitySequence+n+1;var o=a-t.mediaIndex;var u=Math.abs(o);if(!this.discontinuities[s]||this.discontinuities[s].accuracy>u){var f=undefined;if(o<0){f=r.start-(0,d.sumDurations)(i,t.mediaIndex,a)}else{f=r.end+(0,d.sumDurations)(i,t.mediaIndex+1,a)}this.discontinuities[s]={time:f,accuracy:u}}}}}},{key:"logger_",value:function e(){}}]);return t}(l["default"].EventTarget);m["default"]=h}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./playlist":11,"mux.js/lib/mp4/probe":57,"mux.js/lib/tools/ts-inspector.js":59}],19:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function e(){var t=arguments.length<=0||arguments[0]===undefined?"":arguments[0];var i={codecCount:0};var r=undefined;i.codecCount=t.split(",").length;i.codecCount=i.codecCount||2;r=/(^|\s|,)+(avc1)([^ ,]*)/i.exec(t);if(r){i.videoCodec=r[2];i.videoObjectTypeIndicator=r[3]}i.audioProfile=/(^|\s|,)+mp4a.[0-9A-Fa-f]+\.([0-9A-Fa-f]+)/i.exec(t);i.audioProfile=i.audioProfile&&i.audioProfile[2];return i};i.parseCodecs=r},{}],20:[function(y,_,b){(function(e){"use strict";Object.defineProperty(b,"__esModule",{value:true});var t=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=function e(t,i,r){var n=true;e:while(n){var a=t,s=i,o=r;n=false;if(a===null)a=Function.prototype;var u=Object.getOwnPropertyDescriptor(a,s);if(u===undefined){var f=Object.getPrototypeOf(a);if(f===null){return undefined}else{t=f;i=s;r=o;n=true;u=f=undefined;continue e}}else if("value"in u){return u.value}else{var d=u.get;if(d===undefined){return undefined}return d.call(o)}}};function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var s=y("./segment-loader");var o=i(s);var u=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var f=i(u);var d=y("global/window");var l=i(d);var c=y("videojs-contrib-media-sources/es5/remove-cues-from-track.js");var h=i(c);var p=y("./bin-utils");var m=new Uint8Array("\n\n".split("").map(function(e){return e.charCodeAt(0)}));var g=function e(t){return String.fromCharCode.apply(null,t)};var v=function(e){a(i,e);function i(e){var t=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];n(this,i);r(Object.getPrototypeOf(i.prototype),"constructor",this).call(this,e,t);this.mediaSource_=null;this.subtitlesTrack_=null}t(i,[{key:"buffered_",value:function e(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues.length){return f["default"].createTimeRanges()}var t=this.subtitlesTrack_.cues;var i=t[0].startTime;var r=t[t.length-1].startTime;return f["default"].createTimeRanges([[i,r]])}},{key:"initSegment",value:function e(t){var i=arguments.length<=1||arguments[1]===undefined?false:arguments[1];if(!t){return null}var r=(0,p.initSegmentId)(t);var n=this.initSegments_[r];if(i&&!n&&t.bytes){var a=m.byteLength+t.bytes.byteLength;var s=new Uint8Array(a);s.set(t.bytes);s.set(m,t.bytes.byteLength);this.initSegments_[r]=n={resolvedUri:t.resolvedUri,byterange:t.byterange,bytes:s}}return n||t}},{key:"couldBeginLoading_",value:function e(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}},{key:"init_",value:function e(){this.state="READY";this.resetEverything();return this.monitorBuffer_()}},{key:"track",value:function e(t){if(typeof t==="undefined"){return this.subtitlesTrack_}this.subtitlesTrack_=t;if(this.state==="INIT"&&this.couldBeginLoading_()){this.init_()}return this.subtitlesTrack_}},{key:"remove",value:function e(t,i){(0,h["default"])(t,i,this.subtitlesTrack_)}},{key:"fillBuffer_",value:function e(){var t=this;if(!this.syncPoint_){this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_())}var i=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);i=this.skipEmptySegments_(i);if(!i){return}if(this.syncController_.timestampOffsetForTimeline(i.timeline)===null){var r=function e(){t.state="READY";if(!t.paused()){t.monitorBuffer_()}};this.syncController_.one("timestampoffset",r);this.state="WAITING_ON_TIMELINE";return}this.loadSegment_(i)}},{key:"skipEmptySegments_",value:function e(t){while(t&&t.segment.empty){t=this.generateSegmentInfo_(t.playlist,t.mediaIndex+1,t.startOfSegment+t.duration,t.isSyncRequest)}return t}},{key:"handleSegment_",value:function e(){var t=this;if(!this.pendingSegment_||!this.subtitlesTrack_){this.state="READY";return}this.state="APPENDING";var i=this.pendingSegment_;var r=i.segment;if(typeof l["default"].WebVTT!=="function"&&this.subtitlesTrack_&&this.subtitlesTrack_.tech_){var n=function(){var e=function e(){t.handleSegment_()};t.state="WAITING_ON_VTTJS";t.subtitlesTrack_.tech_.one("vttjsloaded",e);t.subtitlesTrack_.tech_.one("vttjserror",function(){t.subtitlesTrack_.tech_.off("vttjsloaded",e);t.error({message:"Error loading vtt.js"});t.state="READY";t.pause();t.trigger("error")});return{v:undefined}}();if(typeof n==="object")return n.v}r.requested=true;try{this.parseVTTCues_(i)}catch(e){this.error({message:e.message});this.state="READY";this.pause();return this.trigger("error")}this.updateTimeMapping_(i,this.syncController_.timelines[i.timeline],this.playlist_);if(i.isSyncRequest){this.trigger("syncinfoupdate");this.pendingSegment_=null;this.state="READY";return}i.byteLength=i.bytes.byteLength;this.mediaSecondsLoaded+=r.duration;if(i.cues.length){this.remove(i.cues[0].endTime,i.cues[i.cues.length-1].endTime)}i.cues.forEach(function(e){t.subtitlesTrack_.addCue(e)});this.handleUpdateEnd_()}},{key:"parseVTTCues_",value:function e(t){var i=undefined;var r=false;if(typeof l["default"].TextDecoder==="function"){i=new l["default"].TextDecoder("utf8")}else{i=l["default"].WebVTT.StringDecoder();r=true}var n=new l["default"].WebVTT.Parser(l["default"],l["default"].vttjs,i);t.cues=[];t.timestampmap={MPEGTS:0,LOCAL:0};n.oncue=t.cues.push.bind(t.cues);n.ontimestampmap=function(e){return t.timestampmap=e};n.onparsingerror=function(e){f["default"].log.warn("Error encountered when parsing cues: "+e.message)};if(t.segment.map){var a=t.segment.map.bytes;if(r){a=g(a)}n.parse(a)}var s=t.bytes;if(r){s=g(s)}n.parse(s);n.flush()}},{key:"updateTimeMapping_",value:function e(t,i,r){var n=t.segment;if(!i){return}if(!t.cues.length){n.empty=true;return}var a=t.timestampmap;var s=a.MPEGTS/9e4-a.LOCAL+i.mapping;t.cues.forEach(function(e){e.startTime+=s;e.endTime+=s});if(!r.syncInfo){var o=t.cues[0].startTime;var u=t.cues[t.cues.length-1].startTime;r.syncInfo={mediaSequence:r.mediaSequence+t.mediaIndex,time:Math.min(o,u-n.duration)}}}}]);return i}(o["default"]);b["default"]=v;_.exports=b["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./bin-utils":2,"./segment-loader":16,"global/window":32,"videojs-contrib-media-sources/es5/remove-cues-from-track.js":72}],21:[function(e,r,n){(function(e){"use strict";Object.defineProperty(n,"__esModule",{value:true});function t(e){return e&&e.__esModule?e:{default:e}}var o=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var u=t(o);var i=function e(){var t=function e(t,r){t=(0,o.mergeOptions)({timeout:45e3},t);var i=e.beforeRequest||u["default"].Hls.xhr.beforeRequest;if(i&&typeof i==="function"){var n=i(t);if(n){t=n}}var a=(0,o.xhr)(t,function(e,t){var i=a.response;if(!e&&i){a.responseTime=Date.now();a.roundTripTime=a.responseTime-a.requestTime;a.bytesReceived=i.byteLength||i.length;if(!a.bandwidth){a.bandwidth=Math.floor(a.bytesReceived/a.roundTripTime*8*1e3)}}if(e&&e.code==="ETIMEDOUT"){a.timedout=true}if(!e&&!a.aborted&&t.statusCode!==200&&t.statusCode!==206&&t.statusCode!==0){e=new Error("XHR Failed with a response of: "+(a&&(i||a.responseText)))}r(e,a)});var s=a.abort;a.abort=function(){a.aborted=true;return s.apply(a,arguments)};a.uri=t.uri;a.requestTime=Date.now();return a};return t};n["default"]=i;r.exports=n["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],22:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function e(){var t=[[[],[],[],[],[]],[[],[],[],[],[]]];var i=t[0];var r=t[1];var n=i[4];var a=r[4];var s=undefined;var o=undefined;var u=undefined;var f=[];var d=[];var l=undefined;var c=undefined;var h=undefined;var p=undefined;var m=undefined;var g=undefined;for(s=0;s<256;s++){d[(f[s]=s<<1^(s>>7)*283)^s]=s}for(o=u=0;!n[o];o^=l||1,u=d[u]||1){p=u^u<<1^u<<2^u<<3^u<<4;p=p>>8^p&255^99;n[o]=p;a[p]=o;h=f[c=f[l=f[o]]];g=h*16843009^c*65537^l*257^o*16843008;m=f[p]*257^p*16843008;for(s=0;s<4;s++){i[s][o]=m=m<<24^m>>>8;r[s][p]=g=g<<24^g>>>8}}for(s=0;s<5;s++){i[s]=i[s].slice(0);r[s]=r[s].slice(0)}return t};var h=null;var n=function(){function d(e){l(this,d);if(!h){h=c()}this._tables=[[h[0][0].slice(),h[0][1].slice(),h[0][2].slice(),h[0][3].slice(),h[0][4].slice()],[h[1][0].slice(),h[1][1].slice(),h[1][2].slice(),h[1][3].slice(),h[1][4].slice()]];var t=undefined;var i=undefined;var r=undefined;var n=undefined;var a=undefined;var s=this._tables[0][4];var o=this._tables[1];var u=e.length;var f=1;if(u!==4&&u!==6&&u!==8){throw new Error("Invalid aes key size")}n=e.slice(0);a=[];this._key=[n,a];for(t=u;t<4*u+28;t++){r=n[t-1];if(t%u===0||u===8&&t%u===4){r=s[r>>>24]<<24^s[r>>16&255]<<16^s[r>>8&255]<<8^s[r&255];if(t%u===0){r=r<<8^r>>>24^f<<24;f=f<<1^(f>>7)*283}}n[t]=n[t-u]^r}for(i=0;t;i++,t--){r=n[i&3?t:t-4];if(t<=4||i<4){a[i]=r}else{a[i]=o[0][s[r>>>24]]^o[1][s[r>>16&255]]^o[2][s[r>>8&255]]^o[3][s[r&255]]}}}r(d,[{key:"decrypt",value:function e(t,i,r,n,a,s){var o=this._key[1];var u=t^o[0];var f=n^o[1];var d=r^o[2];var l=i^o[3];var c=undefined;var h=undefined;var p=undefined;var m=o.length/4-2;var g=undefined;var v=4;var y=this._tables[1];var _=y[0];var b=y[1];var T=y[2];var w=y[3];var S=y[4];for(g=0;g<m;g++){c=_[u>>>24]^b[f>>16&255]^T[d>>8&255]^w[l&255]^o[v];h=_[f>>>24]^b[d>>16&255]^T[l>>8&255]^w[u&255]^o[v+1];p=_[d>>>24]^b[l>>16&255]^T[u>>8&255]^w[f&255]^o[v+2];l=_[l>>>24]^b[u>>16&255]^T[f>>8&255]^w[d&255]^o[v+3];v+=4;u=c;f=h;d=p}for(g=0;g<4;g++){a[(3&-g)+s]=S[u>>>24]<<24^S[f>>16&255]<<16^S[d>>8&255]<<8^S[l&255]^o[v++];c=u;u=f;f=d;d=l;l=c}}}]);return d}();i["default"]=n;t.exports=i["default"]},{}],23:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=function e(t,i,r){var n=true;e:while(n){var a=t,s=i,o=r;n=false;if(a===null)a=Function.prototype;var u=Object.getOwnPropertyDescriptor(a,s);if(u===undefined){var f=Object.getPrototypeOf(a);if(f===null){return undefined}else{t=f;i=s;r=o;n=true;u=f=undefined;continue e}}else if("value"in u){return u.value}else{var d=u.get;if(d===undefined){return undefined}return d.call(o)}}};function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var u=e("./stream");var f=a(u);var d=function(e){o(t,e);function t(){s(this,t);n(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,f["default"]);this.jobs=[];this.delay=1;this.timeout_=null}r(t,[{key:"processJob_",value:function e(){this.jobs.shift()();if(this.jobs.length){this.timeout_=setTimeout(this.processJob_.bind(this),this.delay)}else{this.timeout_=null}}},{key:"push",value:function e(t){this.jobs.push(t);if(!this.timeout_){this.timeout_=setTimeout(this.processJob_.bind(this),this.delay)}}}]);return t}(f["default"]);i["default"]=d;t.exports=i["default"]},{"./stream":26}],24:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=e("./aes");var v=n(a);var s=e("./async-stream");var d=n(s);var l=e("pkcs7");var y=function e(t){return t<<24|(t&65280)<<8|(t&16711680)>>8|t>>>24};var o=function e(t,i,r){var n=new Int32Array(t.buffer,t.byteOffset,t.byteLength>>2);var a=new v["default"](Array.prototype.slice.call(i));var s=new Uint8Array(t.byteLength);var o=new Int32Array(s.buffer);var u=undefined;var f=undefined;var d=undefined;var l=undefined;var c=undefined;var h=undefined;var p=undefined;var m=undefined;var g=undefined;u=r[0];f=r[1];d=r[2];l=r[3];for(g=0;g<n.length;g+=4){c=y(n[g]);h=y(n[g+1]);p=y(n[g+2]);m=y(n[g+3]);a.decrypt(c,h,p,m,o,g);o[g]=y(o[g]^u);o[g+1]=y(o[g+1]^f);o[g+2]=y(o[g+2]^d);o[g+3]=y(o[g+3]^l);u=c;f=h;d=p;l=m}return s};i.decrypt=o;var u=function(){function u(e,t,i,r){f(this,u);var n=u.STEP;var a=new Int32Array(e.buffer);var s=new Uint8Array(e.byteLength);var o=0;this.asyncStream_=new d["default"];this.asyncStream_.push(this.decryptChunk_(a.subarray(o,o+n),t,i,s));for(o=n;o<a.length;o+=n){i=new Uint32Array([y(a[o-4]),y(a[o-3]),y(a[o-2]),y(a[o-1])]);this.asyncStream_.push(this.decryptChunk_(a.subarray(o,o+n),t,i,s))}this.asyncStream_.push(function(){r(null,(0,l.unpad)(s))})}r(u,[{key:"decryptChunk_",value:function e(t,i,r,n){return function(){var e=o(t,i,r);n.set(e,t.byteOffset)}}}],[{key:"STEP",get:function e(){return 32e3}}]);return u}();i.Decrypter=u;i["default"]={Decrypter:u,decrypt:o}},{"./aes":22,"./async-stream":23,pkcs7:28}],25:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});function r(e){return e&&e.__esModule?e:{default:e}}var n=e("./decrypter");var a=e("./async-stream");var s=r(a);i["default"]={decrypt:n.decrypt,Decrypter:n.Decrypter,AsyncStream:s["default"]};t.exports=i["default"]},{"./async-stream":23,"./decrypter":24}],26:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){n(this,e);this.listeners={}}r(e,[{key:"on",value:function e(t,i){if(!this.listeners[t]){this.listeners[t]=[]}this.listeners[t].push(i)}},{key:"off",value:function e(t,i){var r=undefined;if(!this.listeners[t]){return false}r=this.listeners[t].indexOf(i);this.listeners[t].splice(r,1);return r>-1}},{key:"trigger",value:function e(t){var i=undefined;var r=undefined;var n=undefined;var a=undefined;i=this.listeners[t];if(!i){return}if(arguments.length===2){n=i.length;for(r=0;r<n;++r){i[r].call(this,arguments[1])}}else{a=Array.prototype.slice.call(arguments,1);n=i.length;for(r=0;r<n;++r){i[r].apply(this,a)}}}},{key:"dispose",value:function e(){this.listeners={}}},{key:"pipe",value:function e(t){this.on("data",function(e){t.push(e)})}}]);return e}();i["default"]=a;t.exports=i["default"]},{}],27:[function(e,t,i){"use strict";var n;t.exports=function e(t){var i=n[t.byteLength%16||0],r=new Uint8Array(t.byteLength+i.length);r.set(t);r.set(i,t.byteLength);return r};n=[[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],[15,15,15,15,15,15,15,15,15,15,15,15,15,15,15],[14,14,14,14,14,14,14,14,14,14,14,14,14,14],[13,13,13,13,13,13,13,13,13,13,13,13,13],[12,12,12,12,12,12,12,12,12,12,12,12],[11,11,11,11,11,11,11,11,11,11,11],[10,10,10,10,10,10,10,10,10,10],[9,9,9,9,9,9,9,9,9],[8,8,8,8,8,8,8,8],[7,7,7,7,7,7,7],[6,6,6,6,6,6],[5,5,5,5,5],[4,4,4,4],[3,3,3],[2,2],[1]]},{}],28:[function(e,t,i){"use strict";i.pad=e("./pad.js");i.unpad=e("./unpad.js")},{"./pad.js":27,"./unpad.js":29}],29:[function(e,t,i){"use strict";t.exports=function e(t){return t.subarray(0,t.byteLength-t[t.byteLength-1])}},{}],30:[function(e,t,i){},{}],31:[function(n,a,e){(function(e){var t=typeof e!=="undefined"?e:typeof window!=="undefined"?window:{};var i=n("min-document");var r;if(typeof document!=="undefined"){r=document}else{r=t["__GLOBAL_DOCUMENT_CACHE@4"];if(!r){r=t["__GLOBAL_DOCUMENT_CACHE@4"]=i}}a.exports=r}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"min-document":30}],32:[function(e,i,t){(function(e){var t;if(typeof window!=="undefined"){t=window}else if(typeof e!=="undefined"){t=e}else if(typeof self!=="undefined"){t=self}else{t={}}i.exports=t}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],33:[function(e,t,i){"use strict";var r=e("./line-stream");var n=f(r);var a=e("./parse-stream");var s=f(a);var o=e("./parser");var u=f(o);function f(e){return e&&e.__esModule?e:{default:e}}t.exports={LineStream:n["default"],ParseStream:s["default"],Parser:u["default"]}},{"./line-stream":34,"./parse-stream":35,"./parser":36}],34:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("./stream");var a=s(n);function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){f(t,e);function t(){o(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.buffer="";return e}r(t,[{key:"push",value:function e(t){var i=void 0;this.buffer+=t;i=this.buffer.indexOf("\n");for(;i>-1;i=this.buffer.indexOf("\n")){this.trigger("data",this.buffer.substring(0,i));this.buffer=this.buffer.substring(i+1)}}}]);return t}(a["default"]);i["default"]=d},{"./stream":37}],35:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var l=function(){function i(e,t){var i=[];var r=true;var n=false;var a=undefined;try{for(var s=e[Symbol.iterator](),o;!(r=(o=s.next()).done);r=true){i.push(o.value);if(t&&i.length===t)break}}catch(e){n=true;a=e}finally{try{if(!r&&s["return"])s["return"]()}finally{if(n)throw a}}return i}return function(e,t){if(Array.isArray(e)){return e}else if(Symbol.iterator in Object(e)){return i(e,t)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("./stream");var a=s(n);function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function e(){var t="[^=]*";var i='"[^"]*"|[^,]*';var r="(?:"+t+")=(?:"+i+")";return new RegExp("(?:^|,)("+r+")")};var c=function e(t){var i=t.split(d());var r={};var n=i.length;var a=void 0;while(n--){if(i[n]===""){continue}a=/([^=]*)=(.*)/.exec(i[n]).slice(1);a[0]=a[0].replace(/^\s+|\s+$/g,"");a[1]=a[1].replace(/^\s+|\s+$/g,"");a[1]=a[1].replace(/^['"](.*)['"]$/g,"$1");r[a[0]]=a[1]}return r};var h=function(e){f(t,e);function t(){o(this,t);return u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}r(t,[{key:"push",value:function e(t){var i=void 0;var r=void 0;t=t.replace(/^[\u0000\s]+|[\u0000\s]+$/g,"");if(t.length===0){return}if(t[0]!=="#"){this.trigger("data",{type:"uri",uri:t});return}if(t.indexOf("#EXT")!==0){this.trigger("data",{type:"comment",text:t.slice(1)});return}t=t.replace("\r","");i=/^#EXTM3U/.exec(t);if(i){this.trigger("data",{type:"tag",tagType:"m3u"});return}i=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(t);if(i){r={type:"tag",tagType:"inf"};if(i[1]){r.duration=parseFloat(i[1])}if(i[2]){r.title=i[2]}this.trigger("data",r);return}i=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(t);if(i){r={type:"tag",tagType:"targetduration"};if(i[1]){r.duration=parseInt(i[1],10)}this.trigger("data",r);return}i=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(t);if(i){r={type:"tag",tagType:"totalduration"};if(i[1]){r.duration=parseInt(i[1],10)}this.trigger("data",r);return}i=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(t);if(i){r={type:"tag",tagType:"version"};if(i[1]){r.version=parseInt(i[1],10)}this.trigger("data",r);return}i=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(t);if(i){r={type:"tag",tagType:"media-sequence"};if(i[1]){r.number=parseInt(i[1],10)}this.trigger("data",r);return}i=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(t);if(i){r={type:"tag",tagType:"discontinuity-sequence"};if(i[1]){r.number=parseInt(i[1],10)}this.trigger("data",r);return}i=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(t);if(i){r={type:"tag",tagType:"playlist-type"};if(i[1]){r.playlistType=i[1]}this.trigger("data",r);return}i=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(t);if(i){r={type:"tag",tagType:"byterange"};if(i[1]){r.length=parseInt(i[1],10)}if(i[2]){r.offset=parseInt(i[2],10)}this.trigger("data",r);return}i=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(t);if(i){r={type:"tag",tagType:"allow-cache"};if(i[1]){r.allowed=!/NO/.test(i[1])}this.trigger("data",r);return}i=/^#EXT-X-MAP:?(.*)$/.exec(t);if(i){r={type:"tag",tagType:"map"};if(i[1]){var n=c(i[1]);if(n.URI){r.uri=n.URI}if(n.BYTERANGE){var a=n.BYTERANGE.split("@"),s=l(a,2),o=s[0],u=s[1];r.byterange={};if(o){r.byterange.length=parseInt(o,10)}if(u){r.byterange.offset=parseInt(u,10)}}}this.trigger("data",r);return}i=/^#EXT-X-STREAM-INF:?(.*)$/.exec(t);if(i){r={type:"tag",tagType:"stream-inf"};if(i[1]){r.attributes=c(i[1]);if(r.attributes.RESOLUTION){var f=r.attributes.RESOLUTION.split("x");var d={};if(f[0]){d.width=parseInt(f[0],10)}if(f[1]){d.height=parseInt(f[1],10)}r.attributes.RESOLUTION=d}if(r.attributes.BANDWIDTH){r.attributes.BANDWIDTH=parseInt(r.attributes.BANDWIDTH,10)}if(r.attributes["PROGRAM-ID"]){r.attributes["PROGRAM-ID"]=parseInt(r.attributes["PROGRAM-ID"],10)}}this.trigger("data",r);return}i=/^#EXT-X-MEDIA:?(.*)$/.exec(t);if(i){r={type:"tag",tagType:"media"};if(i[1]){r.attributes=c(i[1])}this.trigger("data",r);return}i=/^#EXT-X-ENDLIST/.exec(t);if(i){this.trigger("data",{type:"tag",tagType:"endlist"});return}i=/^#EXT-X-DISCONTINUITY/.exec(t);if(i){this.trigger("data",{type:"tag",tagType:"discontinuity"});return}i=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(t);if(i){r={type:"tag",tagType:"program-date-time"};if(i[1]){r.dateTimeString=i[1];r.dateTimeObject=new Date(i[1])}this.trigger("data",r);return}i=/^#EXT-X-KEY:?(.*)$/.exec(t);if(i){r={type:"tag",tagType:"key"};if(i[1]){r.attributes=c(i[1]);if(r.attributes.IV){if(r.attributes.IV.substring(0,2).toLowerCase()==="0x"){r.attributes.IV=r.attributes.IV.substring(2)}r.attributes.IV=r.attributes.IV.match(/.{8}/g);r.attributes.IV[0]=parseInt(r.attributes.IV[0],16);r.attributes.IV[1]=parseInt(r.attributes.IV[1],16);r.attributes.IV[2]=parseInt(r.attributes.IV[2],16);r.attributes.IV[3]=parseInt(r.attributes.IV[3],16);r.attributes.IV=new Uint32Array(r.attributes.IV)}}this.trigger("data",r);return}i=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(t);if(i){r={type:"tag",tagType:"cue-out-cont"};if(i[1]){r.data=i[1]}else{r.data=""}this.trigger("data",r);return}i=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(t);if(i){r={type:"tag",tagType:"cue-out"};if(i[1]){r.data=i[1]}else{r.data=""}this.trigger("data",r);return}i=/^#EXT-X-CUE-IN:?(.*)?$/.exec(t);if(i){r={type:"tag",tagType:"cue-in"};if(i[1]){r.data=i[1]}else{r.data=""}this.trigger("data",r);return}this.trigger("data",{type:"tag",data:t.slice(4)})}}]);return t}(a["default"]);i["default"]=h},{"./stream":37}],36:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i){if(Object.prototype.hasOwnProperty.call(i,r)){e[r]=i[r]}}}return e};var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var n=e("./stream");var a=u(n);var s=e("./line-stream");var h=u(s);var o=e("./parse-stream");var p=u(o);function u(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function g(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){f(i,e);function i(){m(this,i);var e=g(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));e.lineStream=new h["default"];e.parseStream=new p["default"];e.lineStream.pipe(e.parseStream);var t=e;var a=[];var s={};var o=void 0;var u=void 0;var f=function e(){};var d={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}};var l=0;e.manifest={allowCache:true,discontinuityStarts:[],segments:[]};e.parseStream.on("data",function(i){var r=void 0;var n=void 0;({tag:function e(){({"allow-cache":function e(){this.manifest.allowCache=i.allowed;if(!("allowed"in i)){this.trigger("info",{message:"defaulting allowCache to YES"});this.manifest.allowCache=true}},byterange:function e(){var e={};if("length"in i){s.byterange=e;e.length=i.length;if(!("offset"in i)){this.trigger("info",{message:"defaulting offset to zero"});i.offset=0}}if("offset"in i){s.byterange=e;e.offset=i.offset}},endlist:function e(){this.manifest.endList=true},inf:function e(){if(!("mediaSequence"in this.manifest)){this.manifest.mediaSequence=0;this.trigger("info",{message:"defaulting media sequence to zero"})}if(!("discontinuitySequence"in this.manifest)){this.manifest.discontinuitySequence=0;this.trigger("info",{message:"defaulting discontinuity sequence to zero"})}if(i.duration>0){s.duration=i.duration}if(i.duration===0){s.duration=.01;this.trigger("info",{message:"updating zero segment duration to a small value"})}this.manifest.segments=a},key:function e(){if(!i.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if(i.attributes.METHOD==="NONE"){u=null;return}if(!i.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if(!i.attributes.METHOD){this.trigger("warn",{message:"defaulting key method to AES-128"})}u={method:i.attributes.METHOD||"AES-128",uri:i.attributes.URI};if(typeof i.attributes.IV!=="undefined"){u.iv=i.attributes.IV}},"media-sequence":function e(){if(!isFinite(i.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+i.number});return}this.manifest.mediaSequence=i.number},"discontinuity-sequence":function e(){if(!isFinite(i.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+i.number});return}this.manifest.discontinuitySequence=i.number;l=i.number},"playlist-type":function e(){if(!/VOD|EVENT/.test(i.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+i.playlist});return}this.manifest.playlistType=i.playlistType},map:function e(){o={};if(i.uri){o.uri=i.uri}if(i.byterange){o.byterange=i.byterange}},"stream-inf":function e(){this.manifest.playlists=a;this.manifest.mediaGroups=this.manifest.mediaGroups||d;if(!i.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}if(!s.attributes){s.attributes={}}c(s.attributes,i.attributes)},media:function e(){this.manifest.mediaGroups=this.manifest.mediaGroups||d;if(!(i.attributes&&i.attributes.TYPE&&i.attributes["GROUP-ID"]&&i.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}var t=this.manifest.mediaGroups[i.attributes.TYPE];t[i.attributes["GROUP-ID"]]=t[i.attributes["GROUP-ID"]]||{};r=t[i.attributes["GROUP-ID"]];n={default:/yes/i.test(i.attributes.DEFAULT)};if(n["default"]){n.autoselect=true}else{n.autoselect=/yes/i.test(i.attributes.AUTOSELECT)}if(i.attributes.LANGUAGE){n.language=i.attributes.LANGUAGE}if(i.attributes.URI){n.uri=i.attributes.URI}if(i.attributes["INSTREAM-ID"]){n.instreamId=i.attributes["INSTREAM-ID"]}if(i.attributes.CHARACTERISTICS){n.characteristics=i.attributes.CHARACTERISTICS}if(i.attributes.FORCED){n.forced=/yes/i.test(i.attributes.FORCED)}r[i.attributes.NAME]=n},discontinuity:function e(){l+=1;s.discontinuity=true;this.manifest.discontinuityStarts.push(a.length)},"program-date-time":function e(){this.manifest.dateTimeString=i.dateTimeString;this.manifest.dateTimeObject=i.dateTimeObject},targetduration:function e(){if(!isFinite(i.duration)||i.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+i.duration});return}this.manifest.targetDuration=i.duration},totalduration:function e(){if(!isFinite(i.duration)||i.duration<0){this.trigger("warn",{message:"ignoring invalid total duration: "+i.duration});return}this.manifest.totalDuration=i.duration},"cue-out":function e(){s.cueOut=i.data},"cue-out-cont":function e(){s.cueOutCont=i.data},"cue-in":function e(){s.cueIn=i.data}}[i.tagType]||f).call(t)},uri:function e(){s.uri=i.uri;a.push(s);if(this.manifest.targetDuration&&!("duration"in s)){this.trigger("warn",{message:"defaulting segment duration to the target duration"});s.duration=this.manifest.targetDuration}if(u){s.key=u}s.timeline=l;if(o){s.map=o}s={}},comment:function e(){}})[i.type].call(t)});return e}r(i,[{key:"push",value:function e(t){this.lineStream.push(t)}},{key:"end",value:function e(){this.lineStream.push("\n")}}]);return i}(a["default"]);i["default"]=d},{"./line-stream":34,"./parse-stream":35,"./stream":37}],37:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){n(this,e);this.listeners={}}r(e,[{key:"on",value:function e(t,i){if(!this.listeners[t]){this.listeners[t]=[]}this.listeners[t].push(i)}},{key:"off",value:function e(t,i){if(!this.listeners[t]){return false}var r=this.listeners[t].indexOf(i);this.listeners[t].splice(r,1);return r>-1}},{key:"trigger",value:function e(t){var i=this.listeners[t];var r=void 0;var n=void 0;var a=void 0;if(!i){return}if(arguments.length===2){n=i.length;for(r=0;r<n;++r){i[r].call(this,arguments[1])}}else{a=Array.prototype.slice.call(arguments,1);n=i.length;for(r=0;r<n;++r){i[r].apply(this,a)}}}},{key:"dispose",value:function e(){this.listeners={}}},{key:"pipe",value:function e(t){this.on("data",function(e){t.push(e)})}}]);return e}();i["default"]=a},{}],38:[function(e,t,i){"use strict";var r=e("../utils/stream.js");var n;n=function(){var o=new Uint8Array,u=0;n.prototype.init.call(this);this.setTimestamp=function(e){u=e};this.parseId3TagSize=function(e,t){var i=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],r=e[t+5],n=(r&16)>>4;if(n){return i+20}return i+10};this.parseAdtsSize=function(e,t){var i=(e[t+5]&224)>>5,r=e[t+4]<<3,n=e[t+3]&3<<11;return n|r|i};this.push=function(e){var t=0,i=0,r,n,a,s;if(o.length){s=o.length;o=new Uint8Array(e.byteLength+s);o.set(o.subarray(0,s));o.set(e,s)}else{o=e}while(o.length-i>=3){if(o[i]==="I".charCodeAt(0)&&o[i+1]==="D".charCodeAt(0)&&o[i+2]==="3".charCodeAt(0)){if(o.length-i<10){break}t=this.parseId3TagSize(o,i);if(t>o.length){break}n={type:"timed-metadata",data:o.subarray(i,i+t)};this.trigger("data",n);i+=t;continue}else if(o[i]&255===255&&(o[i+1]&240)===240){if(o.length-i<7){break}t=this.parseAdtsSize(o,i);if(t>o.length){break}a={type:"audio",data:o.subarray(i,i+t),pts:u,dts:u};this.trigger("data",a);i+=t;continue}i++}r=o.length-i;if(r>0){o=o.subarray(i)}else{o=new Uint8Array}}};n.prototype=new r;t.exports=n},{"../utils/stream.js":62}],39:[function(e,t,i){"use strict";var r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];var f=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]};var n=function(e,t,i){var r,n="";for(r=t;r<i;r++){n+="%"+("00"+e[r].toString(16)).slice(-2)}return n};var d=function(e,t,i){return unescape(n(e,t,i))};var a=function(e,t){var i=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],r=e[t+5],n=(r&16)>>4;if(n){return i+20}return i+10};var s=function(e,t){var i=(e[t+5]&224)>>5,r=e[t+4]<<3,n=e[t+3]&3<<11;return n|r|i};var o=function(e,t){if(e[t]==="I".charCodeAt(0)&&e[t+1]==="D".charCodeAt(0)&&e[t+2]==="3".charCodeAt(0)){return"timed-metadata"}else if(e[t]&255===255&&(e[t+1]&240)===240){return"audio"}return null};var u=function(e){var t=0;while(t+5<e.length){if(e[t]!==255||(e[t+1]&246)!==240){t++;continue}return r[(e[t+2]&60)>>>2]}return null};var l=function(e){var t,i,r,n;t=10;if(e[5]&64){t+=4;t+=f(e.subarray(10,14))}do{i=f(e.subarray(t+4,t+8));if(i<1){return null}n=String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3]);if(n==="PRIV"){r=e.subarray(t+10,t+i+10);for(var a=0;a<r.byteLength;a++){if(r[a]===0){var s=d(r,0,a);if(s==="com.apple.streaming.transportStreamTimestamp"){var o=r.subarray(a+1);var u=(o[3]&1)<<30|o[4]<<22|o[5]<<14|o[6]<<6|o[7]>>>2;u*=4;u+=o[7]&3;return u}break}}}t+=10;t+=i}while(t<e.byteLength);return null};t.exports={parseId3TagSize:a,parseAdtsSize:s,parseType:o,parseSampleRate:u,parseAacTimestamp:l}},{}],40:[function(e,t,i){"use strict";var r=e("../utils/stream.js");var n;var d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];n=function(){var f;n.prototype.init.call(this);this.push=function(e){var t=0,i=0,r,n,a,s,o,u;if(e.type!=="audio"){return}if(f){s=f;f=new Uint8Array(s.byteLength+e.data.byteLength);f.set(s);f.set(e.data,s.byteLength)}else{f=e.data}while(t+5<f.length){if(f[t]!==255||(f[t+1]&246)!==240){t++;continue}n=(~f[t+1]&1)*2;r=(f[t+3]&3)<<11|f[t+4]<<3|(f[t+5]&224)>>5;o=((f[t+6]&3)+1)*1024;u=o*9e4/d[(f[t+2]&60)>>>2];a=t+r;if(f.byteLength<a){return}this.trigger("data",{pts:e.pts+i*u,dts:e.dts+i*u,sampleCount:o,audioobjecttype:(f[t+2]>>>6&3)+1,channelcount:(f[t+2]&1)<<2|(f[t+3]&192)>>>6,samplerate:d[(f[t+2]&60)>>>2],samplingfrequencyindex:(f[t+2]&60)>>>2,samplesize:16,data:f.subarray(t+7+n,a)});if(f.byteLength===a){f=undefined;return}i++;f=f.subarray(a)}};this.flush=function(){this.trigger("done")}};n.prototype=new r;t.exports=n},{"../utils/stream.js":62}],41:[function(e,t,i){"use strict";var r=e("../utils/stream.js");var T=e("../utils/exp-golomb.js");var u,f;var w;f=function(){var i=0,r,n;f.prototype.init.call(this);this.push=function(e){var t;if(!n){n=e.data}else{t=new Uint8Array(n.byteLength+e.data.byteLength);t.set(n);t.set(e.data,n.byteLength);n=t}for(;i<n.byteLength-3;i++){if(n[i+2]===1){r=i+5;break}}while(r<n.byteLength){switch(n[r]){case 0:if(n[r-1]!==0){r+=2;break}else if(n[r-2]!==0){r++;break}if(i+3!==r-2){this.trigger("data",n.subarray(i+3,r-2))}do{r++}while(n[r]!==1&&r<n.length);i=r-2;r+=3;break;case 1:if(n[r-1]!==0||n[r-2]!==0){r+=3;break}this.trigger("data",n.subarray(i+3,r-2));i=r-2;r+=3;break;default:r+=3;break}}n=n.subarray(i);r-=i;i=0};this.flush=function(){if(n&&n.byteLength>3){this.trigger("data",n.subarray(i+3))}n=null;i=0;this.trigger("done")}};f.prototype=new r;w={100:true,110:true,122:true,244:true,44:true,83:true,86:true,118:true,128:true,138:true,139:true,134:true};u=function(){var t=new f,i,r,n,a,s,o,b;u.prototype.init.call(this);i=this;this.push=function(e){if(e.type!=="video"){return}r=e.trackId;n=e.pts;a=e.dts;t.push(e)};t.on("data",function(e){var t={trackId:r,pts:n,dts:a,data:e};switch(e[0]&31){case 5:t.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:t.nalUnitType="sei_rbsp";t.escapedRBSP=s(e.subarray(1));break;case 7:t.nalUnitType="seq_parameter_set_rbsp";t.escapedRBSP=s(e.subarray(1));t.config=o(t.escapedRBSP);break;case 8:t.nalUnitType="pic_parameter_set_rbsp";break;case 9:t.nalUnitType="access_unit_delimiter_rbsp";break;default:break}i.trigger("data",t)});t.on("done",function(){i.trigger("done")});this.flush=function(){t.flush()};b=function(e,t){var i=8,r=8,n,a;for(n=0;n<e;n++){if(r!==0){a=t.readExpGolomb();r=(i+a+256)%256}i=r===0?i:r}};s=function(e){var t=e.byteLength,i=[],r=1,n,a;while(r<t-2){if(e[r]===0&&e[r+1]===0&&e[r+2]===3){i.push(r+2);r+=2}else{r++}}if(i.length===0){return e}n=t-i.length;a=new Uint8Array(n);var s=0;for(r=0;r<n;s++,r++){if(s===i[0]){s++;i.shift()}a[r]=e[s]}return a};o=function(e){var t=0,i=0,r=0,n=0,a=1,s,o,u,f,d,l,c,h,p,m,g,v,y,_;s=new T(e);o=s.readUnsignedByte();f=s.readUnsignedByte();u=s.readUnsignedByte();s.skipUnsignedExpGolomb();if(w[o]){d=s.readUnsignedExpGolomb();if(d===3){s.skipBits(1)}s.skipUnsignedExpGolomb();s.skipUnsignedExpGolomb();s.skipBits(1);if(s.readBoolean()){g=d!==3?8:12;for(_=0;_<g;_++){if(s.readBoolean()){if(_<6){b(16,s)}else{b(64,s)}}}}}s.skipUnsignedExpGolomb();l=s.readUnsignedExpGolomb();if(l===0){s.readUnsignedExpGolomb()}else if(l===1){s.skipBits(1);s.skipExpGolomb();s.skipExpGolomb();c=s.readUnsignedExpGolomb();for(_=0;_<c;_++){s.skipExpGolomb()}}s.skipUnsignedExpGolomb();s.skipBits(1);h=s.readUnsignedExpGolomb();p=s.readUnsignedExpGolomb();m=s.readBits(1);if(m===0){s.skipBits(1)}s.skipBits(1);if(s.readBoolean()){t=s.readUnsignedExpGolomb();i=s.readUnsignedExpGolomb();r=s.readUnsignedExpGolomb();n=s.readUnsignedExpGolomb()}if(s.readBoolean()){if(s.readBoolean()){y=s.readUnsignedByte();switch(y){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:{v=[s.readUnsignedByte()<<8|s.readUnsignedByte(),s.readUnsignedByte()<<8|s.readUnsignedByte()];break}}if(v){a=v[0]/v[1]}}}return{profileIdc:o,levelIdc:u,profileCompatibility:f,width:Math.ceil(((h+1)*16-t*2-i*2)*a),height:(2-m)*(p+1)*16-r*2-n*2}}};u.prototype=new r;t.exports={H264Stream:u,NalByteStream:f}},{"../utils/exp-golomb.js":61,"../utils/stream.js":62}],42:[function(e,t,i){var r=[33,16,5,32,164,27];var n=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252];var a=function(e){var t=[];while(e--){t.push(0)}return t};var s=function(i){return Object.keys(i).reduce(function(e,t){e[t]=new Uint8Array(i[t].reduce(function(e,t){return e.concat(t)},[]));return e},{})};var o={96e3:[r,[227,64],a(154),[56]],88200:[r,[231],a(170),[56]],64e3:[r,[248,192],a(240),[56]],48e3:[r,[255,192],a(268),[55,148,128],a(54),[112]],44100:[r,[255,192],a(268),[55,163,128],a(84),[112]],32e3:[r,[255,192],a(268),[55,234],a(226),[112]],24e3:[r,[255,192],a(268),[55,255,128],a(268),[111,112],a(126),[224]],16e3:[r,[255,192],a(268),[55,255,128],a(268),[111,255],a(269),[223,108],a(195),[1,192]],12e3:[n,a(268),[3,127,248],a(268),[6,255,240],a(268),[13,255,224],a(268),[27,253,128],a(259),[56]],11025:[n,a(268),[3,127,248],a(268),[6,255,240],a(268),[13,255,224],a(268),[27,255,192],a(268),[55,175,128],a(108),[112]],8e3:[n,a(268),[3,121,16],a(47),[7]]};t.exports=s(o)},{}],43:[function(e,t,i){"use strict";var r=e("../utils/stream.js");var n=function(e){this.numberOfTracks=0;this.metadataStream=e.metadataStream;this.videoTags=[];this.audioTags=[];this.videoTrack=null;this.audioTrack=null;this.pendingCaptions=[];this.pendingMetadata=[];this.pendingTracks=0;this.processedTracks=0;n.prototype.init.call(this);this.push=function(e){if(e.text){return this.pendingCaptions.push(e)}if(e.frames){return this.pendingMetadata.push(e)}if(e.track.type==="video"){this.videoTrack=e.track;this.videoTags=e.tags;this.pendingTracks++}if(e.track.type==="audio"){this.audioTrack=e.track;this.audioTags=e.tags;this.pendingTracks++}}};n.prototype=new r;n.prototype.flush=function(e){var t,i,r,n,a={tags:{},captions:[],captionStreams:{},metadata:[]};if(this.pendingTracks<this.numberOfTracks){if(e!=="VideoSegmentStream"&&e!=="AudioSegmentStream"){return}else if(this.pendingTracks===0){this.processedTracks++;if(this.processedTracks<this.numberOfTracks){return}}}this.processedTracks+=this.pendingTracks;this.pendingTracks=0;if(this.processedTracks<this.numberOfTracks){return}if(this.videoTrack){n=this.videoTrack.timelineStartInfo.pts}else if(this.audioTrack){n=this.audioTrack.timelineStartInfo.pts}a.tags.videoTags=this.videoTags;a.tags.audioTags=this.audioTags;for(r=0;r<this.pendingCaptions.length;r++){i=this.pendingCaptions[r];i.startTime=i.startPts-n;i.startTime/=9e4;i.endTime=i.endPts-n;i.endTime/=9e4;a.captionStreams[i.stream]=true;a.captions.push(i)}for(r=0;r<this.pendingMetadata.length;r++){t=this.pendingMetadata[r];t.cueTime=t.pts-n;t.cueTime/=9e4;a.metadata.push(t)}a.metadata.dispatchType=this.metadataStream.dispatchType;this.videoTrack=null;this.audioTrack=null;this.videoTags=[];this.audioTags=[];this.pendingCaptions.length=0;this.pendingMetadata.length=0;this.pendingTracks=0;this.processedTracks=0;this.trigger("data",a);this.trigger("done")};t.exports=n},{"../utils/stream.js":62}],44:[function(e,t,i){"use strict";var u=e("./flv-tag.js");var r=function(e,t,i){var r=new Uint8Array(3+1+1+4),n=new DataView(r.buffer),a,s,o;e=e||0;t=t===undefined?true:t;i=i===undefined?true:i;n.setUint8(0,70);n.setUint8(1,76);n.setUint8(2,86);n.setUint8(3,1);n.setUint8(4,(t?4:0)|(i?1:0));n.setUint32(5,r.byteLength);if(e<=0){s=new Uint8Array(r.byteLength+4);s.set(r);s.set([0,0,0,0],r.byteLength);return s}a=new u(u.METADATA_TAG);a.pts=a.dts=0;a.writeMetaDataDouble("duration",e);o=a.finalize().length;s=new Uint8Array(r.byteLength+o);s.set(r);s.set(n.byteLength,o);return s};t.exports=r},{"./flv-tag.js":45}],45:[function(e,t,i){"use strict";var f;f=function(e,i){var r=0,t=16384,a=function(e,t){var i,r=e.position+t;if(r<e.bytes.byteLength){return}i=new Uint8Array(r*2);i.set(e.bytes.subarray(0,e.position),0);e.bytes=i;e.view=new DataView(e.bytes.buffer)},n=f.widthBytes||new Uint8Array("width".length),s=f.heightBytes||new Uint8Array("height".length),o=f.videocodecidBytes||new Uint8Array("videocodecid".length),u;if(!f.widthBytes){for(u=0;u<"width".length;u++){n[u]="width".charCodeAt(u)}for(u=0;u<"height".length;u++){s[u]="height".charCodeAt(u)}for(u=0;u<"videocodecid".length;u++){o[u]="videocodecid".charCodeAt(u)}f.widthBytes=n;f.heightBytes=s;f.videocodecidBytes=o}this.keyFrame=false;switch(e){case f.VIDEO_TAG:this.length=16;t*=6;break;case f.AUDIO_TAG:this.length=13;this.keyFrame=true;break;case f.METADATA_TAG:this.length=29;this.keyFrame=true;break;default:throw new Error("Unknown FLV tag type")}this.bytes=new Uint8Array(t);this.view=new DataView(this.bytes.buffer);this.bytes[0]=e;this.position=this.length;this.keyFrame=i;this.pts=0;this.dts=0;this.writeBytes=function(e,t,i){var r=t||0,n;i=i||e.byteLength;n=r+i;a(this,i);this.bytes.set(e.subarray(r,n),this.position);this.position+=i;this.length=Math.max(this.length,this.position)};this.writeByte=function(e){a(this,1);this.bytes[this.position]=e;this.position++;this.length=Math.max(this.length,this.position)};this.writeShort=function(e){a(this,2);this.view.setUint16(this.position,e);this.position+=2;this.length=Math.max(this.length,this.position)};this.negIndex=function(e){return this.bytes[this.length-e]};this.nalUnitSize=function(){if(r===0){return 0}return this.length-(r+4)};this.startNalUnit=function(){if(r>0){throw new Error("Attempted to create new NAL wihout closing the old one")}r=this.length;this.length+=4;this.position=this.length};this.endNalUnit=function(e){var t,i;if(this.length===r+4){this.length-=4}else if(r>0){t=r+4;i=this.length-t;this.position=r;this.view.setUint32(this.position,i);this.position=this.length;if(e){e.push(this.bytes.subarray(t,t+i))}}r=0};this.writeMetaDataDouble=function(e,t){var i;a(this,2+e.length+9);this.view.setUint16(this.position,e.length);this.position+=2;if(e==="width"){this.bytes.set(n,this.position);this.position+=5}else if(e==="height"){this.bytes.set(s,this.position);this.position+=6}else if(e==="videocodecid"){this.bytes.set(o,this.position);this.position+=12}else{for(i=0;i<e.length;i++){this.bytes[this.position]=e.charCodeAt(i);this.position++}}this.position++;this.view.setFloat64(this.position,t);this.position+=8;this.length=Math.max(this.length,this.position);++r};this.writeMetaDataBoolean=function(e,t){var i;a(this,2);this.view.setUint16(this.position,e.length);this.position+=2;for(i=0;i<e.length;i++){a(this,1);this.bytes[this.position]=e.charCodeAt(i);this.position++}a(this,2);this.view.setUint8(this.position,1);this.position++;this.view.setUint8(this.position,t?1:0);this.position++;this.length=Math.max(this.length,this.position);++r};this.finalize=function(){var e,t;switch(this.bytes[0]){case f.VIDEO_TAG:this.bytes[11]=(this.keyFrame||i?16:32)|7;this.bytes[12]=i?0:1;e=this.pts-this.dts;this.bytes[13]=(e&16711680)>>>16;this.bytes[14]=(e&65280)>>>8;this.bytes[15]=(e&255)>>>0;break;case f.AUDIO_TAG:this.bytes[11]=175;this.bytes[12]=i?0:1;break;case f.METADATA_TAG:this.position=11;this.view.setUint8(this.position,2);this.position++;this.view.setUint16(this.position,10);this.position+=2;this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position);this.position+=10;this.bytes[this.position]=8;this.position++;this.view.setUint32(this.position,r);this.position=this.length;this.bytes.set([0,0,9],this.position);this.position+=3;this.length=this.position;break}t=this.length-11;this.bytes[1]=(t&16711680)>>>16;this.bytes[2]=(t&65280)>>>8;this.bytes[3]=(t&255)>>>0;this.bytes[4]=(this.dts&16711680)>>>16;this.bytes[5]=(this.dts&65280)>>>8;this.bytes[6]=(this.dts&255)>>>0;this.bytes[7]=(this.dts&4278190080)>>>24;this.bytes[8]=0;this.bytes[9]=0;this.bytes[10]=0;a(this,4);this.view.setUint32(this.length,this.length);this.length+=4;this.position+=4;this.bytes=this.bytes.subarray(0,this.length);this.frameTime=f.frameTime(this.bytes);return this}};f.AUDIO_TAG=8;f.VIDEO_TAG=9;f.METADATA_TAG=18;f.isAudioFrame=function(e){return f.AUDIO_TAG===e[0]};f.isVideoFrame=function(e){return f.VIDEO_TAG===e[0]};f.isMetaData=function(e){return f.METADATA_TAG===e[0]};f.isKeyFrame=function(e){if(f.isVideoFrame(e)){return e[11]===23}if(f.isAudioFrame(e)){return true}if(f.isMetaData(e)){return true}return false};f.frameTime=function(e){var t=e[4]<<16;t|=e[5]<<8;t|=e[6]<<0;t|=e[7]<<24;return t};t.exports=f},{}],46:[function(e,t,i){t.exports={tag:e("./flv-tag"),Transmuxer:e("./transmuxer"),getFlvHeader:e("./flv-header")}},{"./flv-header":44,"./flv-tag":45,"./transmuxer":48}],47:[function(e,t,i){"use strict";var r=function(){var e=this;this.list=[];this.push=function(e){this.list.push({bytes:e.bytes,dts:e.dts,pts:e.pts,keyFrame:e.keyFrame,metaDataTag:e.metaDataTag})};Object.defineProperty(this,"length",{get:function(){return e.list.length}})};t.exports=r},{}],48:[function(e,t,i){"use strict";var r=e("../utils/stream.js");var u=e("./flv-tag.js");var p=e("../m2ts/m2ts.js");var m=e("../codecs/adts.js");var g=e("../codecs/h264").H264Stream;var v=e("./coalesce-stream.js");var f=e("./tag-list.js");var y,_,b,d,o,l;d=function(e,t){if(typeof t.pts==="number"){if(e.timelineStartInfo.pts===undefined){e.timelineStartInfo.pts=t.pts}else{e.timelineStartInfo.pts=Math.min(e.timelineStartInfo.pts,t.pts)}}if(typeof t.dts==="number"){if(e.timelineStartInfo.dts===undefined){e.timelineStartInfo.dts=t.dts}else{e.timelineStartInfo.dts=Math.min(e.timelineStartInfo.dts,t.dts)}}};o=function(e,t){var i=new u(u.METADATA_TAG);i.dts=t;i.pts=t;i.writeMetaDataDouble("videocodecid",7);i.writeMetaDataDouble("width",e.width);i.writeMetaDataDouble("height",e.height);return i};l=function(e,t){var i,r=new u(u.VIDEO_TAG,true);r.dts=t;r.pts=t;r.writeByte(1);r.writeByte(e.profileIdc);r.writeByte(e.profileCompatibility);r.writeByte(e.levelIdc);r.writeByte(252|3);r.writeByte(224|1);r.writeShort(e.sps[0].length);r.writeBytes(e.sps[0]);r.writeByte(e.pps.length);for(i=0;i<e.pps.length;++i){r.writeShort(e.pps[i].length);r.writeBytes(e.pps[i])}return r};b=function(n){var a=[],s=[],o;b.prototype.init.call(this);this.push=function(e){d(n,e);if(n){n.audioobjecttype=e.audioobjecttype;n.channelcount=e.channelcount;n.samplerate=e.samplerate;n.samplingfrequencyindex=e.samplingfrequencyindex;n.samplesize=e.samplesize;n.extraData=n.audioobjecttype<<11|n.samplingfrequencyindex<<7|n.channelcount<<3}e.pts=Math.round(e.pts/90);e.dts=Math.round(e.dts/90);a.push(e)};this.flush=function(){var e,t,i,r=new f;if(a.length===0){this.trigger("done","AudioSegmentStream");return}i=-Infinity;while(a.length){e=a.shift();if(s.length&&e.pts>=s[0]){i=s.shift();this.writeMetaDataTags(r,i)}if(n.extraData!==o||e.pts-i>=1e3){this.writeMetaDataTags(r,e.pts);o=n.extraData;i=e.pts}t=new u(u.AUDIO_TAG);t.pts=e.pts;t.dts=e.dts;t.writeBytes(e.data);r.push(t.finalize())}s.length=0;o=null;this.trigger("data",{track:n,tags:r.list});this.trigger("done","AudioSegmentStream")};this.writeMetaDataTags=function(e,t){var i;i=new u(u.METADATA_TAG);i.pts=t;i.dts=t;i.writeMetaDataDouble("audiocodecid",10);i.writeMetaDataBoolean("stereo",n.channelcount===2);i.writeMetaDataDouble("audiosamplerate",n.samplerate);i.writeMetaDataDouble("audiosamplesize",16);e.push(i.finalize());i=new u(u.AUDIO_TAG,true);i.pts=t;i.dts=t;i.view.setUint16(i.position,n.extraData);i.position+=2;i.length=Math.max(i.length,i.position);e.push(i.finalize())};this.onVideoKeyFrame=function(e){s.push(e)}};b.prototype=new r;_=function(n){var i=[],a,s;_.prototype.init.call(this);this.finishFrame=function(e,t){if(!t){return}if(a&&n&&n.newMetadata&&(t.keyFrame||e.length===0)){var i=o(a,t.dts).finalize();var r=l(n,t.dts).finalize();i.metaDataTag=r.metaDataTag=true;e.push(i);e.push(r);n.newMetadata=false;this.trigger("keyframe",t.dts)}t.endNalUnit();e.push(t.finalize());s=null};this.push=function(e){d(n,e);e.pts=Math.round(e.pts/90);e.dts=Math.round(e.dts/90);i.push(e)};this.flush=function(){var e,t=new f;while(i.length){if(i[0].nalUnitType==="access_unit_delimiter_rbsp"){break}i.shift()}if(i.length===0){this.trigger("done","VideoSegmentStream");return}while(i.length){e=i.shift();if(e.nalUnitType==="seq_parameter_set_rbsp"){n.newMetadata=true;a=e.config;n.width=a.width;n.height=a.height;n.sps=[e.data];n.profileIdc=a.profileIdc;n.levelIdc=a.levelIdc;n.profileCompatibility=a.profileCompatibility;s.endNalUnit()}else if(e.nalUnitType==="pic_parameter_set_rbsp"){n.newMetadata=true;n.pps=[e.data];s.endNalUnit()}else if(e.nalUnitType==="access_unit_delimiter_rbsp"){if(s){this.finishFrame(t,s)}s=new u(u.VIDEO_TAG);s.pts=e.pts;s.dts=e.dts}else{if(e.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"){s.keyFrame=true}s.endNalUnit()}s.startNalUnit();s.writeBytes(e.data)}if(s){this.finishFrame(t,s)}this.trigger("data",{track:n,tags:t.list});this.trigger("done","VideoSegmentStream")}};_.prototype=new r;y=function(e){var t=this,i,r,n,a,s,o,u,f,d,l,c,h;y.prototype.init.call(this);e=e||{};this.metadataStream=new p.MetadataStream;e.metadataStream=this.metadataStream;i=new p.TransportPacketStream;r=new p.TransportParseStream;n=new p.ElementaryStream;a=new p.TimestampRolloverStream("video");s=new p.TimestampRolloverStream("audio");o=new p.TimestampRolloverStream("timed-metadata");u=new m;f=new g;h=new v(e);i.pipe(r).pipe(n);n.pipe(a).pipe(f);n.pipe(s).pipe(u);n.pipe(o).pipe(this.metadataStream).pipe(h);c=new p.CaptionStream;f.pipe(c).pipe(h);n.on("data",function(e){var t,i,r;if(e.type==="metadata"){t=e.tracks.length;while(t--){if(e.tracks[t].type==="video"){i=e.tracks[t]}else if(e.tracks[t].type==="audio"){r=e.tracks[t]}}if(i&&!d){h.numberOfTracks++;d=new _(i);f.pipe(d).pipe(h)}if(r&&!l){h.numberOfTracks++;l=new b(r);u.pipe(l).pipe(h);if(d){d.on("keyframe",l.onVideoKeyFrame)}}}});this.push=function(e){i.push(e)};this.flush=function(){i.flush()};this.resetCaptions=function(){c.reset()};h.on("data",function(e){t.trigger("data",e)});h.on("done",function(){t.trigger("done")})};y.prototype=new r;t.exports=y},{"../codecs/adts.js":40,"../codecs/h264":41,"../m2ts/m2ts.js":50,"../utils/stream.js":62,"./coalesce-stream.js":43,"./flv-tag.js":45,"./tag-list.js":47}],49:[function(e,t,i){"use strict";var a=4,s=128,r=e("../utils/stream");var n=function(e){var t=0,i={payloadType:-1,payloadSize:0},r=0,n=0;while(t<e.byteLength){if(e[t]===s){break}while(e[t]===255){r+=255;t++}r+=e[t++];while(e[t]===255){n+=255;t++}n+=e[t++];if(!i.payload&&r===a){i.payloadType=r;i.payloadSize=n;i.payload=e.subarray(t,t+n);break}t+=n;r=0;n=0}return i};var o=function(e){if(e.payload[0]!==181){return null}if((e.payload[1]<<8|e.payload[2])!==49){return null}if(String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])!=="GA94"){return null}if(e.payload[7]!==3){return null}return e.payload.subarray(8,e.payload.length-1)};var u=function(e,t){var i=[],r,n,a,s;if(!(t[0]&64)){return i}n=t[0]&31;for(r=0;r<n;r++){a=r*3;s={type:t[a+2]&3,pts:e};if(t[a+2]&4){s.ccData=t[a+3]<<8|t[a+4];i.push(s)}}return i};var f=function(){f.prototype.init.call(this);this.captionPackets_=[];this.ccStreams_=[new m(0,0),new m(0,1),new m(1,0),new m(1,1)];this.reset();this.ccStreams_.forEach(function(e){e.on("data",this.trigger.bind(this,"data"));e.on("done",this.trigger.bind(this,"done"))},this)};f.prototype=new r;f.prototype.push=function(e){var t,i;if(e.nalUnitType!=="sei_rbsp"){return}t=n(e.escapedRBSP);if(t.payloadType!==a){return}i=o(t);if(!i){return}if(e.dts<this.latestDts_){this.ignoreNextEqualDts_=true;return}else if(e.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.ignoreNextEqualDts_=false;return}this.captionPackets_=this.captionPackets_.concat(u(e.pts,i));this.latestDts_=e.dts};f.prototype.flush=function(){if(!this.captionPackets_.length){this.ccStreams_.forEach(function(e){e.flush()},this);return}this.captionPackets_.forEach(function(e,t){e.presortIndex=t});this.captionPackets_.sort(function(e,t){if(e.pts===t.pts){return e.presortIndex-t.presortIndex}return e.pts-t.pts});this.captionPackets_.forEach(function(e){if(e.type<2){this.dispatchCea608Packet(e)}},this);this.captionPackets_.length=0;this.ccStreams_.forEach(function(e){e.flush()},this);return};f.prototype.reset=function(){this.latestDts_=null;this.ignoreNextEqualDts_=false;this.activeCea608Channel_=[null,null];this.ccStreams_.forEach(function(e){e.reset()})};f.prototype.dispatchCea608Packet=function(e){if(this.setsChannel1Active(e)){this.activeCea608Channel_[e.type]=0}else if(this.setsChannel2Active(e)){this.activeCea608Channel_[e.type]=1}if(this.activeCea608Channel_[e.type]===null){return}this.ccStreams_[(e.type<<1)+this.activeCea608Channel_[e.type]].push(e)};f.prototype.setsChannel1Active=function(e){return(e.ccData&30720)===4096};f.prototype.setsChannel2Active=function(e){return(e.ccData&30720)===6144};var d={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496};var l=function(e){if(e===null){return""}e=d[e]||e;return String.fromCharCode(e)};var c=14;var h=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152];var p=function(){var e=[],t=c+1;while(t--){e.push("")}return e};var m=function(e,t){m.prototype.init.call(this);this.field_=e||0;this.dataChannel_=t||0;this.name_="CC"+((this.field_<<1|this.dataChannel_)+1);this.setConstants();this.reset();this.push=function(e){var t,i,r,n,a;t=e.ccData&32639;if(t===this.lastControlCode_){this.lastControlCode_=null;return}if((t&61440)===4096){this.lastControlCode_=t}else if(t!==this.PADDING_){this.lastControlCode_=null}r=t>>>8;n=t&255;if(t===this.PADDING_){return}else if(t===this.RESUME_CAPTION_LOADING_){this.mode_="popOn"}else if(t===this.END_OF_CAPTION_){this.clearFormatting(e.pts);this.flushDisplayed(e.pts);i=this.displayed_;this.displayed_=this.nonDisplayed_;this.nonDisplayed_=i;this.startPts_=e.pts}else if(t===this.ROLL_UP_2_ROWS_){this.topRow_=c-1;this.mode_="rollUp"}else if(t===this.ROLL_UP_3_ROWS_){this.topRow_=c-2;this.mode_="rollUp"}else if(t===this.ROLL_UP_4_ROWS_){this.topRow_=c-3;this.mode_="rollUp"}else if(t===this.CARRIAGE_RETURN_){this.clearFormatting(e.pts);this.flushDisplayed(e.pts);this.shiftRowsUp_();this.startPts_=e.pts}else if(t===this.BACKSPACE_){if(this.mode_==="popOn"){this.nonDisplayed_[c]=this.nonDisplayed_[c].slice(0,-1)}else{this.displayed_[c]=this.displayed_[c].slice(0,-1)}}else if(t===this.ERASE_DISPLAYED_MEMORY_){this.flushDisplayed(e.pts);this.displayed_=p()}else if(t===this.ERASE_NON_DISPLAYED_MEMORY_){this.nonDisplayed_=p()}else if(t===this.RESUME_DIRECT_CAPTIONING_){this.mode_="paintOn"}else if(this.isSpecialCharacter(r,n)){r=(r&3)<<8;a=l(r|n);this[this.mode_](e.pts,a);this.column_++}else if(this.isExtCharacter(r,n)){if(this.mode_==="popOn"){this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1)}else{this.displayed_[c]=this.displayed_[c].slice(0,-1)}r=(r&3)<<8;a=l(r|n);this[this.mode_](e.pts,a);this.column_++}else if(this.isMidRowCode(r,n)){this.clearFormatting(e.pts);this[this.mode_](e.pts," ");this.column_++;if((n&14)===14){this.addFormatting(e.pts,["i"])}if((n&1)===1){this.addFormatting(e.pts,["u"])}}else if(this.isOffsetControlCode(r,n)){this.column_+=n&3}else if(this.isPAC(r,n)){var s=h.indexOf(t&7968);if(s!==this.row_){this.clearFormatting(e.pts);this.row_=s}if(n&1&&this.formatting_.indexOf("u")===-1){this.addFormatting(e.pts,["u"])}if((t&16)===16){this.column_=((t&14)>>1)*4}if(this.isColorPAC(n)){if((n&14)===14){this.addFormatting(e.pts,["i"])}}}else if(this.isNormalChar(r)){if(n===0){n=null}a=l(r);a+=l(n);this[this.mode_](e.pts,a);this.column_+=a.length}}};m.prototype=new r;m.prototype.flushDisplayed=function(e){var t=this.displayed_.map(function(e){return e.trim()}).join("\n").replace(/^\n+|\n+$/g,"");if(t.length){this.trigger("data",{startPts:this.startPts_,endPts:e,text:t,stream:this.name_})}};m.prototype.reset=function(){this.mode_="popOn";this.topRow_=0;this.startPts_=0;this.displayed_=p();this.nonDisplayed_=p();this.lastControlCode_=null;this.column_=0;this.row_=c;this.formatting_=[]};m.prototype.setConstants=function(){if(this.dataChannel_===0){this.BASE_=16;this.EXT_=17;this.CONTROL_=(20|this.field_)<<8;this.OFFSET_=23}else if(this.dataChannel_===1){this.BASE_=24;this.EXT_=25;this.CONTROL_=(28|this.field_)<<8;this.OFFSET_=31}this.PADDING_=0;this.RESUME_CAPTION_LOADING_=this.CONTROL_|32;this.END_OF_CAPTION_=this.CONTROL_|47;this.ROLL_UP_2_ROWS_=this.CONTROL_|37;this.ROLL_UP_3_ROWS_=this.CONTROL_|38;this.ROLL_UP_4_ROWS_=this.CONTROL_|39;this.CARRIAGE_RETURN_=this.CONTROL_|45;this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41;this.BACKSPACE_=this.CONTROL_|33;this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44;this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46};m.prototype.isSpecialCharacter=function(e,t){return e===this.EXT_&&t>=48&&t<=63};m.prototype.isExtCharacter=function(e,t){return(e===this.EXT_+1||e===this.EXT_+2)&&(t>=32&&t<=63)};m.prototype.isMidRowCode=function(e,t){return e===this.EXT_&&(t>=32&&t<=47)};m.prototype.isOffsetControlCode=function(e,t){return e===this.OFFSET_&&(t>=33&&t<=35)};m.prototype.isPAC=function(e,t){return e>=this.BASE_&&e<this.BASE_+8&&(t>=64&&t<=127)};m.prototype.isColorPAC=function(e){return e>=64&&e<=79||e>=96&&e<=127};m.prototype.isNormalChar=function(e){return e>=32&&e<=127};m.prototype.addFormatting=function(e,t){this.formatting_=this.formatting_.concat(t);var i=t.reduce(function(e,t){return e+"<"+t+">"},"");this[this.mode_](e,i)};m.prototype.clearFormatting=function(e){if(!this.formatting_.length){return}var t=this.formatting_.reverse().reduce(function(e,t){return e+"</"+t+">"},"");this.formatting_=[];this[this.mode_](e,t)};m.prototype.popOn=function(e,t){var i=this.nonDisplayed_[this.row_];i+=t;this.nonDisplayed_[this.row_]=i};m.prototype.rollUp=function(e,t){var i=this.displayed_[c];i+=t;this.displayed_[c]=i};m.prototype.shiftRowsUp_=function(){var e;for(e=0;e<this.topRow_;e++){this.displayed_[e]=""}for(e=this.topRow_;e<c;e++){this.displayed_[e]=this.displayed_[e+1]}this.displayed_[c]=""};m.prototype.paintOn=function(){};t.exports={CaptionStream:f,Cea608Stream:m}},{"../utils/stream":62}],50:[function(e,t,i){"use strict";var r=e("../utils/stream.js"),n=e("./caption-stream"),l=e("./stream-types"),a=e("./timestamp-rollover-stream").TimestampRolloverStream;var o=e("./stream-types.js");var s,f,u;var d=188,c=71;s=function(){var n=new Uint8Array(d),a=0;s.prototype.init.call(this);this.push=function(e){var t=0,i=d,r;if(a){r=new Uint8Array(e.byteLength+a);r.set(n.subarray(0,a));r.set(e,a);a=0}else{r=e}while(i<r.byteLength){if(r[t]===c&&r[i]===c){this.trigger("data",r.subarray(t,i));t+=d;i+=d;continue}t++;i++}if(t<r.byteLength){n.set(r.subarray(t),0);a=r.byteLength-t}};this.flush=function(){if(a===d&&n[0]===c){this.trigger("data",n);a=0}this.trigger("done")}};s.prototype=new r;f=function(){var r,n,a,u;f.prototype.init.call(this);u=this;this.packetsWaitingForPmt=[];this.programMapTable=undefined;r=function(e,t){var i=0;if(t.payloadUnitStartIndicator){i+=e[i]+1}if(t.type==="pat"){n(e.subarray(i),t)}else{a(e.subarray(i),t)}};n=function(e,t){t.section_number=e[7];t.last_section_number=e[8];u.pmtPid=(e[10]&31)<<8|e[11];t.pmtPid=u.pmtPid};a=function(e,t){var i,r,n,a;if(!(e[5]&1)){return}u.programMapTable={video:null,audio:null,"timed-metadata":{}};i=(e[1]&15)<<8|e[2];r=3+i-4;n=(e[10]&15)<<8|e[11];a=12+n;while(a<r){var s=e[a];var o=(e[a+1]&31)<<8|e[a+2];if(s===l.H264_STREAM_TYPE&&u.programMapTable.video===null){u.programMapTable.video=o}else if(s===l.ADTS_STREAM_TYPE&&u.programMapTable.audio===null){u.programMapTable.audio=o}else if(s===l.METADATA_STREAM_TYPE){u.programMapTable["timed-metadata"][o]=s}a+=((e[a+3]&15)<<8|e[a+4])+5}t.programMapTable=u.programMapTable};this.push=function(e){var t={},i=4;t.payloadUnitStartIndicator=!!(e[1]&64);t.pid=e[1]&31;t.pid<<=8;t.pid|=e[2];if((e[3]&48)>>>4>1){i+=e[i]+1}if(t.pid===0){t.type="pat";r(e.subarray(i),t);this.trigger("data",t)}else if(t.pid===this.pmtPid){t.type="pmt";r(e.subarray(i),t);this.trigger("data",t);while(this.packetsWaitingForPmt.length){this.processPes_.apply(this,this.packetsWaitingForPmt.shift())}}else if(this.programMapTable===undefined){this.packetsWaitingForPmt.push([e,i,t])}else{this.processPes_(e,i,t)}};this.processPes_=function(e,t,i){if(i.pid===this.programMapTable.video){i.streamType=l.H264_STREAM_TYPE}else if(i.pid===this.programMapTable.audio){i.streamType=l.ADTS_STREAM_TYPE}else{i.streamType=this.programMapTable["timed-metadata"][i.pid]}i.type="pes";i.data=e.subarray(t);this.trigger("data",i)}};f.prototype=new r;f.STREAM_TYPES={h264:27,adts:15};u=function(){var f=this,r={data:[],size:0},n={data:[],size:0},a={data:[],size:0},d=function(e,t){var i;t.packetLength=6+(e[4]<<8|e[5]);t.dataAlignmentIndicator=(e[6]&4)!==0;i=e[7];if(i&192){t.pts=(e[9]&14)<<27|(e[10]&255)<<20|(e[11]&254)<<12|(e[12]&255)<<5|(e[13]&254)>>>3;t.pts*=4;t.pts+=(e[13]&6)>>>1;t.dts=t.pts;if(i&64){t.dts=(e[14]&14)<<27|(e[15]&255)<<20|(e[16]&254)<<12|(e[17]&255)<<5|(e[18]&254)>>>3;t.dts*=4;t.dts+=(e[18]&6)>>>1}}t.data=e.subarray(9+e[8])},s=function(e,t,i){var r=new Uint8Array(e.size),n={type:t},a=0,s=0,o=false,u;if(!e.data.length||e.size<9){return}n.trackId=e.data[0].pid;for(a=0;a<e.data.length;a++){u=e.data[a];r.set(u.data,s);s+=u.data.byteLength}d(r,n);o=t==="video"||n.packetLength<=e.size;if(i||o){e.size=0;e.data.length=0}if(o){f.trigger("data",n)}};u.prototype.init.call(this);this.push=function(i){({pat:function(){},pes:function(){var e,t;switch(i.streamType){case l.H264_STREAM_TYPE:case o.H264_STREAM_TYPE:e=r;t="video";break;case l.ADTS_STREAM_TYPE:e=n;t="audio";break;case l.METADATA_STREAM_TYPE:e=a;t="timed-metadata";break;default:return}if(i.payloadUnitStartIndicator){s(e,t,true)}e.data.push(i);e.size+=i.data.byteLength},pmt:function(){var e={type:"metadata",tracks:[]},t=i.programMapTable;if(t.video!==null){e.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.video,codec:"avc",type:"video"})}if(t.audio!==null){e.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.audio,codec:"adts",type:"audio"})}f.trigger("data",e)}})[i.type]()};this.flush=function(){s(r,"video");s(n,"audio");s(a,"timed-metadata");this.trigger("done")}};u.prototype=new r;var h={PAT_PID:0,MP2T_PACKET_LENGTH:d,TransportPacketStream:s,TransportParseStream:f,ElementaryStream:u,TimestampRolloverStream:a,CaptionStream:n.CaptionStream,Cea608Stream:n.Cea608Stream,MetadataStream:e("./metadata-stream")};for(var p in l){if(l.hasOwnProperty(p)){h[p]=l[p]}}t.exports=h},{"../utils/stream.js":62,"./caption-stream":49,"./metadata-stream":51,"./stream-types":53,"./stream-types.js":53,"./timestamp-rollover-stream":54}],51:[function(e,t,i){"use strict";var r=e("../utils/stream"),n=e("./stream-types"),a=function(e,t,i){var r,n="";for(r=t;r<i;r++){n+="%"+("00"+e[r].toString(16)).slice(-2)}return n},s=function(e,t,i){return decodeURIComponent(a(e,t,i))},o=function(e,t,i){return unescape(a(e,t,i))},h=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},p={TXXX:function(e){var t;if(e.data[0]!==3){return}for(t=1;t<e.data.length;t++){if(e.data[t]===0){e.description=s(e.data,1,t);e.value=s(e.data,t+1,e.data.length).replace(/\0*$/,"");break}}e.data=e.value},WXXX:function(e){var t;if(e.data[0]!==3){return}for(t=1;t<e.data.length;t++){if(e.data[t]===0){e.description=s(e.data,1,t);e.url=s(e.data,t+1,e.data.length);break}}},PRIV:function(e){var t;for(t=0;t<e.data.length;t++){if(e.data[t]===0){e.owner=o(e.data,0,t);break}}e.privateData=e.data.subarray(t+1);e.data=e.privateData}},u;u=function(e){var f={debug:!!(e&&e.debug),descriptor:e&&e.descriptor},d=0,l=[],c=0,t;u.prototype.init.call(this);this.dispatchType=n.METADATA_STREAM_TYPE.toString(16);if(f.descriptor){for(t=0;t<f.descriptor.length;t++){this.dispatchType+=("00"+f.descriptor[t].toString(16)).slice(-2)}}this.push=function(e){var t,i,r,n,a,s;if(e.type!=="timed-metadata"){return}if(e.dataAlignmentIndicator){c=0;l.length=0}if(l.length===0&&(e.data.length<10||e.data[0]!=="I".charCodeAt(0)||e.data[1]!=="D".charCodeAt(0)||e.data[2]!=="3".charCodeAt(0))){if(f.debug){console.log("Skipping unrecognized metadata packet")}return}l.push(e);c+=e.data.byteLength;if(l.length===1){d=h(e.data.subarray(6,10));d+=10}if(c<d){return}t={data:new Uint8Array(d),frames:[],pts:l[0].pts,dts:l[0].dts};for(a=0;a<d;){t.data.set(l[0].data.subarray(0,d-a),a);a+=l[0].data.byteLength;c-=l[0].data.byteLength;l.shift()}i=10;if(t.data[5]&64){i+=4;i+=h(t.data.subarray(10,14));d-=h(t.data.subarray(16,20))}do{r=h(t.data.subarray(i+4,i+8));if(r<1){return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.")}s=String.fromCharCode(t.data[i],t.data[i+1],t.data[i+2],t.data[i+3]);n={id:s,data:t.data.subarray(i+10,i+r+10)};n.key=n.id;if(p[n.id]){p[n.id](n);if(n.owner==="com.apple.streaming.transportStreamTimestamp"){var o=n.data,u=(o[3]&1)<<30|o[4]<<22|o[5]<<14|o[6]<<6|o[7]>>>2;u*=4;u+=o[7]&3;n.timeStamp=u;if(t.pts===undefined&&t.dts===undefined){t.pts=n.timeStamp;t.dts=n.timeStamp}this.trigger("timestamp",n)}}t.frames.push(n);i+=10;i+=r}while(i<d);this.trigger("data",t)}};u.prototype=new r;t.exports=u},{"../utils/stream":62,"./stream-types":53}],52:[function(e,t,i){"use strict";var n=e("./stream-types.js");var a=function(e){var t=e[1]&31;t<<=8;t|=e[2];return t};var f=function(e){return!!(e[1]&64)};var d=function(e){var t=0;if((e[3]&48)>>>4>1){t+=e[4]+1}return t};var r=function(e,t){var i=a(e);if(i===0){return"pat"}else if(i===t){return"pmt"}else if(t){return"pes"}return null};var s=function(e){var t=f(e);var i=4+d(e);if(t){i+=e[i]+1}return(e[i+10]&31)<<8|e[i+11]};var o=function(e){var t={};var i=f(e);var r=4+d(e);if(i){r+=e[r]+1}if(!(e[r+5]&1)){return}var n,a,s;n=(e[r+1]&15)<<8|e[r+2];a=3+n-4;s=(e[r+10]&15)<<8|e[r+11];var o=12+s;while(o<a){var u=r+o;t[(e[u+1]&31)<<8|e[u+2]]=e[u];o+=((e[u+3]&15)<<8|e[u+4])+5}return t};var u=function(e,t){var i=a(e);var r=t[i];switch(r){case n.H264_STREAM_TYPE:return"video";case n.ADTS_STREAM_TYPE:return"audio";case n.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}};var l=function(e){var t=f(e);if(!t){return null}var i=4+d(e);if(i>=e.byteLength){return null}var r=null;var n;n=e[i+7];if(n&192){r={};r.pts=(e[i+9]&14)<<27|(e[i+10]&255)<<20|(e[i+11]&254)<<12|(e[i+12]&255)<<5|(e[i+13]&254)>>>3;r.pts*=4;r.pts+=(e[i+13]&6)>>>1;r.dts=r.pts;if(n&64){r.dts=(e[i+14]&14)<<27|(e[i+15]&255)<<20|(e[i+16]&254)<<12|(e[i+17]&255)<<5|(e[i+18]&254)>>>3;r.dts*=4;r.dts+=(e[i+18]&6)>>>1}}return r};var c=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}};var h=function(e){var t=4+d(e);var i=e.subarray(t);var r=0;var n=0;var a=false;var s;for(;n<i.byteLength-3;n++){if(i[n+2]===1){r=n+5;break}}while(r<i.byteLength){switch(i[r]){case 0:if(i[r-1]!==0){r+=2;break}else if(i[r-2]!==0){r++;break}if(n+3!==r-2){s=c(i[n+3]&31);if(s==="slice_layer_without_partitioning_rbsp_idr"){a=true}}do{r++}while(i[r]!==1&&r<i.length);n=r-2;r+=3;break;case 1:if(i[r-1]!==0||i[r-2]!==0){r+=3;break}s=c(i[n+3]&31);if(s==="slice_layer_without_partitioning_rbsp_idr"){a=true}n=r-2;r+=3;break;default:r+=3;break}}i=i.subarray(n);r-=n;n=0;if(i&&i.byteLength>3){s=c(i[n+3]&31);if(s==="slice_layer_without_partitioning_rbsp_idr"){a=true}}return a};t.exports={parseType:r,parsePat:s,parsePmt:o,parsePayloadUnitStartIndicator:f,parsePesType:u,parsePesTime:l,videoPacketContainsKeyFrame:h}},{"./stream-types.js":53}],53:[function(e,t,i){"use strict";t.exports={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21}},{}],54:[function(e,t,i){"use strict";var r=e("../utils/stream");var n=8589934592;var a=4294967296;var s=function(e,t){var i=1;if(e>t){i=-1}while(Math.abs(t-e)>a){e+=i*n}return e};var o=function(e){var t,i;o.prototype.init.call(this);this.type_=e;this.push=function(e){if(e.type!==this.type_){return}if(i===undefined){i=e.dts}e.dts=s(e.dts,i);e.pts=s(e.pts,i);t=e.dts;this.trigger("data",e)};this.flush=function(){i=t;this.trigger("done")};this.discontinuity=function(){i=void 0;t=void 0}};o.prototype=new r;t.exports={TimestampRolloverStream:o,handleRollover:s}},{"../utils/stream":62}],55:[function(e,t,i){t.exports={generator:e("./mp4-generator"),Transmuxer:e("./transmuxer").Transmuxer,AudioSegmentStream:e("./transmuxer").AudioSegmentStream,VideoSegmentStream:e("./transmuxer").VideoSegmentStream}},{"./mp4-generator":56,"./transmuxer":58}],56:[function(e,t,i){"use strict";var u=Math.pow(2,32)-1;var f,r,n,a,s,o,d,l,c,h,p,m,g,v,y,_,b,T,w,S,k,O,E,A,L,P,I,C,U,D,M,x,R,B,j,N;(function(){var e;E={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]};if(typeof Uint8Array==="undefined"){return}for(e in E){if(E.hasOwnProperty(e)){E[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]}}A=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]);P=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]);L=new Uint8Array([0,0,0,1]);I=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);C=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);U={video:I,audio:C};x=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);M=new Uint8Array([0,0,0,0,0,0,0,0]);R=new Uint8Array([0,0,0,0,0,0,0,0]);B=R;j=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);N=R;D=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])})();f=function(e){var t=[],i=0,r,n,a;for(r=1;r<arguments.length;r++){t.push(arguments[r])}r=t.length;while(r--){i+=t[r].byteLength}n=new Uint8Array(i+8);a=new DataView(n.buffer,n.byteOffset,n.byteLength);a.setUint32(0,n.byteLength);n.set(e,4);for(r=0,i=8;r<t.length;r++){n.set(t[r],i);i+=t[r].byteLength}return n};r=function(){return f(E.dinf,f(E.dref,x))};n=function(e){return f(E.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))};a=function(){return f(E.ftyp,A,L,A,P)};_=function(e){return f(E.hdlr,U[e])};s=function(e){return f(E.mdat,e)};y=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,e.duration&255,85,196,0,0]);if(e.samplerate){t[12]=e.samplerate>>>24&255;t[13]=e.samplerate>>>16&255;t[14]=e.samplerate>>>8&255;t[15]=e.samplerate&255}return f(E.mdhd,t)};v=function(e){return f(E.mdia,y(e),_(e.type),d(e))};o=function(e){return f(E.mfhd,new Uint8Array([0,0,0,0,(e&4278190080)>>24,(e&16711680)>>16,(e&65280)>>8,e&255]))};d=function(e){return f(E.minf,e.type==="video"?f(E.vmhd,D):f(E.smhd,M),r(),T(e))};l=function(e,t){var i=[],r=t.length;while(r--){i[r]=S(t[r])}return f.apply(null,[E.moof,o(e)].concat(i))};c=function(e){var t=e.length,i=[];while(t--){i[t]=m(e[t])}return f.apply(null,[E.moov,p(4294967295)].concat(i).concat(h(e)))};h=function(e){var t=e.length,i=[];while(t--){i[t]=k(e[t])}return f.apply(null,[E.mvex].concat(i))};p=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(e&4278190080)>>24,(e&16711680)>>16,(e&65280)>>8,e&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return f(E.mvhd,t)};b=function(e){var t=e.samples||[],i=new Uint8Array(4+t.length),r,n;for(n=0;n<t.length;n++){r=t[n].flags;i[n+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy}return f(E.sdtp,i)};T=function(e){return f(E.stbl,w(e),f(E.stts,N),f(E.stsc,B),f(E.stsz,j),f(E.stco,R))};(function(){var t,i;w=function(e){return f(E.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),e.type==="video"?t(e):i(e))};t=function(e){var t=e.sps||[],i=e.pps||[],r=[],n=[],a;for(a=0;a<t.length;a++){r.push((t[a].byteLength&65280)>>>8);r.push(t[a].byteLength&255);r=r.concat(Array.prototype.slice.call(t[a]))}for(a=0;a<i.length;a++){n.push((i[a].byteLength&65280)>>>8);n.push(i[a].byteLength&255);n=n.concat(Array.prototype.slice.call(i[a]))}return f(E.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(e.width&65280)>>8,e.width&255,(e.height&65280)>>8,e.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f(E.avcC,new Uint8Array([1,e.profileIdc,e.profileCompatibility,e.levelIdc,255].concat([t.length]).concat(r).concat([i.length]).concat(n))),f(E.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))};i=function(e){return f(E.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(e.channelcount&65280)>>8,e.channelcount&255,(e.samplesize&65280)>>8,e.samplesize&255,0,0,0,0,(e.samplerate&65280)>>8,e.samplerate&255,0,0]),n(e))}})();g=function(e){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,0,(e.duration&4278190080)>>24,(e.duration&16711680)>>16,(e.duration&65280)>>8,e.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(e.width&65280)>>8,e.width&255,0,0,(e.height&65280)>>8,e.height&255,0,0]);return f(E.tkhd,t)};S=function(e){var t,i,r,n,a,s,o;t=f(E.tfhd,new Uint8Array([0,0,0,58,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0]));s=Math.floor(e.baseMediaDecodeTime/(u+1));o=Math.floor(e.baseMediaDecodeTime%(u+1));i=f(E.tfdt,new Uint8Array([1,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255,o>>>24&255,o>>>16&255,o>>>8&255,o&255]));a=32+20+8+16+8+8;if(e.type==="audio"){r=O(e,a);return f(E.traf,t,i,r)}n=b(e);r=O(e,n.length+a);return f(E.traf,t,i,r,n)};m=function(e){e.duration=e.duration||4294967295;return f(E.trak,g(e),v(e))};k=function(e){var t=new Uint8Array([0,0,0,0,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);if(e.type!=="video"){t[t.length-1]=0}return f(E.trex,t)};(function(){var i,r,s;s=function(e,t){var i=0,r=0,n=0,a=0;if(e.length){if(e[0].duration!==undefined){i=1}if(e[0].size!==undefined){r=2}if(e[0].flags!==undefined){n=4}if(e[0].compositionTimeOffset!==undefined){a=8}}return[0,0,i|r|n|a,1,(e.length&4278190080)>>>24,(e.length&16711680)>>>16,(e.length&65280)>>>8,e.length&255,(t&4278190080)>>>24,(t&16711680)>>>16,(t&65280)>>>8,t&255]};r=function(e,t){var i,r,n,a;r=e.samples||[];t+=8+12+16*r.length;i=s(r,t);for(a=0;a<r.length;a++){n=r[a];i=i.concat([(n.duration&4278190080)>>>24,(n.duration&16711680)>>>16,(n.duration&65280)>>>8,n.duration&255,(n.size&4278190080)>>>24,(n.size&16711680)>>>16,(n.size&65280)>>>8,n.size&255,n.flags.isLeading<<2|n.flags.dependsOn,n.flags.isDependedOn<<6|n.flags.hasRedundancy<<4|n.flags.paddingValue<<1|n.flags.isNonSyncSample,n.flags.degradationPriority&240<<8,n.flags.degradationPriority&15,(n.compositionTimeOffset&4278190080)>>>24,(n.compositionTimeOffset&16711680)>>>16,(n.compositionTimeOffset&65280)>>>8,n.compositionTimeOffset&255])}return f(E.trun,new Uint8Array(i))};i=function(e,t){var i,r,n,a;r=e.samples||[];t+=8+12+8*r.length;i=s(r,t);for(a=0;a<r.length;a++){n=r[a];i=i.concat([(n.duration&4278190080)>>>24,(n.duration&16711680)>>>16,(n.duration&65280)>>>8,n.duration&255,(n.size&4278190080)>>>24,(n.size&16711680)>>>16,(n.size&65280)>>>8,n.size&255])}return f(E.trun,new Uint8Array(i))};O=function(e,t){if(e.type==="audio"){return i(e,t)}return r(e,t)}})();t.exports={ftyp:a,mdat:s,moof:l,moov:c,initSegment:function(e){var t=a(),i=c(e),r;r=new Uint8Array(t.byteLength+i.byteLength);r.set(t);r.set(i,t.byteLength);return r}}},{}],57:[function(e,t,i){"use strict";var u,f,r,n;u=function(e,t){var i=[],r,n,a,s,o;if(!t.length){return null}for(r=0;r<e.byteLength;){n=e[r]<<24;n|=e[r+1]<<16;n|=e[r+2]<<8;n|=e[r+3];a=f(e.subarray(r+4,r+8));s=n>1?r+n:e.byteLength;if(a===t[0]){if(t.length===1){i.push(e.subarray(r+8,s))}else{o=u(e.subarray(r+8,s),t.slice(1));if(o.length){i=i.concat(o)}}}r=s}return i};f=function(e){var t="";t+=String.fromCharCode(e[0]);t+=String.fromCharCode(e[1]);t+=String.fromCharCode(e[2]);t+=String.fromCharCode(e[3]);return t};r=function(e){var t={},i=u(e,["moov","trak"]);return i.reduce(function(e,t){var i,r,n,a,s;i=u(t,["tkhd"])[0];if(!i){return null}r=i[0];n=r===0?12:20;a=i[n]<<24|i[n+1]<<16|i[n+2]<<8|i[n+3];s=u(t,["mdia","mdhd"])[0];if(!s){return null}r=s[0];n=r===0?12:20;e[a]=s[n]<<24|s[n+1]<<16|s[n+2]<<8|s[n+3];return e},t)};n=function(a,e){var t,i,r;t=u(e,["moof","traf"]);i=[].concat.apply([],t.map(function(n){return u(n,["tfhd"]).map(function(e){var t,i,r;t=e[4]<<24|e[5]<<16|e[6]<<8|e[7];i=a[t]||9e4;r=u(n,["tfdt"]).map(function(e){var t,i;t=e[0];i=e[4]<<24|e[5]<<16|e[6]<<8|e[7];if(t===1){i*=Math.pow(2,32);i+=e[8]<<24|e[9]<<16|e[10]<<8|e[11]}return i})[0];r=r||Infinity;return r/i})}));r=Math.min.apply(null,i);return isFinite(r)?r:0};t.exports={parseType:f,timescale:r,startTime:n}},{}],58:[function(e,t,i){"use strict";var r=e("../utils/stream.js");var c=e("./mp4-generator.js");var o=e("../m2ts/m2ts.js");var u=e("../codecs/adts.js");var f=e("../codecs/h264").H264Stream;var d=e("../aac");var l=e("../data/silence");var h=e("../utils/clock");var p=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"];var m=["width","height","profileIdc","levelIdc","profileCompatibility"];var g=9e4;var v,y,_,b;var T,w,S,k,O,E,A;T=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0}}};w=function(e){if(e[0]==="I".charCodeAt(0)&&e[1]==="D".charCodeAt(0)&&e[2]==="3".charCodeAt(0)){return true}return false};E=function(e,t){var i;if(e.length!==t.length){return false}for(i=0;i<e.length;i++){if(e[i]!==t[i]){return false}}return true};A=function(e){var t,i,r=0;for(t=0;t<e.length;t++){i=e[t];r+=i.data.byteLength}return r};y=function(n){var a=[],s=0,t=0,f=0,d=Infinity;y.prototype.init.call(this);this.push=function(t){S(n,t);if(n){p.forEach(function(e){n[e]=t[e]})}a.push(t)};this.setEarliestDts=function(e){t=e-n.timelineStartInfo.baseMediaDecodeTime};this.setVideoBaseMediaDecodeTime=function(e){d=e};this.setAudioAppendStart=function(e){f=e};this.flush=function(){var e,t,i,r;if(a.length===0){this.trigger("done","AudioSegmentStream");return}e=this.trimAdtsFramesByEarliestDts_(a);n.baseMediaDecodeTime=O(n);this.prefixWithSilence_(n,e);n.samples=this.generateSampleTable_(e);i=c.mdat(this.concatenateFrameData_(e));a=[];t=c.moof(s,[n]);r=new Uint8Array(t.byteLength+i.byteLength);s++;r.set(t);r.set(i,t.byteLength);k(n);this.trigger("data",{track:n,boxes:r});this.trigger("done","AudioSegmentStream")};this.prefixWithSilence_=function(e,t){var i,r=0,n=0,a=0,s=0,o,u;if(!t.length){return}i=h.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate);r=Math.ceil(g/(e.samplerate/1024));if(f&&d){n=i-Math.max(f,d);a=Math.floor(n/r);s=a*r}if(a<1||s>g/2){return}o=l[e.samplerate];if(!o){o=t[0].data}for(u=0;u<a;u++){t.splice(u,0,{data:o})}e.baseMediaDecodeTime-=Math.floor(h.videoTsToAudioTs(s,e.samplerate))};this.trimAdtsFramesByEarliestDts_=function(e){if(n.minSegmentDts>=t){return e}n.minSegmentDts=Infinity;return e.filter(function(e){if(e.dts>=t){n.minSegmentDts=Math.min(n.minSegmentDts,e.dts);n.minSegmentPts=n.minSegmentDts;return true}return false})};this.generateSampleTable_=function(e){var t,i,r=[];for(t=0;t<e.length;t++){i=e[t];r.push({size:i.data.byteLength,duration:1024})}return r};this.concatenateFrameData_=function(e){var t,i,r=0,n=new Uint8Array(A(e));for(t=0;t<e.length;t++){i=e[t];n.set(i.data,r);r+=i.data.byteLength}return n}};y.prototype=new r;v=function(f,o){var u=0,d=[],l=[],t,i;o=o||{};v.prototype.init.call(this);delete f.minPTS;this.gopCache_=[];this.push=function(e){S(f,e);if(e.nalUnitType==="seq_parameter_set_rbsp"&&!t){t=e.config;f.sps=[e.data];m.forEach(function(e){f[e]=t[e]},this)}if(e.nalUnitType==="pic_parameter_set_rbsp"&&!i){i=e.data;f.pps=[e.data]}d.push(e)};this.flush=function(){var e,t,i,r,n,a;while(d.length){if(d[0].nalUnitType==="access_unit_delimiter_rbsp"){break}d.shift()}if(d.length===0){this.resetStream_();this.trigger("done","VideoSegmentStream");return}e=this.groupNalsIntoFrames_(d);i=this.groupFramesIntoGops_(e);if(!i[0][0].keyFrame){t=this.getGopForFusion_(d[0],f);if(t){i.unshift(t);i.byteLength+=t.byteLength;i.nalCount+=t.nalCount;i.pts=t.pts;i.dts=t.dts;i.duration+=t.duration}else{i=this.extendFirstKeyFrame_(i)}}if(l.length){var s;if(o.alignGopsAtEnd){s=this.alignGopsAtEnd_(i)}else{s=this.alignGopsAtStart_(i)}if(!s){this.gopCache_.unshift({gop:i.pop(),pps:f.pps,sps:f.sps});this.gopCache_.length=Math.min(6,this.gopCache_.length);d=[];this.resetStream_();this.trigger("done","VideoSegmentStream");return}k(f);i=s}S(f,i);f.samples=this.generateSampleTable_(i);n=c.mdat(this.concatenateNalData_(i));f.baseMediaDecodeTime=O(f);this.trigger("processedGopsInfo",i.map(function(e){return{pts:e.pts,dts:e.dts,byteLength:e.byteLength}}));this.gopCache_.unshift({gop:i.pop(),pps:f.pps,sps:f.sps});this.gopCache_.length=Math.min(6,this.gopCache_.length);d=[];this.trigger("baseMediaDecodeTime",f.baseMediaDecodeTime);this.trigger("timelineStartInfo",f.timelineStartInfo);r=c.moof(u,[f]);a=new Uint8Array(r.byteLength+n.byteLength);u++;a.set(r);a.set(n,r.byteLength);this.trigger("data",{track:f,boxes:a});this.resetStream_();this.trigger("done","VideoSegmentStream")};this.resetStream_=function(){k(f);t=undefined;i=undefined};this.getGopForFusion_=function(e){var t=45e3,i=1e4,r=Infinity,n,a,s,o,u;for(u=0;u<this.gopCache_.length;u++){o=this.gopCache_[u];s=o.gop;if(!(f.pps&&E(f.pps[0],o.pps[0]))||!(f.sps&&E(f.sps[0],o.sps[0]))){continue}if(s.dts<f.timelineStartInfo.dts){continue}n=e.dts-s.dts-s.duration;if(n>=-i&&n<=t){if(!a||r>n){a=o;r=n}}}if(a){return a.gop}return null};this.extendFirstKeyFrame_=function(e){var t;if(!e[0][0].keyFrame&&e.length>1){t=e.shift();e.byteLength-=t.byteLength;e.nalCount-=t.nalCount;e[0][0].dts=t.dts;e[0][0].pts=t.pts;e[0][0].duration+=t.duration}return e};this.groupNalsIntoFrames_=function(e){var t,i,r=[],n=[];r.byteLength=0;for(t=0;t<e.length;t++){i=e[t];if(i.nalUnitType==="access_unit_delimiter_rbsp"){if(r.length){r.duration=i.dts-r.dts;n.push(r)}r=[i];r.byteLength=i.data.byteLength;r.pts=i.pts;r.dts=i.dts}else{if(i.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"){r.keyFrame=true}r.duration=i.dts-r.dts;r.byteLength+=i.data.byteLength;r.push(i)}}if(n.length&&(!r.duration||r.duration<=0)){r.duration=n[n.length-1].duration}n.push(r);return n};this.groupFramesIntoGops_=function(e){var t,i,r=[],n=[];r.byteLength=0;r.nalCount=0;r.duration=0;r.pts=e[0].pts;r.dts=e[0].dts;n.byteLength=0;n.nalCount=0;n.duration=0;n.pts=e[0].pts;n.dts=e[0].dts;for(t=0;t<e.length;t++){i=e[t];if(i.keyFrame){if(r.length){n.push(r);n.byteLength+=r.byteLength;n.nalCount+=r.nalCount;n.duration+=r.duration}r=[i];r.nalCount=i.length;r.byteLength=i.byteLength;r.pts=i.pts;r.dts=i.dts;r.duration=i.duration}else{r.duration+=i.duration;r.nalCount+=i.length;r.byteLength+=i.byteLength;r.push(i)}}if(n.length&&r.duration<=0){r.duration=n[n.length-1].duration}n.byteLength+=r.byteLength;n.nalCount+=r.nalCount;n.duration+=r.duration;n.push(r);return n};this.generateSampleTable_=function(e,t){var i,r,n,a,s,o=t||0,u=[];for(i=0;i<e.length;i++){a=e[i];for(r=0;r<a.length;r++){s=a[r];n=T();n.dataOffset=o;n.compositionTimeOffset=s.pts-s.dts;n.duration=s.duration;n.size=4*s.length;n.size+=s.byteLength;if(s.keyFrame){n.flags.dependsOn=2}o+=n.size;u.push(n)}}return u};this.concatenateNalData_=function(e){var t,i,r,n,a,s,o=0,u=e.byteLength,f=e.nalCount,d=u+4*f,l=new Uint8Array(d),c=new DataView(l.buffer);for(t=0;t<e.length;t++){n=e[t];for(i=0;i<n.length;i++){a=n[i];for(r=0;r<a.length;r++){s=a[r];c.setUint32(o,s.data.byteLength);o+=4;l.set(s.data,o);o+=s.data.byteLength}}}return l};this.alignGopsAtStart_=function(e){var t,i,r,n,a,s,o,u;a=e.byteLength;s=e.nalCount;o=e.duration;t=i=0;while(t<l.length&&i<e.length){r=l[t];n=e[i];if(r.pts===n.pts){break}if(n.pts>r.pts){t++;continue}i++;a-=n.byteLength;s-=n.nalCount;o-=n.duration}if(i===0){return e}if(i===e.length){return null}u=e.slice(i);u.byteLength=a;u.duration=o;u.nalCount=s;u.pts=u[0].pts;u.dts=u[0].dts;return u};this.alignGopsAtEnd_=function(e){var t,i,r,n,a,s;t=l.length-1;i=e.length-1;a=null;s=false;while(t>=0&&i>=0){r=l[t];n=e[i];if(r.pts===n.pts){s=true;break}if(r.pts>n.pts){t--;continue}if(t===l.length-1){a=i}i--}if(!s&&a===null){return null}var o;if(s){o=i}else{o=a}if(o===0){return e}var u=e.slice(o);var f=u.reduce(function(e,t){e.byteLength+=t.byteLength;e.duration+=t.duration;e.nalCount+=t.nalCount;return e},{byteLength:0,duration:0,nalCount:0});u.byteLength=f.byteLength;u.duration=f.duration;u.nalCount=f.nalCount;u.pts=u[0].pts;u.dts=u[0].dts;return u};this.alignGopsWith=function(e){l=e}};v.prototype=new r;S=function(e,t){if(typeof t.pts==="number"){if(e.timelineStartInfo.pts===undefined){e.timelineStartInfo.pts=t.pts}if(e.minSegmentPts===undefined){e.minSegmentPts=t.pts}else{e.minSegmentPts=Math.min(e.minSegmentPts,t.pts)}if(e.maxSegmentPts===undefined){e.maxSegmentPts=t.pts}else{e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)}}if(typeof t.dts==="number"){if(e.timelineStartInfo.dts===undefined){e.timelineStartInfo.dts=t.dts}if(e.minSegmentDts===undefined){e.minSegmentDts=t.dts}else{e.minSegmentDts=Math.min(e.minSegmentDts,t.dts)}if(e.maxSegmentDts===undefined){e.maxSegmentDts=t.dts}else{e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts)}}};k=function(e){delete e.minSegmentDts;delete e.maxSegmentDts;delete e.minSegmentPts;delete e.maxSegmentPts};O=function(e){var t,i,r=e.minSegmentDts-e.timelineStartInfo.dts;t=e.timelineStartInfo.baseMediaDecodeTime;t+=r;t=Math.max(0,t);if(e.type==="audio"){i=e.samplerate/g;t*=i;t=Math.floor(t)}return t};b=function(e,t){this.numberOfTracks=0;this.metadataStream=t;if(typeof e.remux!=="undefined"){this.remuxTracks=!!e.remux}else{this.remuxTracks=true}this.pendingTracks=[];this.videoTrack=null;this.pendingBoxes=[];this.pendingCaptions=[];this.pendingMetadata=[];this.pendingBytes=0;this.emittedTracks=0;b.prototype.init.call(this);this.push=function(e){if(e.text){return this.pendingCaptions.push(e)}if(e.frames){return this.pendingMetadata.push(e)}this.pendingTracks.push(e.track);this.pendingBoxes.push(e.boxes);this.pendingBytes+=e.boxes.byteLength;if(e.track.type==="video"){this.videoTrack=e.track}if(e.track.type==="audio"){this.audioTrack=e.track}}};b.prototype=new r;b.prototype.flush=function(e){var t=0,i={captions:[],captionStreams:{},metadata:[],info:{}},r,n,a,s=0,o;if(this.pendingTracks.length<this.numberOfTracks){if(e!=="VideoSegmentStream"&&e!=="AudioSegmentStream"){return}else if(this.remuxTracks){return}else if(this.pendingTracks.length===0){this.emittedTracks++;if(this.emittedTracks>=this.numberOfTracks){this.trigger("done");this.emittedTracks=0}return}}if(this.videoTrack){s=this.videoTrack.timelineStartInfo.pts;m.forEach(function(e){i.info[e]=this.videoTrack[e]},this)}else if(this.audioTrack){s=this.audioTrack.timelineStartInfo.pts;p.forEach(function(e){i.info[e]=this.audioTrack[e]},this)}if(this.pendingTracks.length===1){i.type=this.pendingTracks[0].type}else{i.type="combined"}this.emittedTracks+=this.pendingTracks.length;a=c.initSegment(this.pendingTracks);i.initSegment=new Uint8Array(a.byteLength);i.initSegment.set(a);i.data=new Uint8Array(this.pendingBytes);for(o=0;o<this.pendingBoxes.length;o++){i.data.set(this.pendingBoxes[o],t);t+=this.pendingBoxes[o].byteLength}for(o=0;o<this.pendingCaptions.length;o++){r=this.pendingCaptions[o];r.startTime=r.startPts-s;r.startTime/=9e4;r.endTime=r.endPts-s;r.endTime/=9e4;i.captionStreams[r.stream]=true;i.captions.push(r)}for(o=0;o<this.pendingMetadata.length;o++){n=this.pendingMetadata[o];n.cueTime=n.pts-s;n.cueTime/=9e4;i.metadata.push(n)}i.metadata.dispatchType=this.metadataStream.dispatchType;this.pendingTracks.length=0;this.videoTrack=null;this.pendingBoxes.length=0;this.pendingCaptions.length=0;this.pendingBytes=0;this.pendingMetadata.length=0;this.trigger("data",i);if(this.emittedTracks>=this.numberOfTracks){this.trigger("done");this.emittedTracks=0}};_=function(r){var n=this,i=true,a,s;_.prototype.init.call(this);r=r||{};this.baseMediaDecodeTime=r.baseMediaDecodeTime||0;this.transmuxPipeline_={};this.setupAacPipeline=function(){var t={};this.transmuxPipeline_=t;t.type="aac";t.metadataStream=new o.MetadataStream;t.aacStream=new d;t.audioTimestampRolloverStream=new o.TimestampRolloverStream("audio");t.timedMetadataTimestampRolloverStream=new o.TimestampRolloverStream("timed-metadata");t.adtsStream=new u;t.coalesceStream=new b(r,t.metadataStream);t.headOfPipeline=t.aacStream;t.aacStream.pipe(t.audioTimestampRolloverStream).pipe(t.adtsStream);t.aacStream.pipe(t.timedMetadataTimestampRolloverStream).pipe(t.metadataStream).pipe(t.coalesceStream);t.metadataStream.on("timestamp",function(e){t.aacStream.setTimestamp(e.timeStamp)});t.aacStream.on("data",function(e){if(e.type==="timed-metadata"&&!t.audioSegmentStream){s=s||{timelineStartInfo:{baseMediaDecodeTime:n.baseMediaDecodeTime},codec:"adts",type:"audio"};t.coalesceStream.numberOfTracks++;t.audioSegmentStream=new y(s);t.adtsStream.pipe(t.audioSegmentStream).pipe(t.coalesceStream)}});t.coalesceStream.on("data",this.trigger.bind(this,"data"));t.coalesceStream.on("done",this.trigger.bind(this,"done"))};this.setupTsPipeline=function(){var i={};this.transmuxPipeline_=i;i.type="ts";i.metadataStream=new o.MetadataStream;i.packetStream=new o.TransportPacketStream;i.parseStream=new o.TransportParseStream;i.elementaryStream=new o.ElementaryStream;i.videoTimestampRolloverStream=new o.TimestampRolloverStream("video");i.audioTimestampRolloverStream=new o.TimestampRolloverStream("audio");i.timedMetadataTimestampRolloverStream=new o.TimestampRolloverStream("timed-metadata");i.adtsStream=new u;i.h264Stream=new f;i.captionStream=new o.CaptionStream;i.coalesceStream=new b(r,i.metadataStream);i.headOfPipeline=i.packetStream;i.packetStream.pipe(i.parseStream).pipe(i.elementaryStream);i.elementaryStream.pipe(i.videoTimestampRolloverStream).pipe(i.h264Stream);i.elementaryStream.pipe(i.audioTimestampRolloverStream).pipe(i.adtsStream);i.elementaryStream.pipe(i.timedMetadataTimestampRolloverStream).pipe(i.metadataStream).pipe(i.coalesceStream);i.h264Stream.pipe(i.captionStream).pipe(i.coalesceStream);i.elementaryStream.on("data",function(e){var t;if(e.type==="metadata"){t=e.tracks.length;while(t--){if(!a&&e.tracks[t].type==="video"){a=e.tracks[t];a.timelineStartInfo.baseMediaDecodeTime=n.baseMediaDecodeTime}else if(!s&&e.tracks[t].type==="audio"){s=e.tracks[t];s.timelineStartInfo.baseMediaDecodeTime=n.baseMediaDecodeTime}}if(a&&!i.videoSegmentStream){i.coalesceStream.numberOfTracks++;i.videoSegmentStream=new v(a,r);i.videoSegmentStream.on("timelineStartInfo",function(e){if(s){s.timelineStartInfo=e;i.audioSegmentStream.setEarliestDts(e.dts)}});i.videoSegmentStream.on("processedGopsInfo",n.trigger.bind(n,"gopInfo"));i.videoSegmentStream.on("baseMediaDecodeTime",function(e){if(s){i.audioSegmentStream.setVideoBaseMediaDecodeTime(e)}});i.h264Stream.pipe(i.videoSegmentStream).pipe(i.coalesceStream)}if(s&&!i.audioSegmentStream){i.coalesceStream.numberOfTracks++;i.audioSegmentStream=new y(s);i.adtsStream.pipe(i.audioSegmentStream).pipe(i.coalesceStream)}}});i.coalesceStream.on("data",this.trigger.bind(this,"data"));i.coalesceStream.on("done",this.trigger.bind(this,"done"))};this.setBaseMediaDecodeTime=function(e){var t=this.transmuxPipeline_;this.baseMediaDecodeTime=e;if(s){s.timelineStartInfo.dts=undefined;s.timelineStartInfo.pts=undefined;k(s);s.timelineStartInfo.baseMediaDecodeTime=e;if(t.audioTimestampRolloverStream){t.audioTimestampRolloverStream.discontinuity()}}if(a){if(t.videoSegmentStream){t.videoSegmentStream.gopCache_=[];t.videoTimestampRolloverStream.discontinuity()}a.timelineStartInfo.dts=undefined;a.timelineStartInfo.pts=undefined;k(a);t.captionStream.reset();a.timelineStartInfo.baseMediaDecodeTime=e}if(t.timedMetadataTimestampRolloverStream){t.timedMetadataTimestampRolloverStream.discontinuity()}};this.setAudioAppendStart=function(e){if(s){this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)}};this.alignGopsWith=function(e){if(a&&this.transmuxPipeline_.videoSegmentStream){this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e)}};this.push=function(e){if(i){var t=w(e);if(t&&this.transmuxPipeline_.type!=="aac"){this.setupAacPipeline()}else if(!t&&this.transmuxPipeline_.type!=="ts"){this.setupTsPipeline()}i=false}this.transmuxPipeline_.headOfPipeline.push(e)};this.flush=function(){i=true;this.transmuxPipeline_.headOfPipeline.flush()};this.resetCaptions=function(){if(this.transmuxPipeline_.captionStream){this.transmuxPipeline_.captionStream.reset()}}};_.prototype=new r;t.exports={Transmuxer:_,VideoSegmentStream:v,AudioSegmentStream:y,AUDIO_PROPERTIES:p,VIDEO_PROPERTIES:m}},{"../aac":38,"../codecs/adts.js":40,"../codecs/h264":41,"../data/silence":42,"../m2ts/m2ts.js":50,"../utils/clock":60,"../utils/stream.js":62,"./mp4-generator.js":56}],59:[function(e,t,i){"use strict";var a=e("../m2ts/stream-types.js");var s=e("../m2ts/timestamp-rollover-stream.js").handleRollover;var m={};m.ts=e("../m2ts/probe.js");m.aac=e("../aac/probe.js");var l=9e4,g=188,v=71;var n=function(e){if(e[0]==="I".charCodeAt(0)&&e[1]==="D".charCodeAt(0)&&e[2]==="3".charCodeAt(0)){return true}return false};var o=function(e,t){var i=0,r=g,n,a;while(r<e.byteLength){if(e[i]===v&&e[r]===v){n=e.subarray(i,r);a=m.ts.parseType(n,t.pid);switch(a){case"pat":if(!t.pid){t.pid=m.ts.parsePat(n)}break;case"pmt":if(!t.table){t.table=m.ts.parsePmt(n)}break;default:break}if(t.pid&&t.table){return}i+=g;r+=g;continue}i++;r++}};var u=function(e,t,i){var r=0,n=g,a,s,o,u,f;var d=false;while(n<e.byteLength){if(e[r]===v&&e[n]===v){a=e.subarray(r,n);s=m.ts.parseType(a,t.pid);switch(s){case"pes":o=m.ts.parsePesType(a,t.table);u=m.ts.parsePayloadUnitStartIndicator(a);if(o==="audio"&&u){f=m.ts.parsePesTime(a);if(f){f.type="audio";i.audio.push(f);d=true}}break;default:break}if(d){break}r+=g;n+=g;continue}r++;n++}n=e.byteLength;r=n-g;d=false;while(r>=0){if(e[r]===v&&e[n]===v){a=e.subarray(r,n);s=m.ts.parseType(a,t.pid);switch(s){case"pes":o=m.ts.parsePesType(a,t.table);u=m.ts.parsePayloadUnitStartIndicator(a);if(o==="audio"&&u){f=m.ts.parsePesTime(a);if(f){f.type="audio";i.audio.push(f);d=true}}break;default:break}if(d){break}r-=g;n-=g;continue}r--;n--}};var f=function(e,t,i){var r=0,n=g,a,s,o,u,f,d,l,c;var h=false;var p={data:[],size:0};while(n<e.byteLength){if(e[r]===v&&e[n]===v){a=e.subarray(r,n);s=m.ts.parseType(a,t.pid);switch(s){case"pes":o=m.ts.parsePesType(a,t.table);u=m.ts.parsePayloadUnitStartIndicator(a);if(o==="video"){if(u&&!h){f=m.ts.parsePesTime(a);if(f){f.type="video";i.video.push(f);h=true}}if(!i.firstKeyFrame){if(u){if(p.size!==0){d=new Uint8Array(p.size);l=0;while(p.data.length){c=p.data.shift();d.set(c,l);l+=c.byteLength}if(m.ts.videoPacketContainsKeyFrame(d)){i.firstKeyFrame=m.ts.parsePesTime(d);i.firstKeyFrame.type="video"}p.size=0}}p.data.push(a);p.size+=a.byteLength}}break;default:break}if(h&&i.firstKeyFrame){break}r+=g;n+=g;continue}r++;n++}n=e.byteLength;r=n-g;h=false;while(r>=0){if(e[r]===v&&e[n]===v){a=e.subarray(r,n);s=m.ts.parseType(a,t.pid);switch(s){case"pes":o=m.ts.parsePesType(a,t.table);u=m.ts.parsePayloadUnitStartIndicator(a);if(o==="video"&&u){f=m.ts.parsePesTime(a);if(f){f.type="video";i.video.push(f);h=true}}break;default:break}if(h){break}r-=g;n-=g;continue}r--;n--}};var d=function(e,t){if(e.audio&&e.audio.length){var i=t;if(typeof i==="undefined"){i=e.audio[0].dts}e.audio.forEach(function(e){e.dts=s(e.dts,i);e.pts=s(e.pts,i);e.dtsTime=e.dts/l;e.ptsTime=e.pts/l})}if(e.video&&e.video.length){var r=t;if(typeof r==="undefined"){r=e.video[0].dts}e.video.forEach(function(e){e.dts=s(e.dts,r);e.pts=s(e.pts,r);e.dtsTime=e.dts/l;e.ptsTime=e.pts/l});if(e.firstKeyFrame){var n=e.firstKeyFrame;n.dts=s(n.dts,r);n.pts=s(n.pts,r);n.dtsTime=n.dts/l;n.ptsTime=n.dts/l}}};var c=function(e){var t=false,i=0,r=null,n=null,a=0,s=0,o;while(e.length-s>=3){var u=m.aac.parseType(e,s);switch(u){case"timed-metadata":if(e.length-s<10){t=true;break}a=m.aac.parseId3TagSize(e,s);if(a>e.length){t=true;break}if(n===null){o=e.subarray(s,s+a);n=m.aac.parseAacTimestamp(o)}s+=a;break;case"audio":if(e.length-s<7){t=true;break}a=m.aac.parseAdtsSize(e,s);if(a>e.length){t=true;break}if(r===null){o=e.subarray(s,s+a);r=m.aac.parseSampleRate(o)}i++;s+=a;break;default:s++;break}if(t){return null}}if(r===null||n===null){return null}var f=l/r;var d={audio:[{type:"audio",dts:n,pts:n},{type:"audio",dts:n+i*1024*f,pts:n+i*1024*f}]};return d};var h=function(e){var t={pid:null,table:null};var i={};o(e,t);for(var r in t.table){if(t.table.hasOwnProperty(r)){var n=t.table[r];switch(n){case a.H264_STREAM_TYPE:i.video=[];f(e,t,i);if(i.video.length===0){delete i.video}break;case a.ADTS_STREAM_TYPE:i.audio=[];u(e,t,i);if(i.audio.length===0){delete i.audio}break;default:break}}}return i};var r=function(e,t){var i=n(e);var r;if(i){r=c(e)}else{r=h(e)}if(!r||!r.audio&&!r.video){return null}d(r,t);return r};t.exports={inspect:r}},{"../aac/probe.js":39,"../m2ts/probe.js":52,"../m2ts/stream-types.js":53,"../m2ts/timestamp-rollover-stream.js":54}],60:[function(e,t,i){var r=9e4,n,a,s,o,u,f;n=function(e){return e*r};a=function(e,t){return e*t};s=function(e){return e/r};o=function(e,t){return e/t};u=function(e,t){return n(o(e,t))};f=function(e,t){return a(s(e),t)};t.exports={secondsToVideoTs:n,secondsToAudioTs:a,videoTsToSeconds:s,audioTsToSeconds:o,audioTsToVideoTs:u,videoTsToAudioTs:f}},{}],61:[function(e,t,i){"use strict";var r;r=function(r){var n=r.byteLength,a=0,s=0;this.length=function(){return 8*n};this.bitsAvailable=function(){return 8*n+s};this.loadWord=function(){var e=r.byteLength-n,t=new Uint8Array(4),i=Math.min(4,n);if(i===0){throw new Error("no bytes available")}t.set(r.subarray(e,e+i));a=new DataView(t.buffer).getUint32(0);s=i*8;n-=i};this.skipBits=function(e){var t;if(s>e){a<<=e;s-=e}else{e-=s;t=Math.floor(e/8);e-=t*8;n-=t;this.loadWord();a<<=e;s-=e}};this.readBits=function(e){var t=Math.min(s,e),i=a>>>32-t;s-=t;if(s>0){a<<=t}else if(n>0){this.loadWord()}t=e-t;if(t>0){return i<<t|this.readBits(t)}return i};this.skipLeadingZeros=function(){var e;for(e=0;e<s;++e){if((a&2147483648>>>e)!==0){a<<=e;s-=e;return e}}this.loadWord();return e+this.skipLeadingZeros()};this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())};this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())};this.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1};this.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();if(1&e){return 1+e>>>1}return-1*(e>>>1)};this.readBoolean=function(){return this.readBits(1)===1};this.readUnsignedByte=function(){return this.readBits(8)};this.loadWord()};t.exports=r},{}],62:[function(e,t,i){"use strict";var r=function(){this.init=function(){var a={};this.on=function(e,t){if(!a[e]){a[e]=[]}a[e]=a[e].concat(t)};this.off=function(e,t){var i;if(!a[e]){return false}i=a[e].indexOf(t);a[e]=a[e].slice();a[e].splice(i,1);return i>-1};this.trigger=function(e){var t,i,r,n;t=a[e];if(!t){return}if(arguments.length===2){r=t.length;for(i=0;i<r;++i){t[i].call(this,arguments[1])}}else{n=[];i=arguments.length;for(i=1;i<arguments.length;++i){n.push(arguments[i])}r=t.length;for(i=0;i<r;++i){t[i].apply(this,n)}}};this.dispose=function(){a={}}}};r.prototype.pipe=function(t){this.on("data",function(e){t.push(e)});this.on("done",function(e){t.flush(e)});return t};r.prototype.push=function(e){this.trigger("data",e)};r.prototype.flush=function(e){this.trigger("done",e)};t.exports=r},{}],63:[function(e,n,a){(function(e){var i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/;var d=/^([^\/;?#]*)(.*)$/;var t=/(?:\/|^)\.(?=\/)/g;var r=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g;var l={buildAbsoluteURL:function(e,t,i){i=i||{};e=e.trim();t=t.trim();if(!t){if(!i.alwaysNormalize){return e}var r=this.parseURL(e);if(!r){throw new Error("Error trying to parse base URL.")}r.path=l.normalizePath(r.path);return l.buildURLFromParts(r)}var n=this.parseURL(t);if(!n){throw new Error("Error trying to parse relative URL.")}if(n.scheme){if(!i.alwaysNormalize){return t}n.path=l.normalizePath(n.path);return l.buildURLFromParts(n)}var a=this.parseURL(e);if(!a){throw new Error("Error trying to parse base URL.")}if(!a.netLoc&&a.path&&a.path[0]!=="/"){var s=d.exec(a.path);a.netLoc=s[1];a.path=s[2]}if(a.netLoc&&!a.path){a.path="/"}var o={scheme:a.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};if(!n.netLoc){o.netLoc=a.netLoc;if(n.path[0]!=="/"){if(!n.path){o.path=a.path;if(!n.params){o.params=a.params;if(!n.query){o.query=a.query}}}else{var u=a.path;var f=u.substring(0,u.lastIndexOf("/")+1)+n.path;o.path=l.normalizePath(f)}}}if(o.path===null){o.path=i.alwaysNormalize?l.normalizePath(n.path):n.path}return l.buildURLFromParts(o)},parseURL:function(e){var t=i.exec(e);if(!t){return null}return{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}},normalizePath:function(e){e=e.split("").reverse().join("").replace(t,"");while(e.length!==(e=e.replace(r,"")).length){}return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};if(typeof a==="object"&&typeof n==="object")n.exports=l;else if(typeof s==="function"&&s.amd)s([],function(){return l});else if(typeof a==="object")a["URLToolkit"]=l;else e["URLToolkit"]=l})(this)},{}],64:[function(f,d,l){(function(e){"use strict";Object.defineProperty(l,"__esModule",{value:true});function t(e){return e&&e.__esModule?e:{default:e}}var i=f("global/window");var a=t(i);var r=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var n=t(r);var o=function e(t){Object.defineProperties(t.frame,{id:{get:function e(){n["default"].log.warn("cue.frame.id is deprecated. Use cue.value.key instead.");return t.value.key}},value:{get:function e(){n["default"].log.warn("cue.frame.value is deprecated. Use cue.value.data instead.");return t.value.data}},privateData:{get:function e(){n["default"].log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead.");return t.value.data}}})};var u=function e(t){var i=undefined;if(isNaN(t)||Math.abs(t)===Infinity){i=Number.MAX_VALUE}else{i=t}return i};var s=function e(r,t,i){var n=a["default"].WebKitDataCue||a["default"].VTTCue;if(t){t.forEach(function(e){var t=e.stream;this.inbandTextTracks_[t].addCue(new n(e.startTime+this.timestampOffset,e.endTime+this.timestampOffset,e.text))},r)}if(i){(function(){var s=u(r.mediaSource_.duration);i.forEach(function(e){var i=e.cueTime+this.timestampOffset;e.frames.forEach(function(e){var t=new n(i,i,e.value||e.url||e.data||"");t.frame=e;t.value=e;o(t);this.metadataTrack_.addCue(t)},this)},r);if(r.metadataTrack_&&r.metadataTrack_.cues&&r.metadataTrack_.cues.length){(function(){var e=r.metadataTrack_.cues;var t=[];for(var i=0;i<e.length;i++){if(e[i]){t.push(e[i])}}var n=t.reduce(function(e,t){var i=e[t.startTime]||[];i.push(t);e[t.startTime]=i;return e},{});var a=Object.keys(n).sort(function(e,t){return Number(e)-Number(t)});a.forEach(function(e,t){var i=n[e];var r=Number(a[t+1])||s;i.forEach(function(e){e.endTime=r})})})()}})()}};l["default"]={addTextTrackData:s,durationOfVideo:u};d.exports=l["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"global/window":32}],65:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function e(t){return/mp4a\.\d+.\d+/i.test(t)};var n=function e(t){return/avc1\.[\da-f]+/i.test(t)};var a=function e(t){var n={type:"",parameters:{}};var i=t.trim().split(";");n.type=i.shift().trim();i.forEach(function(e){var t=e.trim().split("=");if(t.length>1){var i=t[0].replace(/"/g,"").trim();var r=t[1].replace(/"/g,"").trim();n.parameters[i]=r}});return n};var s=function e(t){return t.map(function(e){return e.replace(/avc1\.(\d+)\.(\d+)/i,function(e,t,i){var r=("00"+Number(t).toString(16)).slice(-2);var n=("00"+Number(i).toString(16)).slice(-2);return"avc1."+r+"00"+n})})};i["default"]={isAudioCodec:r,parseContentType:a,isVideoCodec:n,translateLegacyCodecs:s};t.exports=i["default"]},{}],66:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function e(t,i,r){var n=i.player_;if(r.captions&&r.captions.length){if(!t.inbandTextTracks_){t.inbandTextTracks_={}}for(var a in r.captionStreams){if(!t.inbandTextTracks_[a]){n.tech_.trigger({type:"usage",name:"hls-608"});var s=n.textTracks().getTrackById(a);if(s){t.inbandTextTracks_[a]=s}else{t.inbandTextTracks_[a]=n.addRemoteTextTrack({kind:"captions",id:a,label:a},false).track}}}}if(r.metadata&&r.metadata.length&&!t.metadataTrack_){t.metadataTrack_=n.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},false).track;t.metadataTrack_.inBandMetadataTrackDispatchType=r.metadata.dispatchType}};i["default"]=r;t.exports=i["default"]},{}],67:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r={TIME_BETWEEN_CHUNKS:1,BYTES_PER_CHUNK:1024*32};i["default"]=r;t.exports=i["default"]},{}],68:[function(v,y,_){(function(e){"use strict";Object.defineProperty(_,"__esModule",{value:true});var t=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=function e(t,i,r){var n=true;e:while(n){var a=t,s=i,o=r;n=false;if(a===null)a=Function.prototype;var u=Object.getOwnPropertyDescriptor(a,s);if(u===undefined){var f=Object.getPrototypeOf(a);if(f===null){return undefined}else{t=f;i=s;r=o;n=true;u=f=undefined;continue e}}else if("value"in u){return u.value}else{var d=u.get;if(d===undefined){return undefined}return d.call(o)}}};function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var s=v("global/document");var o=i(s);var u=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var f=i(u);var d=v("./flash-source-buffer");var l=i(d);var c=v("./flash-constants");var h=i(c);var p=v("./codec-utils");var m=function(e){a(i,e);function i(){var t=this;n(this,i);r(Object.getPrototypeOf(i.prototype),"constructor",this).call(this);this.sourceBuffers=[];this.readyState="closed";this.on(["sourceopen","webkitsourceopen"],function(e){t.swfObj=o["default"].getElementById(e.swfId);t.player_=(0,f["default"])(t.swfObj.parentNode);t.tech_=t.swfObj.tech;t.readyState="open";t.tech_.on("seeking",function(){var e=t.sourceBuffers.length;while(e--){t.sourceBuffers[e].abort()}});if(t.swfObj){t.swfObj.vjs_load()}})}t(i,[{key:"addSeekableRange_",value:function e(){}},{key:"addSourceBuffer",value:function e(t){var i=(0,p.parseContentType)(t);var r=undefined;if(i.type==="video/mp2t"||i.type==="audio/mp2t"){r=new l["default"](this)}else{throw new Error("NotSupportedError (Video.js)")}this.sourceBuffers.push(r);return r}},{key:"endOfStream",value:function e(t){if(t==="network"){this.tech_.error(2)}else if(t==="decode"){this.tech_.error(3)}if(this.readyState!=="ended"){this.readyState="ended";this.swfObj.vjs_endOfStream()}}}]);return i}(f["default"].EventTarget);_["default"]=m;try{Object.defineProperty(m.prototype,"duration",{get:function e(){if(!this.swfObj){return NaN}return this.swfObj.vjs_getProperty("duration")},set:function e(t){var i=undefined;var r=this.swfObj.vjs_getProperty("duration");this.swfObj.vjs_setProperty("duration",t);if(t<r){for(i=0;i<this.sourceBuffers.length;i++){this.sourceBuffers[i].remove(t,r)}}return t}})}catch(e){m.prototype.duration=NaN}for(var g in h["default"]){m[g]=h["default"][g]}y.exports=_["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./codec-utils":65,"./flash-constants":67,"./flash-source-buffer":69,"global/document":31}],69:[function(L,P,I){(function(e){"use strict";Object.defineProperty(I,"__esModule",{value:true});var t=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var s=function e(t,i,r){var n=true;e:while(n){var a=t,s=i,o=r;n=false;if(a===null)a=Function.prototype;var u=Object.getOwnPropertyDescriptor(a,s);if(u===undefined){var f=Object.getPrototypeOf(a);if(f===null){return undefined}else{t=f;i=s;r=o;n=true;u=f=undefined;continue e}}else if("value"in u){return u.value}else{var d=u.get;if(d===undefined){return undefined}return d.call(o)}}};function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function r(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var n=L("global/window");var u=i(n);var a=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var f=i(a);var d=L("mux.js/lib/flv");var l=i(d);var c=L("./remove-cues-from-track");var h=i(c);var p=L("./create-text-tracks-if-necessary");var m=i(p);var g=L("./add-text-track-data");var v=L("./flash-transmuxer-worker");var y=i(v);var _=L("webwackify");var b=i(_);var T=L("./flash-constants");var w=i(T);var S=function e(){var t=undefined;try{t=L.resolve("./flash-transmuxer-worker")}catch(e){}return t};var k=function e(t){u["default"].setTimeout(t,w["default"].TIME_BETWEEN_CHUNKS)};var O=function e(){return Math.random().toString(36).slice(2,8)};var E=function e(t,i){if(typeof i!=="number"||i<0){i=0}var r=Math.pow(10,i);return Math.round(t*r)/r};var A=function(e){r(a,e);function a(e){var t=this;o(this,a);s(Object.getPrototypeOf(a.prototype),"constructor",this).call(this);var i=undefined;this.chunkSize_=w["default"].BYTES_PER_CHUNK;this.buffer_=[];this.bufferSize_=0;this.basePtsOffset_=NaN;this.mediaSource_=e;this.audioBufferEnd_=NaN;this.videoBufferEnd_=NaN;this.updating=false;this.timestampOffset_=0;i=u["default"].btoa(String.fromCharCode.apply(null,Array.prototype.slice.call(l["default"].getFlvHeader())));var r=this.mediaSource_.player_.id().replace(/[^a-zA-Z0-9]/g,"_");this.flashEncodedHeaderName_="vjs_flashEncodedHeader_"+r+O();this.flashEncodedDataName_="vjs_flashEncodedData_"+r+O();u["default"][this.flashEncodedHeaderName_]=function(){delete u["default"][t.flashEncodedHeaderName_];return i};this.mediaSource_.swfObj.vjs_appendChunkReady(this.flashEncodedHeaderName_);this.transmuxer_=(0,b["default"])(y["default"],S());this.transmuxer_.postMessage({action:"init",options:{}});this.transmuxer_.onmessage=function(e){if(e.data.action==="data"){t.receiveBuffer_(e.data.segment)}};this.one("updateend",function(){t.mediaSource_.tech_.trigger("loadedmetadata")});Object.defineProperty(this,"timestampOffset",{get:function e(){return this.timestampOffset_},set:function e(t){if(typeof t==="number"&&t>=0){this.timestampOffset_=t;this.mediaSource_.swfObj.vjs_discontinuity();this.basePtsOffset_=NaN;this.audioBufferEnd_=NaN;this.videoBufferEnd_=NaN;this.transmuxer_.postMessage({action:"reset"})}}});Object.defineProperty(this,"buffered",{get:function e(){if(!this.mediaSource_||!this.mediaSource_.swfObj||!("vjs_getProperty"in this.mediaSource_.swfObj)){return f["default"].createTimeRange()}var t=this.mediaSource_.swfObj.vjs_getProperty("buffered");if(t&&t.length){t[0][0]=E(t[0][0],3);t[0][1]=E(t[0][1],3)}return f["default"].createTimeRanges(t)}});this.mediaSource_.player_.on("seeked",function(){(0,h["default"])(0,Infinity,t.metadataTrack_);if(t.inbandTextTracks_){for(var e in t.inbandTextTracks_){(0,h["default"])(0,Infinity,t.inbandTextTracks_[e])}}});var n=this.onHlsReset_.bind(this);this.mediaSource_.player_.tech_.on("hls-reset",n);this.mediaSource_.player_.tech_.hls.on("dispose",function(){t.transmuxer_.terminate();t.mediaSource_.player_.tech_.off("hls-reset",n)})}t(a,[{key:"appendBuffer",value:function e(t){var i=undefined;if(this.updating){i=new Error("SourceBuffer.append() cannot be called "+"while an update is in progress");i.name="InvalidStateError";i.code=11;throw i}this.updating=true;this.mediaSource_.readyState="open";this.trigger({type:"update"});this.transmuxer_.postMessage({action:"push",data:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength},[t.buffer]);this.transmuxer_.postMessage({action:"flush"})}},{key:"abort",value:function e(){this.buffer_=[];this.bufferSize_=0;this.mediaSource_.swfObj.vjs_abort();if(this.updating){this.updating=false;this.trigger({type:"updateend"})}}},{key:"remove",value:function e(t,i){(0,h["default"])(t,i,this.metadataTrack_);if(this.inbandTextTracks_){for(var r in this.inbandTextTracks_){(0,h["default"])(t,i,this.inbandTextTracks_[r])}}this.trigger({type:"update"});this.trigger({type:"updateend"})}},{key:"receiveBuffer_",value:function e(t){var i=this;(0,m["default"])(this,this.mediaSource_,t);(0,g.addTextTrackData)(this,t.captions,t.metadata);k(function(){var e=i.convertTagsToData_(t);if(i.buffer_.length===0){k(i.processBuffer_.bind(i))}if(e){i.buffer_.push(e);i.bufferSize_+=e.byteLength}})}},{key:"processBuffer_",value:function e(){var t=this;var i=w["default"].BYTES_PER_CHUNK;if(!this.buffer_.length){if(this.updating!==false){this.updating=false;this.trigger({type:"updateend"})}return}var r=this.buffer_[0].subarray(0,i);if(r.byteLength<i||this.buffer_[0].byteLength===i){this.buffer_.shift()}else{this.buffer_[0]=this.buffer_[0].subarray(i)}this.bufferSize_-=r.byteLength;var n=[];var a=r.byteLength;for(var s=0;s<a;s++){n.push(String.fromCharCode(r[s]))}var o=u["default"].btoa(n.join(""));u["default"][this.flashEncodedDataName_]=function(){k(t.processBuffer_.bind(t));delete u["default"][t.flashEncodedDataName_];return o};this.mediaSource_.swfObj.vjs_appendChunkReady(this.flashEncodedDataName_)}},{key:"convertTagsToData_",value:function e(t){var i=0;var r=this.mediaSource_.tech_;var n=0;var a=undefined;var s=t.tags.videoTags;var o=t.tags.audioTags;if(isNaN(this.basePtsOffset_)&&(s.length||o.length)){var u=s[0]||{pts:Infinity};var f=o[0]||{pts:Infinity};this.basePtsOffset_=Math.min(f.pts,u.pts)}if(r.seeking()){this.videoBufferEnd_=NaN;this.audioBufferEnd_=NaN}if(isNaN(this.videoBufferEnd_)){if(r.buffered().length){n=r.buffered().end(0)-this.timestampOffset}if(r.seeking()){n=Math.max(n,r.currentTime()-this.timestampOffset)}n*=1e3;n+=this.basePtsOffset_}else{n=this.videoBufferEnd_+.1}var d=s.length;if(d&&s[d-1].pts>=n){while(--d){var l=s[d];if(l.pts>n){continue}if(l.keyFrame||l.metaDataTag){break}}while(d){var c=s[d-1];if(!c.metaDataTag){break}d--}}var h=s.slice(d);var p=undefined;if(isNaN(this.audioBufferEnd_)){p=n}else{p=this.audioBufferEnd_+.1}if(h.length){p=Math.min(p,h[0].pts)}d=0;while(d<o.length){if(o[d].pts>=p){break}d++}var m=o.slice(d);if(m.length){this.audioBufferEnd_=m[m.length-1].pts}if(h.length){this.videoBufferEnd_=h[h.length-1].pts}var g=this.getOrderedTags_(h,m);if(g.length===0){return}if(g[0].pts<n&&r.seeking()){var v=1/30;var y=r.currentTime();var _=(n-g[0].pts)/1e3;var b=y-_;if(b<v){b=0}try{this.mediaSource_.swfObj.vjs_adjustCurrentTime(b)}catch(e){}}for(var T=0;T<g.length;T++){i+=g[T].bytes.byteLength}a=new Uint8Array(i);for(var T=0,w=0;T<g.length;T++){a.set(g[T].bytes,w);w+=g[T].bytes.byteLength}return a}},{key:"getOrderedTags_",value:function e(t,i){var r=undefined;var n=[];while(t.length||i.length){if(!t.length){r=i.shift()}else if(!i.length){r=t.shift()}else if(i[0].dts<t[0].dts){r=i.shift()}else{r=t.shift()}n.push(r)}return n}},{key:"onHlsReset_",value:function e(){this.transmuxer_.postMessage({action:"resetCaptions"})}}]);return a}(f["default"].EventTarget);I["default"]=A;P.exports=I["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./add-text-track-data":64,"./create-text-tracks-if-necessary":66,"./flash-constants":67,"./flash-transmuxer-worker":70,"./remove-cues-from-track":72,"global/window":32,"mux.js/lib/flv":46,webwackify:76}],70:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=e("global/window");var o=n(s);var u=e("mux.js/lib/flv");var f=n(u);var d=function e(t){t.on("data",function(e){o["default"].postMessage({action:"data",segment:e})});t.on("done",function(e){o["default"].postMessage({action:"done"})})};var l=function(){function t(e){a(this,t);this.options=e||{};this.init()}r(t,[{key:"init",value:function e(){if(this.transmuxer){this.transmuxer.dispose()}this.transmuxer=new f["default"].Transmuxer(this.options);d(this.transmuxer)}},{key:"push",value:function e(t){var i=new Uint8Array(t.data,t.byteOffset,t.byteLength);this.transmuxer.push(i)}},{key:"reset",value:function e(){this.init()}},{key:"flush",value:function e(){this.transmuxer.flush()}},{key:"resetCaptions",value:function e(){this.transmuxer.resetCaptions()}}]);return t}();var c=function e(t){t.onmessage=function(e){if(e.data.action==="init"&&e.data.options){this.messageHandlers=new l(e.data.options);return}if(!this.messageHandlers){this.messageHandlers=new l}if(e.data&&e.data.action&&e.data.action!=="init"){if(this.messageHandlers[e.data.action]){this.messageHandlers[e.data.action](e.data)}}}};i["default"]=function(e){return new c(e)};t.exports=i["default"]},{"global/window":32,"mux.js/lib/flv":46}],71:[function(v,y,_){(function(e){"use strict";Object.defineProperty(_,"__esModule",{value:true});var i=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var r=function e(t,i,r){var n=true;e:while(n){var a=t,s=i,o=r;n=false;if(a===null)a=Function.prototype;var u=Object.getOwnPropertyDescriptor(a,s);if(u===undefined){var f=Object.getPrototypeOf(a);if(f===null){return undefined}else{t=f;i=s;r=o;n=true;u=f=undefined;continue e}}else if("value"in u){return u.value}else{var d=u.get;if(d===undefined){return undefined}return d.call(o)}}};function t(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var s=v("global/window");var o=t(s);var u=v("global/document");var f=t(u);var d=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var l=t(d);var c=v("./virtual-source-buffer");var h=t(c);var p=v("./add-text-track-data");var m=v("./codec-utils");var g=function(e){a(t,e);function t(){var a=this;n(this,t);r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var e=undefined;this.nativeMediaSource_=new o["default"].MediaSource;for(e in this.nativeMediaSource_){if(!(e in t.prototype)&&typeof this.nativeMediaSource_[e]==="function"){this[e]=this.nativeMediaSource_[e].bind(this.nativeMediaSource_)}}this.duration_=NaN;Object.defineProperty(this,"duration",{get:function e(){if(this.duration_===Infinity){return this.duration_}return this.nativeMediaSource_.duration},set:function e(t){this.duration_=t;if(t!==Infinity){this.nativeMediaSource_.duration=t;return}}});Object.defineProperty(this,"seekable",{get:function e(){if(this.duration_===Infinity){return l["default"].createTimeRanges([[0,this.nativeMediaSource_.duration]])}return this.nativeMediaSource_.seekable}});Object.defineProperty(this,"readyState",{get:function e(){return this.nativeMediaSource_.readyState}});Object.defineProperty(this,"activeSourceBuffers",{get:function e(){return this.activeSourceBuffers_}});this.sourceBuffers=[];this.activeSourceBuffers_=[];this.updateActiveSourceBuffers_=function(){a.activeSourceBuffers_.length=0;if(a.sourceBuffers.length===1){var e=a.sourceBuffers[0];e.appendAudioInitSegment_=true;e.audioDisabled_=!e.audioCodec_;a.activeSourceBuffers_.push(e);return}var t=false;var i=true;for(var r=0;r<a.player_.audioTracks().length;r++){var n=a.player_.audioTracks()[r];if(n.enabled&&n.kind!=="main"){t=true;i=false;break}}a.sourceBuffers.forEach(function(e){e.appendAudioInitSegment_=true;if(e.videoCodec_&&e.audioCodec_){e.audioDisabled_=t}else if(e.videoCodec_&&!e.audioCodec_){e.audioDisabled_=true;i=false}else if(!e.videoCodec_&&e.audioCodec_){e.audioDisabled_=i;if(i){return}}a.activeSourceBuffers_.push(e)})};this.onPlayerMediachange_=function(){a.sourceBuffers.forEach(function(e){e.appendAudioInitSegment_=true})};this.onHlsReset_=function(){a.sourceBuffers.forEach(function(e){if(e.transmuxer_){e.transmuxer_.postMessage({action:"resetCaptions"})}})};this.onHlsSegmentTimeMapping_=function(t){a.sourceBuffers.forEach(function(e){return e.timeMapping_=t.mapping})};["sourceopen","sourceclose","sourceended"].forEach(function(e){this.nativeMediaSource_.addEventListener(e,this.trigger.bind(this))},this);this.on("sourceopen",function(e){var t=f["default"].querySelector('[src="'+a.url_+'"]');if(!t){return}a.player_=(0,l["default"])(t.parentNode);a.player_.tech_.on("hls-reset",a.onHlsReset_);a.player_.tech_.on("hls-segment-time-mapping",a.onHlsSegmentTimeMapping_);if(a.player_.audioTracks&&a.player_.audioTracks()){a.player_.audioTracks().on("change",a.updateActiveSourceBuffers_);a.player_.audioTracks().on("addtrack",a.updateActiveSourceBuffers_);a.player_.audioTracks().on("removetrack",a.updateActiveSourceBuffers_)}a.player_.on("mediachange",a.onPlayerMediachange_)});this.on("sourceended",function(e){var t=(0,p.durationOfVideo)(a.duration);for(var i=0;i<a.sourceBuffers.length;i++){var r=a.sourceBuffers[i];var n=r.metadataTrack_&&r.metadataTrack_.cues;if(n&&n.length){n[n.length-1].endTime=t}}});this.on("sourceclose",function(e){this.sourceBuffers.forEach(function(e){if(e.transmuxer_){e.transmuxer_.terminate()}});this.sourceBuffers.length=0;if(!this.player_){return}if(this.player_.audioTracks&&this.player_.audioTracks()){this.player_.audioTracks().off("change",this.updateActiveSourceBuffers_);this.player_.audioTracks().off("addtrack",this.updateActiveSourceBuffers_);this.player_.audioTracks().off("removetrack",this.updateActiveSourceBuffers_)}if(this.player_.el_){this.player_.off("mediachange",this.onPlayerMediachange_);this.player_.tech_.off("hls-reset",this.onHlsReset_);this.player_.tech_.off("hls-segment-time-mapping",this.onHlsSegmentTimeMapping_)}})}i(t,[{key:"addSeekableRange_",value:function e(t,i){var r=undefined;if(this.duration!==Infinity){r=new Error("MediaSource.addSeekableRange() can only be invoked "+"when the duration is Infinity");r.name="InvalidStateError";r.code=11;throw r}if(i>this.nativeMediaSource_.duration||isNaN(this.nativeMediaSource_.duration)){this.nativeMediaSource_.duration=i}}},{key:"addSourceBuffer",value:function e(t){var i=undefined;var r=(0,m.parseContentType)(t);if(/^(video|audio)\/mp2t$/i.test(r.type)){var n=[];if(r.parameters&&r.parameters.codecs){n=r.parameters.codecs.split(",");n=(0,m.translateLegacyCodecs)(n);n=n.filter(function(e){return(0,m.isAudioCodec)(e)||(0,m.isVideoCodec)(e)})}if(n.length===0){n=["avc1.4d400d","mp4a.40.2"]}i=new h["default"](this,n);if(this.sourceBuffers.length!==0){this.sourceBuffers[0].createRealSourceBuffers_();i.createRealSourceBuffers_();this.sourceBuffers[0].audioDisabled_=true}}else{i=this.nativeMediaSource_.addSourceBuffer(t)}this.sourceBuffers.push(i);return i}}]);return t}(l["default"].EventTarget);_["default"]=g;y.exports=_["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./add-text-track-data":64,"./codec-utils":65,"./virtual-source-buffer":75,"global/document":31,"global/window":32}],72:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function e(t,i,r){var n=undefined;var a=undefined;if(!r){return}if(!r.cues){return}n=r.cues.length;while(n--){a=r.cues[n];if(a.startTime<=i&&a.endTime>=t){r.removeCue(a)}}};i["default"]=r;t.exports=i["default"]},{}],73:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=e("global/window");var o=n(s);var u=e("mux.js/lib/mp4");var f=n(u);var d=function e(t){t.on("data",function(e){var t=e.initSegment;e.initSegment={data:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength};var i=e.data;e.data=i.buffer;o["default"].postMessage({action:"data",segment:e,byteOffset:i.byteOffset,byteLength:i.byteLength},[e.data])});if(t.captionStream){t.captionStream.on("data",function(e){o["default"].postMessage({action:"caption",data:e})})}t.on("done",function(e){o["default"].postMessage({action:"done"})});t.on("gopInfo",function(e){o["default"].postMessage({action:"gopInfo",gopInfo:e})})};var l=function(){function t(e){a(this,t);this.options=e||{};this.init()}r(t,[{key:"init",value:function e(){if(this.transmuxer){this.transmuxer.dispose()}this.transmuxer=new f["default"].Transmuxer(this.options);d(this.transmuxer)}},{key:"push",value:function e(t){var i=new Uint8Array(t.data,t.byteOffset,t.byteLength);this.transmuxer.push(i)}},{key:"reset",value:function e(){this.init()}},{key:"setTimestampOffset",value:function e(t){var i=t.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(i*9e4))}},{key:"setAudioAppendStart",value:function e(t){this.transmuxer.setAudioAppendStart(Math.ceil(t.appendStart*9e4))}},{key:"flush",value:function e(t){this.transmuxer.flush()}},{key:"resetCaptions",value:function e(){this.transmuxer.resetCaptions()}},{key:"alignGopsWith",value:function e(t){this.transmuxer.alignGopsWith(t.gopsToAlignWith.slice())}}]);return t}();var c=function e(t){t.onmessage=function(e){if(e.data.action==="init"&&e.data.options){this.messageHandlers=new l(e.data.options);return}if(!this.messageHandlers){this.messageHandlers=new l}if(e.data&&e.data.action&&e.data.action!=="init"){if(this.messageHandlers[e.data.action]){this.messageHandlers[e.data.action](e.data)}}}};i["default"]=function(e){return new c(e)};t.exports=i["default"]},{"global/window":32,"mux.js/lib/mp4":55}],74:[function(g,e,v){(function(e){"use strict";Object.defineProperty(v,"__esModule",{value:true});function t(e){return e&&e.__esModule?e:{default:e}}var i=g("global/window");var n=t(i);var r=g("./flash-media-source");var a=t(r);var s=g("./html-media-source");var o=t(s);var u=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var f=t(u);var d=0;var l={mode:"auto"};f["default"].mediaSources={};var c=function e(t,i){var r=f["default"].mediaSources[t];if(r){r.trigger({type:"sourceopen",swfId:i})}else{throw new Error("Media Source not found (Video.js)")}};var h=function e(){return!!n["default"].MediaSource&&!!n["default"].MediaSource.isTypeSupported&&n["default"].MediaSource.isTypeSupported('video/mp4;codecs="avc1.4d400d,mp4a.40.2"')};var p=function e(t){var i=f["default"].mergeOptions(l,t);this.MediaSource={open:c,supportsNativeMediaSources:h};if(i.mode==="html5"||i.mode==="auto"&&h()){return new o["default"]}else if(f["default"].getTech("Flash")){return new a["default"]}throw new Error("Cannot use Flash or Html5 to create a MediaSource for this video")};v.MediaSource=p;p.open=c;p.supportsNativeMediaSources=h;var m={createObjectURL:function e(t){var i="blob:vjs-media-source/";var r=undefined;if(t instanceof o["default"]){r=n["default"].URL.createObjectURL(t.nativeMediaSource_);t.url_=r;return r}if(!(t instanceof a["default"])){r=n["default"].URL.createObjectURL(t);t.url_=r;return r}r=i+d;d++;f["default"].mediaSources[r]=t;return r}};v.URL=m;f["default"].MediaSource=p;f["default"].URL=m}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./flash-media-source":68,"./html-media-source":71,"global/window":32}],75:[function(k,e,O){(function(e){"use strict";Object.defineProperty(O,"__esModule",{value:true});var t=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var a=function e(t,i,r){var n=true;e:while(n){var a=t,s=i,o=r;n=false;if(a===null)a=Function.prototype;var u=Object.getOwnPropertyDescriptor(a,s);if(u===undefined){var f=Object.getPrototypeOf(a);if(f===null){return undefined}else{t=f;i=s;r=o;n=true;u=f=undefined;continue e}}else if("value"in u){return u.value}else{var d=u.get;if(d===undefined){return undefined}return d.call(o)}}};function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function r(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var n=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var f=i(n);var o=k("./create-text-tracks-if-necessary");var u=i(o);var d=k("./remove-cues-from-track");var l=i(d);var c=k("./add-text-track-data");var h=k("webwackify");var p=i(h);var m=k("./transmuxer-worker");var g=i(m);var v=k("./codec-utils");var y=function e(){var t=undefined;try{t=k.resolve("./transmuxer-worker")}catch(e){}return t};var _=function e(t,i){var r=t.addSourceBuffer(i);var n=Object.create(null);n.updating=false;n.realBuffer_=r;var a=function(i){if(typeof r[i]==="function"){n[i]=function(){return r[i].apply(r,arguments)}}else if(typeof n[i]==="undefined"){Object.defineProperty(n,i,{get:function e(){return r[i]},set:function e(t){return r[i]=t}})}};for(var s in r){a(s)}return n};var b=function e(t,i,r){if(!i||!t.length){return[]}var n=Math.ceil((i.currentTime()-r+3)*9e4);var a=undefined;for(a=0;a<t.length;a++){if(t[a].pts>n){break}}return t.slice(a)};O.gopsSafeToAlignWith=b;var T=function e(t,i,r){if(!i.length){return t}if(r){return i.slice()}var n=i[0].pts;var a=0;for(a;a<t.length;a++){if(t[a].pts>=n){break}}return t.slice(0,a).concat(i)};O.updateGopBuffer=T;var w=function e(t,i,r,n){var a=Math.ceil((i-n)*9e4);var s=Math.ceil((r-n)*9e4);var o=t.slice();var u=t.length;while(u--){if(t[u].pts<=s){break}}if(u===-1){return o}var f=u+1;while(f--){if(t[f].pts<=a){break}}f=Math.max(f,0);o.splice(f,u-f+1);return o};O.removeGopBuffer=w;var S=function(e){r(n,e);function n(e,t){var i=this;s(this,n);a(Object.getPrototypeOf(n.prototype),"constructor",this).call(this,f["default"].EventTarget);this.timestampOffset_=0;this.pendingBuffers_=[];this.bufferUpdating_=false;this.mediaSource_=e;this.codecs_=t;this.audioCodec_=null;this.videoCodec_=null;this.audioDisabled_=false;this.appendAudioInitSegment_=true;this.gopBuffer_=[];this.timeMapping_=0;this.safeAppend_=f["default"].browser.IE_VERSION>=11;var r={remux:false,alignGopsAtEnd:this.safeAppend_};this.codecs_.forEach(function(e){if((0,v.isAudioCodec)(e)){i.audioCodec_=e}else if((0,v.isVideoCodec)(e)){i.videoCodec_=e}});this.transmuxer_=(0,p["default"])(g["default"],y());this.transmuxer_.postMessage({action:"init",options:r});this.transmuxer_.onmessage=function(e){if(e.data.action==="data"){return i.data_(e)}if(e.data.action==="done"){return i.done_(e)}if(e.data.action==="gopInfo"){return i.appendGopInfo_(e)}};Object.defineProperty(this,"timestampOffset",{get:function e(){return this.timestampOffset_},set:function e(t){if(typeof t==="number"&&t>=0){this.timestampOffset_=t;this.appendAudioInitSegment_=true;this.gopBuffer_.length=0;this.timeMapping_=0;this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:t})}}});Object.defineProperty(this,"appendWindowStart",{get:function e(){return(this.videoBuffer_||this.audioBuffer_).appendWindowStart},set:function e(t){if(this.videoBuffer_){this.videoBuffer_.appendWindowStart=t}if(this.audioBuffer_){this.audioBuffer_.appendWindowStart=t}}});Object.defineProperty(this,"updating",{get:function e(){return!!(this.bufferUpdating_||!this.audioDisabled_&&this.audioBuffer_&&this.audioBuffer_.updating||this.videoBuffer_&&this.videoBuffer_.updating)}});Object.defineProperty(this,"buffered",{get:function e(){var t=null;var i=null;var r=0;var n=[];var a=[];if(!this.videoBuffer_&&!this.audioBuffer_){return f["default"].createTimeRange()}if(!this.videoBuffer_){return this.audioBuffer_.buffered}if(!this.audioBuffer_){return this.videoBuffer_.buffered}if(this.audioDisabled_){return this.videoBuffer_.buffered}if(this.videoBuffer_.buffered.length===0&&this.audioBuffer_.buffered.length===0){return f["default"].createTimeRange()}var s=this.videoBuffer_.buffered;var o=this.audioBuffer_.buffered;var u=s.length;while(u--){n.push({time:s.start(u),type:"start"});n.push({time:s.end(u),type:"end"})}u=o.length;while(u--){n.push({time:o.start(u),type:"start"});n.push({time:o.end(u),type:"end"})}n.sort(function(e,t){return e.time-t.time});for(u=0;u<n.length;u++){if(n[u].type==="start"){r++;if(r===2){t=n[u].time}}else if(n[u].type==="end"){r--;if(r===1){i=n[u].time}}if(t!==null&&i!==null){a.push([t,i]);t=null;i=null}}return f["default"].createTimeRanges(a)}})}t(n,[{key:"data_",value:function e(t){var i=t.data.segment;i.data=new Uint8Array(i.data,t.data.byteOffset,t.data.byteLength);i.initSegment=new Uint8Array(i.initSegment.data,i.initSegment.byteOffset,i.initSegment.byteLength);(0,u["default"])(this,this.mediaSource_,i);this.pendingBuffers_.push(i);return}},{key:"done_",value:function e(t){if(this.mediaSource_.readyState==="closed"){this.pendingBuffers_.length=0;return}this.processPendingSegments_();return}},{key:"createRealSourceBuffers_",value:function e(){var n=this;var a=["audio","video"];a.forEach(function(i){if(!n[i+"Codec_"]){return}if(n[i+"Buffer_"]){return}var e=null;if(n.mediaSource_[i+"Buffer_"]){e=n.mediaSource_[i+"Buffer_"];e.updating=false}else{var t=i+"Codec_";var r=i+'/mp4;codecs="'+n[t]+'"';e=_(n.mediaSource_.nativeMediaSource_,r);n.mediaSource_[i+"Buffer_"]=e}n[i+"Buffer_"]=e;["update","updatestart","updateend"].forEach(function(t){e.addEventListener(t,function(){if(i==="audio"&&n.audioDisabled_){return}if(t==="updateend"){n[i+"Buffer_"].updating=false}var e=a.every(function(e){if(e==="audio"&&n.audioDisabled_){return true}if(i!==e&&n[e+"Buffer_"]&&n[e+"Buffer_"].updating){return false}return true});if(e){return n.trigger(t)}})})})}},{key:"appendBuffer",value:function e(t){this.bufferUpdating_=true;if(this.audioBuffer_&&this.audioBuffer_.buffered.length){var i=this.audioBuffer_.buffered;this.transmuxer_.postMessage({action:"setAudioAppendStart",appendStart:i.end(i.length-1)})}if(this.videoBuffer_){this.transmuxer_.postMessage({action:"alignGopsWith",gopsToAlignWith:b(this.gopBuffer_,this.mediaSource_.player_,this.timeMapping_)})}this.transmuxer_.postMessage({action:"push",data:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength},[t.buffer]);this.transmuxer_.postMessage({action:"flush"})}},{key:"appendGopInfo_",value:function e(t){this.gopBuffer_=T(this.gopBuffer_,t.data.gopInfo,this.safeAppend_)}},{key:"remove",value:function e(t,i){if(this.videoBuffer_){this.videoBuffer_.updating=true;this.videoBuffer_.remove(t,i);this.gopBuffer_=w(this.gopBuffer_,t,i,this.timeMapping_)}if(!this.audioDisabled_&&this.audioBuffer_){this.audioBuffer_.updating=true;this.audioBuffer_.remove(t,i)}(0,l["default"])(t,i,this.metadataTrack_);if(this.inbandTextTracks_){for(var r in this.inbandTextTracks_){(0,l["default"])(t,i,this.inbandTextTracks_[r])}}}},{key:"processPendingSegments_",value:function e(){var t={video:{segments:[],bytes:0},audio:{segments:[],bytes:0},captions:[],metadata:[]};t=this.pendingBuffers_.reduce(function(e,t){var i=t.type;var r=t.data;var n=t.initSegment;e[i].segments.push(r);e[i].bytes+=r.byteLength;e[i].initSegment=n;if(t.captions){e.captions=e.captions.concat(t.captions)}if(t.info){e[i].info=t.info}if(t.metadata){e.metadata=e.metadata.concat(t.metadata)}return e},t);if(!this.videoBuffer_&&!this.audioBuffer_){if(t.video.bytes===0){this.videoCodec_=null}if(t.audio.bytes===0){this.audioCodec_=null}this.createRealSourceBuffers_()}if(t.audio.info){this.mediaSource_.trigger({type:"audioinfo",info:t.audio.info})}if(t.video.info){this.mediaSource_.trigger({type:"videoinfo",info:t.video.info})}if(this.appendAudioInitSegment_){if(!this.audioDisabled_&&this.audioBuffer_){t.audio.segments.unshift(t.audio.initSegment);t.audio.bytes+=t.audio.initSegment.byteLength}this.appendAudioInitSegment_=false}var i=false;if(this.videoBuffer_&&t.video.bytes){t.video.segments.unshift(t.video.initSegment);t.video.bytes+=t.video.initSegment.byteLength;this.concatAndAppendSegments_(t.video,this.videoBuffer_);(0,c.addTextTrackData)(this,t.captions,t.metadata)}else if(this.videoBuffer_&&(this.audioDisabled_||!this.audioBuffer_)){i=true}if(!this.audioDisabled_&&this.audioBuffer_){this.concatAndAppendSegments_(t.audio,this.audioBuffer_)}this.pendingBuffers_.length=0;if(i){this.trigger("updateend")}this.bufferUpdating_=false}},{key:"concatAndAppendSegments_",value:function e(t,i){var r=0;var n=undefined;if(t.bytes){n=new Uint8Array(t.bytes);t.segments.forEach(function(e){n.set(e,r);r+=e.byteLength});try{i.updating=true;i.appendBuffer(n)}catch(e){if(this.mediaSource_.player_){this.mediaSource_.player_.error({code:-3,type:"APPEND_BUFFER_ERR",message:e.message,originalError:e})}}}}},{key:"abort",value:function e(){if(this.videoBuffer_){this.videoBuffer_.abort()}if(!this.audioDisabled_&&this.audioBuffer_){this.audioBuffer_.abort()}if(this.transmuxer_){this.transmuxer_.postMessage({action:"reset"})}this.pendingBuffers_.length=0;this.bufferUpdating_=false}}]);return n}(f["default"].EventTarget);O["default"]=S}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./add-text-track-data":64,"./codec-utils":65,"./create-text-tracks-if-necessary":66,"./remove-cues-from-track":72,"./transmuxer-worker":73,webwackify:76}],76:[function(e,t,i){var f=arguments[3];var d=arguments[4];var l=arguments[5];var c=JSON.stringify;var u=false;var r=function(i){var r={};function n(e){if(r[e]){return r[e].exports}var t=r[e]={i:e,l:false,exports:{}};i[e].call(t.exports,t,t.exports,n);t.l=true;return t.exports}n.m=i;n.c=r;n.d=function(e,t,i){if(!n.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:i})}};n.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};n.d(e,"a",e);return e};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";return n(n.s=entryModule)};if(typeof f==="undefined"){u=true;f=r;d=__webpack_modules__}var h=function(e){var t=Object.keys(l);var i;for(var r=0;r<t.length;r++){var n=t[r];var a=l[n].exports;if(a===e||a&&a.default===e){i=n;break}}if(!i){i=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var s={};for(var r=0;r<t.length;r++){var n=t[r];s[n]=n}d[i]=["function(require,module,exports){"+e+"(self); }",s]}var o=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var u={};u[i]=i;d[o]=["function(require,module,exports){"+"var f = require("+c(i)+");"+"(f.default ? f.default : f)(self);"+"}",u];return"("+f+")({"+Object.keys(d).map(function(e){return c(e)+":["+d[e][0]+","+c(d[e][1])+"]"}).join(",")+"},{},["+c(o)+"])"};var p=function(e,t){var i=typeof t==="string";var r;if(i){r={}}else{r=[]}Object.keys(d).forEach(function(e){if(!d[e]){return}r[e]=d[e].toString()});var n=__webpack_require__(t);if(!(n&&(n===e||n.default===e))){var a=r[t];r[t]=a.substring(0,a.length-1)+"\n"+e.name+"();\n}"}var s;if(i){t=c(t);var o=Object.keys(r).map(function(e){return c(e)+":"+r[e]});s="{"+o.join(",")+"}"}else{s="["+r.join(",")+"]"}return"var fn = ("+f.toString().replace("entryModule",t)+")("+s+");\n"+'(typeof fn === "function") && fn(self);'};t.exports=function e(t,i){var r;if(u){r=p(t,i)}else{r=h(t)}var n=new Blob([r],{type:"text/javascript"});var a=window.URL||window.webkitURL||window.mozURL||window.msURL;var s=a.createObjectURL(n);var o=new Worker(s);o.objectURL=s;return o}},{}],77:[function(G,H,e){(function(e){"use strict";var t=function(){function r(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(e,t,i){if(t)r(e.prototype,t);if(i)r(e,i);return e}}();var s=function e(t,i,r){var n=true;e:while(n){var a=t,s=i,o=r;n=false;if(a===null)a=Function.prototype;var u=Object.getOwnPropertyDescriptor(a,s);if(u===undefined){var f=Object.getPrototypeOf(a);if(f===null){return undefined}else{t=f;i=s;r=o;n=true;u=f=undefined;continue e}}else if("value"in u){return u.value}else{var d=u.get;if(d===undefined){return undefined}return d.call(o)}}};function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function r(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var n=G("global/document");var u=i(n);var a=G("./playlist-loader");var f=i(a);var d=G("./playlist");var l=i(d);var c=G("./xhr");var h=i(c);var p=G("aes-decrypter");var m=G("./bin-utils");var g=i(m);var v=G("videojs-contrib-media-sources");var y=G("m3u8-parser");var _=i(y);var b=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var T=i(b);var w=G("./master-playlist-controller");var S=G("./config");var k=i(S);var O=G("./rendition-mixin");var E=i(O);var A=G("global/window");var L=i(A);var P=G("./playback-watcher");var I=i(P);var C=G("./reload-source-on-error");var U=i(C);var D=G("./playlist-selectors.js");var M={PlaylistLoader:f["default"],Playlist:l["default"],Decrypter:p.Decrypter,AsyncStream:p.AsyncStream,decrypt:p.decrypt,utils:g["default"],STANDARD_PLAYLIST_SELECTOR:D.lastBandwidthSelector,INITIAL_PLAYLIST_SELECTOR:D.lowestBitrateCompatibleVariantSelector,comparePlaylistBandwidth:D.comparePlaylistBandwidth,comparePlaylistResolution:D.comparePlaylistResolution,xhr:(0,h["default"])()};var x=4194304;["GOAL_BUFFER_LENGTH","MAX_GOAL_BUFFER_LENGTH","GOAL_BUFFER_LENGTH_RATE","BUFFER_LOW_WATER_LINE","MAX_BUFFER_LOW_WATER_LINE","BUFFER_LOW_WATER_LINE_RATE","BANDWIDTH_VARIANCE"].forEach(function(i){Object.defineProperty(M,i,{get:function e(){T["default"].log.warn("using Hls."+i+" is UNSAFE be sure you know what you are doing");return k["default"][i]},set:function e(t){T["default"].log.warn("using Hls."+i+" is UNSAFE be sure you know what you are doing");if(typeof t!=="number"||t<0){T["default"].log.warn("value of Hls."+i+" must be greater than or equal to 0");return}k["default"][i]=t}})});var R=function e(t,i){var r=i.media();var n=-1;for(var a=0;a<t.length;a++){if(t[a].id===r.uri){n=a;break}}t.selectedIndex_=n;t.trigger({selectedIndex:n,type:"change"})};var B=function e(t,i){i.representations().forEach(function(e){t.addQualityLevel(e)});R(t,i.playlists)};M.canPlaySource=function(){return T["default"].log.warn("HLS is no longer a tech. Please remove it from "+"your player's techOrder.")};M.supportsNativeHls=function(){var t=u["default"].createElement("video");if(!T["default"].getTech("Html5").isSupported()){return false}var e=["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"];return e.some(function(e){return/maybe|probably/i.test(t.canPlayType(e))})}();M.isSupported=function(){return T["default"].log.warn("HLS is no longer a tech. Please remove it from "+"your player's techOrder.")};var j=T["default"].getComponent("Component");var N=function(e){r(a,e);function a(e,t,i){var r=this;o(this,a);s(Object.getPrototypeOf(a.prototype),"constructor",this).call(this,t,i.hls);if(t.options_&&t.options_.playerId){var n=(0,T["default"])(t.options_.playerId);if(!n.hasOwnProperty("hls")){Object.defineProperty(n,"hls",{get:function e(){T["default"].log.warn("player.hls is deprecated. Use player.tech_.hls instead.");t.trigger({type:"usage",name:"hls-player-access"});return r}})}}this.tech_=t;this.source_=e;this.stats={};this.ignoreNextSeekingEvent_=false;this.setOptions_();if(this.options_.overrideNative&&(t.featuresNativeVideoTracks||t.featuresNativeAudioTracks)){throw new Error("Overriding native HLS requires emulated tracks. "+"See https://git.io/vMpjB")}this.on(u["default"],["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],function(e){var t=u["default"].fullscreenElement||u["default"].webkitFullscreenElement||u["default"].mozFullScreenElement||u["default"].msFullscreenElement;if(t&&t.contains(r.tech_.el())){r.masterPlaylistController_.fastQualityChange_()}});this.on(this.tech_,"seeking",function(){if(this.ignoreNextSeekingEvent_){this.ignoreNextSeekingEvent_=false;return}this.setCurrentTime(this.tech_.currentTime())});this.on(this.tech_,"error",function(){if(this.masterPlaylistController_){this.masterPlaylistController_.pauseLoading()}});this.on(this.tech_,"play",this.play)}t(a,[{key:"setOptions_",value:function e(){var t=this;this.options_.withCredentials=this.options_.withCredentials||false;if(typeof this.options_.blacklistDuration!=="number"){this.options_.blacklistDuration=5*60}if(typeof this.options_.bandwidth!=="number"){this.options_.bandwidth=x}this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===x;["withCredentials","bandwidth"].forEach(function(e){if(typeof t.source_[e]!=="undefined"){t.options_[e]=t.source_[e]}});this.bandwidth=this.options_.bandwidth}},{key:"src",value:function e(t){var i=this;if(!t){return}this.setOptions_();this.options_.url=this.source_.src;this.options_.tech=this.tech_;this.options_.externHls=M;this.masterPlaylistController_=new w.MasterPlaylistController(this.options_);this.playbackWatcher_=new I["default"](T["default"].mergeOptions(this.options_,{seekable:function e(){return i.seekable()}}));this.masterPlaylistController_.on("error",function(){var e=T["default"].players[i.tech_.options_.playerId];e.error(i.masterPlaylistController_.error)});this.masterPlaylistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):M.STANDARD_PLAYLIST_SELECTOR.bind(this);this.masterPlaylistController_.selectInitialPlaylist=M.INITIAL_PLAYLIST_SELECTOR.bind(this);this.playlists=this.masterPlaylistController_.masterPlaylistLoader_;this.mediaSource=this.masterPlaylistController_.mediaSource;Object.defineProperties(this,{selectPlaylist:{get:function e(){return this.masterPlaylistController_.selectPlaylist},set:function e(t){this.masterPlaylistController_.selectPlaylist=t.bind(this)}},throughput:{get:function e(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function e(t){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=t;this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function e(){return this.masterPlaylistController_.mainSegmentLoader_.bandwidth},set:function e(t){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=t;this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function e(){var t=1/(this.bandwidth||1);var i=undefined;if(this.throughput>0){i=1/this.throughput}else{i=0}var r=Math.floor(1/(t+i));return r},set:function e(){T["default"].log.error('The "systemBandwidth" property is read-only')}}});Object.defineProperties(this.stats,{bandwidth:{get:function e(){return i.bandwidth||0},enumerable:true},mediaRequests:{get:function e(){return i.masterPlaylistController_.mediaRequests_()||0},enumerable:true},mediaRequestsAborted:{get:function e(){return i.masterPlaylistController_.mediaRequestsAborted_()||0},enumerable:true},mediaRequestsTimedout:{get:function e(){return i.masterPlaylistController_.mediaRequestsTimedout_()||0},enumerable:true},mediaRequestsErrored:{get:function e(){return i.masterPlaylistController_.mediaRequestsErrored_()||0},enumerable:true},mediaTransferDuration:{get:function e(){return i.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:true},mediaBytesTransferred:{get:function e(){return i.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:true},mediaSecondsLoaded:{get:function e(){return i.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:true}});this.tech_.one("canplay",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_));this.masterPlaylistController_.on("selectedinitialmedia",function(){(0,E["default"])(i)});this.on(this.masterPlaylistController_,"progress",function(){this.tech_.trigger("progress")});this.on(this.masterPlaylistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=true});this.tech_.ready(function(){return i.setupQualityLevels_()});if(!this.tech_.el()){return}this.tech_.src(T["default"].URL.createObjectURL(this.masterPlaylistController_.mediaSource))}},{key:"setupQualityLevels_",value:function e(){var t=this;var i=T["default"].players[this.tech_.options_.playerId];if(i&&i.qualityLevels){this.qualityLevels_=i.qualityLevels();this.masterPlaylistController_.on("selectedinitialmedia",function(){B(t.qualityLevels_,t)});this.playlists.on("mediachange",function(){R(t.qualityLevels_,t.playlists)})}}},{key:"play",value:function e(){this.masterPlaylistController_.play()}},{key:"setCurrentTime",value:function e(t){this.masterPlaylistController_.setCurrentTime(t)}},{key:"duration",value:function e(){return this.masterPlaylistController_.duration()}},{key:"seekable",value:function e(){return this.masterPlaylistController_.seekable()}},{key:"dispose",value:function e(){if(this.playbackWatcher_){this.playbackWatcher_.dispose()}if(this.masterPlaylistController_){this.masterPlaylistController_.dispose()}if(this.qualityLevels_){this.qualityLevels_.dispose()}s(Object.getPrototypeOf(a.prototype),"dispose",this).call(this)}}]);return a}(j);var F=function n(a){return{canHandleSource:function e(t){var i=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var r=T["default"].mergeOptions(T["default"].options,i);if(r.hls&&r.hls.mode&&r.hls.mode!==a){return false}return n.canPlayType(t.type,r)},handleSource:function e(t,i){var r=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];var n=T["default"].mergeOptions(T["default"].options,r,{hls:{mode:a}});if(a==="flash"){i.setTimeout(function(){i.trigger("loadstart")},1)}i.hls=new N(t,i,n);i.hls.xhr=(0,h["default"])();i.hls.src(t.src);return i.hls},canPlayType:function e(t){var i=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var r=T["default"].mergeOptions(T["default"].options,i);if(n.canPlayType(t,r)){return"maybe"}return""}}};F.canPlayType=function(e,t){if(T["default"].browser.IE_VERSION&&T["default"].browser.IE_VERSION<=10){return false}var i=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i;if(!t.hls.overrideNative&&M.supportsNativeHls){return false}return i.test(e)};if(typeof T["default"].MediaSource==="undefined"||typeof T["default"].URL==="undefined"){T["default"].MediaSource=v.MediaSource;T["default"].URL=v.URL}var q=T["default"].getTech("Flash");if(v.MediaSource.supportsNativeMediaSources()){T["default"].getTech("Html5").registerSourceHandler(F("html5"),0)}if(L["default"].Uint8Array&&q){q.registerSourceHandler(F("flash"))}T["default"].HlsHandler=N;T["default"].HlsSourceHandler=F;T["default"].Hls=M;if(!T["default"].use){T["default"].registerComponent("Hls",M)}T["default"].m3u8=_["default"];T["default"].options.hls=T["default"].options.hls||{};if(T["default"].registerPlugin){T["default"].registerPlugin("reloadSourceOnError",U["default"])}else{T["default"].plugin("reloadSourceOnError",U["default"])}H.exports={Hls:M,HlsHandler:N,HlsSourceHandler:F}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./bin-utils":2,"./config":3,"./master-playlist-controller":5,"./playback-watcher":8,"./playlist":11,"./playlist-loader":9,"./playlist-selectors.js":10,"./reload-source-on-error":13,"./rendition-mixin":14,"./xhr":21,"aes-decrypter":25,"global/document":31,"global/window":32,"m3u8-parser":33,"videojs-contrib-media-sources":74}]},{},[77])(77)});