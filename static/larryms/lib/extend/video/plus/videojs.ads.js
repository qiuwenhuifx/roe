(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?module.exports=t(require("video.js")):typeof define==="function"&&define.amd?define(["video.js"],t):e.videojsContribAds=t(e.videojs)})(this,function(f){"use strict";f=f&&f.hasOwnProperty("default")?f["default"]:f;var e="6.6.1";function s(o){return{disableNextSnapshotRestore:false,_contentEnding:false,_contentHasEnded:false,_hasThereBeenALoadStartDuringPlayerLife:false,_hasThereBeenALoadedData:false,_hasThereBeenALoadedMetaData:false,_inLinearAdMode:false,_shouldBlockPlay:false,_playBlocked:false,_playRequested:false,adType:null,VERSION:e,reset:function e(){o.ads.disableNextSnapshotRestore=false;o.ads._contentEnding=false;o.ads._contentHasEnded=false;o.ads.snapshot=null;o.ads.adType=null;o.ads._hasThereBeenALoadedData=false;o.ads._hasThereBeenALoadedMetaData=false;o.ads._cancelledPlay=false;o.ads._shouldBlockPlay=false;o.ads._playBlocked=false;o.ads.nopreroll_=false;o.ads.nopostroll_=false;o.ads._playRequested=false},startLinearAdMode:function e(){o.ads._state.startLinearAdMode()},endLinearAdMode:function e(){o.ads._state.endLinearAdMode()},skipLinearAdMode:function e(){o.ads._state.skipLinearAdMode()},stitchedAds:function e(t){if(t!==undefined){f.log.warn("Using player.ads.stitchedAds() as a setter is deprecated, "+"it should be set as an option upon initialization of contrib-ads.");this.settings.stitchedAds=!!t}return this.settings.stitchedAds},videoElementRecycled:function e(){if(o.ads.shouldPlayContentBehindAd(o)){return false}if(!this.snapshot){throw new Error("You cannot use videoElementRecycled while there is no snapshot.")}var t=o.tech_.src()!==this.snapshot.src;var n=o.currentSrc()!==this.snapshot.currentSrc;return t||n},isLive:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:o;if(typeof t.ads.settings.contentIsLive==="boolean"){return t.ads.settings.contentIsLive}else if(t.duration()===Infinity){return true}else if(f.browser.IOS_VERSION==="8"&&t.duration()===0){return true}return false},shouldPlayContentBehindAd:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:o;if(!t){throw new Error("shouldPlayContentBehindAd requires a player as a param")}else if(!t.ads.settings.liveCuePoints){return false}else{return!f.browser.IS_IOS&&!f.browser.IS_ANDROID&&t.duration()===Infinity}},shouldTakeSnapshots:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:o;return!this.shouldPlayContentBehindAd(t)&&!this.stitchedAds()},isInAdMode:function e(){return this._state.isAdState()},isWaitingForAdBreak:function e(){return this._state.isWaitingForAdBreak()},isContentResuming:function e(){return this._state.isContentResuming()},isAdPlaying:function e(){return this._state.inAdBreak()},inAdBreak:function e(){return this._state.inAdBreak()},removeNativePoster:function e(){var t=o.$(".vjs-tech");if(t){t.removeAttribute("poster")}},debug:function e(){if(this.settings.debug){for(var t=arguments.length,n=Array(t),o=0;o<t;o++){n[o]=arguments[o]}if(n.length===1&&typeof n[0]==="string"){f.log("ADS: "+n[0])}else{f.log.apply(f,["ADS:"].concat(n))}}}}}var r=function e(t,n){n.isImmediatePropagationStopped=function(){return true};n.cancelBubble=true;n.isPropagationStopped=function(){return true}};var o=function e(t,n,o){r(t,o);t.trigger({type:n+o.type,originalEvent:o})};var t=function e(t,n){if(t.ads.isInAdMode()){if(t.ads.isContentResuming()){if(t.ads._contentEnding){o(t,"content",n)}}else{o(t,"ad",n)}}};var n=function e(t,n){if(t.ads.isInAdMode()){if(t.ads.isContentResuming()){r(t,n);t.trigger("resumeended")}else{o(t,"ad",n)}}else if(!t.ads._contentHasEnded&&!t.ads.stitchedAds()){o(t,"content",n);t.trigger("readyforpostroll")}};var a=function e(t,n){if(n.type==="loadstart"&&!t.ads._hasThereBeenALoadStartDuringPlayerLife||n.type==="loadeddata"&&!t.ads._hasThereBeenALoadedData||n.type==="loadedmetadata"&&!t.ads._hasThereBeenALoadedMetaData){return}else if(t.ads.inAdBreak()){o(t,"ad",n)}else if(t.currentSrc()!==t.ads.contentSrc){return}else{o(t,"content",n)}};var i=function e(t,n){if(t.ads.inAdBreak()){o(t,"ad",n)}else if(t.ads.isContentResuming()){o(t,"content",n)}};function d(e){if(e.type==="playing"){t(this,e)}else if(e.type==="ended"){n(this,e)}else if(e.type==="loadstart"||e.type==="loadeddata"||e.type==="loadedmetadata"){a(this,e)}else if(e.type==="play"){i(this,e)}else if(this.ads.isInAdMode()){if(this.ads.isContentResuming()){o(this,"content",e)}else{o(this,"ad",e)}}}function l(n){n.ads.contentSrc=n.currentSrc();n.ads._seenInitialLoadstart=false;var e=function e(){if(!n.ads.inAdBreak()){var t=n.currentSrc();if(t!==n.ads.contentSrc){if(n.ads._seenInitialLoadstart){n.trigger({type:"contentchanged"})}n.trigger({type:"contentupdate",oldValue:n.ads.contentSrc,newValue:t});n.ads.contentSrc=t}n.ads._seenInitialLoadstart=true}};n.on("loadstart",e)}var u=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};var c;if(typeof window!=="undefined"){c=window}else if(typeof u!=="undefined"){c=u}else if(typeof self!=="undefined"){c=self}else{c={}}var p=c;var h={};var y=(Object.freeze||Object)({default:h});var g=y&&h||y;var v=typeof u!=="undefined"?u:typeof window!=="undefined"?window:{};var m;if(typeof document!=="undefined"){m=document}else{m=v["__GLOBAL_DOCUMENT_CACHE@4"];if(!m){m=v["__GLOBAL_DOCUMENT_CACHE@4"]=g}}var A=m;var b=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var _=function(){function l(e){this.value=e}function t(r){var a,i;function e(o,r){return new Promise(function(e,t){var n={key:o,arg:r,resolve:e,reject:t,next:null};if(i){i=i.next=n}else{a=i=n;s(o,r)}})}function s(e,t){try{var n=r[e](t);var o=n.value;if(o instanceof l){Promise.resolve(o.value).then(function(e){s("next",e)},function(e){s("throw",e)})}else{d(n.done?"return":"normal",n.value)}}catch(e){d("throw",e)}}function d(e,t){switch(e){case"return":a.resolve({value:t,done:true});break;case"throw":a.reject(t);break;default:a.resolve({value:t,done:false});break}a=a.next;if(a){s(a.key,a.arg)}else{i=null}}this._invoke=e;if(typeof r.return!=="function"){this.return=undefined}}if(typeof Symbol==="function"&&Symbol.asyncIterator){t.prototype[Symbol.asyncIterator]=function(){return this}}t.prototype.next=function(e){return this._invoke("next",e)};t.prototype.throw=function(e){return this._invoke("throw",e)};t.prototype.return=function(e){return this._invoke("return",e)};return{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(e){return new l(e)}}}();var k=function(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}};var T=function(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t};var C=function(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e};var P=function e(t,n){if(n){return encodeURIComponent(t)}return t};var w=function e(t,n,o){if(t&&t[o]){var r=t[o];var a=Object.keys(r);for(var i=0;i<a.length;i++){var s="{mediainfo."+o+"."+a[i]+"}";n[s]=r[a[i]]}}};function S(e,s,t){var n=this;var d={};e=e.replace(/{([^}=]+)=([^}]+)}/g,function(e,t,n){d["{"+t+"}"]=n;return"{"+t+"}"});if(s===undefined){s=false}var o={};if(t!==undefined){o=t}o["{player.id}"]=this.options_["data-player"];o["{mediainfo.id}"]=this.mediainfo?this.mediainfo.id:"";o["{mediainfo.name}"]=this.mediainfo?this.mediainfo.name:"";o["{mediainfo.duration}"]=this.mediainfo?this.mediainfo.duration:"";o["{player.duration}"]=this.duration();o["{timestamp}"]=(new Date).getTime();o["{document.referrer}"]=A.referrer;o["{window.location.href}"]=p.location.href;o["{random}"]=Math.floor(Math.random()*1e12);["description","tags","reference_id","ad_keys"].forEach(function(e){if(n.mediainfo&&n.mediainfo[e]){o["{mediainfo."+e+"}"]=n.mediainfo[e]}else if(d["{mediainfo."+e+"}"]){o["{mediainfo."+e+"}"]=d["{mediainfo."+e+"}"]}else{o["{mediainfo."+e+"}"]=""}});w(this.mediainfo,o,"custom_fields");w(this.mediainfo,o,"customFields");for(var r in o){e=e.split(r).join(P(o[r],s))}e=e.replace(/{pageVariable\.([^}]+)}/g,function(e,t){var n=void 0;var o=p;var r=t.split(".");for(var a=0;a<r.length;a++){if(a===r.length-1){n=o[r[a]]}else{o=o[r[a]]}}var i=typeof n==="undefined"?"undefined":b(n);if(n===null){return"null"}else if(n===undefined){if(d["{pageVariable."+t+"}"]){return d["{pageVariable."+t+"}"]}f.log.warn('Page variable "'+t+'" not found');return""}else if(i!=="string"&&i!=="number"&&i!=="boolean"){f.log.warn('Page variable "'+t+'" is not a supported type');return""}return P(String(n),s)});for(var a in d){e=e.replace(a,d[a])}return e}var R={};R.processMetadataTracks=function(n,o){var e=n.textTracks();var t=function e(t){if(t.kind==="metadata"){n.ads.cueTextTracks.setMetadataTrackMode(t);o(n,t)}};for(var r=0;r<e.length;r++){t(e[r])}e.addEventListener("addtrack",function(e){t(e.track)})};R.setMetadataTrackMode=function(e){return};R.getSupportedAdCue=function(e,t){return t};R.isSupportedAdCue=function(e,t){return true};R.getCueId=function(e,t){return t.id};var L=function e(t,n){return n!==undefined&&t.ads.includedCues[n]};var B=function e(t,n){if(n!==undefined&&n!==""){t.ads.includedCues[n]=true}};R.processAdTrack=function(e,t,n,o){e.ads.includedCues={};for(var r=0;r<t.length;r++){var a=t[r];var i=this.getSupportedAdCue(e,a);if(!this.isSupportedAdCue(e,a)){f.log.warn("Skipping as this is not a supported ad cue.",a);return}var s=this.getCueId(e,a);var d=a.startTime;if(L(e,s)){f.log("Skipping ad already seen with ID "+s);return}if(o){o(e,i,s,d)}n(e,i,s,d);B(e,s)}};function M(e,t){if(t){f.log("Using cancelContentPlay to block content playback")}e.on("play",j)}function j(){var e=this;if(e.ads._shouldBlockPlay===false){return}if(!e.paused()){e.ads.debug("Playback was canceled by cancelContentPlay");e.pause()}e.ads._cancelledPlay=true}var E={};var N=f;E.isMiddlewareMediatorSupported=function(){if(N.browser.IS_IOS||N.browser.IS_ANDROID){return false}else if(N.use&&N.middleware&&N.middleware.TERMINATOR){return true}return false};E.playMiddleware=function(o){return{setSource:function e(t,n){n(null,t)},callPlay:function e(){if(o.ads&&o.ads._shouldBlockPlay===true){o.ads.debug("Using playMiddleware to block content playback");o.ads._playBlocked=true;return N.middleware.TERMINATOR}},play:function e(t,n){if(o.ads&&o.ads._playBlocked&&t){o.ads.debug("Play call to Tech was terminated.");o.trigger("play");o.addClass("vjs-has-started");o.ads._playBlocked=false}else if(n&&n["catch"]){n["catch"](function(e){if(e.message==="play() failed because the user didn't interact with the "+"document first. https://goo.gl/xX8pDD"){o.trigger("pause")}})}}}};E.testHook=function(e){N=e};var I=E.playMiddleware;var x=E.isMiddlewareMediatorSupported;var O=function e(){if(f.getPlugin){return Boolean(f.getPlugin("ads"))}var t=f.getComponent("Player");return Boolean(t&&t.prototype.ads)};function D(e){if(O(f)){return false}var t=f.registerPlugin||f.plugin;t("ads",e);if(x()&&!f.usingContribAdsMiddleware_){f.use("*",I);f.usingContribAdsMiddleware_=true;f.log("Play middleware has been registered with videojs")}return true}var F=function(){t._getName=function e(){return"Anonymous State"};function t(e){k(this,t);this.player=e}t.prototype.transitionTo=function e(t){var n=this.player;var o=this;o.cleanup(n);var r=new t(n);n.ads._state=r;n.ads.debug(o.constructor._getName()+" -> "+r.constructor._getName());for(var a=arguments.length,i=Array(a>1?a-1:0),s=1;s<a;s++){i[s-1]=arguments[s]}r.init.apply(r,[n].concat(i))};t.prototype.init=function e(){};t.prototype.cleanup=function e(){};t.prototype.onPlay=function e(){};t.prototype.onPlaying=function e(){};t.prototype.onEnded=function e(){};t.prototype.onAdEnded=function e(){};t.prototype.onAdsReady=function e(){f.log.warn("Unexpected adsready event")};t.prototype.onAdsError=function e(){};t.prototype.onAdsCanceled=function e(){};t.prototype.onAdTimeout=function e(){};t.prototype.onAdStarted=function e(){};t.prototype.onContentChanged=function e(){};t.prototype.onContentResumed=function e(){};t.prototype.onReadyForPostroll=function e(){f.log.warn("Unexpected readyforpostroll event")};t.prototype.onNoPreroll=function e(){};t.prototype.onNoPostroll=function e(){};t.prototype.startLinearAdMode=function e(){f.log.warn("Unexpected startLinearAdMode invocation "+"(State via "+this.constructor._getName()+")")};t.prototype.endLinearAdMode=function e(){f.log.warn("Unexpected endLinearAdMode invocation "+"(State via "+this.constructor._getName()+")")};t.prototype.skipLinearAdMode=function e(){f.log.warn("Unexpected skipLinearAdMode invocation "+"(State via "+this.constructor._getName()+")")};t.prototype.isAdState=function e(){throw new Error("isAdState unimplemented for "+this.constructor._getName())};t.prototype.isWaitingForAdBreak=function e(){return false};t.prototype.isContentResuming=function e(){return false};t.prototype.inAdBreak=function e(){return false};t.prototype.handleEvent=function e(t){var n=this.player;if(t==="play"){this.onPlay(n)}else if(t==="adsready"){this.onAdsReady(n)}else if(t==="adserror"){this.onAdsError(n)}else if(t==="adscanceled"){this.onAdsCanceled(n)}else if(t==="adtimeout"){this.onAdTimeout(n)}else if(t==="ads-ad-started"){this.onAdStarted(n)}else if(t==="contentchanged"){this.onContentChanged(n)}else if(t==="contentresumed"){this.onContentResumed(n)}else if(t==="readyforpostroll"){this.onReadyForPostroll(n)}else if(t==="playing"){this.onPlaying(n)}else if(t==="ended"){this.onEnded(n)}else if(t==="nopreroll"){this.onNoPreroll(n)}else if(t==="nopostroll"){this.onNoPostroll(n)}else if(t==="adended"){this.onAdEnded(n)}};return t}();var U=function(n){T(o,n);function o(e){k(this,o);var t=C(this,n.call(this,e));t.contentResuming=false;t.waitingForAdBreak=false;return t}o.prototype.isAdState=function e(){return true};o.prototype.onPlaying=function e(){if(this.contentResuming){this.transitionTo(Q)}};o.prototype.onContentResumed=function e(){if(this.contentResuming){this.transitionTo(Q)}};o.prototype.isWaitingForAdBreak=function e(){return this.waitingForAdBreak};o.prototype.isContentResuming=function e(){return this.contentResuming};o.prototype.inAdBreak=function e(){return this.player.ads._inLinearAdMode===true};return o}(F);var V=function(e){T(t,e);function t(){k(this,t);return C(this,e.apply(this,arguments))}t.prototype.isAdState=function e(){return false};t.prototype.onContentChanged=function e(t){t.ads.debug("Received contentchanged event (ContentState)");if(t.paused()){this.transitionTo(K)}else{this.transitionTo(X,false);t.pause();t.ads._pausedOnContentupdate=true}};return t}(F);var H=void 0;function q(e){var t=void 0;if(f.browser.IS_IOS&&e.ads.isLive(e)){if(e.seekable().length>0){t=e.currentTime()-e.seekable().end(0)}else{t=e.currentTime()}}else{t=e.currentTime()}var n=e.$(".vjs-tech");var o=e.textTracks?e.textTracks():[];var r=[];var a={ended:e.ended(),currentSrc:e.currentSrc(),sources:e.currentSources(),src:e.tech_.src(),currentTime:t,type:e.currentType()};if(n){a.style=n.getAttribute("style")}for(var i=0;i<o.length;i++){var s=o[i];r.push({track:s,mode:s.mode});s.mode="disabled"}a.suppressedTracks=r;return a}function z(r,e){var a=r.ads.snapshot;if(e===undefined){e=function e(){}}if(r.ads.disableNextSnapshotRestore===true){r.ads.disableNextSnapshotRestore=false;delete r.ads.snapshot;e();return}var t=r.$(".vjs-tech");var n=20;var o=a.suppressedTracks;var i=void 0;var s=function e(){for(var t=0;t<o.length;t++){i=o[t];i.track.mode=i.mode}};var d=function e(){var t=void 0;if(f.browser.IS_IOS&&r.ads.isLive(r)){if(a.currentTime<0){if(r.seekable().length>0){t=r.seekable().end(0)+a.currentTime}else{t=r.currentTime()}r.currentTime(t)}if(r.paused()){var n=r.play();if(n&&n["catch"]){n["catch"](function(e){f.log.warn("Play promise rejected in IOS snapshot resume",e)})}}}else if(a.ended){r.currentTime(r.duration())}else{r.currentTime(a.currentTime);var o=r.play();if(o&&o["catch"]){o["catch"](function(e){f.log.warn("Play promise rejected in snapshot resume",e)})}}if(r.ads.shouldRemoveAutoplay_){r.autoplay(false);r.ads.shouldRemoveAutoplay_=false}};var l=function e(){r.off("contentcanplay",e);if(H){r.clearTimeout(H)}t=r.el().querySelector(".vjs-tech");if(t.readyState>1){return d()}if(t.seekable===undefined){return d()}if(t.seekable.length>0){return d()}if(n--){r.setTimeout(e,50)}else{try{d()}catch(e){f.log.warn("Failed to resume the content after an advertisement",e)}}};if("style"in a){t.setAttribute("style",a.style||"")}if(r.ads.videoElementRecycled()){r.one("resumeended",function(){delete r.ads.snapshot;e()});r.one("contentloadedmetadata",s);if(f.browser.IS_IOS&&!r.autoplay()){r.autoplay(true);r.ads.shouldRemoveAutoplay_=true}r.src(a.sources);r.one("contentcanplay",l);H=r.setTimeout(l,2e3)}else{s();if(!r.ended()){var u=r.play();if(u&&u["catch"]){u["catch"](function(e){f.log.warn("Play promise rejected in snapshot restore",e)})}}delete r.ads.snapshot;e()}}function W(e){e.ads.debug("Starting ad break");e.ads._inLinearAdMode=true;e.trigger("adstart");if(e.ads.shouldTakeSnapshots()){e.ads.snapshot=q(e)}if(e.ads.shouldPlayContentBehindAd(e)){e.ads.preAdVolume_=e.volume();e.volume(0)}e.addClass("vjs-ad-playing");if(e.hasClass("vjs-live")){e.removeClass("vjs-live")}e.ads.removeNativePoster()}function $(e,t){e.ads.debug("Ending ad break");if(t===undefined){t=function e(){}}e.ads.adType=null;e.ads._inLinearAdMode=false;e.trigger("adend");e.removeClass("vjs-ad-playing");if(e.ads.isLive(e)){e.addClass("vjs-live")}if(e.ads.shouldTakeSnapshots()){z(e,t)}else{e.volume(e.ads.preAdVolume_);t()}}var G={start:W,end:$};var X=function(e){T(t,e);function t(){k(this,t);return C(this,e.apply(this,arguments))}t._getName=function e(){return"Preroll"};t.prototype.init=function e(t,n,o){this.waitingForAdBreak=true;t.addClass("vjs-ad-loading");if(o||t.ads.nopreroll_){return this.resumeAfterNoPreroll(t)}var r=t.ads.settings.timeout;if(typeof t.ads.settings.prerollTimeout==="number"){r=t.ads.settings.prerollTimeout}this._timeout=t.setTimeout(function(){t.trigger("adtimeout")},r);if(n){this.handleAdsReady()}else{this.adsReady=false}};t.prototype.onAdsReady=function e(t){if(!t.ads.inAdBreak()){t.ads.debug("Received adsready event (Preroll)");this.handleAdsReady()}else{f.log.warn("Unexpected adsready event (Preroll)")}};t.prototype.handleAdsReady=function e(){this.adsReady=true;this.readyForPreroll()};t.prototype.afterLoadStart=function e(t){var n=this.player;if(n.ads._hasThereBeenALoadStartDuringPlayerLife){t()}else{n.ads.debug("Waiting for loadstart...");n.one("loadstart",function(){n.ads.debug("Received loadstart event");t()})}};t.prototype.noPreroll=function e(){var t=this;this.afterLoadStart(function(){t.player.ads.debug("Skipping prerolls due to nopreroll event (Preroll)");t.resumeAfterNoPreroll(t.player)})};t.prototype.readyForPreroll=function e(){var t=this.player;this.afterLoadStart(function(){t.ads.debug("Triggered readyforpreroll event (Preroll)");t.trigger("readyforpreroll")})};t.prototype.onAdsCanceled=function e(t){var n=this;t.ads.debug("adscanceled (Preroll)");this.afterLoadStart(function(){n.resumeAfterNoPreroll(t)})};t.prototype.onAdsError=function e(t){var n=this;f.log("adserror (Preroll)");if(this.inAdBreak()){t.ads.endLinearAdMode()}else{this.afterLoadStart(function(){n.resumeAfterNoPreroll(t)})}};t.prototype.startLinearAdMode=function e(){var t=this.player;if(this.adsReady&&!t.ads.inAdBreak()&&!this.isContentResuming()){t.clearTimeout(this._timeout);t.ads.adType="preroll";this.waitingForAdBreak=false;G.start(t);t.ads._shouldBlockPlay=false}else{f.log.warn("Unexpected startLinearAdMode invocation (Preroll)")}};t.prototype.onAdStarted=function e(t){t.removeClass("vjs-ad-loading")};t.prototype.endLinearAdMode=function e(){var t=this.player;if(this.inAdBreak()){t.removeClass("vjs-ad-loading");t.addClass("vjs-ad-content-resuming");this.contentResuming=true;G.end(t)}};t.prototype.skipLinearAdMode=function e(){var t=this;var n=this.player;if(n.ads.inAdBreak()||this.isContentResuming()){f.log.warn("Unexpected skipLinearAdMode invocation")}else{this.afterLoadStart(function(){n.trigger("adskip");n.ads.debug("skipLinearAdMode (Preroll)");t.resumeAfterNoPreroll(n)})}};t.prototype.onAdTimeout=function e(t){var n=this;this.afterLoadStart(function(){t.ads.debug("adtimeout (Preroll)");n.resumeAfterNoPreroll(t)})};t.prototype.onNoPreroll=function e(t){if(t.ads.inAdBreak()||this.isContentResuming()){f.log.warn("Unexpected nopreroll event (Preroll)")}else{this.noPreroll()}};t.prototype.resumeAfterNoPreroll=function e(t){this.contentResuming=true;t.ads._shouldBlockPlay=false;if(t.paused()&&(t.ads._playRequested||t.ads._pausedOnContentupdate)){t.play()}};t.prototype.cleanup=function e(t){if(!t.ads._hasThereBeenALoadStartDuringPlayerLife){f.log.warn("Leaving Preroll state before loadstart event can cause issues.")}t.removeClass("vjs-ad-loading");t.removeClass("vjs-ad-content-resuming");t.clearTimeout(this._timeout)};return t}(U);var Y=function(e){T(t,e);function t(){k(this,t);return C(this,e.apply(this,arguments))}t._getName=function e(){return"Midroll"};t.prototype.init=function e(t){t.ads.adType="midroll";G.start(t);t.addClass("vjs-ad-loading")};t.prototype.onAdStarted=function e(t){t.removeClass("vjs-ad-loading")};t.prototype.endLinearAdMode=function e(){var t=this.player;if(this.inAdBreak()){this.contentResuming=true;t.addClass("vjs-ad-content-resuming");t.removeClass("vjs-ad-loading");G.end(t)}};t.prototype.onAdsError=function e(t){if(this.inAdBreak()){t.ads.endLinearAdMode()}};t.prototype.cleanup=function e(t){t.removeClass("vjs-ad-loading");t.removeClass("vjs-ad-content-resuming")};return t}(U);var J=function(e){T(t,e);function t(){k(this,t);return C(this,e.apply(this,arguments))}t._getName=function e(){return"Postroll"};t.prototype.init=function e(t){this.waitingForAdBreak=true;t.ads._contentEnding=true;if(!t.ads.nopostroll_){t.addClass("vjs-ad-loading");var n=t.ads.settings.timeout;if(typeof t.ads.settings.postrollTimeout==="number"){n=t.ads.settings.postrollTimeout}this._postrollTimeout=t.setTimeout(function(){t.trigger("adtimeout")},n)}else{this.resumeContent(t);this.transitionTo(Z)}};t.prototype.startLinearAdMode=function e(){var t=this.player;if(!t.ads.inAdBreak()&&!this.isContentResuming()){t.ads.adType="postroll";t.clearTimeout(this._postrollTimeout);this.waitingForAdBreak=false;G.start(t)}else{f.log.warn("Unexpected startLinearAdMode invocation (Postroll)")}};t.prototype.onAdStarted=function e(t){t.removeClass("vjs-ad-loading")};t.prototype.endLinearAdMode=function e(){var t=this;var n=this.player;if(this.inAdBreak()){n.removeClass("vjs-ad-loading");this.resumeContent(n);G.end(n,function(){t.transitionTo(Z)})}};t.prototype.skipLinearAdMode=function e(){var t=this.player;if(t.ads.inAdBreak()||this.isContentResuming()){f.log.warn("Unexpected skipLinearAdMode invocation")}else{t.ads.debug("Postroll abort (skipLinearAdMode)");t.trigger("adskip");this.abort(t)}};t.prototype.onAdTimeout=function e(t){t.ads.debug("Postroll abort (adtimeout)");this.abort(t)};t.prototype.onAdsError=function e(t){t.ads.debug("Postroll abort (adserror)");if(t.ads.inAdBreak()){t.ads.endLinearAdMode()}else{this.abort(t)}};t.prototype.onContentChanged=function e(t){if(this.isContentResuming()){this.transitionTo(K)}else if(!this.inAdBreak()){this.transitionTo(X)}};t.prototype.onNoPostroll=function e(t){if(!this.isContentResuming()&&!this.inAdBreak()){this.abort(t)}else{f.log.warn("Unexpected nopostroll event (Postroll)")}};t.prototype.resumeContent=function e(t){this.contentResuming=true;t.addClass("vjs-ad-content-resuming")};t.prototype.abort=function e(t){this.resumeContent(t);t.removeClass("vjs-ad-loading");this.transitionTo(Z)};t.prototype.cleanup=function e(t){t.removeClass("vjs-ad-content-resuming");t.clearTimeout(this._postrollTimeout);t.ads._contentEnding=false};return t}(U);var K=function(e){T(t,e);function t(){k(this,t);return C(this,e.apply(this,arguments))}t._getName=function e(){return"BeforePreroll"};t.prototype.init=function e(t){this.adsReady=false;this.shouldResumeToContent=false;t.ads._shouldBlockPlay=true};t.prototype.onAdsReady=function e(t){t.ads.debug("Received adsready event (BeforePreroll)");this.adsReady=true};t.prototype.onPlay=function e(t){t.ads.debug("Received play event (BeforePreroll)");this.transitionTo(X,this.adsReady,this.shouldResumeToContent)};t.prototype.onAdsCanceled=function e(t){t.ads.debug("adscanceled (BeforePreroll)");this.shouldResumeToContent=true};t.prototype.onAdsError=function e(){this.player.ads.debug("adserror (BeforePreroll)");this.shouldResumeToContent=true};t.prototype.onNoPreroll=function e(){this.player.ads.debug("Skipping prerolls due to nopreroll event (BeforePreroll)");this.shouldResumeToContent=true};t.prototype.skipLinearAdMode=function e(){var t=this.player;t.trigger("adskip");t.ads.debug("skipLinearAdMode (BeforePreroll)");this.shouldResumeToContent=true};t.prototype.onContentChanged=function e(){this.init(this.player)};return t}(V);var Q=function(e){T(t,e);function t(){k(this,t);return C(this,e.apply(this,arguments))}t._getName=function e(){return"ContentPlayback"};t.prototype.init=function e(t){t.ads._shouldBlockPlay=false};t.prototype.onAdsReady=function e(t){t.ads.debug("Received adsready event (ContentPlayback)");if(!t.ads.nopreroll_){t.ads.debug("Triggered readyforpreroll event (ContentPlayback)");t.trigger("readyforpreroll")}};t.prototype.onReadyForPostroll=function e(t){t.ads.debug("Received readyforpostroll event");this.transitionTo(J)};t.prototype.startLinearAdMode=function e(){this.transitionTo(Y)};return t}(V);var Z=function(e){T(t,e);function t(){k(this,t);return C(this,e.apply(this,arguments))}t._getName=function e(){return"AdsDone"};t.prototype.init=function e(t){t.ads._contentHasEnded=true;t.trigger("ended")};t.prototype.startLinearAdMode=function e(){f.log.warn("Unexpected startLinearAdMode invocation (AdsDone)")};return t}(V);var ee=function(e){T(t,e);function t(){k(this,t);return C(this,e.apply(this,arguments))}t._getName=function e(){return"StitchedAdRoll"};t.prototype.init=function e(){this.waitingForAdBreak=false;this.contentResuming=false;this.player.ads.adType="stitched";G.start(this.player)};t.prototype.onPlaying=function e(){};t.prototype.onContentResumed=function e(){};t.prototype.onAdEnded=function e(){this.endLinearAdMode();this.player.trigger("ended")};t.prototype.endLinearAdMode=function e(){G.end(this.player);this.transitionTo(te)};return t}(U);var te=function(e){T(t,e);function t(){k(this,t);return C(this,e.apply(this,arguments))}t._getName=function e(){return"StitchedContentPlayback"};t.prototype.init=function e(){this.player.ads._shouldBlockPlay=false};t.prototype.onContentChanged=function e(){this.player.ads.debug("Received contentchanged event ("+this._getName()+")")};t.prototype.startLinearAdMode=function e(){this.transitionTo(ee)};return t}(V);var ne=E.isMiddlewareMediatorSupported;var oe=f.getTech("Html5").Events;var re={timeout:5e3,prerollTimeout:undefined,postrollTimeout:undefined,debug:false,stitchedAds:false,contentIsLive:undefined,liveCuePoints:true};var ae=function e(t){var r=this;var n=f.mergeOptions(re,t);var o=oe.concat(["firstplay","loadedalldata","playing"]);r.on(o,d);if(!ne()){M(r,n.debug)}r.setTimeout(function(){if(!r.ads._hasThereBeenALoadStartDuringPlayerLife&&r.src()!==""){f.log.error("videojs-contrib-ads has not seen a loadstart event 5 seconds "+"after being initialized, but a source is present. This indicates that "+"videojs-contrib-ads was initialized too late. It must be initialized "+"immediately after video.js in the same tick. As a result, some ads will not "+"play and some media events will be incorrect. For more information, see "+"http://videojs.github.io/videojs-contrib-ads/integrator/getting-started.html")}},5e3);r.on("ended",function(){if(!r.hasClass("vjs-has-started")){r.addClass("vjs-has-started")}});r.on("contenttimeupdate",function(){r.removeClass("vjs-waiting")});r.on(["addurationchange","adcanplay"],function(){if(r.ads.snapshot&&r.currentSrc()===r.ads.snapshot.currentSrc){return}if(!r.ads.inAdBreak()){return}var e=r.play();if(e&&e["catch"]){e["catch"](function(e){f.log.warn("Play promise rejected when playing ad",e)})}});r.on("nopreroll",function(){r.ads.debug("Received nopreroll event");r.ads.nopreroll_=true});r.on("nopostroll",function(){r.ads.debug("Received nopostroll event");r.ads.nopostroll_=true});r.on("playing",function(){r.ads._cancelledPlay=false;r.ads._pausedOnContentupdate=false});r.on("play",function(){r.ads._playRequested=true});r.one("loadstart",function(){r.ads._hasThereBeenALoadStartDuringPlayerLife=true});r.on("loadeddata",function(){r.ads._hasThereBeenALoadedData=true});r.on("loadedmetadata",function(){r.ads._hasThereBeenALoadedMetaData=true});r.ads=s(r);r.ads.settings=n;n.stitchedAds=!!n.stitchedAds;if(n.stitchedAds){r.ads._state=new te(r)}else{r.ads._state=new K(r)}r.ads._state.init(r);r.ads.cueTextTracks=R;r.ads.adMacroReplacement=S.bind(r);l(r);r.on("contentchanged",r.ads.reset);var a=function e(){return!r.ads.shouldPlayContentBehindAd(r)&&r.ads.inAdBreak()&&r.tech_.featuresNativeTextTracks&&f.browser.IS_IOS&&!Array.isArray(r.textTracks())};var i=function e(){var t=r.textTracks();if(a()){for(var n=0;n<t.length;n++){var o=t[n];if(o.mode==="showing"){o.mode="disabled"}}}};r.ready(function(){r.textTracks().addEventListener("change",i)});r.on(["play","playing","ended","adsready","adscanceled","adskip","adserror","adtimeout","adended","ads-ad-started","contentchanged","dispose","contentresumed","readyforpostroll","nopreroll","nopostroll"],function(e){r.ads._state.handleEvent(e.type)});r.on("dispose",function(){r.ads.reset();r.textTracks().removeEventListener("change",i)})};ae.VERSION=e;D(ae);return ae});