(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.videojsContribMediaSources=e()}})(function(){var e,t,i;return function r(s,o,u){function f(i,e){if(!o[i]){if(!s[i]){var t=typeof require=="function"&&require;if(!e&&t)return t(i,!0);if(d)return d(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var n=o[i]={exports:{}};s[i][0].call(n.exports,function(e){var t=s[i][1][e];return f(t?t:e)},n,n.exports,r,s,o,u)}return o[i].exports}var d=typeof require=="function"&&require;for(var e=0;e<u.length;e++)f(u[e]);return f}({1:[function(f,d,h){(function(e){"use strict";Object.defineProperty(h,"__esModule",{value:true});function t(e){return e&&e.__esModule?e:{default:e}}var i=f("global/window");var r=t(i);var a=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var n=t(a);var o=function e(t){Object.defineProperties(t.frame,{id:{get:function e(){n["default"].log.warn("cue.frame.id is deprecated. Use cue.value.key instead.");return t.value.key}},value:{get:function e(){n["default"].log.warn("cue.frame.value is deprecated. Use cue.value.data instead.");return t.value.data}},privateData:{get:function e(){n["default"].log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead.");return t.value.data}}})};var u=function e(t){var i=undefined;if(isNaN(t)||Math.abs(t)===Infinity){i=Number.MAX_VALUE}else{i=t}return i};var s=function e(a,t,i){var n=r["default"].WebKitDataCue||r["default"].VTTCue;if(t){t.forEach(function(e){var t=e.stream;this.inbandTextTracks_[t].addCue(new n(e.startTime+this.timestampOffset,e.endTime+this.timestampOffset,e.text))},a)}if(i){(function(){var s=u(a.mediaSource_.duration);i.forEach(function(e){var i=e.cueTime+this.timestampOffset;e.frames.forEach(function(e){var t=new n(i,i,e.value||e.url||e.data||"");t.frame=e;t.value=e;o(t);this.metadataTrack_.addCue(t)},this)},a);if(a.metadataTrack_&&a.metadataTrack_.cues&&a.metadataTrack_.cues.length){(function(){var e=a.metadataTrack_.cues;var t=[];for(var i=0;i<e.length;i++){if(e[i]){t.push(e[i])}}var n=t.reduce(function(e,t){var i=e[t.startTime]||[];i.push(t);e[t.startTime]=i;return e},{});var r=Object.keys(n).sort(function(e,t){return Number(e)-Number(t)});r.forEach(function(e,t){var i=n[e];var a=Number(r[t+1])||s;i.forEach(function(e){e.endTime=a})})})()}})()}};h["default"]={addTextTrackData:s,durationOfVideo:u};d.exports=h["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"global/window":14}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var a=function e(t){return/mp4a\.\d+.\d+/i.test(t)};var n=function e(t){return/avc1\.[\da-f]+/i.test(t)};var r=function e(t){var n={type:"",parameters:{}};var i=t.trim().split(";");n.type=i.shift().trim();i.forEach(function(e){var t=e.trim().split("=");if(t.length>1){var i=t[0].replace(/"/g,"").trim();var a=t[1].replace(/"/g,"").trim();n.parameters[i]=a}});return n};var s=function e(t){return t.map(function(e){return e.replace(/avc1\.(\d+)\.(\d+)/i,function(e,t,i){var a=("00"+Number(t).toString(16)).slice(-2);var n=("00"+Number(i).toString(16)).slice(-2);return"avc1."+a+"00"+n})})};i["default"]={isAudioCodec:a,parseContentType:r,isVideoCodec:n,translateLegacyCodecs:s};t.exports=i["default"]},{}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var a=function e(t,i,a){var n=i.player_;if(a.captions&&a.captions.length){if(!t.inbandTextTracks_){t.inbandTextTracks_={}}for(var r in a.captionStreams){if(!t.inbandTextTracks_[r]){n.tech_.trigger({type:"usage",name:"hls-608"});var s=n.textTracks().getTrackById(r);if(s){t.inbandTextTracks_[r]=s}else{t.inbandTextTracks_[r]=n.addRemoteTextTrack({kind:"captions",id:r,label:r},false).track}}}}if(a.metadata&&a.metadata.length&&!t.metadataTrack_){t.metadataTrack_=n.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},false).track;t.metadataTrack_.inBandMetadataTrackDispatchType=a.metadata.dispatchType}};i["default"]=a;t.exports=i["default"]},{}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var a={TIME_BETWEEN_CHUNKS:1,BYTES_PER_CHUNK:1024*32};i["default"]=a;t.exports=i["default"]},{}],5:[function(y,v,_){(function(e){"use strict";Object.defineProperty(_,"__esModule",{value:true});var t=function(){function a(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(e,t,i){if(t)a(e.prototype,t);if(i)a(e,i);return e}}();var a=function e(t,i,a){var n=true;e:while(n){var r=t,s=i,o=a;n=false;if(r===null)r=Function.prototype;var u=Object.getOwnPropertyDescriptor(r,s);if(u===undefined){var f=Object.getPrototypeOf(r);if(f===null){return undefined}else{t=f;i=s;a=o;n=true;u=f=undefined;continue e}}else if("value"in u){return u.value}else{var d=u.get;if(d===undefined){return undefined}return d.call(o)}}};function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function r(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var s=y("global/document");var o=i(s);var u=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var f=i(u);var d=y("./flash-source-buffer");var h=i(d);var l=y("./flash-constants");var c=i(l);var p=y("./codec-utils");var m=function(e){r(i,e);function i(){var t=this;n(this,i);a(Object.getPrototypeOf(i.prototype),"constructor",this).call(this);this.sourceBuffers=[];this.readyState="closed";this.on(["sourceopen","webkitsourceopen"],function(e){t.swfObj=o["default"].getElementById(e.swfId);t.player_=(0,f["default"])(t.swfObj.parentNode);t.tech_=t.swfObj.tech;t.readyState="open";t.tech_.on("seeking",function(){var e=t.sourceBuffers.length;while(e--){t.sourceBuffers[e].abort()}});if(t.swfObj){t.swfObj.vjs_load()}})}t(i,[{key:"addSeekableRange_",value:function e(){}},{key:"addSourceBuffer",value:function e(t){var i=(0,p.parseContentType)(t);var a=undefined;if(i.type==="video/mp2t"||i.type==="audio/mp2t"){a=new h["default"](this)}else{throw new Error("NotSupportedError (Video.js)")}this.sourceBuffers.push(a);return a}},{key:"endOfStream",value:function e(t){if(t==="network"){this.tech_.error(2)}else if(t==="decode"){this.tech_.error(3)}if(this.readyState!=="ended"){this.readyState="ended";this.swfObj.vjs_endOfStream()}}}]);return i}(f["default"].EventTarget);_["default"]=m;try{Object.defineProperty(m.prototype,"duration",{get:function e(){if(!this.swfObj){return NaN}return this.swfObj.vjs_getProperty("duration")},set:function e(t){var i=undefined;var a=this.swfObj.vjs_getProperty("duration");this.swfObj.vjs_setProperty("duration",t);if(t<a){for(i=0;i<this.sourceBuffers.length;i++){this.sourceBuffers[i].remove(t,a)}}return t}})}catch(e){m.prototype.duration=NaN}for(var g in c["default"]){m[g]=c["default"][g]}v.exports=_["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./codec-utils":2,"./flash-constants":4,"./flash-source-buffer":6,"global/document":13}],6:[function(x,E,C){(function(e){"use strict";Object.defineProperty(C,"__esModule",{value:true});var t=function(){function a(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(e,t,i){if(t)a(e.prototype,t);if(i)a(e,i);return e}}();var s=function e(t,i,a){var n=true;e:while(n){var r=t,s=i,o=a;n=false;if(r===null)r=Function.prototype;var u=Object.getOwnPropertyDescriptor(r,s);if(u===undefined){var f=Object.getPrototypeOf(r);if(f===null){return undefined}else{t=f;i=s;a=o;n=true;u=f=undefined;continue e}}else if("value"in u){return u.value}else{var d=u.get;if(d===undefined){return undefined}return d.call(o)}}};function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var n=x("global/window");var u=i(n);var r=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var f=i(r);var d=x("mux.js/lib/flv");var h=i(d);var l=x("./remove-cues-from-track");var c=i(l);var p=x("./create-text-tracks-if-necessary");var m=i(p);var g=x("./add-text-track-data");var y=x("./flash-transmuxer-worker");var v=i(y);var _=x("webwackify");var b=i(_);var S=x("./flash-constants");var w=i(S);var T=function e(){var t=undefined;try{t=x.resolve("./flash-transmuxer-worker")}catch(e){}return t};var k=function e(t){u["default"].setTimeout(t,w["default"].TIME_BETWEEN_CHUNKS)};var A=function e(){return Math.random().toString(36).slice(2,8)};var O=function e(t,i){if(typeof i!=="number"||i<0){i=0}var a=Math.pow(10,i);return Math.round(t*a)/a};var M=function(e){a(r,e);function r(e){var t=this;o(this,r);s(Object.getPrototypeOf(r.prototype),"constructor",this).call(this);var i=undefined;this.chunkSize_=w["default"].BYTES_PER_CHUNK;this.buffer_=[];this.bufferSize_=0;this.basePtsOffset_=NaN;this.mediaSource_=e;this.audioBufferEnd_=NaN;this.videoBufferEnd_=NaN;this.updating=false;this.timestampOffset_=0;i=u["default"].btoa(String.fromCharCode.apply(null,Array.prototype.slice.call(h["default"].getFlvHeader())));var a=this.mediaSource_.player_.id().replace(/[^a-zA-Z0-9]/g,"_");this.flashEncodedHeaderName_="vjs_flashEncodedHeader_"+a+A();this.flashEncodedDataName_="vjs_flashEncodedData_"+a+A();u["default"][this.flashEncodedHeaderName_]=function(){delete u["default"][t.flashEncodedHeaderName_];return i};this.mediaSource_.swfObj.vjs_appendChunkReady(this.flashEncodedHeaderName_);this.transmuxer_=(0,b["default"])(v["default"],T());this.transmuxer_.postMessage({action:"init",options:{}});this.transmuxer_.onmessage=function(e){if(e.data.action==="data"){t.receiveBuffer_(e.data.segment)}};this.one("updateend",function(){t.mediaSource_.tech_.trigger("loadedmetadata")});Object.defineProperty(this,"timestampOffset",{get:function e(){return this.timestampOffset_},set:function e(t){if(typeof t==="number"&&t>=0){this.timestampOffset_=t;this.mediaSource_.swfObj.vjs_discontinuity();this.basePtsOffset_=NaN;this.audioBufferEnd_=NaN;this.videoBufferEnd_=NaN;this.transmuxer_.postMessage({action:"reset"})}}});Object.defineProperty(this,"buffered",{get:function e(){if(!this.mediaSource_||!this.mediaSource_.swfObj||!("vjs_getProperty"in this.mediaSource_.swfObj)){return f["default"].createTimeRange()}var t=this.mediaSource_.swfObj.vjs_getProperty("buffered");if(t&&t.length){t[0][0]=O(t[0][0],3);t[0][1]=O(t[0][1],3)}return f["default"].createTimeRanges(t)}});this.mediaSource_.player_.on("seeked",function(){(0,c["default"])(0,Infinity,t.metadataTrack_);if(t.inbandTextTracks_){for(var e in t.inbandTextTracks_){(0,c["default"])(0,Infinity,t.inbandTextTracks_[e])}}});var n=this.onHlsReset_.bind(this);this.mediaSource_.player_.tech_.on("hls-reset",n);this.mediaSource_.player_.tech_.hls.on("dispose",function(){t.transmuxer_.terminate();t.mediaSource_.player_.tech_.off("hls-reset",n)})}t(r,[{key:"appendBuffer",value:function e(t){var i=undefined;if(this.updating){i=new Error("SourceBuffer.append() cannot be called "+"while an update is in progress");i.name="InvalidStateError";i.code=11;throw i}this.updating=true;this.mediaSource_.readyState="open";this.trigger({type:"update"});this.transmuxer_.postMessage({action:"push",data:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength},[t.buffer]);this.transmuxer_.postMessage({action:"flush"})}},{key:"abort",value:function e(){this.buffer_=[];this.bufferSize_=0;this.mediaSource_.swfObj.vjs_abort();if(this.updating){this.updating=false;this.trigger({type:"updateend"})}}},{key:"remove",value:function e(t,i){(0,c["default"])(t,i,this.metadataTrack_);if(this.inbandTextTracks_){for(var a in this.inbandTextTracks_){(0,c["default"])(t,i,this.inbandTextTracks_[a])}}this.trigger({type:"update"});this.trigger({type:"updateend"})}},{key:"receiveBuffer_",value:function e(t){var i=this;(0,m["default"])(this,this.mediaSource_,t);(0,g.addTextTrackData)(this,t.captions,t.metadata);k(function(){var e=i.convertTagsToData_(t);if(i.buffer_.length===0){k(i.processBuffer_.bind(i))}if(e){i.buffer_.push(e);i.bufferSize_+=e.byteLength}})}},{key:"processBuffer_",value:function e(){var t=this;var i=w["default"].BYTES_PER_CHUNK;if(!this.buffer_.length){if(this.updating!==false){this.updating=false;this.trigger({type:"updateend"})}return}var a=this.buffer_[0].subarray(0,i);if(a.byteLength<i||this.buffer_[0].byteLength===i){this.buffer_.shift()}else{this.buffer_[0]=this.buffer_[0].subarray(i)}this.bufferSize_-=a.byteLength;var n=[];var r=a.byteLength;for(var s=0;s<r;s++){n.push(String.fromCharCode(a[s]))}var o=u["default"].btoa(n.join(""));u["default"][this.flashEncodedDataName_]=function(){k(t.processBuffer_.bind(t));delete u["default"][t.flashEncodedDataName_];return o};this.mediaSource_.swfObj.vjs_appendChunkReady(this.flashEncodedDataName_)}},{key:"convertTagsToData_",value:function e(t){var i=0;var a=this.mediaSource_.tech_;var n=0;var r=undefined;var s=t.tags.videoTags;var o=t.tags.audioTags;if(isNaN(this.basePtsOffset_)&&(s.length||o.length)){var u=s[0]||{pts:Infinity};var f=o[0]||{pts:Infinity};this.basePtsOffset_=Math.min(f.pts,u.pts)}if(a.seeking()){this.videoBufferEnd_=NaN;this.audioBufferEnd_=NaN}if(isNaN(this.videoBufferEnd_)){if(a.buffered().length){n=a.buffered().end(0)-this.timestampOffset}if(a.seeking()){n=Math.max(n,a.currentTime()-this.timestampOffset)}n*=1e3;n+=this.basePtsOffset_}else{n=this.videoBufferEnd_+.1}var d=s.length;if(d&&s[d-1].pts>=n){while(--d){var h=s[d];if(h.pts>n){continue}if(h.keyFrame||h.metaDataTag){break}}while(d){var l=s[d-1];if(!l.metaDataTag){break}d--}}var c=s.slice(d);var p=undefined;if(isNaN(this.audioBufferEnd_)){p=n}else{p=this.audioBufferEnd_+.1}if(c.length){p=Math.min(p,c[0].pts)}d=0;while(d<o.length){if(o[d].pts>=p){break}d++}var m=o.slice(d);if(m.length){this.audioBufferEnd_=m[m.length-1].pts}if(c.length){this.videoBufferEnd_=c[c.length-1].pts}var g=this.getOrderedTags_(c,m);if(g.length===0){return}if(g[0].pts<n&&a.seeking()){var y=1/30;var v=a.currentTime();var _=(n-g[0].pts)/1e3;var b=v-_;if(b<y){b=0}try{this.mediaSource_.swfObj.vjs_adjustCurrentTime(b)}catch(e){}}for(var S=0;S<g.length;S++){i+=g[S].bytes.byteLength}r=new Uint8Array(i);for(var S=0,w=0;S<g.length;S++){r.set(g[S].bytes,w);w+=g[S].bytes.byteLength}return r}},{key:"getOrderedTags_",value:function e(t,i){var a=undefined;var n=[];while(t.length||i.length){if(!t.length){a=i.shift()}else if(!i.length){a=t.shift()}else if(i[0].dts<t[0].dts){a=i.shift()}else{a=t.shift()}n.push(a)}return n}},{key:"onHlsReset_",value:function e(){this.transmuxer_.postMessage({action:"resetCaptions"})}}]);return r}(f["default"].EventTarget);C["default"]=M;E.exports=C["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./add-text-track-data":1,"./create-text-tracks-if-necessary":3,"./flash-constants":4,"./flash-transmuxer-worker":7,"./remove-cues-from-track":9,"global/window":14,"mux.js/lib/flv":22,webwackify:36}],7:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var a=function(){function a(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(e,t,i){if(t)a(e.prototype,t);if(i)a(e,i);return e}}();function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=e("global/window");var o=n(s);var u=e("mux.js/lib/flv");var f=n(u);var d=function e(t){t.on("data",function(e){o["default"].postMessage({action:"data",segment:e})});t.on("done",function(e){o["default"].postMessage({action:"done"})})};var h=function(){function t(e){r(this,t);this.options=e||{};this.init()}a(t,[{key:"init",value:function e(){if(this.transmuxer){this.transmuxer.dispose()}this.transmuxer=new f["default"].Transmuxer(this.options);d(this.transmuxer)}},{key:"push",value:function e(t){var i=new Uint8Array(t.data,t.byteOffset,t.byteLength);this.transmuxer.push(i)}},{key:"reset",value:function e(){this.init()}},{key:"flush",value:function e(){this.transmuxer.flush()}},{key:"resetCaptions",value:function e(){this.transmuxer.resetCaptions()}}]);return t}();var l=function e(t){t.onmessage=function(e){if(e.data.action==="init"&&e.data.options){this.messageHandlers=new h(e.data.options);return}if(!this.messageHandlers){this.messageHandlers=new h}if(e.data&&e.data.action&&e.data.action!=="init"){if(this.messageHandlers[e.data.action]){this.messageHandlers[e.data.action](e.data)}}}};i["default"]=function(e){return new l(e)};t.exports=i["default"]},{"global/window":14,"mux.js/lib/flv":22}],8:[function(y,v,_){(function(e){"use strict";Object.defineProperty(_,"__esModule",{value:true});var i=function(){function a(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(e,t,i){if(t)a(e.prototype,t);if(i)a(e,i);return e}}();var a=function e(t,i,a){var n=true;e:while(n){var r=t,s=i,o=a;n=false;if(r===null)r=Function.prototype;var u=Object.getOwnPropertyDescriptor(r,s);if(u===undefined){var f=Object.getPrototypeOf(r);if(f===null){return undefined}else{t=f;i=s;a=o;n=true;u=f=undefined;continue e}}else if("value"in u){return u.value}else{var d=u.get;if(d===undefined){return undefined}return d.call(o)}}};function t(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function r(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var s=y("global/window");var o=t(s);var u=y("global/document");var f=t(u);var d=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var h=t(d);var l=y("./virtual-source-buffer");var c=t(l);var p=y("./add-text-track-data");var m=y("./codec-utils");var g=function(e){r(t,e);function t(){var r=this;n(this,t);a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var e=undefined;this.nativeMediaSource_=new o["default"].MediaSource;for(e in this.nativeMediaSource_){if(!(e in t.prototype)&&typeof this.nativeMediaSource_[e]==="function"){this[e]=this.nativeMediaSource_[e].bind(this.nativeMediaSource_)}}this.duration_=NaN;Object.defineProperty(this,"duration",{get:function e(){if(this.duration_===Infinity){return this.duration_}return this.nativeMediaSource_.duration},set:function e(t){this.duration_=t;if(t!==Infinity){this.nativeMediaSource_.duration=t;return}}});Object.defineProperty(this,"seekable",{get:function e(){if(this.duration_===Infinity){return h["default"].createTimeRanges([[0,this.nativeMediaSource_.duration]])}return this.nativeMediaSource_.seekable}});Object.defineProperty(this,"readyState",{get:function e(){return this.nativeMediaSource_.readyState}});Object.defineProperty(this,"activeSourceBuffers",{get:function e(){return this.activeSourceBuffers_}});this.sourceBuffers=[];this.activeSourceBuffers_=[];this.updateActiveSourceBuffers_=function(){r.activeSourceBuffers_.length=0;if(r.sourceBuffers.length===1){var e=r.sourceBuffers[0];e.appendAudioInitSegment_=true;e.audioDisabled_=!e.audioCodec_;r.activeSourceBuffers_.push(e);return}var t=false;var i=true;for(var a=0;a<r.player_.audioTracks().length;a++){var n=r.player_.audioTracks()[a];if(n.enabled&&n.kind!=="main"){t=true;i=false;break}}r.sourceBuffers.forEach(function(e){e.appendAudioInitSegment_=true;if(e.videoCodec_&&e.audioCodec_){e.audioDisabled_=t}else if(e.videoCodec_&&!e.audioCodec_){e.audioDisabled_=true;i=false}else if(!e.videoCodec_&&e.audioCodec_){e.audioDisabled_=i;if(i){return}}r.activeSourceBuffers_.push(e)})};this.onPlayerMediachange_=function(){r.sourceBuffers.forEach(function(e){e.appendAudioInitSegment_=true})};this.onHlsReset_=function(){r.sourceBuffers.forEach(function(e){if(e.transmuxer_){e.transmuxer_.postMessage({action:"resetCaptions"})}})};this.onHlsSegmentTimeMapping_=function(t){r.sourceBuffers.forEach(function(e){return e.timeMapping_=t.mapping})};["sourceopen","sourceclose","sourceended"].forEach(function(e){this.nativeMediaSource_.addEventListener(e,this.trigger.bind(this))},this);this.on("sourceopen",function(e){var t=f["default"].querySelector('[src="'+r.url_+'"]');if(!t){return}r.player_=(0,h["default"])(t.parentNode);r.player_.tech_.on("hls-reset",r.onHlsReset_);r.player_.tech_.on("hls-segment-time-mapping",r.onHlsSegmentTimeMapping_);if(r.player_.audioTracks&&r.player_.audioTracks()){r.player_.audioTracks().on("change",r.updateActiveSourceBuffers_);r.player_.audioTracks().on("addtrack",r.updateActiveSourceBuffers_);r.player_.audioTracks().on("removetrack",r.updateActiveSourceBuffers_)}r.player_.on("mediachange",r.onPlayerMediachange_)});this.on("sourceended",function(e){var t=(0,p.durationOfVideo)(r.duration);for(var i=0;i<r.sourceBuffers.length;i++){var a=r.sourceBuffers[i];var n=a.metadataTrack_&&a.metadataTrack_.cues;if(n&&n.length){n[n.length-1].endTime=t}}});this.on("sourceclose",function(e){this.sourceBuffers.forEach(function(e){if(e.transmuxer_){e.transmuxer_.terminate()}});this.sourceBuffers.length=0;if(!this.player_){return}if(this.player_.audioTracks&&this.player_.audioTracks()){this.player_.audioTracks().off("change",this.updateActiveSourceBuffers_);this.player_.audioTracks().off("addtrack",this.updateActiveSourceBuffers_);this.player_.audioTracks().off("removetrack",this.updateActiveSourceBuffers_)}if(this.player_.el_){this.player_.off("mediachange",this.onPlayerMediachange_);this.player_.tech_.off("hls-reset",this.onHlsReset_);this.player_.tech_.off("hls-segment-time-mapping",this.onHlsSegmentTimeMapping_)}})}i(t,[{key:"addSeekableRange_",value:function e(t,i){var a=undefined;if(this.duration!==Infinity){a=new Error("MediaSource.addSeekableRange() can only be invoked "+"when the duration is Infinity");a.name="InvalidStateError";a.code=11;throw a}if(i>this.nativeMediaSource_.duration||isNaN(this.nativeMediaSource_.duration)){this.nativeMediaSource_.duration=i}}},{key:"addSourceBuffer",value:function e(t){var i=undefined;var a=(0,m.parseContentType)(t);if(/^(video|audio)\/mp2t$/i.test(a.type)){var n=[];if(a.parameters&&a.parameters.codecs){n=a.parameters.codecs.split(",");n=(0,m.translateLegacyCodecs)(n);n=n.filter(function(e){return(0,m.isAudioCodec)(e)||(0,m.isVideoCodec)(e)})}if(n.length===0){n=["avc1.4d400d","mp4a.40.2"]}i=new c["default"](this,n);if(this.sourceBuffers.length!==0){this.sourceBuffers[0].createRealSourceBuffers_();i.createRealSourceBuffers_();this.sourceBuffers[0].audioDisabled_=true}}else{i=this.nativeMediaSource_.addSourceBuffer(t)}this.sourceBuffers.push(i);return i}}]);return t}(h["default"].EventTarget);_["default"]=g;v.exports=_["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./add-text-track-data":1,"./codec-utils":2,"./virtual-source-buffer":11,"global/document":13,"global/window":14}],9:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var a=function e(t,i,a){var n=undefined;var r=undefined;if(!a){return}if(!a.cues){return}n=a.cues.length;while(n--){r=a.cues[n];if(r.startTime<=i&&r.endTime>=t){a.removeCue(r)}}};i["default"]=a;t.exports=i["default"]},{}],10:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var a=function(){function a(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(e,t,i){if(t)a(e.prototype,t);if(i)a(e,i);return e}}();function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=e("global/window");var o=n(s);var u=e("mux.js/lib/mp4");var f=n(u);var d=function e(t){t.on("data",function(e){var t=e.initSegment;e.initSegment={data:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength};var i=e.data;e.data=i.buffer;o["default"].postMessage({action:"data",segment:e,byteOffset:i.byteOffset,byteLength:i.byteLength},[e.data])});if(t.captionStream){t.captionStream.on("data",function(e){o["default"].postMessage({action:"caption",data:e})})}t.on("done",function(e){o["default"].postMessage({action:"done"})});t.on("gopInfo",function(e){o["default"].postMessage({action:"gopInfo",gopInfo:e})})};var h=function(){function t(e){r(this,t);this.options=e||{};this.init()}a(t,[{key:"init",value:function e(){if(this.transmuxer){this.transmuxer.dispose()}this.transmuxer=new f["default"].Transmuxer(this.options);d(this.transmuxer)}},{key:"push",value:function e(t){var i=new Uint8Array(t.data,t.byteOffset,t.byteLength);this.transmuxer.push(i)}},{key:"reset",value:function e(){this.init()}},{key:"setTimestampOffset",value:function e(t){var i=t.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(i*9e4))}},{key:"setAudioAppendStart",value:function e(t){this.transmuxer.setAudioAppendStart(Math.ceil(t.appendStart*9e4))}},{key:"flush",value:function e(t){this.transmuxer.flush()}},{key:"resetCaptions",value:function e(){this.transmuxer.resetCaptions()}},{key:"alignGopsWith",value:function e(t){this.transmuxer.alignGopsWith(t.gopsToAlignWith.slice())}}]);return t}();var l=function e(t){t.onmessage=function(e){if(e.data.action==="init"&&e.data.options){this.messageHandlers=new h(e.data.options);return}if(!this.messageHandlers){this.messageHandlers=new h}if(e.data&&e.data.action&&e.data.action!=="init"){if(this.messageHandlers[e.data.action]){this.messageHandlers[e.data.action](e.data)}}}};i["default"]=function(e){return new l(e)};t.exports=i["default"]},{"global/window":14,"mux.js/lib/mp4":30}],11:[function(k,e,A){(function(e){"use strict";Object.defineProperty(A,"__esModule",{value:true});var t=function(){function a(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(e,t,i){if(t)a(e.prototype,t);if(i)a(e,i);return e}}();var r=function e(t,i,a){var n=true;e:while(n){var r=t,s=i,o=a;n=false;if(r===null)r=Function.prototype;var u=Object.getOwnPropertyDescriptor(r,s);if(u===undefined){var f=Object.getPrototypeOf(r);if(f===null){return undefined}else{t=f;i=s;a=o;n=true;u=f=undefined;continue e}}else if("value"in u){return u.value}else{var d=u.get;if(d===undefined){return undefined}return d.call(o)}}};function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var n=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var f=i(n);var o=k("./create-text-tracks-if-necessary");var u=i(o);var d=k("./remove-cues-from-track");var h=i(d);var l=k("./add-text-track-data");var c=k("webwackify");var p=i(c);var m=k("./transmuxer-worker");var g=i(m);var y=k("./codec-utils");var v=function e(){var t=undefined;try{t=k.resolve("./transmuxer-worker")}catch(e){}return t};var _=function e(t,i){var a=t.addSourceBuffer(i);var n=Object.create(null);n.updating=false;n.realBuffer_=a;var r=function(i){if(typeof a[i]==="function"){n[i]=function(){return a[i].apply(a,arguments)}}else if(typeof n[i]==="undefined"){Object.defineProperty(n,i,{get:function e(){return a[i]},set:function e(t){return a[i]=t}})}};for(var s in a){r(s)}return n};var b=function e(t,i,a){if(!i||!t.length){return[]}var n=Math.ceil((i.currentTime()-a+3)*9e4);var r=undefined;for(r=0;r<t.length;r++){if(t[r].pts>n){break}}return t.slice(r)};A.gopsSafeToAlignWith=b;var S=function e(t,i,a){if(!i.length){return t}if(a){return i.slice()}var n=i[0].pts;var r=0;for(r;r<t.length;r++){if(t[r].pts>=n){break}}return t.slice(0,r).concat(i)};A.updateGopBuffer=S;var w=function e(t,i,a,n){var r=Math.ceil((i-n)*9e4);var s=Math.ceil((a-n)*9e4);var o=t.slice();var u=t.length;while(u--){if(t[u].pts<=s){break}}if(u===-1){return o}var f=u+1;while(f--){if(t[f].pts<=r){break}}f=Math.max(f,0);o.splice(f,u-f+1);return o};A.removeGopBuffer=w;var T=function(e){a(n,e);function n(e,t){var i=this;s(this,n);r(Object.getPrototypeOf(n.prototype),"constructor",this).call(this,f["default"].EventTarget);this.timestampOffset_=0;this.pendingBuffers_=[];this.bufferUpdating_=false;this.mediaSource_=e;this.codecs_=t;this.audioCodec_=null;this.videoCodec_=null;this.audioDisabled_=false;this.appendAudioInitSegment_=true;this.gopBuffer_=[];this.timeMapping_=0;this.safeAppend_=f["default"].browser.IE_VERSION>=11;var a={remux:false,alignGopsAtEnd:this.safeAppend_};this.codecs_.forEach(function(e){if((0,y.isAudioCodec)(e)){i.audioCodec_=e}else if((0,y.isVideoCodec)(e)){i.videoCodec_=e}});this.transmuxer_=(0,p["default"])(g["default"],v());this.transmuxer_.postMessage({action:"init",options:a});this.transmuxer_.onmessage=function(e){if(e.data.action==="data"){return i.data_(e)}if(e.data.action==="done"){return i.done_(e)}if(e.data.action==="gopInfo"){return i.appendGopInfo_(e)}};Object.defineProperty(this,"timestampOffset",{get:function e(){return this.timestampOffset_},set:function e(t){if(typeof t==="number"&&t>=0){this.timestampOffset_=t;this.appendAudioInitSegment_=true;this.gopBuffer_.length=0;this.timeMapping_=0;this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:t})}}});Object.defineProperty(this,"appendWindowStart",{get:function e(){return(this.videoBuffer_||this.audioBuffer_).appendWindowStart},set:function e(t){if(this.videoBuffer_){this.videoBuffer_.appendWindowStart=t}if(this.audioBuffer_){this.audioBuffer_.appendWindowStart=t}}});Object.defineProperty(this,"updating",{get:function e(){return!!(this.bufferUpdating_||!this.audioDisabled_&&this.audioBuffer_&&this.audioBuffer_.updating||this.videoBuffer_&&this.videoBuffer_.updating)}});Object.defineProperty(this,"buffered",{get:function e(){var t=null;var i=null;var a=0;var n=[];var r=[];if(!this.videoBuffer_&&!this.audioBuffer_){return f["default"].createTimeRange()}if(!this.videoBuffer_){return this.audioBuffer_.buffered}if(!this.audioBuffer_){return this.videoBuffer_.buffered}if(this.audioDisabled_){return this.videoBuffer_.buffered}if(this.videoBuffer_.buffered.length===0&&this.audioBuffer_.buffered.length===0){return f["default"].createTimeRange()}var s=this.videoBuffer_.buffered;var o=this.audioBuffer_.buffered;var u=s.length;while(u--){n.push({time:s.start(u),type:"start"});n.push({time:s.end(u),type:"end"})}u=o.length;while(u--){n.push({time:o.start(u),type:"start"});n.push({time:o.end(u),type:"end"})}n.sort(function(e,t){return e.time-t.time});for(u=0;u<n.length;u++){if(n[u].type==="start"){a++;if(a===2){t=n[u].time}}else if(n[u].type==="end"){a--;if(a===1){i=n[u].time}}if(t!==null&&i!==null){r.push([t,i]);t=null;i=null}}return f["default"].createTimeRanges(r)}})}t(n,[{key:"data_",value:function e(t){var i=t.data.segment;i.data=new Uint8Array(i.data,t.data.byteOffset,t.data.byteLength);i.initSegment=new Uint8Array(i.initSegment.data,i.initSegment.byteOffset,i.initSegment.byteLength);(0,u["default"])(this,this.mediaSource_,i);this.pendingBuffers_.push(i);return}},{key:"done_",value:function e(t){if(this.mediaSource_.readyState==="closed"){this.pendingBuffers_.length=0;return}this.processPendingSegments_();return}},{key:"createRealSourceBuffers_",value:function e(){var n=this;var r=["audio","video"];r.forEach(function(i){if(!n[i+"Codec_"]){return}if(n[i+"Buffer_"]){return}var e=null;if(n.mediaSource_[i+"Buffer_"]){e=n.mediaSource_[i+"Buffer_"];e.updating=false}else{var t=i+"Codec_";var a=i+'/mp4;codecs="'+n[t]+'"';e=_(n.mediaSource_.nativeMediaSource_,a);n.mediaSource_[i+"Buffer_"]=e}n[i+"Buffer_"]=e;["update","updatestart","updateend"].forEach(function(t){e.addEventListener(t,function(){if(i==="audio"&&n.audioDisabled_){return}if(t==="updateend"){n[i+"Buffer_"].updating=false}var e=r.every(function(e){if(e==="audio"&&n.audioDisabled_){return true}if(i!==e&&n[e+"Buffer_"]&&n[e+"Buffer_"].updating){return false}return true});if(e){return n.trigger(t)}})})})}},{key:"appendBuffer",value:function e(t){this.bufferUpdating_=true;if(this.audioBuffer_&&this.audioBuffer_.buffered.length){var i=this.audioBuffer_.buffered;this.transmuxer_.postMessage({action:"setAudioAppendStart",appendStart:i.end(i.length-1)})}if(this.videoBuffer_){this.transmuxer_.postMessage({action:"alignGopsWith",gopsToAlignWith:b(this.gopBuffer_,this.mediaSource_.player_,this.timeMapping_)})}this.transmuxer_.postMessage({action:"push",data:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength},[t.buffer]);this.transmuxer_.postMessage({action:"flush"})}},{key:"appendGopInfo_",value:function e(t){this.gopBuffer_=S(this.gopBuffer_,t.data.gopInfo,this.safeAppend_)}},{key:"remove",value:function e(t,i){if(this.videoBuffer_){this.videoBuffer_.updating=true;this.videoBuffer_.remove(t,i);this.gopBuffer_=w(this.gopBuffer_,t,i,this.timeMapping_)}if(!this.audioDisabled_&&this.audioBuffer_){this.audioBuffer_.updating=true;this.audioBuffer_.remove(t,i)}(0,h["default"])(t,i,this.metadataTrack_);if(this.inbandTextTracks_){for(var a in this.inbandTextTracks_){(0,h["default"])(t,i,this.inbandTextTracks_[a])}}}},{key:"processPendingSegments_",value:function e(){var t={video:{segments:[],bytes:0},audio:{segments:[],bytes:0},captions:[],metadata:[]};t=this.pendingBuffers_.reduce(function(e,t){var i=t.type;var a=t.data;var n=t.initSegment;e[i].segments.push(a);e[i].bytes+=a.byteLength;e[i].initSegment=n;if(t.captions){e.captions=e.captions.concat(t.captions)}if(t.info){e[i].info=t.info}if(t.metadata){e.metadata=e.metadata.concat(t.metadata)}return e},t);if(!this.videoBuffer_&&!this.audioBuffer_){if(t.video.bytes===0){this.videoCodec_=null}if(t.audio.bytes===0){this.audioCodec_=null}this.createRealSourceBuffers_()}if(t.audio.info){this.mediaSource_.trigger({type:"audioinfo",info:t.audio.info})}if(t.video.info){this.mediaSource_.trigger({type:"videoinfo",info:t.video.info})}if(this.appendAudioInitSegment_){if(!this.audioDisabled_&&this.audioBuffer_){t.audio.segments.unshift(t.audio.initSegment);t.audio.bytes+=t.audio.initSegment.byteLength}this.appendAudioInitSegment_=false}var i=false;if(this.videoBuffer_&&t.video.bytes){t.video.segments.unshift(t.video.initSegment);t.video.bytes+=t.video.initSegment.byteLength;this.concatAndAppendSegments_(t.video,this.videoBuffer_);(0,l.addTextTrackData)(this,t.captions,t.metadata)}else if(this.videoBuffer_&&(this.audioDisabled_||!this.audioBuffer_)){i=true}if(!this.audioDisabled_&&this.audioBuffer_){this.concatAndAppendSegments_(t.audio,this.audioBuffer_)}this.pendingBuffers_.length=0;if(i){this.trigger("updateend")}this.bufferUpdating_=false}},{key:"concatAndAppendSegments_",value:function e(t,i){var a=0;var n=undefined;if(t.bytes){n=new Uint8Array(t.bytes);t.segments.forEach(function(e){n.set(e,a);a+=e.byteLength});try{i.updating=true;i.appendBuffer(n)}catch(e){if(this.mediaSource_.player_){this.mediaSource_.player_.error({code:-3,type:"APPEND_BUFFER_ERR",message:e.message,originalError:e})}}}}},{key:"abort",value:function e(){if(this.videoBuffer_){this.videoBuffer_.abort()}if(!this.audioDisabled_&&this.audioBuffer_){this.audioBuffer_.abort()}if(this.transmuxer_){this.transmuxer_.postMessage({action:"reset"})}this.pendingBuffers_.length=0;this.bufferUpdating_=false}}]);return n}(f["default"].EventTarget);A["default"]=T}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./add-text-track-data":1,"./codec-utils":2,"./create-text-tracks-if-necessary":3,"./remove-cues-from-track":9,"./transmuxer-worker":10,webwackify:36}],12:[function(e,t,i){},{}],13:[function(n,r,e){(function(e){var t=typeof e!=="undefined"?e:typeof window!=="undefined"?window:{};var i=n("min-document");var a;if(typeof document!=="undefined"){a=document}else{a=t["__GLOBAL_DOCUMENT_CACHE@4"];if(!a){a=t["__GLOBAL_DOCUMENT_CACHE@4"]=i}}r.exports=a}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"min-document":12}],14:[function(e,i,t){(function(e){var t;if(typeof window!=="undefined"){t=window}else if(typeof e!=="undefined"){t=e}else if(typeof self!=="undefined"){t=self}else{t={}}i.exports=t}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],15:[function(e,t,i){"use strict";var a=e("../utils/stream.js");var n;n=function(){var o=new Uint8Array,u=0;n.prototype.init.call(this);this.setTimestamp=function(e){u=e};this.parseId3TagSize=function(e,t){var i=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],a=e[t+5],n=(a&16)>>4;if(n){return i+20}return i+10};this.parseAdtsSize=function(e,t){var i=(e[t+5]&224)>>5,a=e[t+4]<<3,n=e[t+3]&3<<11;return n|a|i};this.push=function(e){var t=0,i=0,a,n,r,s;if(o.length){s=o.length;o=new Uint8Array(e.byteLength+s);o.set(o.subarray(0,s));o.set(e,s)}else{o=e}while(o.length-i>=3){if(o[i]==="I".charCodeAt(0)&&o[i+1]==="D".charCodeAt(0)&&o[i+2]==="3".charCodeAt(0)){if(o.length-i<10){break}t=this.parseId3TagSize(o,i);if(t>o.length){break}n={type:"timed-metadata",data:o.subarray(i,i+t)};this.trigger("data",n);i+=t;continue}else if(o[i]&255===255&&(o[i+1]&240)===240){if(o.length-i<7){break}t=this.parseAdtsSize(o,i);if(t>o.length){break}r={type:"audio",data:o.subarray(i,i+t),pts:u,dts:u};this.trigger("data",r);i+=t;continue}i++}a=o.length-i;if(a>0){o=o.subarray(i)}else{o=new Uint8Array}}};n.prototype=new a;t.exports=n},{"../utils/stream.js":35}],16:[function(e,t,i){"use strict";var a=e("../utils/stream.js");var n;var d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];n=function(){var f;n.prototype.init.call(this);this.push=function(e){var t=0,i=0,a,n,r,s,o,u;if(e.type!=="audio"){return}if(f){s=f;f=new Uint8Array(s.byteLength+e.data.byteLength);f.set(s);f.set(e.data,s.byteLength)}else{f=e.data}while(t+5<f.length){if(f[t]!==255||(f[t+1]&246)!==240){t++;continue}n=(~f[t+1]&1)*2;a=(f[t+3]&3)<<11|f[t+4]<<3|(f[t+5]&224)>>5;o=((f[t+6]&3)+1)*1024;u=o*9e4/d[(f[t+2]&60)>>>2];r=t+a;if(f.byteLength<r){return}this.trigger("data",{pts:e.pts+i*u,dts:e.dts+i*u,sampleCount:o,audioobjecttype:(f[t+2]>>>6&3)+1,channelcount:(f[t+2]&1)<<2|(f[t+3]&192)>>>6,samplerate:d[(f[t+2]&60)>>>2],samplingfrequencyindex:(f[t+2]&60)>>>2,samplesize:16,data:f.subarray(t+7+n,r)});if(f.byteLength===r){f=undefined;return}i++;f=f.subarray(r)}};this.flush=function(){this.trigger("done")}};n.prototype=new a;t.exports=n},{"../utils/stream.js":35}],17:[function(e,t,i){"use strict";var a=e("../utils/stream.js");var S=e("../utils/exp-golomb.js");var u,f;var w;f=function(){var i=0,a,n;f.prototype.init.call(this);this.push=function(e){var t;if(!n){n=e.data}else{t=new Uint8Array(n.byteLength+e.data.byteLength);t.set(n);t.set(e.data,n.byteLength);n=t}for(;i<n.byteLength-3;i++){if(n[i+2]===1){a=i+5;break}}while(a<n.byteLength){switch(n[a]){case 0:if(n[a-1]!==0){a+=2;break}else if(n[a-2]!==0){a++;break}if(i+3!==a-2){this.trigger("data",n.subarray(i+3,a-2))}do{a++}while(n[a]!==1&&a<n.length);i=a-2;a+=3;break;case 1:if(n[a-1]!==0||n[a-2]!==0){a+=3;break}this.trigger("data",n.subarray(i+3,a-2));i=a-2;a+=3;break;default:a+=3;break}}n=n.subarray(i);a-=i;i=0};this.flush=function(){if(n&&n.byteLength>3){this.trigger("data",n.subarray(i+3))}n=null;i=0;this.trigger("done")}};f.prototype=new a;w={100:true,110:true,122:true,244:true,44:true,83:true,86:true,118:true,128:true,138:true,139:true,134:true};u=function(){var t=new f,i,a,n,r,s,o,b;u.prototype.init.call(this);i=this;this.push=function(e){if(e.type!=="video"){return}a=e.trackId;n=e.pts;r=e.dts;t.push(e)};t.on("data",function(e){var t={trackId:a,pts:n,dts:r,data:e};switch(e[0]&31){case 5:t.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:t.nalUnitType="sei_rbsp";t.escapedRBSP=s(e.subarray(1));break;case 7:t.nalUnitType="seq_parameter_set_rbsp";t.escapedRBSP=s(e.subarray(1));t.config=o(t.escapedRBSP);break;case 8:t.nalUnitType="pic_parameter_set_rbsp";break;case 9:t.nalUnitType="access_unit_delimiter_rbsp";break;default:break}i.trigger("data",t)});t.on("done",function(){i.trigger("done")});this.flush=function(){t.flush()};b=function(e,t){var i=8,a=8,n,r;for(n=0;n<e;n++){if(a!==0){r=t.readExpGolomb();a=(i+r+256)%256}i=a===0?i:a}};s=function(e){var t=e.byteLength,i=[],a=1,n,r;while(a<t-2){if(e[a]===0&&e[a+1]===0&&e[a+2]===3){i.push(a+2);a+=2}else{a++}}if(i.length===0){return e}n=t-i.length;r=new Uint8Array(n);var s=0;for(a=0;a<n;s++,a++){if(s===i[0]){s++;i.shift()}r[a]=e[s]}return r};o=function(e){var t=0,i=0,a=0,n=0,r=1,s,o,u,f,d,h,l,c,p,m,g,y,v,_;s=new S(e);o=s.readUnsignedByte();f=s.readUnsignedByte();u=s.readUnsignedByte();s.skipUnsignedExpGolomb();if(w[o]){d=s.readUnsignedExpGolomb();if(d===3){s.skipBits(1)}s.skipUnsignedExpGolomb();s.skipUnsignedExpGolomb();s.skipBits(1);if(s.readBoolean()){g=d!==3?8:12;for(_=0;_<g;_++){if(s.readBoolean()){if(_<6){b(16,s)}else{b(64,s)}}}}}s.skipUnsignedExpGolomb();h=s.readUnsignedExpGolomb();if(h===0){s.readUnsignedExpGolomb()}else if(h===1){s.skipBits(1);s.skipExpGolomb();s.skipExpGolomb();l=s.readUnsignedExpGolomb();for(_=0;_<l;_++){s.skipExpGolomb()}}s.skipUnsignedExpGolomb();s.skipBits(1);c=s.readUnsignedExpGolomb();p=s.readUnsignedExpGolomb();m=s.readBits(1);if(m===0){s.skipBits(1)}s.skipBits(1);if(s.readBoolean()){t=s.readUnsignedExpGolomb();i=s.readUnsignedExpGolomb();a=s.readUnsignedExpGolomb();n=s.readUnsignedExpGolomb()}if(s.readBoolean()){if(s.readBoolean()){v=s.readUnsignedByte();switch(v){case 1:y=[1,1];break;case 2:y=[12,11];break;case 3:y=[10,11];break;case 4:y=[16,11];break;case 5:y=[40,33];break;case 6:y=[24,11];break;case 7:y=[20,11];break;case 8:y=[32,11];break;case 9:y=[80,33];break;case 10:y=[18,11];break;case 11:y=[15,11];break;case 12:y=[64,33];break;case 13:y=[160,99];break;case 14:y=[4,3];break;case 15:y=[3,2];break;case 16:y=[2,1];break;case 255:{y=[s.readUnsignedByte()<<8|s.readUnsignedByte(),s.readUnsignedByte()<<8|s.readUnsignedByte()];break}}if(y){r=y[0]/y[1]}}}return{profileIdc:o,levelIdc:u,profileCompatibility:f,width:Math.ceil(((c+1)*16-t*2-i*2)*r),height:(2-m)*(p+1)*16-a*2-n*2}}};u.prototype=new a;t.exports={H264Stream:u,NalByteStream:f}},{"../utils/exp-golomb.js":34,"../utils/stream.js":35}],18:[function(e,t,i){var a=[33,16,5,32,164,27];var n=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252];var r=function(e){var t=[];while(e--){t.push(0)}return t};var s=function(i){return Object.keys(i).reduce(function(e,t){e[t]=new Uint8Array(i[t].reduce(function(e,t){return e.concat(t)},[]));return e},{})};var o={96e3:[a,[227,64],r(154),[56]],88200:[a,[231],r(170),[56]],64e3:[a,[248,192],r(240),[56]],48e3:[a,[255,192],r(268),[55,148,128],r(54),[112]],44100:[a,[255,192],r(268),[55,163,128],r(84),[112]],32e3:[a,[255,192],r(268),[55,234],r(226),[112]],24e3:[a,[255,192],r(268),[55,255,128],r(268),[111,112],r(126),[224]],16e3:[a,[255,192],r(268),[55,255,128],r(268),[111,255],r(269),[223,108],r(195),[1,192]],12e3:[n,r(268),[3,127,248],r(268),[6,255,240],r(268),[13,255,224],r(268),[27,253,128],r(259),[56]],11025:[n,r(268),[3,127,248],r(268),[6,255,240],r(268),[13,255,224],r(268),[27,255,192],r(268),[55,175,128],r(108),[112]],8e3:[n,r(268),[3,121,16],r(47),[7]]};t.exports=s(o)},{}],19:[function(e,t,i){"use strict";var a=e("../utils/stream.js");var n=function(e){this.numberOfTracks=0;this.metadataStream=e.metadataStream;this.videoTags=[];this.audioTags=[];this.videoTrack=null;this.audioTrack=null;this.pendingCaptions=[];this.pendingMetadata=[];this.pendingTracks=0;this.processedTracks=0;n.prototype.init.call(this);this.push=function(e){if(e.text){return this.pendingCaptions.push(e)}if(e.frames){return this.pendingMetadata.push(e)}if(e.track.type==="video"){this.videoTrack=e.track;this.videoTags=e.tags;this.pendingTracks++}if(e.track.type==="audio"){this.audioTrack=e.track;this.audioTags=e.tags;this.pendingTracks++}}};n.prototype=new a;n.prototype.flush=function(e){var t,i,a,n,r={tags:{},captions:[],captionStreams:{},metadata:[]};if(this.pendingTracks<this.numberOfTracks){if(e!=="VideoSegmentStream"&&e!=="AudioSegmentStream"){return}else if(this.pendingTracks===0){this.processedTracks++;if(this.processedTracks<this.numberOfTracks){return}}}this.processedTracks+=this.pendingTracks;this.pendingTracks=0;if(this.processedTracks<this.numberOfTracks){return}if(this.videoTrack){n=this.videoTrack.timelineStartInfo.pts}else if(this.audioTrack){n=this.audioTrack.timelineStartInfo.pts}r.tags.videoTags=this.videoTags;r.tags.audioTags=this.audioTags;for(a=0;a<this.pendingCaptions.length;a++){i=this.pendingCaptions[a];i.startTime=i.startPts-n;i.startTime/=9e4;i.endTime=i.endPts-n;i.endTime/=9e4;r.captionStreams[i.stream]=true;r.captions.push(i)}for(a=0;a<this.pendingMetadata.length;a++){t=this.pendingMetadata[a];t.cueTime=t.pts-n;t.cueTime/=9e4;r.metadata.push(t)}r.metadata.dispatchType=this.metadataStream.dispatchType;this.videoTrack=null;this.audioTrack=null;this.videoTags=[];this.audioTags=[];this.pendingCaptions.length=0;this.pendingMetadata.length=0;this.pendingTracks=0;this.processedTracks=0;this.trigger("data",r);this.trigger("done")};t.exports=n},{"../utils/stream.js":35}],20:[function(e,t,i){"use strict";var u=e("./flv-tag.js");var a=function(e,t,i){var a=new Uint8Array(3+1+1+4),n=new DataView(a.buffer),r,s,o;e=e||0;t=t===undefined?true:t;i=i===undefined?true:i;n.setUint8(0,70);n.setUint8(1,76);n.setUint8(2,86);n.setUint8(3,1);n.setUint8(4,(t?4:0)|(i?1:0));n.setUint32(5,a.byteLength);if(e<=0){s=new Uint8Array(a.byteLength+4);s.set(a);s.set([0,0,0,0],a.byteLength);return s}r=new u(u.METADATA_TAG);r.pts=r.dts=0;r.writeMetaDataDouble("duration",e);o=r.finalize().length;s=new Uint8Array(a.byteLength+o);s.set(a);s.set(n.byteLength,o);return s};t.exports=a},{"./flv-tag.js":21}],21:[function(e,t,i){"use strict";var f;f=function(e,i){var a=0,t=16384,r=function(e,t){var i,a=e.position+t;if(a<e.bytes.byteLength){return}i=new Uint8Array(a*2);i.set(e.bytes.subarray(0,e.position),0);e.bytes=i;e.view=new DataView(e.bytes.buffer)},n=f.widthBytes||new Uint8Array("width".length),s=f.heightBytes||new Uint8Array("height".length),o=f.videocodecidBytes||new Uint8Array("videocodecid".length),u;if(!f.widthBytes){for(u=0;u<"width".length;u++){n[u]="width".charCodeAt(u)}for(u=0;u<"height".length;u++){s[u]="height".charCodeAt(u)}for(u=0;u<"videocodecid".length;u++){o[u]="videocodecid".charCodeAt(u)}f.widthBytes=n;f.heightBytes=s;f.videocodecidBytes=o}this.keyFrame=false;switch(e){case f.VIDEO_TAG:this.length=16;t*=6;break;case f.AUDIO_TAG:this.length=13;this.keyFrame=true;break;case f.METADATA_TAG:this.length=29;this.keyFrame=true;break;default:throw new Error("Unknown FLV tag type")}this.bytes=new Uint8Array(t);this.view=new DataView(this.bytes.buffer);this.bytes[0]=e;this.position=this.length;this.keyFrame=i;this.pts=0;this.dts=0;this.writeBytes=function(e,t,i){var a=t||0,n;i=i||e.byteLength;n=a+i;r(this,i);this.bytes.set(e.subarray(a,n),this.position);this.position+=i;this.length=Math.max(this.length,this.position)};this.writeByte=function(e){r(this,1);this.bytes[this.position]=e;this.position++;this.length=Math.max(this.length,this.position)};this.writeShort=function(e){r(this,2);this.view.setUint16(this.position,e);this.position+=2;this.length=Math.max(this.length,this.position)};this.negIndex=function(e){return this.bytes[this.length-e]};this.nalUnitSize=function(){if(a===0){return 0}return this.length-(a+4)};this.startNalUnit=function(){if(a>0){throw new Error("Attempted to create new NAL wihout closing the old one")}a=this.length;this.length+=4;this.position=this.length};this.endNalUnit=function(e){var t,i;if(this.length===a+4){this.length-=4}else if(a>0){t=a+4;i=this.length-t;this.position=a;this.view.setUint32(this.position,i);this.position=this.length;if(e){e.push(this.bytes.subarray(t,t+i))}}a=0};this.writeMetaDataDouble=function(e,t){var i;r(this,2+e.length+9);this.view.setUint16(this.position,e.length);this.position+=2;if(e==="width"){this.bytes.set(n,this.position);this.position+=5}else if(e==="height"){this.bytes.set(s,this.position);this.position+=6}else if(e==="videocodecid"){this.bytes.set(o,this.position);this.position+=12}else{for(i=0;i<e.length;i++){this.bytes[this.position]=e.charCodeAt(i);this.position++}}this.position++;this.view.setFloat64(this.position,t);this.position+=8;this.length=Math.max(this.length,this.position);++a};this.writeMetaDataBoolean=function(e,t){var i;r(this,2);this.view.setUint16(this.position,e.length);this.position+=2;for(i=0;i<e.length;i++){r(this,1);this.bytes[this.position]=e.charCodeAt(i);this.position++}r(this,2);this.view.setUint8(this.position,1);this.position++;this.view.setUint8(this.position,t?1:0);this.position++;this.length=Math.max(this.length,this.position);++a};this.finalize=function(){var e,t;switch(this.bytes[0]){case f.VIDEO_TAG:this.bytes[11]=(this.keyFrame||i?16:32)|7;this.bytes[12]=i?0:1;e=this.pts-this.dts;this.bytes[13]=(e&16711680)>>>16;this.bytes[14]=(e&65280)>>>8;this.bytes[15]=(e&255)>>>0;break;case f.AUDIO_TAG:this.bytes[11]=175;this.bytes[12]=i?0:1;break;case f.METADATA_TAG:this.position=11;this.view.setUint8(this.position,2);this.position++;this.view.setUint16(this.position,10);this.position+=2;this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position);this.position+=10;this.bytes[this.position]=8;this.position++;this.view.setUint32(this.position,a);this.position=this.length;this.bytes.set([0,0,9],this.position);this.position+=3;this.length=this.position;break}t=this.length-11;this.bytes[1]=(t&16711680)>>>16;this.bytes[2]=(t&65280)>>>8;this.bytes[3]=(t&255)>>>0;this.bytes[4]=(this.dts&16711680)>>>16;this.bytes[5]=(this.dts&65280)>>>8;this.bytes[6]=(this.dts&255)>>>0;this.bytes[7]=(this.dts&4278190080)>>>24;this.bytes[8]=0;this.bytes[9]=0;this.bytes[10]=0;r(this,4);this.view.setUint32(this.length,this.length);this.length+=4;this.position+=4;this.bytes=this.bytes.subarray(0,this.length);this.frameTime=f.frameTime(this.bytes);return this}};f.AUDIO_TAG=8;f.VIDEO_TAG=9;f.METADATA_TAG=18;f.isAudioFrame=function(e){return f.AUDIO_TAG===e[0]};f.isVideoFrame=function(e){return f.VIDEO_TAG===e[0]};f.isMetaData=function(e){return f.METADATA_TAG===e[0]};f.isKeyFrame=function(e){if(f.isVideoFrame(e)){return e[11]===23}if(f.isAudioFrame(e)){return true}if(f.isMetaData(e)){return true}return false};f.frameTime=function(e){var t=e[4]<<16;t|=e[5]<<8;t|=e[6]<<0;t|=e[7]<<24;return t};t.exports=f},{}],22:[function(e,t,i){t.exports={tag:e("./flv-tag"),Transmuxer:e("./transmuxer"),getFlvHeader:e("./flv-header")}},{"./flv-header":20,"./flv-tag":21,"./transmuxer":24}],23:[function(e,t,i){"use strict";var a=function(){var e=this;this.list=[];this.push=function(e){this.list.push({bytes:e.bytes,dts:e.dts,pts:e.pts,keyFrame:e.keyFrame,metaDataTag:e.metaDataTag})};Object.defineProperty(this,"length",{get:function(){return e.list.length}})};t.exports=a},{}],24:[function(e,t,i){"use strict";var a=e("../utils/stream.js");var u=e("./flv-tag.js");var p=e("../m2ts/m2ts.js");var m=e("../codecs/adts.js");var g=e("../codecs/h264").H264Stream;var y=e("./coalesce-stream.js");var f=e("./tag-list.js");var v,_,b,d,o,h;d=function(e,t){if(typeof t.pts==="number"){if(e.timelineStartInfo.pts===undefined){e.timelineStartInfo.pts=t.pts}else{e.timelineStartInfo.pts=Math.min(e.timelineStartInfo.pts,t.pts)}}if(typeof t.dts==="number"){if(e.timelineStartInfo.dts===undefined){e.timelineStartInfo.dts=t.dts}else{e.timelineStartInfo.dts=Math.min(e.timelineStartInfo.dts,t.dts)}}};o=function(e,t){var i=new u(u.METADATA_TAG);i.dts=t;i.pts=t;i.writeMetaDataDouble("videocodecid",7);i.writeMetaDataDouble("width",e.width);i.writeMetaDataDouble("height",e.height);return i};h=function(e,t){var i,a=new u(u.VIDEO_TAG,true);a.dts=t;a.pts=t;a.writeByte(1);a.writeByte(e.profileIdc);a.writeByte(e.profileCompatibility);a.writeByte(e.levelIdc);a.writeByte(252|3);a.writeByte(224|1);a.writeShort(e.sps[0].length);a.writeBytes(e.sps[0]);a.writeByte(e.pps.length);for(i=0;i<e.pps.length;++i){a.writeShort(e.pps[i].length);a.writeBytes(e.pps[i])}return a};b=function(n){var r=[],s=[],o;b.prototype.init.call(this);this.push=function(e){d(n,e);if(n){n.audioobjecttype=e.audioobjecttype;n.channelcount=e.channelcount;n.samplerate=e.samplerate;n.samplingfrequencyindex=e.samplingfrequencyindex;n.samplesize=e.samplesize;n.extraData=n.audioobjecttype<<11|n.samplingfrequencyindex<<7|n.channelcount<<3}e.pts=Math.round(e.pts/90);e.dts=Math.round(e.dts/90);r.push(e)};this.flush=function(){var e,t,i,a=new f;if(r.length===0){this.trigger("done","AudioSegmentStream");return}i=-Infinity;while(r.length){e=r.shift();if(s.length&&e.pts>=s[0]){i=s.shift();this.writeMetaDataTags(a,i)}if(n.extraData!==o||e.pts-i>=1e3){this.writeMetaDataTags(a,e.pts);o=n.extraData;i=e.pts}t=new u(u.AUDIO_TAG);t.pts=e.pts;t.dts=e.dts;t.writeBytes(e.data);a.push(t.finalize())}s.length=0;o=null;this.trigger("data",{track:n,tags:a.list});this.trigger("done","AudioSegmentStream")};this.writeMetaDataTags=function(e,t){var i;i=new u(u.METADATA_TAG);i.pts=t;i.dts=t;i.writeMetaDataDouble("audiocodecid",10);i.writeMetaDataBoolean("stereo",n.channelcount===2);i.writeMetaDataDouble("audiosamplerate",n.samplerate);i.writeMetaDataDouble("audiosamplesize",16);e.push(i.finalize());i=new u(u.AUDIO_TAG,true);i.pts=t;i.dts=t;i.view.setUint16(i.position,n.extraData);i.position+=2;i.length=Math.max(i.length,i.position);e.push(i.finalize())};this.onVideoKeyFrame=function(e){s.push(e)}};b.prototype=new a;_=function(n){var i=[],r,s;_.prototype.init.call(this);this.finishFrame=function(e,t){if(!t){return}if(r&&n&&n.newMetadata&&(t.keyFrame||e.length===0)){var i=o(r,t.dts).finalize();var a=h(n,t.dts).finalize();i.metaDataTag=a.metaDataTag=true;e.push(i);e.push(a);n.newMetadata=false;this.trigger("keyframe",t.dts)}t.endNalUnit();e.push(t.finalize());s=null};this.push=function(e){d(n,e);e.pts=Math.round(e.pts/90);e.dts=Math.round(e.dts/90);i.push(e)};this.flush=function(){var e,t=new f;while(i.length){if(i[0].nalUnitType==="access_unit_delimiter_rbsp"){break}i.shift()}if(i.length===0){this.trigger("done","VideoSegmentStream");return}while(i.length){e=i.shift();if(e.nalUnitType==="seq_parameter_set_rbsp"){n.newMetadata=true;r=e.config;n.width=r.width;n.height=r.height;n.sps=[e.data];n.profileIdc=r.profileIdc;n.levelIdc=r.levelIdc;n.profileCompatibility=r.profileCompatibility;s.endNalUnit()}else if(e.nalUnitType==="pic_parameter_set_rbsp"){n.newMetadata=true;n.pps=[e.data];s.endNalUnit()}else if(e.nalUnitType==="access_unit_delimiter_rbsp"){if(s){this.finishFrame(t,s)}s=new u(u.VIDEO_TAG);s.pts=e.pts;s.dts=e.dts}else{if(e.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"){s.keyFrame=true}s.endNalUnit()}s.startNalUnit();s.writeBytes(e.data)}if(s){this.finishFrame(t,s)}this.trigger("data",{track:n,tags:t.list});this.trigger("done","VideoSegmentStream")}};_.prototype=new a;v=function(e){var t=this,i,a,n,r,s,o,u,f,d,h,l,c;v.prototype.init.call(this);e=e||{};this.metadataStream=new p.MetadataStream;e.metadataStream=this.metadataStream;i=new p.TransportPacketStream;a=new p.TransportParseStream;n=new p.ElementaryStream;r=new p.TimestampRolloverStream("video");s=new p.TimestampRolloverStream("audio");o=new p.TimestampRolloverStream("timed-metadata");u=new m;f=new g;c=new y(e);i.pipe(a).pipe(n);n.pipe(r).pipe(f);n.pipe(s).pipe(u);n.pipe(o).pipe(this.metadataStream).pipe(c);l=new p.CaptionStream;f.pipe(l).pipe(c);n.on("data",function(e){var t,i,a;if(e.type==="metadata"){t=e.tracks.length;while(t--){if(e.tracks[t].type==="video"){i=e.tracks[t]}else if(e.tracks[t].type==="audio"){a=e.tracks[t]}}if(i&&!d){c.numberOfTracks++;d=new _(i);f.pipe(d).pipe(c)}if(a&&!h){c.numberOfTracks++;h=new b(a);u.pipe(h).pipe(c);if(d){d.on("keyframe",h.onVideoKeyFrame)}}}});this.push=function(e){i.push(e)};this.flush=function(){i.flush()};this.resetCaptions=function(){l.reset()};c.on("data",function(e){t.trigger("data",e)});c.on("done",function(){t.trigger("done")})};v.prototype=new a;t.exports=v},{"../codecs/adts.js":16,"../codecs/h264":17,"../m2ts/m2ts.js":26,"../utils/stream.js":35,"./coalesce-stream.js":19,"./flv-tag.js":21,"./tag-list.js":23}],25:[function(e,t,i){"use strict";var r=4,s=128,a=e("../utils/stream");var n=function(e){var t=0,i={payloadType:-1,payloadSize:0},a=0,n=0;while(t<e.byteLength){if(e[t]===s){break}while(e[t]===255){a+=255;t++}a+=e[t++];while(e[t]===255){n+=255;t++}n+=e[t++];if(!i.payload&&a===r){i.payloadType=a;i.payloadSize=n;i.payload=e.subarray(t,t+n);break}t+=n;a=0;n=0}return i};var o=function(e){if(e.payload[0]!==181){return null}if((e.payload[1]<<8|e.payload[2])!==49){return null}if(String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])!=="GA94"){return null}if(e.payload[7]!==3){return null}return e.payload.subarray(8,e.payload.length-1)};var u=function(e,t){var i=[],a,n,r,s;if(!(t[0]&64)){return i}n=t[0]&31;for(a=0;a<n;a++){r=a*3;s={type:t[r+2]&3,pts:e};if(t[r+2]&4){s.ccData=t[r+3]<<8|t[r+4];i.push(s)}}return i};var f=function(){f.prototype.init.call(this);this.captionPackets_=[];this.ccStreams_=[new m(0,0),new m(0,1),new m(1,0),new m(1,1)];this.reset();this.ccStreams_.forEach(function(e){e.on("data",this.trigger.bind(this,"data"));e.on("done",this.trigger.bind(this,"done"))},this)};f.prototype=new a;f.prototype.push=function(e){var t,i;if(e.nalUnitType!=="sei_rbsp"){return}t=n(e.escapedRBSP);if(t.payloadType!==r){return}i=o(t);if(!i){return}if(e.dts<this.latestDts_){this.ignoreNextEqualDts_=true;return}else if(e.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.ignoreNextEqualDts_=false;return}this.captionPackets_=this.captionPackets_.concat(u(e.pts,i));this.latestDts_=e.dts};f.prototype.flush=function(){if(!this.captionPackets_.length){this.ccStreams_.forEach(function(e){e.flush()},this);return}this.captionPackets_.forEach(function(e,t){e.presortIndex=t});this.captionPackets_.sort(function(e,t){if(e.pts===t.pts){return e.presortIndex-t.presortIndex}return e.pts-t.pts});this.captionPackets_.forEach(function(e){if(e.type<2){this.dispatchCea608Packet(e)}},this);this.captionPackets_.length=0;this.ccStreams_.forEach(function(e){e.flush()},this);return};f.prototype.reset=function(){this.latestDts_=null;this.ignoreNextEqualDts_=false;this.activeCea608Channel_=[null,null];this.ccStreams_.forEach(function(e){e.reset()})};f.prototype.dispatchCea608Packet=function(e){if(this.setsChannel1Active(e)){this.activeCea608Channel_[e.type]=0}else if(this.setsChannel2Active(e)){this.activeCea608Channel_[e.type]=1}if(this.activeCea608Channel_[e.type]===null){return}this.ccStreams_[(e.type<<1)+this.activeCea608Channel_[e.type]].push(e)};f.prototype.setsChannel1Active=function(e){return(e.ccData&30720)===4096};f.prototype.setsChannel2Active=function(e){return(e.ccData&30720)===6144};var d={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496};var h=function(e){if(e===null){return""}e=d[e]||e;return String.fromCharCode(e)};var l=14;var c=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152];var p=function(){var e=[],t=l+1;while(t--){e.push("")}return e};var m=function(e,t){m.prototype.init.call(this);this.field_=e||0;this.dataChannel_=t||0;this.name_="CC"+((this.field_<<1|this.dataChannel_)+1);this.setConstants();this.reset();this.push=function(e){var t,i,a,n,r;t=e.ccData&32639;if(t===this.lastControlCode_){this.lastControlCode_=null;return}if((t&61440)===4096){this.lastControlCode_=t}else if(t!==this.PADDING_){this.lastControlCode_=null}a=t>>>8;n=t&255;if(t===this.PADDING_){return}else if(t===this.RESUME_CAPTION_LOADING_){this.mode_="popOn"}else if(t===this.END_OF_CAPTION_){this.clearFormatting(e.pts);this.flushDisplayed(e.pts);i=this.displayed_;this.displayed_=this.nonDisplayed_;this.nonDisplayed_=i;this.startPts_=e.pts}else if(t===this.ROLL_UP_2_ROWS_){this.topRow_=l-1;this.mode_="rollUp"}else if(t===this.ROLL_UP_3_ROWS_){this.topRow_=l-2;this.mode_="rollUp"}else if(t===this.ROLL_UP_4_ROWS_){this.topRow_=l-3;this.mode_="rollUp"}else if(t===this.CARRIAGE_RETURN_){this.clearFormatting(e.pts);this.flushDisplayed(e.pts);this.shiftRowsUp_();this.startPts_=e.pts}else if(t===this.BACKSPACE_){if(this.mode_==="popOn"){this.nonDisplayed_[l]=this.nonDisplayed_[l].slice(0,-1)}else{this.displayed_[l]=this.displayed_[l].slice(0,-1)}}else if(t===this.ERASE_DISPLAYED_MEMORY_){this.flushDisplayed(e.pts);this.displayed_=p()}else if(t===this.ERASE_NON_DISPLAYED_MEMORY_){this.nonDisplayed_=p()}else if(t===this.RESUME_DIRECT_CAPTIONING_){this.mode_="paintOn"}else if(this.isSpecialCharacter(a,n)){a=(a&3)<<8;r=h(a|n);this[this.mode_](e.pts,r);this.column_++}else if(this.isExtCharacter(a,n)){if(this.mode_==="popOn"){this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1)}else{this.displayed_[l]=this.displayed_[l].slice(0,-1)}a=(a&3)<<8;r=h(a|n);this[this.mode_](e.pts,r);this.column_++}else if(this.isMidRowCode(a,n)){this.clearFormatting(e.pts);this[this.mode_](e.pts," ");this.column_++;if((n&14)===14){this.addFormatting(e.pts,["i"])}if((n&1)===1){this.addFormatting(e.pts,["u"])}}else if(this.isOffsetControlCode(a,n)){this.column_+=n&3}else if(this.isPAC(a,n)){var s=c.indexOf(t&7968);if(s!==this.row_){this.clearFormatting(e.pts);this.row_=s}if(n&1&&this.formatting_.indexOf("u")===-1){this.addFormatting(e.pts,["u"])}if((t&16)===16){this.column_=((t&14)>>1)*4}if(this.isColorPAC(n)){if((n&14)===14){this.addFormatting(e.pts,["i"])}}}else if(this.isNormalChar(a)){if(n===0){n=null}r=h(a);r+=h(n);this[this.mode_](e.pts,r);this.column_+=r.length}}};m.prototype=new a;m.prototype.flushDisplayed=function(e){var t=this.displayed_.map(function(e){return e.trim()}).join("\n").replace(/^\n+|\n+$/g,"");if(t.length){this.trigger("data",{startPts:this.startPts_,endPts:e,text:t,stream:this.name_})}};m.prototype.reset=function(){this.mode_="popOn";this.topRow_=0;this.startPts_=0;this.displayed_=p();this.nonDisplayed_=p();this.lastControlCode_=null;this.column_=0;this.row_=l;this.formatting_=[]};m.prototype.setConstants=function(){if(this.dataChannel_===0){this.BASE_=16;this.EXT_=17;this.CONTROL_=(20|this.field_)<<8;this.OFFSET_=23}else if(this.dataChannel_===1){this.BASE_=24;this.EXT_=25;this.CONTROL_=(28|this.field_)<<8;this.OFFSET_=31}this.PADDING_=0;this.RESUME_CAPTION_LOADING_=this.CONTROL_|32;this.END_OF_CAPTION_=this.CONTROL_|47;this.ROLL_UP_2_ROWS_=this.CONTROL_|37;this.ROLL_UP_3_ROWS_=this.CONTROL_|38;this.ROLL_UP_4_ROWS_=this.CONTROL_|39;this.CARRIAGE_RETURN_=this.CONTROL_|45;this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41;this.BACKSPACE_=this.CONTROL_|33;this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44;this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46};m.prototype.isSpecialCharacter=function(e,t){return e===this.EXT_&&t>=48&&t<=63};m.prototype.isExtCharacter=function(e,t){return(e===this.EXT_+1||e===this.EXT_+2)&&(t>=32&&t<=63)};m.prototype.isMidRowCode=function(e,t){return e===this.EXT_&&(t>=32&&t<=47)};m.prototype.isOffsetControlCode=function(e,t){return e===this.OFFSET_&&(t>=33&&t<=35)};m.prototype.isPAC=function(e,t){return e>=this.BASE_&&e<this.BASE_+8&&(t>=64&&t<=127)};m.prototype.isColorPAC=function(e){return e>=64&&e<=79||e>=96&&e<=127};m.prototype.isNormalChar=function(e){return e>=32&&e<=127};m.prototype.addFormatting=function(e,t){this.formatting_=this.formatting_.concat(t);var i=t.reduce(function(e,t){return e+"<"+t+">"},"");this[this.mode_](e,i)};m.prototype.clearFormatting=function(e){if(!this.formatting_.length){return}var t=this.formatting_.reverse().reduce(function(e,t){return e+"</"+t+">"},"");this.formatting_=[];this[this.mode_](e,t)};m.prototype.popOn=function(e,t){var i=this.nonDisplayed_[this.row_];i+=t;this.nonDisplayed_[this.row_]=i};m.prototype.rollUp=function(e,t){var i=this.displayed_[l];i+=t;this.displayed_[l]=i};m.prototype.shiftRowsUp_=function(){var e;for(e=0;e<this.topRow_;e++){this.displayed_[e]=""}for(e=this.topRow_;e<l;e++){this.displayed_[e]=this.displayed_[e+1]}this.displayed_[l]=""};m.prototype.paintOn=function(){};t.exports={CaptionStream:f,Cea608Stream:m}},{"../utils/stream":35}],26:[function(e,t,i){"use strict";var a=e("../utils/stream.js"),n=e("./caption-stream"),h=e("./stream-types"),r=e("./timestamp-rollover-stream").TimestampRolloverStream;var o=e("./stream-types.js");var s,f,u;var d=188,l=71;s=function(){var n=new Uint8Array(d),r=0;s.prototype.init.call(this);this.push=function(e){var t=0,i=d,a;if(r){a=new Uint8Array(e.byteLength+r);a.set(n.subarray(0,r));a.set(e,r);r=0}else{a=e}while(i<a.byteLength){if(a[t]===l&&a[i]===l){this.trigger("data",a.subarray(t,i));t+=d;i+=d;continue}t++;i++}if(t<a.byteLength){n.set(a.subarray(t),0);r=a.byteLength-t}};this.flush=function(){if(r===d&&n[0]===l){this.trigger("data",n);r=0}this.trigger("done")}};s.prototype=new a;f=function(){var a,n,r,u;f.prototype.init.call(this);u=this;this.packetsWaitingForPmt=[];this.programMapTable=undefined;a=function(e,t){var i=0;if(t.payloadUnitStartIndicator){i+=e[i]+1}if(t.type==="pat"){n(e.subarray(i),t)}else{r(e.subarray(i),t)}};n=function(e,t){t.section_number=e[7];t.last_section_number=e[8];u.pmtPid=(e[10]&31)<<8|e[11];t.pmtPid=u.pmtPid};r=function(e,t){var i,a,n,r;if(!(e[5]&1)){return}u.programMapTable={video:null,audio:null,"timed-metadata":{}};i=(e[1]&15)<<8|e[2];a=3+i-4;n=(e[10]&15)<<8|e[11];r=12+n;while(r<a){var s=e[r];var o=(e[r+1]&31)<<8|e[r+2];if(s===h.H264_STREAM_TYPE&&u.programMapTable.video===null){u.programMapTable.video=o}else if(s===h.ADTS_STREAM_TYPE&&u.programMapTable.audio===null){u.programMapTable.audio=o}else if(s===h.METADATA_STREAM_TYPE){u.programMapTable["timed-metadata"][o]=s}r+=((e[r+3]&15)<<8|e[r+4])+5}t.programMapTable=u.programMapTable};this.push=function(e){var t={},i=4;t.payloadUnitStartIndicator=!!(e[1]&64);t.pid=e[1]&31;t.pid<<=8;t.pid|=e[2];if((e[3]&48)>>>4>1){i+=e[i]+1}if(t.pid===0){t.type="pat";a(e.subarray(i),t);this.trigger("data",t)}else if(t.pid===this.pmtPid){t.type="pmt";a(e.subarray(i),t);this.trigger("data",t);while(this.packetsWaitingForPmt.length){this.processPes_.apply(this,this.packetsWaitingForPmt.shift())}}else if(this.programMapTable===undefined){this.packetsWaitingForPmt.push([e,i,t])}else{this.processPes_(e,i,t)}};this.processPes_=function(e,t,i){if(i.pid===this.programMapTable.video){i.streamType=h.H264_STREAM_TYPE}else if(i.pid===this.programMapTable.audio){i.streamType=h.ADTS_STREAM_TYPE}else{i.streamType=this.programMapTable["timed-metadata"][i.pid]}i.type="pes";i.data=e.subarray(t);this.trigger("data",i)}};f.prototype=new a;f.STREAM_TYPES={h264:27,adts:15};u=function(){var f=this,a={data:[],size:0},n={data:[],size:0},r={data:[],size:0},d=function(e,t){var i;t.packetLength=6+(e[4]<<8|e[5]);t.dataAlignmentIndicator=(e[6]&4)!==0;i=e[7];if(i&192){t.pts=(e[9]&14)<<27|(e[10]&255)<<20|(e[11]&254)<<12|(e[12]&255)<<5|(e[13]&254)>>>3;t.pts*=4;t.pts+=(e[13]&6)>>>1;t.dts=t.pts;if(i&64){t.dts=(e[14]&14)<<27|(e[15]&255)<<20|(e[16]&254)<<12|(e[17]&255)<<5|(e[18]&254)>>>3;t.dts*=4;t.dts+=(e[18]&6)>>>1}}t.data=e.subarray(9+e[8])},s=function(e,t,i){var a=new Uint8Array(e.size),n={type:t},r=0,s=0,o=false,u;if(!e.data.length||e.size<9){return}n.trackId=e.data[0].pid;for(r=0;r<e.data.length;r++){u=e.data[r];a.set(u.data,s);s+=u.data.byteLength}d(a,n);o=t==="video"||n.packetLength<=e.size;if(i||o){e.size=0;e.data.length=0}if(o){f.trigger("data",n)}};u.prototype.init.call(this);this.push=function(i){({pat:function(){},pes:function(){var e,t;switch(i.streamType){case h.H264_STREAM_TYPE:case o.H264_STREAM_TYPE:e=a;t="video";break;case h.ADTS_STREAM_TYPE:e=n;t="audio";break;case h.METADATA_STREAM_TYPE:e=r;t="timed-metadata";break;default:return}if(i.payloadUnitStartIndicator){s(e,t,true)}e.data.push(i);e.size+=i.data.byteLength},pmt:function(){var e={type:"metadata",tracks:[]},t=i.programMapTable;if(t.video!==null){e.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.video,codec:"avc",type:"video"})}if(t.audio!==null){e.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+t.audio,codec:"adts",type:"audio"})}f.trigger("data",e)}})[i.type]()};this.flush=function(){s(a,"video");s(n,"audio");s(r,"timed-metadata");this.trigger("done")}};u.prototype=new a;var c={PAT_PID:0,MP2T_PACKET_LENGTH:d,TransportPacketStream:s,TransportParseStream:f,ElementaryStream:u,TimestampRolloverStream:r,CaptionStream:n.CaptionStream,Cea608Stream:n.Cea608Stream,MetadataStream:e("./metadata-stream")};for(var p in h){if(h.hasOwnProperty(p)){c[p]=h[p]}}t.exports=c},{"../utils/stream.js":35,"./caption-stream":25,"./metadata-stream":27,"./stream-types":28,"./stream-types.js":28,"./timestamp-rollover-stream":29}],27:[function(e,t,i){"use strict";var a=e("../utils/stream"),n=e("./stream-types"),r=function(e,t,i){var a,n="";for(a=t;a<i;a++){n+="%"+("00"+e[a].toString(16)).slice(-2)}return n},s=function(e,t,i){return decodeURIComponent(r(e,t,i))},o=function(e,t,i){return unescape(r(e,t,i))},c=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},p={TXXX:function(e){var t;if(e.data[0]!==3){return}for(t=1;t<e.data.length;t++){if(e.data[t]===0){e.description=s(e.data,1,t);e.value=s(e.data,t+1,e.data.length).replace(/\0*$/,"");break}}e.data=e.value},WXXX:function(e){var t;if(e.data[0]!==3){return}for(t=1;t<e.data.length;t++){if(e.data[t]===0){e.description=s(e.data,1,t);e.url=s(e.data,t+1,e.data.length);break}}},PRIV:function(e){var t;for(t=0;t<e.data.length;t++){if(e.data[t]===0){e.owner=o(e.data,0,t);break}}e.privateData=e.data.subarray(t+1);e.data=e.privateData}},u;u=function(e){var f={debug:!!(e&&e.debug),descriptor:e&&e.descriptor},d=0,h=[],l=0,t;u.prototype.init.call(this);this.dispatchType=n.METADATA_STREAM_TYPE.toString(16);if(f.descriptor){for(t=0;t<f.descriptor.length;t++){this.dispatchType+=("00"+f.descriptor[t].toString(16)).slice(-2)}}this.push=function(e){var t,i,a,n,r,s;if(e.type!=="timed-metadata"){return}if(e.dataAlignmentIndicator){l=0;h.length=0}if(h.length===0&&(e.data.length<10||e.data[0]!=="I".charCodeAt(0)||e.data[1]!=="D".charCodeAt(0)||e.data[2]!=="3".charCodeAt(0))){if(f.debug){console.log("Skipping unrecognized metadata packet")}return}h.push(e);l+=e.data.byteLength;if(h.length===1){d=c(e.data.subarray(6,10));d+=10}if(l<d){return}t={data:new Uint8Array(d),frames:[],pts:h[0].pts,dts:h[0].dts};for(r=0;r<d;){t.data.set(h[0].data.subarray(0,d-r),r);r+=h[0].data.byteLength;l-=h[0].data.byteLength;h.shift()}i=10;if(t.data[5]&64){i+=4;i+=c(t.data.subarray(10,14));d-=c(t.data.subarray(16,20))}do{a=c(t.data.subarray(i+4,i+8));if(a<1){return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.")}s=String.fromCharCode(t.data[i],t.data[i+1],t.data[i+2],t.data[i+3]);n={id:s,data:t.data.subarray(i+10,i+a+10)};n.key=n.id;if(p[n.id]){p[n.id](n);if(n.owner==="com.apple.streaming.transportStreamTimestamp"){var o=n.data,u=(o[3]&1)<<30|o[4]<<22|o[5]<<14|o[6]<<6|o[7]>>>2;u*=4;u+=o[7]&3;n.timeStamp=u;if(t.pts===undefined&&t.dts===undefined){t.pts=n.timeStamp;t.dts=n.timeStamp}this.trigger("timestamp",n)}}t.frames.push(n);i+=10;i+=a}while(i<d);this.trigger("data",t)}};u.prototype=new a;t.exports=u},{"../utils/stream":35,"./stream-types":28}],28:[function(e,t,i){"use strict";t.exports={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21}},{}],29:[function(e,t,i){"use strict";var a=e("../utils/stream");var n=8589934592;var r=4294967296;var s=function(e,t){var i=1;if(e>t){i=-1}while(Math.abs(t-e)>r){e+=i*n}return e};var o=function(e){var t,i;o.prototype.init.call(this);this.type_=e;this.push=function(e){if(e.type!==this.type_){return}if(i===undefined){i=e.dts}e.dts=s(e.dts,i);e.pts=s(e.pts,i);t=e.dts;this.trigger("data",e)};this.flush=function(){i=t;this.trigger("done")};this.discontinuity=function(){i=void 0;t=void 0}};o.prototype=new a;t.exports={TimestampRolloverStream:o,handleRollover:s}},{"../utils/stream":35}],30:[function(e,t,i){t.exports={generator:e("./mp4-generator"),Transmuxer:e("./transmuxer").Transmuxer,AudioSegmentStream:e("./transmuxer").AudioSegmentStream,VideoSegmentStream:e("./transmuxer").VideoSegmentStream}},{"./mp4-generator":31,"./transmuxer":32}],31:[function(e,t,i){"use strict";var u=Math.pow(2,32)-1;var f,a,n,r,s,o,d,h,l,c,p,m,g,y,v,_,b,S,w,T,k,A,O,M,x,E,C,B,D,P,U,L,j,R,I,N;(function(){var e;O={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]};if(typeof Uint8Array==="undefined"){return}for(e in O){if(O.hasOwnProperty(e)){O[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]}}M=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]);E=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]);x=new Uint8Array([0,0,0,1]);C=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);B=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);D={video:C,audio:B};L=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);U=new Uint8Array([0,0,0,0,0,0,0,0]);j=new Uint8Array([0,0,0,0,0,0,0,0]);R=j;I=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);N=j;P=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])})();f=function(e){var t=[],i=0,a,n,r;for(a=1;a<arguments.length;a++){t.push(arguments[a])}a=t.length;while(a--){i+=t[a].byteLength}n=new Uint8Array(i+8);r=new DataView(n.buffer,n.byteOffset,n.byteLength);r.setUint32(0,n.byteLength);n.set(e,4);for(a=0,i=8;a<t.length;a++){n.set(t[a],i);i+=t[a].byteLength}return n};a=function(){return f(O.dinf,f(O.dref,L))};n=function(e){return f(O.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))};r=function(){return f(O.ftyp,M,x,M,E)};_=function(e){return f(O.hdlr,D[e])};s=function(e){return f(O.mdat,e)};v=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,e.duration&255,85,196,0,0]);if(e.samplerate){t[12]=e.samplerate>>>24&255;t[13]=e.samplerate>>>16&255;t[14]=e.samplerate>>>8&255;t[15]=e.samplerate&255}return f(O.mdhd,t)};y=function(e){return f(O.mdia,v(e),_(e.type),d(e))};o=function(e){return f(O.mfhd,new Uint8Array([0,0,0,0,(e&4278190080)>>24,(e&16711680)>>16,(e&65280)>>8,e&255]))};d=function(e){return f(O.minf,e.type==="video"?f(O.vmhd,P):f(O.smhd,U),a(),S(e))};h=function(e,t){var i=[],a=t.length;while(a--){i[a]=T(t[a])}return f.apply(null,[O.moof,o(e)].concat(i))};l=function(e){var t=e.length,i=[];while(t--){i[t]=m(e[t])}return f.apply(null,[O.moov,p(4294967295)].concat(i).concat(c(e)))};c=function(e){var t=e.length,i=[];while(t--){i[t]=k(e[t])}return f.apply(null,[O.mvex].concat(i))};p=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(e&4278190080)>>24,(e&16711680)>>16,(e&65280)>>8,e&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return f(O.mvhd,t)};b=function(e){var t=e.samples||[],i=new Uint8Array(4+t.length),a,n;for(n=0;n<t.length;n++){a=t[n].flags;i[n+4]=a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy}return f(O.sdtp,i)};S=function(e){return f(O.stbl,w(e),f(O.stts,N),f(O.stsc,R),f(O.stsz,I),f(O.stco,j))};(function(){var t,i;w=function(e){return f(O.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),e.type==="video"?t(e):i(e))};t=function(e){var t=e.sps||[],i=e.pps||[],a=[],n=[],r;for(r=0;r<t.length;r++){a.push((t[r].byteLength&65280)>>>8);a.push(t[r].byteLength&255);a=a.concat(Array.prototype.slice.call(t[r]))}for(r=0;r<i.length;r++){n.push((i[r].byteLength&65280)>>>8);n.push(i[r].byteLength&255);n=n.concat(Array.prototype.slice.call(i[r]))}return f(O.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(e.width&65280)>>8,e.width&255,(e.height&65280)>>8,e.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f(O.avcC,new Uint8Array([1,e.profileIdc,e.profileCompatibility,e.levelIdc,255].concat([t.length]).concat(a).concat([i.length]).concat(n))),f(O.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))};i=function(e){return f(O.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(e.channelcount&65280)>>8,e.channelcount&255,(e.samplesize&65280)>>8,e.samplesize&255,0,0,0,0,(e.samplerate&65280)>>8,e.samplerate&255,0,0]),n(e))}})();g=function(e){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,0,(e.duration&4278190080)>>24,(e.duration&16711680)>>16,(e.duration&65280)>>8,e.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(e.width&65280)>>8,e.width&255,0,0,(e.height&65280)>>8,e.height&255,0,0]);return f(O.tkhd,t)};T=function(e){var t,i,a,n,r,s,o;t=f(O.tfhd,new Uint8Array([0,0,0,58,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0]));s=Math.floor(e.baseMediaDecodeTime/(u+1));o=Math.floor(e.baseMediaDecodeTime%(u+1));i=f(O.tfdt,new Uint8Array([1,0,0,0,s>>>24&255,s>>>16&255,s>>>8&255,s&255,o>>>24&255,o>>>16&255,o>>>8&255,o&255]));r=32+20+8+16+8+8;if(e.type==="audio"){a=A(e,r);return f(O.traf,t,i,a)}n=b(e);a=A(e,n.length+r);return f(O.traf,t,i,a,n)};m=function(e){e.duration=e.duration||4294967295;return f(O.trak,g(e),y(e))};k=function(e){var t=new Uint8Array([0,0,0,0,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);if(e.type!=="video"){t[t.length-1]=0}return f(O.trex,t)};(function(){var i,a,s;s=function(e,t){var i=0,a=0,n=0,r=0;if(e.length){if(e[0].duration!==undefined){i=1}if(e[0].size!==undefined){a=2}if(e[0].flags!==undefined){n=4}if(e[0].compositionTimeOffset!==undefined){r=8}}return[0,0,i|a|n|r,1,(e.length&4278190080)>>>24,(e.length&16711680)>>>16,(e.length&65280)>>>8,e.length&255,(t&4278190080)>>>24,(t&16711680)>>>16,(t&65280)>>>8,t&255]};a=function(e,t){var i,a,n,r;a=e.samples||[];t+=8+12+16*a.length;i=s(a,t);for(r=0;r<a.length;r++){n=a[r];i=i.concat([(n.duration&4278190080)>>>24,(n.duration&16711680)>>>16,(n.duration&65280)>>>8,n.duration&255,(n.size&4278190080)>>>24,(n.size&16711680)>>>16,(n.size&65280)>>>8,n.size&255,n.flags.isLeading<<2|n.flags.dependsOn,n.flags.isDependedOn<<6|n.flags.hasRedundancy<<4|n.flags.paddingValue<<1|n.flags.isNonSyncSample,n.flags.degradationPriority&240<<8,n.flags.degradationPriority&15,(n.compositionTimeOffset&4278190080)>>>24,(n.compositionTimeOffset&16711680)>>>16,(n.compositionTimeOffset&65280)>>>8,n.compositionTimeOffset&255])}return f(O.trun,new Uint8Array(i))};i=function(e,t){var i,a,n,r;a=e.samples||[];t+=8+12+8*a.length;i=s(a,t);for(r=0;r<a.length;r++){n=a[r];i=i.concat([(n.duration&4278190080)>>>24,(n.duration&16711680)>>>16,(n.duration&65280)>>>8,n.duration&255,(n.size&4278190080)>>>24,(n.size&16711680)>>>16,(n.size&65280)>>>8,n.size&255])}return f(O.trun,new Uint8Array(i))};A=function(e,t){if(e.type==="audio"){return i(e,t)}return a(e,t)}})();t.exports={ftyp:r,mdat:s,moof:h,moov:l,initSegment:function(e){var t=r(),i=l(e),a;a=new Uint8Array(t.byteLength+i.byteLength);a.set(t);a.set(i,t.byteLength);return a}}},{}],32:[function(e,t,i){"use strict";var a=e("../utils/stream.js");var l=e("./mp4-generator.js");var o=e("../m2ts/m2ts.js");var u=e("../codecs/adts.js");var f=e("../codecs/h264").H264Stream;var d=e("../aac");var h=e("../data/silence");var c=e("../utils/clock");var p=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"];var m=["width","height","profileIdc","levelIdc","profileCompatibility"];var g=9e4;var y,v,_,b;var S,w,T,k,A,O,M;S=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0}}};w=function(e){if(e[0]==="I".charCodeAt(0)&&e[1]==="D".charCodeAt(0)&&e[2]==="3".charCodeAt(0)){return true}return false};O=function(e,t){var i;if(e.length!==t.length){return false}for(i=0;i<e.length;i++){if(e[i]!==t[i]){return false}}return true};M=function(e){var t,i,a=0;for(t=0;t<e.length;t++){i=e[t];a+=i.data.byteLength}return a};v=function(n){var r=[],s=0,t=0,f=0,d=Infinity;v.prototype.init.call(this);this.push=function(t){T(n,t);if(n){p.forEach(function(e){n[e]=t[e]})}r.push(t)};this.setEarliestDts=function(e){t=e-n.timelineStartInfo.baseMediaDecodeTime};this.setVideoBaseMediaDecodeTime=function(e){d=e};this.setAudioAppendStart=function(e){f=e};this.flush=function(){var e,t,i,a;if(r.length===0){this.trigger("done","AudioSegmentStream");return}e=this.trimAdtsFramesByEarliestDts_(r);n.baseMediaDecodeTime=A(n);this.prefixWithSilence_(n,e);n.samples=this.generateSampleTable_(e);i=l.mdat(this.concatenateFrameData_(e));r=[];t=l.moof(s,[n]);a=new Uint8Array(t.byteLength+i.byteLength);s++;a.set(t);a.set(i,t.byteLength);k(n);this.trigger("data",{track:n,boxes:a});this.trigger("done","AudioSegmentStream")};this.prefixWithSilence_=function(e,t){var i,a=0,n=0,r=0,s=0,o,u;if(!t.length){return}i=c.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate);a=Math.ceil(g/(e.samplerate/1024));if(f&&d){n=i-Math.max(f,d);r=Math.floor(n/a);s=r*a}if(r<1||s>g/2){return}o=h[e.samplerate];if(!o){o=t[0].data}for(u=0;u<r;u++){t.splice(u,0,{data:o})}e.baseMediaDecodeTime-=Math.floor(c.videoTsToAudioTs(s,e.samplerate))};this.trimAdtsFramesByEarliestDts_=function(e){if(n.minSegmentDts>=t){return e}n.minSegmentDts=Infinity;return e.filter(function(e){if(e.dts>=t){n.minSegmentDts=Math.min(n.minSegmentDts,e.dts);n.minSegmentPts=n.minSegmentDts;return true}return false})};this.generateSampleTable_=function(e){var t,i,a=[];for(t=0;t<e.length;t++){i=e[t];a.push({size:i.data.byteLength,duration:1024})}return a};this.concatenateFrameData_=function(e){var t,i,a=0,n=new Uint8Array(M(e));for(t=0;t<e.length;t++){i=e[t];n.set(i.data,a);a+=i.data.byteLength}return n}};v.prototype=new a;y=function(f,o){var u=0,d=[],h=[],t,i;o=o||{};y.prototype.init.call(this);delete f.minPTS;this.gopCache_=[];this.push=function(e){T(f,e);if(e.nalUnitType==="seq_parameter_set_rbsp"&&!t){t=e.config;f.sps=[e.data];m.forEach(function(e){f[e]=t[e]},this)}if(e.nalUnitType==="pic_parameter_set_rbsp"&&!i){i=e.data;f.pps=[e.data]}d.push(e)};this.flush=function(){var e,t,i,a,n,r;while(d.length){if(d[0].nalUnitType==="access_unit_delimiter_rbsp"){break}d.shift()}if(d.length===0){this.resetStream_();this.trigger("done","VideoSegmentStream");return}e=this.groupNalsIntoFrames_(d);i=this.groupFramesIntoGops_(e);if(!i[0][0].keyFrame){t=this.getGopForFusion_(d[0],f);if(t){i.unshift(t);i.byteLength+=t.byteLength;i.nalCount+=t.nalCount;i.pts=t.pts;i.dts=t.dts;i.duration+=t.duration}else{i=this.extendFirstKeyFrame_(i)}}if(h.length){var s;if(o.alignGopsAtEnd){s=this.alignGopsAtEnd_(i)}else{s=this.alignGopsAtStart_(i)}if(!s){this.gopCache_.unshift({gop:i.pop(),pps:f.pps,sps:f.sps});this.gopCache_.length=Math.min(6,this.gopCache_.length);d=[];this.resetStream_();this.trigger("done","VideoSegmentStream");return}k(f);i=s}T(f,i);f.samples=this.generateSampleTable_(i);n=l.mdat(this.concatenateNalData_(i));f.baseMediaDecodeTime=A(f);this.trigger("processedGopsInfo",i.map(function(e){return{pts:e.pts,dts:e.dts,byteLength:e.byteLength}}));this.gopCache_.unshift({gop:i.pop(),pps:f.pps,sps:f.sps});this.gopCache_.length=Math.min(6,this.gopCache_.length);d=[];this.trigger("baseMediaDecodeTime",f.baseMediaDecodeTime);this.trigger("timelineStartInfo",f.timelineStartInfo);a=l.moof(u,[f]);r=new Uint8Array(a.byteLength+n.byteLength);u++;r.set(a);r.set(n,a.byteLength);this.trigger("data",{track:f,boxes:r});this.resetStream_();this.trigger("done","VideoSegmentStream")};this.resetStream_=function(){k(f);t=undefined;i=undefined};this.getGopForFusion_=function(e){var t=45e3,i=1e4,a=Infinity,n,r,s,o,u;for(u=0;u<this.gopCache_.length;u++){o=this.gopCache_[u];s=o.gop;if(!(f.pps&&O(f.pps[0],o.pps[0]))||!(f.sps&&O(f.sps[0],o.sps[0]))){continue}if(s.dts<f.timelineStartInfo.dts){continue}n=e.dts-s.dts-s.duration;if(n>=-i&&n<=t){if(!r||a>n){r=o;a=n}}}if(r){return r.gop}return null};this.extendFirstKeyFrame_=function(e){var t;if(!e[0][0].keyFrame&&e.length>1){t=e.shift();e.byteLength-=t.byteLength;e.nalCount-=t.nalCount;e[0][0].dts=t.dts;e[0][0].pts=t.pts;e[0][0].duration+=t.duration}return e};this.groupNalsIntoFrames_=function(e){var t,i,a=[],n=[];a.byteLength=0;for(t=0;t<e.length;t++){i=e[t];if(i.nalUnitType==="access_unit_delimiter_rbsp"){if(a.length){a.duration=i.dts-a.dts;n.push(a)}a=[i];a.byteLength=i.data.byteLength;a.pts=i.pts;a.dts=i.dts}else{if(i.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"){a.keyFrame=true}a.duration=i.dts-a.dts;a.byteLength+=i.data.byteLength;a.push(i)}}if(n.length&&(!a.duration||a.duration<=0)){a.duration=n[n.length-1].duration}n.push(a);return n};this.groupFramesIntoGops_=function(e){var t,i,a=[],n=[];a.byteLength=0;a.nalCount=0;a.duration=0;a.pts=e[0].pts;a.dts=e[0].dts;n.byteLength=0;n.nalCount=0;n.duration=0;n.pts=e[0].pts;n.dts=e[0].dts;for(t=0;t<e.length;t++){i=e[t];if(i.keyFrame){if(a.length){n.push(a);n.byteLength+=a.byteLength;n.nalCount+=a.nalCount;n.duration+=a.duration}a=[i];a.nalCount=i.length;a.byteLength=i.byteLength;a.pts=i.pts;a.dts=i.dts;a.duration=i.duration}else{a.duration+=i.duration;a.nalCount+=i.length;a.byteLength+=i.byteLength;a.push(i)}}if(n.length&&a.duration<=0){a.duration=n[n.length-1].duration}n.byteLength+=a.byteLength;n.nalCount+=a.nalCount;n.duration+=a.duration;n.push(a);return n};this.generateSampleTable_=function(e,t){var i,a,n,r,s,o=t||0,u=[];for(i=0;i<e.length;i++){r=e[i];for(a=0;a<r.length;a++){s=r[a];n=S();n.dataOffset=o;n.compositionTimeOffset=s.pts-s.dts;n.duration=s.duration;n.size=4*s.length;n.size+=s.byteLength;if(s.keyFrame){n.flags.dependsOn=2}o+=n.size;u.push(n)}}return u};this.concatenateNalData_=function(e){var t,i,a,n,r,s,o=0,u=e.byteLength,f=e.nalCount,d=u+4*f,h=new Uint8Array(d),l=new DataView(h.buffer);for(t=0;t<e.length;t++){n=e[t];for(i=0;i<n.length;i++){r=n[i];for(a=0;a<r.length;a++){s=r[a];l.setUint32(o,s.data.byteLength);o+=4;h.set(s.data,o);o+=s.data.byteLength}}}return h};this.alignGopsAtStart_=function(e){var t,i,a,n,r,s,o,u;r=e.byteLength;s=e.nalCount;o=e.duration;t=i=0;while(t<h.length&&i<e.length){a=h[t];n=e[i];if(a.pts===n.pts){break}if(n.pts>a.pts){t++;continue}i++;r-=n.byteLength;s-=n.nalCount;o-=n.duration}if(i===0){return e}if(i===e.length){return null}u=e.slice(i);u.byteLength=r;u.duration=o;u.nalCount=s;u.pts=u[0].pts;u.dts=u[0].dts;return u};this.alignGopsAtEnd_=function(e){var t,i,a,n,r,s;t=h.length-1;i=e.length-1;r=null;s=false;while(t>=0&&i>=0){a=h[t];n=e[i];if(a.pts===n.pts){s=true;break}if(a.pts>n.pts){t--;continue}if(t===h.length-1){r=i}i--}if(!s&&r===null){return null}var o;if(s){o=i}else{o=r}if(o===0){return e}var u=e.slice(o);var f=u.reduce(function(e,t){e.byteLength+=t.byteLength;e.duration+=t.duration;e.nalCount+=t.nalCount;return e},{byteLength:0,duration:0,nalCount:0});u.byteLength=f.byteLength;u.duration=f.duration;u.nalCount=f.nalCount;u.pts=u[0].pts;u.dts=u[0].dts;return u};this.alignGopsWith=function(e){h=e}};y.prototype=new a;T=function(e,t){if(typeof t.pts==="number"){if(e.timelineStartInfo.pts===undefined){e.timelineStartInfo.pts=t.pts}if(e.minSegmentPts===undefined){e.minSegmentPts=t.pts}else{e.minSegmentPts=Math.min(e.minSegmentPts,t.pts)}if(e.maxSegmentPts===undefined){e.maxSegmentPts=t.pts}else{e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)}}if(typeof t.dts==="number"){if(e.timelineStartInfo.dts===undefined){e.timelineStartInfo.dts=t.dts}if(e.minSegmentDts===undefined){e.minSegmentDts=t.dts}else{e.minSegmentDts=Math.min(e.minSegmentDts,t.dts)}if(e.maxSegmentDts===undefined){e.maxSegmentDts=t.dts}else{e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts)}}};k=function(e){delete e.minSegmentDts;delete e.maxSegmentDts;delete e.minSegmentPts;delete e.maxSegmentPts};A=function(e){var t,i,a=e.minSegmentDts-e.timelineStartInfo.dts;t=e.timelineStartInfo.baseMediaDecodeTime;t+=a;t=Math.max(0,t);if(e.type==="audio"){i=e.samplerate/g;t*=i;t=Math.floor(t)}return t};b=function(e,t){this.numberOfTracks=0;this.metadataStream=t;if(typeof e.remux!=="undefined"){this.remuxTracks=!!e.remux}else{this.remuxTracks=true}this.pendingTracks=[];this.videoTrack=null;this.pendingBoxes=[];this.pendingCaptions=[];this.pendingMetadata=[];this.pendingBytes=0;this.emittedTracks=0;b.prototype.init.call(this);this.push=function(e){if(e.text){return this.pendingCaptions.push(e)}if(e.frames){return this.pendingMetadata.push(e)}this.pendingTracks.push(e.track);this.pendingBoxes.push(e.boxes);this.pendingBytes+=e.boxes.byteLength;if(e.track.type==="video"){this.videoTrack=e.track}if(e.track.type==="audio"){this.audioTrack=e.track}}};b.prototype=new a;b.prototype.flush=function(e){var t=0,i={captions:[],captionStreams:{},metadata:[],info:{}},a,n,r,s=0,o;if(this.pendingTracks.length<this.numberOfTracks){if(e!=="VideoSegmentStream"&&e!=="AudioSegmentStream"){return}else if(this.remuxTracks){return}else if(this.pendingTracks.length===0){this.emittedTracks++;if(this.emittedTracks>=this.numberOfTracks){this.trigger("done");this.emittedTracks=0}return}}if(this.videoTrack){s=this.videoTrack.timelineStartInfo.pts;m.forEach(function(e){i.info[e]=this.videoTrack[e]},this)}else if(this.audioTrack){s=this.audioTrack.timelineStartInfo.pts;p.forEach(function(e){i.info[e]=this.audioTrack[e]},this)}if(this.pendingTracks.length===1){i.type=this.pendingTracks[0].type}else{i.type="combined"}this.emittedTracks+=this.pendingTracks.length;r=l.initSegment(this.pendingTracks);i.initSegment=new Uint8Array(r.byteLength);i.initSegment.set(r);i.data=new Uint8Array(this.pendingBytes);for(o=0;o<this.pendingBoxes.length;o++){i.data.set(this.pendingBoxes[o],t);t+=this.pendingBoxes[o].byteLength}for(o=0;o<this.pendingCaptions.length;o++){a=this.pendingCaptions[o];a.startTime=a.startPts-s;a.startTime/=9e4;a.endTime=a.endPts-s;a.endTime/=9e4;i.captionStreams[a.stream]=true;i.captions.push(a)}for(o=0;o<this.pendingMetadata.length;o++){n=this.pendingMetadata[o];n.cueTime=n.pts-s;n.cueTime/=9e4;i.metadata.push(n)}i.metadata.dispatchType=this.metadataStream.dispatchType;this.pendingTracks.length=0;this.videoTrack=null;this.pendingBoxes.length=0;this.pendingCaptions.length=0;this.pendingBytes=0;this.pendingMetadata.length=0;this.trigger("data",i);if(this.emittedTracks>=this.numberOfTracks){this.trigger("done");this.emittedTracks=0}};_=function(a){var n=this,i=true,r,s;_.prototype.init.call(this);a=a||{};this.baseMediaDecodeTime=a.baseMediaDecodeTime||0;this.transmuxPipeline_={};this.setupAacPipeline=function(){var t={};this.transmuxPipeline_=t;t.type="aac";t.metadataStream=new o.MetadataStream;t.aacStream=new d;t.audioTimestampRolloverStream=new o.TimestampRolloverStream("audio");t.timedMetadataTimestampRolloverStream=new o.TimestampRolloverStream("timed-metadata");t.adtsStream=new u;t.coalesceStream=new b(a,t.metadataStream);t.headOfPipeline=t.aacStream;t.aacStream.pipe(t.audioTimestampRolloverStream).pipe(t.adtsStream);t.aacStream.pipe(t.timedMetadataTimestampRolloverStream).pipe(t.metadataStream).pipe(t.coalesceStream);t.metadataStream.on("timestamp",function(e){t.aacStream.setTimestamp(e.timeStamp)});t.aacStream.on("data",function(e){if(e.type==="timed-metadata"&&!t.audioSegmentStream){s=s||{timelineStartInfo:{baseMediaDecodeTime:n.baseMediaDecodeTime},codec:"adts",type:"audio"};t.coalesceStream.numberOfTracks++;t.audioSegmentStream=new v(s);t.adtsStream.pipe(t.audioSegmentStream).pipe(t.coalesceStream)}});t.coalesceStream.on("data",this.trigger.bind(this,"data"));t.coalesceStream.on("done",this.trigger.bind(this,"done"))};this.setupTsPipeline=function(){var i={};this.transmuxPipeline_=i;i.type="ts";i.metadataStream=new o.MetadataStream;i.packetStream=new o.TransportPacketStream;i.parseStream=new o.TransportParseStream;i.elementaryStream=new o.ElementaryStream;i.videoTimestampRolloverStream=new o.TimestampRolloverStream("video");i.audioTimestampRolloverStream=new o.TimestampRolloverStream("audio");i.timedMetadataTimestampRolloverStream=new o.TimestampRolloverStream("timed-metadata");i.adtsStream=new u;i.h264Stream=new f;i.captionStream=new o.CaptionStream;i.coalesceStream=new b(a,i.metadataStream);i.headOfPipeline=i.packetStream;i.packetStream.pipe(i.parseStream).pipe(i.elementaryStream);i.elementaryStream.pipe(i.videoTimestampRolloverStream).pipe(i.h264Stream);i.elementaryStream.pipe(i.audioTimestampRolloverStream).pipe(i.adtsStream);i.elementaryStream.pipe(i.timedMetadataTimestampRolloverStream).pipe(i.metadataStream).pipe(i.coalesceStream);i.h264Stream.pipe(i.captionStream).pipe(i.coalesceStream);i.elementaryStream.on("data",function(e){var t;if(e.type==="metadata"){t=e.tracks.length;while(t--){if(!r&&e.tracks[t].type==="video"){r=e.tracks[t];r.timelineStartInfo.baseMediaDecodeTime=n.baseMediaDecodeTime}else if(!s&&e.tracks[t].type==="audio"){s=e.tracks[t];s.timelineStartInfo.baseMediaDecodeTime=n.baseMediaDecodeTime}}if(r&&!i.videoSegmentStream){i.coalesceStream.numberOfTracks++;i.videoSegmentStream=new y(r,a);i.videoSegmentStream.on("timelineStartInfo",function(e){if(s){s.timelineStartInfo=e;i.audioSegmentStream.setEarliestDts(e.dts)}});i.videoSegmentStream.on("processedGopsInfo",n.trigger.bind(n,"gopInfo"));i.videoSegmentStream.on("baseMediaDecodeTime",function(e){if(s){i.audioSegmentStream.setVideoBaseMediaDecodeTime(e)}});i.h264Stream.pipe(i.videoSegmentStream).pipe(i.coalesceStream)}if(s&&!i.audioSegmentStream){i.coalesceStream.numberOfTracks++;i.audioSegmentStream=new v(s);i.adtsStream.pipe(i.audioSegmentStream).pipe(i.coalesceStream)}}});i.coalesceStream.on("data",this.trigger.bind(this,"data"));i.coalesceStream.on("done",this.trigger.bind(this,"done"))};this.setBaseMediaDecodeTime=function(e){var t=this.transmuxPipeline_;this.baseMediaDecodeTime=e;if(s){s.timelineStartInfo.dts=undefined;s.timelineStartInfo.pts=undefined;k(s);s.timelineStartInfo.baseMediaDecodeTime=e;if(t.audioTimestampRolloverStream){t.audioTimestampRolloverStream.discontinuity()}}if(r){if(t.videoSegmentStream){t.videoSegmentStream.gopCache_=[];t.videoTimestampRolloverStream.discontinuity()}r.timelineStartInfo.dts=undefined;r.timelineStartInfo.pts=undefined;k(r);t.captionStream.reset();r.timelineStartInfo.baseMediaDecodeTime=e}if(t.timedMetadataTimestampRolloverStream){t.timedMetadataTimestampRolloverStream.discontinuity()}};this.setAudioAppendStart=function(e){if(s){this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)}};this.alignGopsWith=function(e){if(r&&this.transmuxPipeline_.videoSegmentStream){this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e)}};this.push=function(e){if(i){var t=w(e);if(t&&this.transmuxPipeline_.type!=="aac"){this.setupAacPipeline()}else if(!t&&this.transmuxPipeline_.type!=="ts"){this.setupTsPipeline()}i=false}this.transmuxPipeline_.headOfPipeline.push(e)};this.flush=function(){i=true;this.transmuxPipeline_.headOfPipeline.flush()};this.resetCaptions=function(){if(this.transmuxPipeline_.captionStream){this.transmuxPipeline_.captionStream.reset()}}};_.prototype=new a;t.exports={Transmuxer:_,VideoSegmentStream:y,AudioSegmentStream:v,AUDIO_PROPERTIES:p,VIDEO_PROPERTIES:m}},{"../aac":15,"../codecs/adts.js":16,"../codecs/h264":17,"../data/silence":18,"../m2ts/m2ts.js":26,"../utils/clock":33,"../utils/stream.js":35,"./mp4-generator.js":31}],33:[function(e,t,i){var a=9e4,n,r,s,o,u,f;n=function(e){return e*a};r=function(e,t){return e*t};s=function(e){return e/a};o=function(e,t){return e/t};u=function(e,t){return n(o(e,t))};f=function(e,t){return r(s(e),t)};t.exports={secondsToVideoTs:n,secondsToAudioTs:r,videoTsToSeconds:s,audioTsToSeconds:o,audioTsToVideoTs:u,videoTsToAudioTs:f}},{}],34:[function(e,t,i){"use strict";var a;a=function(a){var n=a.byteLength,r=0,s=0;this.length=function(){return 8*n};this.bitsAvailable=function(){return 8*n+s};this.loadWord=function(){var e=a.byteLength-n,t=new Uint8Array(4),i=Math.min(4,n);if(i===0){throw new Error("no bytes available")}t.set(a.subarray(e,e+i));r=new DataView(t.buffer).getUint32(0);s=i*8;n-=i};this.skipBits=function(e){var t;if(s>e){r<<=e;s-=e}else{e-=s;t=Math.floor(e/8);e-=t*8;n-=t;this.loadWord();r<<=e;s-=e}};this.readBits=function(e){var t=Math.min(s,e),i=r>>>32-t;s-=t;if(s>0){r<<=t}else if(n>0){this.loadWord()}t=e-t;if(t>0){return i<<t|this.readBits(t)}return i};this.skipLeadingZeros=function(){var e;for(e=0;e<s;++e){if((r&2147483648>>>e)!==0){r<<=e;s-=e;return e}}this.loadWord();return e+this.skipLeadingZeros()};this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())};this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())};this.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1};this.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();if(1&e){return 1+e>>>1}return-1*(e>>>1)};this.readBoolean=function(){return this.readBits(1)===1};this.readUnsignedByte=function(){return this.readBits(8)};this.loadWord()};t.exports=a},{}],35:[function(e,t,i){"use strict";var a=function(){this.init=function(){var r={};this.on=function(e,t){if(!r[e]){r[e]=[]}r[e]=r[e].concat(t)};this.off=function(e,t){var i;if(!r[e]){return false}i=r[e].indexOf(t);r[e]=r[e].slice();r[e].splice(i,1);return i>-1};this.trigger=function(e){var t,i,a,n;t=r[e];if(!t){return}if(arguments.length===2){a=t.length;for(i=0;i<a;++i){t[i].call(this,arguments[1])}}else{n=[];i=arguments.length;for(i=1;i<arguments.length;++i){n.push(arguments[i])}a=t.length;for(i=0;i<a;++i){t[i].apply(this,n)}}};this.dispose=function(){r={}}}};a.prototype.pipe=function(t){this.on("data",function(e){t.push(e)});this.on("done",function(e){t.flush(e)});return t};a.prototype.push=function(e){this.trigger("data",e)};a.prototype.flush=function(e){this.trigger("done",e)};t.exports=a},{}],36:[function(e,t,i){var f=arguments[3];var d=arguments[4];var h=arguments[5];var l=JSON.stringify;var u=false;var a=function(i){var a={};function n(e){if(a[e]){return a[e].exports}var t=a[e]={i:e,l:false,exports:{}};i[e].call(t.exports,t,t.exports,n);t.l=true;return t.exports}n.m=i;n.c=a;n.d=function(e,t,i){if(!n.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:i})}};n.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};n.d(e,"a",e);return e};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";return n(n.s=entryModule)};if(typeof f==="undefined"){u=true;f=a;d=__webpack_modules__}var c=function(e){var t=Object.keys(h);var i;for(var a=0;a<t.length;a++){var n=t[a];var r=h[n].exports;if(r===e||r&&r.default===e){i=n;break}}if(!i){i=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var s={};for(var a=0;a<t.length;a++){var n=t[a];s[n]=n}d[i]=["function(require,module,exports){"+e+"(self); }",s]}var o=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var u={};u[i]=i;d[o]=["function(require,module,exports){"+"var f = require("+l(i)+");"+"(f.default ? f.default : f)(self);"+"}",u];return"("+f+")({"+Object.keys(d).map(function(e){return l(e)+":["+d[e][0]+","+l(d[e][1])+"]"}).join(",")+"},{},["+l(o)+"])"};var p=function(e,t){var i=typeof t==="string";var a;if(i){a={}}else{a=[]}Object.keys(d).forEach(function(e){if(!d[e]){return}a[e]=d[e].toString()});var n=__webpack_require__(t);if(!(n&&(n===e||n.default===e))){var r=a[t];a[t]=r.substring(0,r.length-1)+"\n"+e.name+"();\n}"}var s;if(i){t=l(t);var o=Object.keys(a).map(function(e){return l(e)+":"+a[e]});s="{"+o.join(",")+"}"}else{s="["+a.join(",")+"]"}return"var fn = ("+f.toString().replace("entryModule",t)+")("+s+");\n"+'(typeof fn === "function") && fn(self);'};t.exports=function e(t,i){var a;if(u){a=p(t,i)}else{a=c(t)}var n=new Blob([a],{type:"text/javascript"});var r=window.URL||window.webkitURL||window.mozURL||window.msURL;var s=r.createObjectURL(n);var o=new Worker(s);o.objectURL=s;return o}},{}],37:[function(g,e,y){(function(e){"use strict";Object.defineProperty(y,"__esModule",{value:true});function t(e){return e&&e.__esModule?e:{default:e}}var i=g("global/window");var n=t(i);var a=g("./flash-media-source");var r=t(a);var s=g("./html-media-source");var o=t(s);var u=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var f=t(u);var d=0;var h={mode:"auto"};f["default"].mediaSources={};var l=function e(t,i){var a=f["default"].mediaSources[t];if(a){a.trigger({type:"sourceopen",swfId:i})}else{throw new Error("Media Source not found (Video.js)")}};var c=function e(){return!!n["default"].MediaSource&&!!n["default"].MediaSource.isTypeSupported&&n["default"].MediaSource.isTypeSupported('video/mp4;codecs="avc1.4d400d,mp4a.40.2"')};var p=function e(t){var i=f["default"].mergeOptions(h,t);this.MediaSource={open:l,supportsNativeMediaSources:c};if(i.mode==="html5"||i.mode==="auto"&&c()){return new o["default"]}else if(f["default"].getTech("Flash")){return new r["default"]}throw new Error("Cannot use Flash or Html5 to create a MediaSource for this video")};y.MediaSource=p;p.open=l;p.supportsNativeMediaSources=c;var m={createObjectURL:function e(t){var i="blob:vjs-media-source/";var a=undefined;if(t instanceof o["default"]){a=n["default"].URL.createObjectURL(t.nativeMediaSource_);t.url_=a;return a}if(!(t instanceof r["default"])){a=n["default"].URL.createObjectURL(t);t.url_=a;return a}a=i+d;d++;f["default"].mediaSources[a]=t;return a}};y.URL=m;f["default"].MediaSource=p;f["default"].URL=m}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./flash-media-source":5,"./html-media-source":8,"global/window":14}]},{},[37])(37)});