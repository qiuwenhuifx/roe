(function(i,r){if(window.layui&&layui.define){layui.define(["jquery","draggable","collision"],function(i){var t=layui.$,e=layui.draggable,s=layui.collision;i("gridster",r(t,e,s))})}else if(typeof define==="function"&&define.amd){define(["jquery","gridster-draggable","gridster-collision"],r)}else{i.Gridster=r(i.$||i.jQuery,i.GridsterDraggable,i.GridsterCollision)}})(this,function(u,i,t){if(!window.larrymsExtend){return false}layui.link(layui.cache.extendStyle+"gridster/gridster.min.css");var a=u;var e={namespace:"",widget_selector:"li",widget_margins:[10,10],widget_base_dimensions:[400,225],extra_rows:0,extra_cols:0,min_cols:1,max_cols:Infinity,min_rows:15,max_size_x:false,autogrow_cols:false,autogenerate_stylesheet:true,avoid_overlapped_widgets:true,auto_init:true,serialize_params:function(i,t){return{col:t.col,row:t.row,size_x:t.size_x,size_y:t.size_y}},collision:{},draggable:{items:".gs-w",distance:4,ignore_dragging:i.defaults.ignore_dragging.slice(0)},resize:{enabled:false,axes:["both"],handle_append_to:"",handle_class:"gs-resize-handle",max_size:[Infinity,Infinity],min_size:[1,1]}};function d(i,t){this.options=u.extend(true,{},e,t);this.$el=u(i);this.$wrapper=this.$el.parent();this.$widgets=this.$el.children(this.options.widget_selector).addClass("gs-w");this.widgets=[];this.$changed=u([]);this.wrapper_width=this.$wrapper.width();this.min_widget_width=this.options.widget_margins[0]*2+this.options.widget_base_dimensions[0];this.min_widget_height=this.options.widget_margins[1]*2+this.options.widget_base_dimensions[1];this.generated_stylesheets=[];this.$style_tags=u([]);this.options.auto_init&&this.init()}d.defaults=e;d.generated_stylesheets=[];d.sort_by_row_asc=function(i){i=i.sort(function(i,t){if(!i.row){i=u(i).coords().grid;t=u(t).coords().grid}if(i.row>t.row){return 1}return-1});return i};d.sort_by_row_and_col_asc=function(i){i=i.sort(function(i,t){if(i.row>t.row||i.row===t.row&&i.col>t.col){return 1}return-1});return i};d.sort_by_col_asc=function(i){i=i.sort(function(i,t){if(i.col>t.col){return 1}return-1});return i};d.sort_by_row_desc=function(i){i=i.sort(function(i,t){if(i.row+i.size_y<t.row+t.size_y){return 1}return-1});return i};var s=d.prototype;s.init=function(){this.options.resize.enabled&&this.setup_resize();this.generate_grid_and_stylesheet();this.get_widgets_from_DOM();this.set_dom_grid_height();this.set_dom_grid_width();this.$wrapper.addClass("ready");this.draggable();this.options.resize.enabled&&this.resizable();u(window).bind("resize.gridster",throttle(u.proxy(this.recalculate_faux_grid,this),200))};s.disable=function(){this.$wrapper.find(".player-revert").removeClass("player-revert");this.drag_api.disable();return this};s.enable=function(){this.drag_api.enable();return this};s.disable_resize=function(){this.$el.addClass("gs-resize-disabled");this.resize_api.disable();return this};s.enable_resize=function(){this.$el.removeClass("gs-resize-disabled");this.resize_api.enable();return this};s.add_widget=function(i,t,e,s,r,a,o){var _;t||(t=1);e||(e=1);if(!s&!r){_=this.next_position(t,e)}else{_={col:s,row:r,size_x:t,size_y:e};this.empty_cells(s,r,t,e)}var h=u(i).attr({"data-col":_.col,"data-row":_.row,"data-sizex":t,"data-sizey":e}).addClass("gs-w").appendTo(this.$el).hide();this.$widgets=this.$widgets.add(h);this.register_widget(h);this.add_faux_rows(_.size_y);if(a){this.set_widget_max_size(h,a)}if(o){this.set_widget_min_size(h,o)}this.set_dom_grid_width();this.set_dom_grid_height();this.drag_api.set_limits(this.cols*this.min_widget_width);return h.fadeIn()};s.set_widget_min_size=function(i,t){i=typeof i==="number"?this.$widgets.eq(i):i;if(!i.length){return this}var e=i.data("coords").grid;e.min_size_x=t[0];e.min_size_y=t[1];return this};s.set_widget_max_size=function(i,t){i=typeof i==="number"?this.$widgets.eq(i):i;if(!i.length){return this}var e=i.data("coords").grid;e.max_size_x=t[0];e.max_size_y=t[1];return this};s.add_resize_handle=function(i){var t=this.options.resize.handle_append_to;u(this.resize_handle_tpl).appendTo(t?u(t,i):i);return this};s.resize_widget=function(i,t,e,s){var r=i.coords().grid;var a=r.col;var o=this.options.max_cols;var _=r.size_y;var h=r.col;var n=h;t||(t=r.size_x);e||(e=r.size_y);if(o!==Infinity){t=Math.min(t,o-a+1)}if(e>_){this.add_faux_rows(Math.max(e-_,0))}var d=a+t-1;if(d>this.cols){this.add_faux_cols(d-this.cols)}var l={col:n,row:r.row,size_x:t,size_y:e};this.mutate_widget_in_gridmap(i,r,l);this.set_dom_grid_height();this.set_dom_grid_width();if(s){s.call(this,l.size_x,l.size_y)}return i};s.mutate_widget_in_gridmap=function(i,t,e){var s=t.size_x;var r=t.size_y;var a=this.get_cells_occupied(t);var o=this.get_cells_occupied(e);var _=[];u.each(a.cols,function(i,t){if(u.inArray(t,o.cols)===-1){_.push(t)}});var h=[];u.each(o.cols,function(i,t){if(u.inArray(t,a.cols)===-1){h.push(t)}});var n=[];u.each(a.rows,function(i,t){if(u.inArray(t,o.rows)===-1){n.push(t)}});var d=[];u.each(o.rows,function(i,t){if(u.inArray(t,a.rows)===-1){d.push(t)}});this.remove_from_gridmap(t);if(h.length){var l=[e.col,e.row,e.size_x,Math.min(r,e.size_y),i];this.empty_cells.apply(this,l)}if(d.length){var c=[e.col,e.row,e.size_x,e.size_y,i];this.empty_cells.apply(this,c)}t.col=e.col;t.row=e.row;t.size_x=e.size_x;t.size_y=e.size_y;this.add_to_gridmap(e,i);i.removeClass("player-revert");i.data("coords").update({width:e.size_x*this.options.widget_base_dimensions[0]+(e.size_x-1)*this.options.widget_margins[0]*2,height:e.size_y*this.options.widget_base_dimensions[1]+(e.size_y-1)*this.options.widget_margins[1]*2});i.attr({"data-col":e.col,"data-row":e.row,"data-sizex":e.size_x,"data-sizey":e.size_y});if(_.length){var g=[_[0],e.row,_.length,Math.min(r,e.size_y),i];this.remove_empty_cells.apply(this,g)}if(n.length){var p=[e.col,e.row,e.size_x,e.size_y,i];this.remove_empty_cells.apply(this,p)}this.move_widget_up(i);return this};s.empty_cells=function(i,r,t,a,e){var s=this.widgets_below({col:i,row:r-a,size_x:t,size_y:a});s.not(e).each(u.proxy(function(i,t){var e=u(t).coords().grid;if(!(e.row<=r+a-1)){return}var s=r+a-e.row;this.move_widget_down(u(t),s)},this));this.set_dom_grid_height();return this};s.remove_empty_cells=function(i,t,e,s,r){var a=this.widgets_below({col:i,row:t,size_x:e,size_y:s});a.not(r).each(u.proxy(function(i,t){this.move_widget_up(u(t),s)},this));this.set_dom_grid_height();return this};s.next_position=function(i,t){i||(i=1);t||(t=1);var e=this.gridmap;var s=e.length;var r=[];var a;for(var o=1;o<s;o++){a=e[o].length;for(var _=1;_<=a;_++){var h=this.can_move_to({size_x:i,size_y:t},o,_);if(h){r.push({col:o,row:_,size_y:t,size_x:i})}}}if(r.length){return d.sort_by_row_and_col_asc(r)[0]}return false};s.remove_widget=function(i,t,e){var s=i instanceof u?i:u(i);var r=s.coords().grid;if(u.isFunction(t)){e=t;t=false}this.cells_occupied_by_placeholder={};this.$widgets=this.$widgets.not(s);var a=this.widgets_below(s);this.remove_from_gridmap(r);s.fadeOut(u.proxy(function(){s.remove();if(!t){a.each(u.proxy(function(i,t){this.move_widget_up(u(t),r.size_y)},this))}this.set_dom_grid_height();if(e){e.call(this,i)}},this));return this};s.remove_all_widgets=function(e){this.$widgets.each(u.proxy(function(i,t){this.remove_widget(t,true,e)},this));return this};s.serialize=function(i){i||(i=this.$widgets);return i.map(u.proxy(function(i,t){var e=u(t);return this.options.serialize_params(e,e.coords().grid)},this)).get()};s.serialize_changed=function(){return this.serialize(this.$changed)};s.dom_to_coords=function(i){return{col:parseInt(i.attr("data-col"),10),row:parseInt(i.attr("data-row"),10),size_x:parseInt(i.attr("data-sizex"),10)||1,size_y:parseInt(i.attr("data-sizey"),10)||1,max_size_x:parseInt(i.attr("data-max-sizex"),10)||false,max_size_y:parseInt(i.attr("data-max-sizey"),10)||false,min_size_x:parseInt(i.attr("data-min-sizex"),10)||false,min_size_y:parseInt(i.attr("data-min-sizey"),10)||false,el:i}};s.register_widget=function(i){var t=i instanceof a;var e=t?this.dom_to_coords(i):i;var s=false;t||(i=e.el);var r=this.can_go_widget_up(e);if(r){e.row=r;i.attr("data-row",r);this.$el.trigger("gridster:positionchanged",[e]);s=true}if(this.options.avoid_overlapped_widgets&&!this.can_move_to({size_x:e.size_x,size_y:e.size_y},e.col,e.row)){u.extend(e,this.next_position(e.size_x,e.size_y));i.attr({"data-col":e.col,"data-row":e.row,"data-sizex":e.size_x,"data-sizey":e.size_y});s=true}i.data("coords",i.coords());i.data("coords").grid=e;this.add_to_gridmap(e,i);this.options.resize.enabled&&this.add_resize_handle(i);return s};s.update_widget_position=function(i,e){this.for_each_cell_occupied(i,function(i,t){if(!this.gridmap[i]){return this}this.gridmap[i][t]=e});return this};s.remove_from_gridmap=function(i){return this.update_widget_position(i,false)};s.add_to_gridmap=function(i,t){this.update_widget_position(i,t||i.el);if(i.el){var e=this.widgets_below(i.el);e.each(u.proxy(function(i,t){this.move_widget_up(u(t))},this))}};s.draggable=function(){var e=this;var i=u.extend(true,{},this.options.draggable,{offset_left:this.options.widget_margins[0],offset_top:this.options.widget_margins[1],container_width:this.cols*this.min_widget_width,limit:true,start:function(i,t){e.$widgets.filter(".player-revert").removeClass("player-revert");e.$player=u(this);e.$helper=u(t.$helper);e.helper=!e.$helper.is(e.$player);e.on_start_drag.call(e,i,t);e.$el.trigger("gridster:dragstart")},stop:function(i,t){e.on_stop_drag.call(e,i,t);e.$el.trigger("gridster:dragstop")},drag:throttle(function(i,t){e.on_drag.call(e,i,t);e.$el.trigger("gridster:drag")},60)});this.drag_api=this.$el.drag(i);return this};s.resizable=function(){this.resize_api=this.$el.drag({items:"."+this.options.resize.handle_class,offset_left:this.options.widget_margins[0],container_width:this.container_width,move_element:false,resize:true,limit:this.options.autogrow_cols?false:true,start:u.proxy(this.on_start_resize,this),stop:u.proxy(function(i,t){delay(u.proxy(function(){this.on_stop_resize(i,t)},this),120)},this),drag:throttle(u.proxy(this.on_resize,this),60)});return this};s.setup_resize=function(){this.resize_handle_class=this.options.resize.handle_class;var i=this.options.resize.axes;var t='<span class="'+this.resize_handle_class+" "+this.resize_handle_class+'-{type}" />';this.resize_handle_tpl=u.map(i,function(i){return t.replace("{type}",i)}).join("");if(u.isArray(this.options.draggable.ignore_dragging)){this.options.draggable.ignore_dragging.push("."+this.resize_handle_class)}return this};s.on_start_drag=function(i,t){this.$helper.add(this.$player).add(this.$wrapper).addClass("dragging");this.highest_col=this.get_highest_occupied_cell().col;this.$player.addClass("player");this.player_grid_data=this.$player.coords().grid;this.placeholder_grid_data=u.extend({},this.player_grid_data);this.set_dom_grid_height(this.$el.height()+this.player_grid_data.size_y*this.min_widget_height);this.set_dom_grid_width(this.cols);var e=this.player_grid_data.size_x;var s=this.cols-this.highest_col;if(this.options.autogrow_cols&&s<=e){this.add_faux_cols(Math.min(e-s,1))}var r=this.faux_grid;var a=this.$player.data("coords").coords;this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data);this.last_cols=[];this.last_rows=[];this.collision_api=this.$helper.collision(r,this.options.collision);this.$preview_holder=u("<"+this.$player.get(0).tagName+" />",{class:"preview-holder","data-row":this.$player.attr("data-row"),"data-col":this.$player.attr("data-col"),css:{width:a.width,height:a.height}}).appendTo(this.$el);if(this.options.draggable.start){this.options.draggable.start.call(this,i,t)}};s.on_drag=function(i,t){if(this.$player===null){return false}var e={left:t.position.left+this.baseX,top:t.position.top+this.baseY};if(this.options.autogrow_cols){var s=this.placeholder_grid_data.col+this.placeholder_grid_data.size_x-1;if(s>=this.cols-1&&this.options.max_cols>=this.cols+1){this.add_faux_cols(1);this.set_dom_grid_width(this.cols+1);this.drag_api.set_limits(this.container_width)}this.collision_api.set_colliders(this.faux_grid)}this.colliders_data=this.collision_api.get_closest_colliders(e);this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column);this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row);if(this.helper&&this.$player){this.$player.css({left:t.position.left,top:t.position.top})}if(this.options.draggable.drag){this.options.draggable.drag.call(this,i,t)}};s.on_stop_drag=function(i,t){this.$helper.add(this.$player).add(this.$wrapper).removeClass("dragging");t.position.left=t.position.left+this.baseX;t.position.top=t.position.top+this.baseY;this.colliders_data=this.collision_api.get_closest_colliders(t.position);this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column);this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row);this.$player.addClass("player-revert").removeClass("player").attr({"data-col":this.placeholder_grid_data.col,"data-row":this.placeholder_grid_data.row}).css({left:"",top:""});this.$changed=this.$changed.add(this.$player);this.cells_occupied_by_player=this.get_cells_occupied(this.placeholder_grid_data);this.set_cells_player_occupies(this.placeholder_grid_data.col,this.placeholder_grid_data.row);this.$player.coords().grid.row=this.placeholder_grid_data.row;this.$player.coords().grid.col=this.placeholder_grid_data.col;if(this.options.draggable.stop){this.options.draggable.stop.call(this,i,t)}this.$preview_holder.remove();this.$player=null;this.$helper=null;this.placeholder_grid_data={};this.player_grid_data={};this.cells_occupied_by_placeholder={};this.cells_occupied_by_player={};this.set_dom_grid_height();this.set_dom_grid_width();if(this.options.autogrow_cols){this.drag_api.set_limits(this.cols*this.min_widget_width)}};s.on_start_resize=function(i,t){this.$resized_widget=t.$player.closest(".gs-w");this.resize_coords=this.$resized_widget.coords();this.resize_wgd=this.resize_coords.grid;this.resize_initial_width=this.resize_coords.coords.width;this.resize_initial_height=this.resize_coords.coords.height;this.resize_initial_sizex=this.resize_coords.grid.size_x;this.resize_initial_sizey=this.resize_coords.grid.size_y;this.resize_initial_col=this.resize_coords.grid.col;this.resize_last_sizex=this.resize_initial_sizex;this.resize_last_sizey=this.resize_initial_sizey;this.resize_max_size_x=Math.min(this.resize_wgd.max_size_x||this.options.resize.max_size[0],this.options.max_cols-this.resize_initial_col+1);this.resize_max_size_y=this.resize_wgd.max_size_y||this.options.resize.max_size[1];this.resize_min_size_x=this.resize_wgd.min_size_x||this.options.resize.min_size[0]||1;this.resize_min_size_y=this.resize_wgd.min_size_y||this.options.resize.min_size[1]||1;this.resize_initial_last_col=this.get_highest_occupied_cell().col;this.set_dom_grid_width(this.cols);this.resize_dir={right:t.$player.is("."+this.resize_handle_class+"-x"),bottom:t.$player.is("."+this.resize_handle_class+"-y")};this.$resized_widget.css({"min-width":this.options.widget_base_dimensions[0],"min-height":this.options.widget_base_dimensions[1]});var e=this.$resized_widget.get(0).tagName;this.$resize_preview_holder=u("<"+e+" />",{class:"preview-holder resize-preview-holder","data-row":this.$resized_widget.attr("data-row"),"data-col":this.$resized_widget.attr("data-col"),css:{width:this.resize_initial_width,height:this.resize_initial_height}}).appendTo(this.$el);this.$resized_widget.addClass("resizing");if(this.options.resize.start){this.options.resize.start.call(this,i,t,this.$resized_widget)}this.$el.trigger("gridster:resizestart")};s.on_stop_resize=function(i,t){this.$resized_widget.removeClass("resizing").css({width:"",height:""});delay(u.proxy(function(){this.$resize_preview_holder.remove().css({"min-width":"","min-height":""});if(this.options.resize.stop){this.options.resize.stop.call(this,i,t,this.$resized_widget)}this.$el.trigger("gridster:resizestop")},this),300);this.set_dom_grid_width();if(this.options.autogrow_cols){this.drag_api.set_limits(this.cols*this.min_widget_width)}};s.on_resize=function(i,t){var e=t.pointer.diff_left;var s=t.pointer.diff_top;var r=this.options.widget_base_dimensions[0];var a=this.options.widget_base_dimensions[1];var o=this.options.widget_margins[0];var _=this.options.widget_margins[1];var h=this.resize_max_size_x;var n=this.resize_min_size_x;var d=this.resize_max_size_y;var l=this.resize_min_size_y;var c=this.options.autogrow_cols;var g;var p=Infinity;var u=Infinity;var f=Math.ceil(e/(r+o*2)-.2);var w=Math.ceil(s/(a+_*2)-.2);var v=Math.max(1,this.resize_initial_sizex+f);var m=Math.max(1,this.resize_initial_sizey+w);var y=this.container_width/this.min_widget_width-this.resize_initial_col+1;var z=y*this.min_widget_width-o*2;v=Math.max(Math.min(v,h),n);v=Math.min(y,v);g=h*r+(v-1)*o*2;p=Math.min(g,z);min_width=n*r+(v-1)*o*2;m=Math.max(Math.min(m,d),l);u=d*a+(m-1)*_*2;min_height=l*a+(m-1)*_*2;if(this.resize_dir.right){m=this.resize_initial_sizey}else if(this.resize_dir.bottom){v=this.resize_initial_sizex}if(c){var x=this.resize_initial_col+v-1;if(c&&this.resize_initial_last_col<=x){this.set_dom_grid_width(Math.max(x+1,this.cols));if(this.cols<x){this.add_faux_cols(x-this.cols)}}}var b={};!this.resize_dir.bottom&&(b.width=Math.max(Math.min(this.resize_initial_width+e,p),min_width));!this.resize_dir.right&&(b.height=Math.max(Math.min(this.resize_initial_height+s,u),min_height));this.$resized_widget.css(b);if(v!==this.resize_last_sizex||m!==this.resize_last_sizey){this.resize_widget(this.$resized_widget,v,m);this.set_dom_grid_width(this.cols);this.$resize_preview_holder.css({width:"",height:""}).attr({"data-row":this.$resized_widget.attr("data-row"),"data-sizex":v,"data-sizey":m})}if(this.options.resize.resize){this.options.resize.resize.call(this,i,t,this.$resized_widget)}this.$el.trigger("gridster:resize");this.resize_last_sizex=v;this.resize_last_sizey=m};s.on_overlapped_column_change=function(i,t){if(!this.colliders_data.length){return this}var e=this.get_targeted_columns(this.colliders_data[0].el.data.col);var s=this.last_cols.length;var r=e.length;var a;for(a=0;a<r;a++){if(u.inArray(e[a],this.last_cols)===-1){(i||u.noop).call(this,e[a])}}for(a=0;a<s;a++){if(u.inArray(this.last_cols[a],e)===-1){(t||u.noop).call(this,this.last_cols[a])}}this.last_cols=e;return this};s.on_overlapped_row_change=function(i,t){if(!this.colliders_data.length){return this}var e=this.get_targeted_rows(this.colliders_data[0].el.data.row);var s=this.last_rows.length;var r=e.length;var a;for(a=0;a<r;a++){if(u.inArray(e[a],this.last_rows)===-1){(i||u.noop).call(this,e[a])}}for(a=0;a<s;a++){if(u.inArray(this.last_rows[a],e)===-1){(t||u.noop).call(this,this.last_rows[a])}}this.last_rows=e};s.set_player=function(i,t,e){var s=this;if(!e){this.empty_cells_player_occupies()}var r=!e?s.colliders_data[0].el.data:{col:i};var a=r.col;var o=t||r.row;this.player_grid_data={col:a,row:o,size_y:this.player_grid_data.size_y,size_x:this.player_grid_data.size_x};this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);var _=this.get_widgets_overlapped(this.player_grid_data);var h=this.widgets_constraints(_);this.manage_movements(h.can_go_up,a,o);this.manage_movements(h.can_not_go_up,a,o);if(!_.length){var n=this.can_go_player_up(this.player_grid_data);if(n!==false){o=n}this.set_placeholder(a,o)}return{col:a,row:o}};s.widgets_constraints=function(i){var r=u([]);var t;var a=[];var o=[];i.each(u.proxy(function(i,t){var e=u(t);var s=e.coords().grid;if(this.can_go_widget_up(s)){r=r.add(e);a.push(s)}else{o.push(s)}},this));t=i.not(r);return{can_go_up:d.sort_by_row_asc(a),can_not_go_up:d.sort_by_row_desc(o)}};s.manage_movements=function(i,_,h){u.each(i,u.proxy(function(i,t){var e=t;var s=e.el;var r=this.can_go_widget_up(e);if(r){this.move_widget_to(s,r);this.set_placeholder(_,r+e.size_y)}else{var a=this.can_go_player_up(this.player_grid_data);if(!a){var o=h+this.player_grid_data.size_y-e.row;this.move_widget_down(s,o);this.set_placeholder(_,h)}}},this));return this};s.is_player=function(i,t){if(t&&!this.gridmap[i]){return false}var e=t?this.gridmap[i][t]:i;return e&&(e.is(this.$player)||e.is(this.$helper))};s.is_player_in=function(i,t){var e=this.cells_occupied_by_player||{};return u.inArray(i,e.cols)>=0&&u.inArray(t,e.rows)>=0};s.is_placeholder_in=function(i,t){var e=this.cells_occupied_by_placeholder||{};return this.is_placeholder_in_col(i)&&u.inArray(t,e.rows)>=0};s.is_placeholder_in_col=function(i){var t=this.cells_occupied_by_placeholder||[];return u.inArray(i,t.cols)>=0};s.is_empty=function(i,t){if(typeof this.gridmap[i]!=="undefined"){if(typeof this.gridmap[i][t]!=="undefined"&&this.gridmap[i][t]===false){return true}return false}return true};s.is_occupied=function(i,t){if(!this.gridmap[i]){return false}if(this.gridmap[i][t]){return true}return false};s.is_widget=function(i,t){var e=this.gridmap[i];if(!e){return false}e=e[t];if(e){return e}return false};s.is_widget_under_player=function(i,t){if(this.is_widget(i,t)){return this.is_player_in(i,t)}return false};s.get_widgets_under_player=function(t){t||(t=this.cells_occupied_by_player||{cols:[],rows:[]});var s=u([]);u.each(t.cols,u.proxy(function(i,e){u.each(t.rows,u.proxy(function(i,t){if(this.is_widget(e,t)){s=s.add(this.gridmap[e][t])}},this))},this));return s};s.set_placeholder=function(e,s){var r=u.extend({},this.placeholder_grid_data);var i=this.widgets_below({col:r.col,row:r.row,size_y:r.size_y,size_x:r.size_x});var t=e+r.size_x-1;if(t>this.cols){e=e-(t-e)}var a=this.placeholder_grid_data.row<s;var o=this.placeholder_grid_data.col!==e;this.placeholder_grid_data.col=e;this.placeholder_grid_data.row=s;this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data);this.$preview_holder.attr({"data-row":s,"data-col":e});if(a||o){i.each(u.proxy(function(i,t){this.move_widget_up(u(t),this.placeholder_grid_data.col-e+r.size_y)},this))}var _=this.get_widgets_under_player(this.cells_occupied_by_placeholder);if(_.length){_.each(u.proxy(function(i,t){var e=u(t);this.move_widget_down(e,s+r.size_y-e.data("coords").grid.row)},this))}};s.can_go_player_up=function(i){var s=i.row+i.size_y-1;var r=true;var a=[];var o=1e4;var _=this.get_widgets_under_player();this.for_each_column_occupied(i,function(i){var t=this.gridmap[i];var e=s+1;a[i]=[];while(--e>0){if(this.is_empty(i,e)||this.is_player(i,e)||this.is_widget(i,e)&&t[e].is(_)){a[i].push(e);o=e<o?e:o}else{break}}if(a[i].length===0){r=false;return true}a[i].sort(function(i,t){return i-t})});if(!r){return false}return this.get_valid_rows(i,a,o)};s.can_go_widget_up=function(s){var r=s.row+s.size_y-1;var a=true;var o=[];var _=1e4;this.for_each_column_occupied(s,function(i){var t=this.gridmap[i];o[i]=[];var e=r+1;while(--e>0){if(this.is_widget(i,e)&&!this.is_player_in(i,e)){if(!t[e].is(s.el)){break}}if(!this.is_player(i,e)&&!this.is_placeholder_in(i,e)&&!this.is_player_in(i,e)){o[i].push(e)}if(e<_){_=e}}if(o[i].length===0){a=false;return true}o[i].sort(function(i,t){return i-t})});if(!a){return false}return this.get_valid_rows(s,o,_)};s.get_valid_rows=function(i,t,e){var s=i.row;var r=i.row+i.size_y-1;var a=i.size_y;var o=e-1;var _=[];while(++o<=r){var h=true;u.each(t,function(i,t){if(u.isArray(t)&&u.inArray(o,t)===-1){h=false}});if(h===true){_.push(o);if(_.length===a){break}}}var n=false;if(a===1){if(_[0]!==s){n=_[0]||false}}else{if(_[0]!==s){n=this.get_consecutive_numbers_index(_,a)}}return n};s.get_consecutive_numbers_index=function(i,t){var e=i.length;var s=[];var r=true;var a=-1;for(var o=0;o<e;o++){if(r||i[o]===a+1){s.push(o);if(s.length===t){break}r=false}else{s=[];r=true}a=i[o]}return s.length>=t?i[s[0]]:false};s.get_widgets_overlapped=function(){var i;var r=u([]);var a=[];var t=this.cells_occupied_by_player.rows.slice(0);t.reverse();u.each(this.cells_occupied_by_player.cols,u.proxy(function(i,s){u.each(t,u.proxy(function(i,t){if(!this.gridmap[s]){return true}var e=this.gridmap[s][t];if(this.is_occupied(s,t)&&!this.is_player(e)&&u.inArray(e,a)===-1){r=r.add(e);a.push(e)}},this))},this));return r};s.on_start_overlapping_column=function(i){this.set_player(i,false)};s.on_start_overlapping_row=function(i){this.set_player(false,i)};s.on_stop_overlapping_column=function(i){this.set_player(i,false);var e=this;this.for_each_widget_below(i,this.cells_occupied_by_player.rows[0],function(i,t){e.move_widget_up(this,e.player_grid_data.size_y)})};s.on_stop_overlapping_row=function(i){this.set_player(false,i);var e=this;var t=this.cells_occupied_by_player.cols;for(var s=0,r=t.length;s<r;s++){this.for_each_widget_below(t[s],i,function(i,t){e.move_widget_up(this,e.player_grid_data.size_y)})}};s.move_widget_to=function(i,t){var a=this;var e=i.coords().grid;var s=t-e.row;var r=this.widgets_below(i);var o=this.can_move_to(e,e.col,t,i);if(o===false){return false}this.remove_from_gridmap(e);e.row=t;this.add_to_gridmap(e);i.attr("data-row",t);this.$changed=this.$changed.add(i);r.each(function(i,t){var e=u(t);var s=e.coords().grid;var r=a.can_go_widget_up(s);if(r&&r!==s.row){a.move_widget_to(e,r)}});return this};s.move_widget_up=function(r,a){var i=r.coords().grid;var o=i.row;var _=[];var t=true;a||(a=1);if(!this.can_go_up(r)){return false}this.for_each_column_occupied(i,function(i){if(u.inArray(r,_)===-1){var t=r.coords().grid;var e=o-a;e=this.can_go_up_to_row(t,i,e);if(!e){return true}var s=this.widgets_below(r);this.remove_from_gridmap(t);t.row=e;this.add_to_gridmap(t);r.attr("data-row",t.row);this.$changed=this.$changed.add(r);_.push(r);s.each(u.proxy(function(i,t){this.move_widget_up(u(t),a)},this))}})};s.move_widget_down=function(i,t){var e,s,r,a;if(t<=0){return false}e=i.coords().grid;s=e.row;r=[];a=t;if(!i){return false}if(u.inArray(i,r)===-1){var o=i.coords().grid;var _=s+t;var h=this.widgets_below(i);this.remove_from_gridmap(o);h.each(u.proxy(function(i,t){var e=u(t);var s=e.coords().grid;var r=this.displacement_diff(s,o,a);if(r>0){this.move_widget_down(e,r)}},this));o.row=_;this.update_widget_position(o,i);i.attr("data-row",o.row);this.$changed=this.$changed.add(i);r.push(i)}};s.can_go_up_to_row=function(i,t,e){var s=this.gridmap;var r=true;var a=[];var o=i.row;var _;this.for_each_column_occupied(i,function(i){var t=s[i];a[i]=[];_=o;while(_--){if(this.is_empty(i,_)&&!this.is_placeholder_in(i,_)){a[i].push(_)}else{break}}if(!a[i].length){r=false;return true}});if(!r){return false}_=e;for(_=1;_<o;_++){var h=true;for(var n=0,d=a.length;n<d;n++){if(a[n]&&u.inArray(_,a[n])===-1){h=false}}if(h===true){r=_;break}}return r};s.displacement_diff=function(i,t,e){var s=i.row;var r=[];var a=t.row+t.size_y;this.for_each_column_occupied(i,function(i){var t=0;for(var e=a;e<s;e++){if(this.is_empty(i,e)){t=t+1}}r.push(t)});var o=Math.max.apply(Math,r);e=e-o;return e>0?e:0};s.widgets_below=function(i){var t=u.isPlainObject(i)?i:i.coords().grid;var e=this;var s=this.gridmap;var r=t.row+t.size_y-1;var a=u([]);this.for_each_column_occupied(t,function(i){e.for_each_widget_below(i,r,function(i,t){if(!e.is_player(this)&&u.inArray(this,a)===-1){a=a.add(this);return true}})});return d.sort_by_row_asc(a)};s.set_cells_player_occupies=function(i,t){this.remove_from_gridmap(this.placeholder_grid_data);this.placeholder_grid_data.col=i;this.placeholder_grid_data.row=t;this.add_to_gridmap(this.placeholder_grid_data,this.$player);return this};s.empty_cells_player_occupies=function(){this.remove_from_gridmap(this.placeholder_grid_data);return this};s.can_go_up=function(i){var t=i.coords().grid;var e=t.row;var s=e-1;var r=this.gridmap;var a=[];var o=true;if(e===1){return false}this.for_each_column_occupied(t,function(i){var t=this.is_widget(i,s);if(this.is_occupied(i,s)||this.is_player(i,s)||this.is_placeholder_in(i,s)||this.is_player_in(i,s)){o=false;return true}});return o};s.can_move_to=function(s,i,t,e){var r=this.gridmap;var a=s.el;var o={size_y:s.size_y,size_x:s.size_x,col:i,row:t};var _=true;var h=i+s.size_x-1;if(h>this.cols){return false}if(e&&e<t+s.size_y-1){return false}this.for_each_cell_occupied(o,function(i,t){var e=this.is_widget(i,t);if(e&&(!s.el||e.is(a))){_=false}});return _};s.get_targeted_columns=function(i){var t=(i||this.player_grid_data.col)+(this.player_grid_data.size_x-1);var e=[];for(var s=i;s<=t;s++){e.push(s)}return e};s.get_targeted_rows=function(i){var t=(i||this.player_grid_data.row)+(this.player_grid_data.size_y-1);var e=[];for(var s=i;s<=t;s++){e.push(s)}return e};s.get_cells_occupied=function(i){var t={cols:[],rows:[]};var e;if(arguments[1]instanceof u){i=arguments[1].coords().grid}for(e=0;e<i.size_x;e++){var s=i.col+e;t.cols.push(s)}for(e=0;e<i.size_y;e++){var r=i.row+e;t.rows.push(r)}return t};s.for_each_cell_occupied=function(i,e){this.for_each_column_occupied(i,function(t){this.for_each_row_occupied(i,function(i){e.call(this,t,i)})});return this};s.for_each_column_occupied=function(i,t){for(var e=0;e<i.size_x;e++){var s=i.col+e;t.call(this,s,i)}};s.for_each_row_occupied=function(i,t){for(var e=0;e<i.size_y;e++){var s=i.row+e;t.call(this,s,i)}};s._traversing_widgets=function(i,t,e,s,r){var a=this.gridmap;if(!a[e]){return}var o,_;var h=i+"/"+t;if(arguments[2]instanceof u){var n=arguments[2].coords().grid;e=n.col;s=n.row;r=arguments[3]}var d=[];var l=s;var c={"for_each/above":function(){while(l--){if(l>0&&this.is_widget(e,l)&&u.inArray(a[e][l],d)===-1){o=r.call(a[e][l],e,l);d.push(a[e][l]);if(o){break}}}},"for_each/below":function(){for(l=s+1,_=a[e].length;l<_;l++){if(this.is_widget(e,l)&&u.inArray(a[e][l],d)===-1){o=r.call(a[e][l],e,l);d.push(a[e][l]);if(o){break}}}}};if(c[h]){c[h].call(this)}};s.for_each_widget_above=function(i,t,e){this._traversing_widgets("for_each","above",i,t,e);return this};s.for_each_widget_below=function(i,t,e){this._traversing_widgets("for_each","below",i,t,e);return this};s.get_highest_occupied_cell=function(){var i;var t=this.gridmap;var e=t[1].length;var s=[],r=[];var a=[];for(var o=t.length-1;o>=1;o--){for(i=e-1;i>=1;i--){if(this.is_widget(o,i)){s.push(i);r.push(o);break}}}return{col:Math.max.apply(Math,r),row:Math.max.apply(Math,s)}};s.get_widgets_from=function(t,e){var i=this.gridmap;var s=u();if(t){s=s.add(this.$widgets.filter(function(){var i=u(this).attr("data-col");return i===t||i>t}))}if(e){s=s.add(this.$widgets.filter(function(){var i=u(this).attr("data-row");return i===e||i>e}))}return s};s.set_dom_grid_height=function(i){if(typeof i==="undefined"){var t=this.get_highest_occupied_cell().row;i=t*this.min_widget_height}this.container_height=i;this.$el.css("height",this.container_height);return this};s.set_dom_grid_width=function(i){if(typeof i==="undefined"){i=this.get_highest_occupied_cell().col}var t=this.options.autogrow_cols?this.options.max_cols:this.cols;i=Math.min(t,Math.max(i,this.options.min_cols));this.container_width=i*this.min_widget_width;this.$el.css("width",this.container_width);return this};s.generate_stylesheet=function(i){var t="";var e=this.options.max_size_x||this.cols;var s=0;var r=0;var a;var o;i||(i={});i.cols||(i.cols=this.cols);i.rows||(i.rows=this.rows);i.namespace||(i.namespace=this.options.namespace);i.widget_base_dimensions||(i.widget_base_dimensions=this.options.widget_base_dimensions);i.widget_margins||(i.widget_margins=this.options.widget_margins);i.min_widget_width=i.widget_margins[0]*2+i.widget_base_dimensions[0];i.min_widget_height=i.widget_margins[1]*2+i.widget_base_dimensions[1];var _=u.param(i);if(u.inArray(_,d.generated_stylesheets)>=0){return false}this.generated_stylesheets.push(_);d.generated_stylesheets.push(_);for(a=i.cols;a>=0;a--){t+=i.namespace+' [data-col="'+(a+1)+'"] { left:'+(a*i.widget_base_dimensions[0]+a*i.widget_margins[0]+(a+1)*i.widget_margins[0])+"px; }\n"}for(a=i.rows;a>=0;a--){t+=i.namespace+' [data-row="'+(a+1)+'"] { top:'+(a*i.widget_base_dimensions[1]+a*i.widget_margins[1]+(a+1)*i.widget_margins[1])+"px; }\n"}for(var h=1;h<=i.rows;h++){t+=i.namespace+' [data-sizey="'+h+'"] { height:'+(h*i.widget_base_dimensions[1]+(h-1)*(i.widget_margins[1]*2))+"px; }\n"}for(var n=1;n<=e;n++){t+=i.namespace+' [data-sizex="'+n+'"] { width:'+(n*i.widget_base_dimensions[0]+(n-1)*(i.widget_margins[0]*2))+"px; }\n"}this.remove_style_tags();return this.add_style_tag(t)};s.add_style_tag=function(i){var t=document;var e=t.createElement("style");t.getElementsByTagName("head")[0].appendChild(e);e.setAttribute("type","text/css");if(e.styleSheet){e.styleSheet.cssText=i}else{e.appendChild(document.createTextNode(i))}this.$style_tags=this.$style_tags.add(e);return this};s.remove_style_tags=function(){var i=d.generated_stylesheets;var t=this.generated_stylesheets;this.$style_tags.remove();d.generated_stylesheets=u.map(i,function(i){if(u.inArray(i,t)===-1){return i}})};s.generate_faux_grid=function(i,t){this.faux_grid=[];this.gridmap=[];var e;var s;for(e=t;e>0;e--){this.gridmap[e]=[];for(s=i;s>0;s--){this.add_faux_cell(s,e)}}return this};s.add_faux_cell=function(i,t){var e=u({left:this.baseX+(t-1)*this.min_widget_width,top:this.baseY+(i-1)*this.min_widget_height,width:this.min_widget_width,height:this.min_widget_height,col:t,row:i,original_col:t,original_row:i}).coords();if(!u.isArray(this.gridmap[t])){this.gridmap[t]=[]}this.gridmap[t][i]=false;this.faux_grid.push(e);return this};s.add_faux_rows=function(i){var t=this.rows;var e=t+(i||1);for(var s=e;s>t;s--){for(var r=this.cols;r>=1;r--){this.add_faux_cell(s,r)}}this.rows=e;if(this.options.autogenerate_stylesheet){this.generate_stylesheet()}return this};s.add_faux_cols=function(i){var t=this.cols;var e=t+(i||1);e=Math.min(e,this.options.max_cols);for(var s=t+1;s<=e;s++){for(var r=this.rows;r>=1;r--){this.add_faux_cell(r,s)}}this.cols=e;if(this.options.autogenerate_stylesheet){this.generate_stylesheet()}return this};s.recalculate_faux_grid=function(){var i=this.$wrapper.width();this.baseX=(u(window).width()-i)/2;this.baseY=this.$wrapper.offset().top;u.each(this.faux_grid,u.proxy(function(i,t){this.faux_grid[i]=t.update({left:this.baseX+(t.data.col-1)*this.min_widget_width,top:this.baseY+(t.data.row-1)*this.min_widget_height})},this));return this};s.get_widgets_from_DOM=function(){var i=this.$widgets.map(u.proxy(function(i,t){var e=u(t);return this.dom_to_coords(e)},this));i=d.sort_by_row_and_col_asc(i);var t=u(i).map(u.proxy(function(i,t){return this.register_widget(t)||null},this));if(t.length){this.$el.trigger("gridster:positionschanged")}return this};s.generate_grid_and_stylesheet=function(){var i=this.$wrapper.width();var t=this.options.max_cols;var e=Math.floor(i/this.min_widget_width)+this.options.extra_cols;var s=this.$widgets.map(function(){return u(this).attr("data-col")}).get();s.length||(s=[0]);var r=Math.max.apply(Math,s);this.cols=Math.max(r,e,this.options.min_cols);if(t!==Infinity&&t>=r&&t<this.cols){this.cols=t}var a=this.options.extra_rows;this.$widgets.each(function(i,t){a+=+u(t).attr("data-sizey")});this.rows=Math.max(a,this.options.min_rows);this.baseX=(u(window).width()-i)/2;this.baseY=this.$wrapper.offset().top;if(this.options.autogenerate_stylesheet){this.generate_stylesheet()}return this.generate_faux_grid(this.rows,this.cols)};s.destroy=function(i){this.$el.removeData("gridster");u(window).unbind(".gridster");if(this.drag_api){this.drag_api.destroy()}this.remove_style_tags();i&&this.$el.remove();return this};u.fn.gridster=function(i){return this.each(function(){if(!u(this).data("gridster")){u(this).data("gridster",new d(this,i))}})};return d});